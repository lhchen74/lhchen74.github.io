



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CFira%20Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db" />


<link rel="canonical" href="https://lhchen74.github.io/2019/06/06/oracle/">



  <title>
Oracle - manual |
D E W = 露の世</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2019-06-06 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2019-06-06T00:00:00+08:00">2019-06-06</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">D E W</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/anime/index/头文字D.jpg"></li>
          <li class="item" data-background-image="/anime/index/捉妖小红娘-2.jpg"></li>
          <li class="item" data-background-image="/anime/index/哈尔的移动城堡.jpg"></li>
          <li class="item" data-background-image="/anime/index/碧蓝之海.jpg"></li>
          <li class="item" data-background-image="/anime/index/混沌武士-1.jpg"></li>
          <li class="item" data-background-image="/anime/index/龙与虎.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/manual/" itemprop="item" rel="index" title="In manual"><span itemprop="name">manual</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2019/06/06/oracle/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="ddl"><a class="markdownIt-Anchor" href="#ddl">#</a> DDL</h2>
<p><code>DDL(Data Definition Language)</code>  数据定义语言，用于定义和管理 SQL 数据库中的所有对象的语言，包括  <code>CREATE, ALTER, DROP, TRUNCATE, COMMENT, GRANT, REVOKE</code></p>
<h3 id="db-objects"><a class="markdownIt-Anchor" href="#db-objects">#</a> DB Objects</h3>
<table>
<thead>
<tr>
<th>view</th>
<th>functional</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_objects</td>
<td>当前用户通过 DDL 建立的所有对象</td>
</tr>
<tr>
<td>user_tables</td>
<td>当前用户的所有 Table</td>
</tr>
<tr>
<td>user_views</td>
<td>当前用户的所有 View</td>
</tr>
<tr>
<td>user_sequences</td>
<td>当前用户的所有 Sequence</td>
</tr>
<tr>
<td>user_source</td>
<td>当前用户的 Package, Trigger Source</td>
</tr>
<tr>
<td>user_constraints</td>
<td>当前用户的所有 Constraint</td>
</tr>
<tr>
<td>user_indexes</td>
<td>当前用户的所有 Index</td>
</tr>
<tr>
<td>user_errors</td>
<td>当前用户的所有 Error</td>
</tr>
<tr>
<td>user_dependencies</td>
<td>当前用户的所有 Dependencie</td>
</tr>
</tbody>
</table>
<p>使用：判断表是否存在，如果存在就删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  num number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">into</span> num</span><br><span class="line">    <span class="keyword">from</span> user_tables</span><br><span class="line">   <span class="keyword">where</span> table_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  if num <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">execute</span> immediate <span class="string">&#x27;drop table test&#x27;</span>;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p>user_tables 只能查询当前用户的表，如果查询其他  <code>owner</code>  的表需要查询  <code>dba_tables</code>  或者  <code>all_tables</code></p>
<ul>
<li><strong>dba_tables:</strong> describes all relational tables in the database.</li>
<li><strong>all_tables:</strong> describes the relational tables <strong>accessible</strong> to the current user.</li>
<li><strong>user_tables:</strong> describes the relational tables <strong>owned</strong> by the current user.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> dba_tables</span><br><span class="line"> <span class="keyword">where</span> owner <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;ysc&#x27;</span>)</span><br><span class="line">   <span class="keyword">and</span> table_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;som_edi_temp_h&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>使用：查找文本所在 Source</p>
<p>在做 Transact Move Orders 时弹出错误：累计拣货数量超过报关数量。</p>
<ul>
<li>检查 form 的 trigger 没有发现 <strong>累计拣货数量超过报关数量</strong> 相关代码和描述。</li>
<li>在 PL/SQL 中使用  <code>select * from all_source s where s.text like '%累计拣货数量超过报关数量%';</code>  可以在 DB trigger 中找到相关文字，查看 trigger 代码可以看到实际原因是报关资料抄写没有抄写成功。</li>
</ul>
<p><strong>uer_errors</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_div(p1 number, p2 number) </span><br><span class="line">  <span class="keyword">return</span> number</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  l_temp numberx;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">return</span> p1 <span class="operator">/</span> p2;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_errors <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;EDI_DIV&#x27;</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>NAME</th>
<th>TYPE</th>
<th>SEQUENCE</th>
<th>LINE</th>
<th>POSITION</th>
<th>TEXT</th>
<th>ATTRIBUTE</th>
<th>MESSAGE_NUMBER</th>
</tr>
</thead>
<tbody>
<tr>
<td>EDI_DIV</td>
<td>FUNCTION</td>
<td>1</td>
<td>4</td>
<td>10</td>
<td>PLS-00201: identifier ‘NUMBERX’ must be declared</td>
<td>ERROR</td>
<td>201</td>
</tr>
<tr>
<td>EDI_DIV</td>
<td>FUNCTION</td>
<td>2</td>
<td>4</td>
<td>10</td>
<td>PL/SQL: Item ignored</td>
<td>ERROR</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="table-columns"><a class="markdownIt-Anchor" href="#table-columns">#</a> Table Columns</h3>
<p>The  <code>ALL_TABLE_COLUMNS</code>  view filters out system-generated hidden columns and invisible columns.<br>
The  <code>ALL_TAB_COLS</code>  view does not filter out hidden columns and invisible columns.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> all_tab_cols t</span><br><span class="line"> <span class="keyword">where</span> t.table_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;table_name&#x27;</span>)</span><br><span class="line">   <span class="keyword">and</span> t.owner <span class="operator">=</span> <span class="string">&#x27;APPS&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">listagg</span>(t.column_name, <span class="string">&#x27;,&#x27;</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> t.segment_column_id)</span><br><span class="line">  <span class="keyword">from</span> all_tab_cols t</span><br><span class="line"> <span class="keyword">where</span> t.table_name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;table_name&#x27;</span>)</span><br><span class="line">   <span class="keyword">and</span> t.owner <span class="operator">=</span> <span class="string">&#x27;APPS&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="get_ddl"><a class="markdownIt-Anchor" href="#get_ddl">#</a> GET_DDL</h3>
<p>在 Oracle 中，使用  <code>DBMS_METADATA</code>  包中的  <code>GET_DDL</code>  函数来获得对应对象的定义语句。</p>
<p>GET_DDL 函数的定义和参数说明如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DBMS_METADATA.GET_DDL (</span><br><span class="line">    object_type     <span class="keyword">IN</span> VARCHAR2,                           <span class="comment">--对象类型</span></span><br><span class="line">    name            <span class="keyword">IN</span> VARCHAR2,                           <span class="comment">--对象名称</span></span><br><span class="line">    schema          <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,              <span class="comment">--对象所在的Schema，默认为当前用户所在所Schema</span></span><br><span class="line">    version         <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> <span class="string">&#x27;COMPATIBLE&#x27;</span>,      <span class="comment">--对象原数据的版本</span></span><br><span class="line">    model           <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> <span class="string">&#x27;ORACLE&#x27;</span>,          <span class="comment">--原数据的类型默认为ORACLE</span></span><br><span class="line">    transform       <span class="keyword">IN</span> VARCHAR2 <span class="keyword">DEFAULT</span> <span class="string">&#x27;DDL&#x27;</span>)</span><br><span class="line">    <span class="keyword">RETURN</span> <span class="type">CLOB</span>;                                           <span class="comment">--对象的原数据默认以CLOB类型返回</span></span><br></pre></td></tr></table></figure>
<p>GET_DDL 函数使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;TABLE&#x27;</span>, <span class="string">&#x27;ASO_BI_QOT_APRB_MV&#x27;</span>, <span class="string">&#x27;APPS&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;SEQUENCE&#x27;</span>, <span class="string">&#x27;RA_TRX_NUMBER_1000_S&#x27;</span>, <span class="string">&#x27;APPS&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 获取所有sequence的定义</span></span><br><span class="line"><span class="keyword">select</span> dbms_metadata.get_ddl(<span class="string">&#x27;SEQUENCE&#x27;</span>, u.object_name)</span><br><span class="line">  <span class="keyword">from</span> user_objects u</span><br><span class="line"> <span class="keyword">where</span> object_type<span class="operator">=</span><span class="string">&#x27;SEQUENCE&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">--The output not include terminators. </span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   DBMS_METADATA.set_transform_param (DBMS_METADATA.session_transform, <span class="string">&#x27;SQLTERMINATOR&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">   DBMS_METADATA.set_transform_param (DBMS_METADATA.session_transform, <span class="string">&#x27;PRETTY&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"><span class="keyword">select</span> DBMS_METADATA.get_ddl(<span class="string">&#x27;TABLE&#x27;</span>, <span class="string">&#x27;EDI_T&#x27;</span>) <span class="keyword">as</span> output <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> DBMS_METADATA.get_dependent_ddl(<span class="string">&#x27;INDEX&#x27;</span>,<span class="string">&#x27;SOM_EDI_856_HEADER&#x27;</span>,<span class="string">&#x27;YSC&#x27;</span>) <span class="keyword">as</span> output <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> DBMS_METADATA.get_xml(<span class="string">&#x27;TABLE&#x27;</span>, <span class="string">&#x27;EDI_T&#x27;</span>) <span class="keyword">as</span> output <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="db-dynamic-message"><a class="markdownIt-Anchor" href="#db-dynamic-message">#</a> DB Dynamic Message</h3>
<p>以  <code>v$</code>  开头的表一般是 oracle 的系统视图 ，具体存放数据库相关动态信息。</p>
<h4 id="vsession"><a class="markdownIt-Anchor" href="#vsession">#</a> v$session</h4>
<p><code>v$session</code>  是 APPS 用户下面对于  <code>sys.v_$session</code>  视图的同义词。在这个视图中，每一个连接到数据库实例中的 session 都拥有一条记录。包括用户 session 及后台进程如 DBWR，LGWR，arcchiver 等等。v$session 是基础信息视图，用于找寻用户  <code>SID 或 SADDR</code>  。</p>
<h4 id="vsql"><a class="markdownIt-Anchor" href="#vsql">#</a> v$sql</h4>
<p>含有 SQL_TEXT, USERS_OPENING （执行语句的用户数等）</p>
<h4 id="vdatabase"><a class="markdownIt-Anchor" href="#vdatabase">#</a> v$database</h4>
<p>select name from v$database; （返回当前数据库名，例如 TEST）</p>
<h4 id="vversion"><a class="markdownIt-Anchor" href="#vversion">#</a> v$version</h4>
<p>返回数据库版本</p>
<h3 id="create-primary-key-and-index"><a class="markdownIt-Anchor" href="#create-primary-key-and-index">#</a> Create Primary Key and Index</h3>
<p>Designate primay key when create table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> som_edi_861_header (</span><br><span class="line">  header_id       number <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">  document_number varchar2(<span class="number">30</span>),</span><br><span class="line">  document_date   varchar2(<span class="number">8</span>),</span><br><span class="line">  received_date   varchar2(<span class="number">8</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Designate primary key after create table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> som_edi_861_header</span><br><span class="line">  <span class="keyword">add</span> <span class="keyword">constraint</span> som_edi_861_header_pk <span class="keyword">primary</span> key (header_id);</span><br></pre></td></tr></table></figure>
<p>Create index after create table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index som_edi_861_header_n1 <span class="keyword">on</span> som_edi_861_header(document_number);</span><br></pre></td></tr></table></figure>
<h3 id="rename-table-name"><a class="markdownIt-Anchor" href="#rename-table-name">#</a> Rename Table Name</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> SAMP.EMP_ACT <span class="keyword">TO</span> EMPLOYEE_ACT</span><br></pre></td></tr></table></figure>
<h3 id="alter-table-columns"><a class="markdownIt-Anchor" href="#alter-table-columns">#</a> Alter Table Columns</h3>
<table>
<thead>
<tr>
<th>操作</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>更新字段名</td>
<td>alter table table_name <strong>rename column</strong> column_old to column_new</td>
</tr>
<tr>
<td>删除字段</td>
<td>alter table table_name <strong>drop column</strong> column_name</td>
</tr>
<tr>
<td>添加字段并附值</td>
<td>alter table table_name <strong>add column_name</strong> number(1) default 1</td>
</tr>
<tr>
<td>修改字段数据类型</td>
<td>alter table table_name <strong>modify column_name</strong> varchar2(20);</td>
</tr>
<tr>
<td>修改字段值</td>
<td>update table_name set column_name=value where column_name=value;</td>
</tr>
</tbody>
</table>
<h3 id="recover-the-dropped-table"><a class="markdownIt-Anchor" href="#recover-the-dropped-table">#</a> Recover the Dropped Table</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flashback <span class="keyword">table</span> hr.regions_hist <span class="keyword">to</span> before <span class="keyword">drop</span>;</span><br></pre></td></tr></table></figure>
<h3 id="read-only-table"><a class="markdownIt-Anchor" href="#read-only-table">#</a> Read Only Table</h3>
<h4 id="read-only-kekword"><a class="markdownIt-Anchor" href="#read-only-kekword">#</a> Read Only KekWord</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_emp(</span><br><span class="line">  eno number,</span><br><span class="line">  ename varchar2(<span class="number">1000</span>),</span><br><span class="line">  sal number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;Babb&#x27;</span>, <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;Babb Chen&#x27;</span>, <span class="number">9000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_emp read <span class="keyword">only</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">3</span>, <span class="string">&#x27;Babbbbb Chen&#x27;</span>, <span class="number">9000</span>); <span class="comment">--ORA-12081: update operation not allowed on table &quot;APPS&quot;.&quot;EDI_EMP&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_emp read write;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">3</span>, <span class="string">&#x27;Babbbbb Chen&#x27;</span>, <span class="number">9000</span>);</span><br></pre></td></tr></table></figure>
<h4 id="trigger-implements"><a class="markdownIt-Anchor" href="#trigger-implements">#</a> Trigger Implements</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_block_dml_on_emp before</span><br><span class="line"> <span class="keyword">insert</span> <span class="keyword">or</span> update <span class="keyword">or</span> <span class="keyword">delete</span> <span class="keyword">on</span> edi_emp</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  raise_application_error(<span class="number">-20001</span>, <span class="string">&#x27;DML Operation not allowed on EMP&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">4</span>, <span class="string">&#x27;Babbbbb Chennnn&#x27;</span>, <span class="number">9000</span>);</span><br></pre></td></tr></table></figure>
<h4 id="grant-select-only"><a class="markdownIt-Anchor" href="#grant-select-only">#</a> Grant Select Only</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp; </span><br><span class="line"></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span> <span class="keyword">on</span> edi_emp <span class="keyword">to</span> ysc;  </span><br><span class="line"></span><br><span class="line"><span class="comment">--use ysc login</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> apps.edi_emp;</span><br></pre></td></tr></table></figure>
<h3 id="handle-exception-from-constraint"><a class="markdownIt-Anchor" href="#handle-exception-from-constraint">#</a> Handle Exception From Constraint</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  c number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">add</span> <span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key (c); <span class="comment">--ORA-02437: cannot validate (APPS.PK1) - primary key violated</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_exceptions (</span><br><span class="line">  row_id rowid,</span><br><span class="line">  user_name varchar2(<span class="number">30</span>),</span><br><span class="line">  table_name varchar2(<span class="number">30</span>),</span><br><span class="line">  cons_name varchar2(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">add</span> <span class="keyword">constraint</span> pk1 <span class="keyword">primary</span> key (c) exceptions <span class="keyword">into</span> edi_exceptions; <span class="comment">--ORA-02437: cannot validate (APPS.PK1) - primary key violated</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_exceptions;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ROW_ID</th>
<th>USER_NAME</th>
<th>TABLE_NAME</th>
<th>CONS_NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAgRpkAFIAACf+WAAE</td>
<td>APPS</td>
<td>EDI_T</td>
<td>PK1</td>
</tr>
<tr>
<td>AAgRpkAFIAACf+WAAB</td>
<td>APPS</td>
<td>EDI_T</td>
<td>PK1</td>
</tr>
<tr>
<td>AAgRpkAFIAACf+WAAF</td>
<td>APPS</td>
<td>EDI_T</td>
<td>PK1</td>
</tr>
<tr>
<td>AAgRpkAFIAACf+WAAD</td>
<td>APPS</td>
<td>EDI_T</td>
<td>PK1</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t <span class="keyword">where</span> rowid <span class="keyword">in</span> (</span><br><span class="line">  <span class="keyword">select</span> row_id <span class="keyword">from</span> edi_exceptions</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>4</td>
</tr>
</tbody>
</table>
<h3 id="error-logging-table"><a class="markdownIt-Anchor" href="#error-logging-table">#</a> Error Logging Table</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_emp1(</span><br><span class="line">  empno number <span class="keyword">primary</span> key,</span><br><span class="line">  ename varchar2(<span class="number">30</span>),</span><br><span class="line">  doj <span class="type">date</span>,</span><br><span class="line">  sal number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp1 <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;Babb&#x27;</span>, sysdate, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp1 <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;Babb&#x27;</span>, sysdate, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp1 <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;Babb&#x27;</span>, <span class="keyword">null</span>, <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp1 <span class="keyword">values</span>(<span class="number">4</span>, <span class="string">&#x27;Babbbbbbbbbb Chen&#x27;</span>, sysdate, <span class="number">4000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  edi_emp1;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>DOJ</th>
<th>SAL</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Babb</td>
<td>2024-01-06 03:18:55 PM</td>
<td>1000</td>
</tr>
<tr>
<td>2</td>
<td>Babb</td>
<td>2024-01-06 03:18:55 PM</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>Babb</td>
<td></td>
<td>2000</td>
</tr>
<tr>
<td>4</td>
<td>Babbbbbbbbbb Chen</td>
<td>2024-01-06 03:18:56 PM</td>
<td>4000</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_emp2(</span><br><span class="line">  empno number <span class="keyword">primary</span> key,</span><br><span class="line">  ename varchar2(<span class="number">7</span>),  <span class="comment">--edi_emp1 varchar2(30)</span></span><br><span class="line">  doj <span class="type">date</span> <span class="keyword">not</span> <span class="keyword">null</span>,  <span class="comment">--edi_emp1 nullable</span></span><br><span class="line">  sal number <span class="keyword">not</span> <span class="keyword">null</span> <span class="comment">--edi_emp1 nullable</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp2 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp1; <span class="comment">--ORA-01400: cannot insert NULL into (&quot;APPS&quot;.&quot;EDI_EMP2&quot;.&quot;SAL&quot;)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp2;  <span class="comment">--0 rows selected</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_errlog.create_error_log(dml_table_name <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;edi_emp2&#x27;</span>); <span class="comment">--dml_table_name same as target table</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_emp2; <span class="comment">--0 rows selected</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp2 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp1</span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_emp2 reject limit unlimited; </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp2;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>DOJ</th>
<th>SAL</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Babb</td>
<td>2024-01-06 03:18:55 PM</td>
<td>1000</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_emp2;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ORA_ERR_NUMBER$</th>
<th>ORA_ERR_MESG$</th>
<th>ORA_ERR_ROWID$</th>
<th>ORA_ERR_OPTYP$</th>
<th>ORA_ERR_TAG$</th>
<th>EMPNO</th>
<th>ENAME</th>
<th>DOJ</th>
<th>SAL</th>
</tr>
</thead>
<tbody>
<tr>
<td>1400</td>
<td>ORA-01400: cannot insert NULL into (“APPS”.“EDI_EMP2”.“SAL”)</td>
<td></td>
<td>I</td>
<td></td>
<td>2</td>
<td>Babb</td>
<td>06-JAN-24</td>
<td></td>
</tr>
<tr>
<td>1400</td>
<td>ORA-01400: cannot insert NULL into (“APPS”.“EDI_EMP2”.“DOJ”)</td>
<td></td>
<td>I</td>
<td></td>
<td>3</td>
<td>Babb</td>
<td></td>
<td>2000</td>
</tr>
<tr>
<td>12899</td>
<td>ORA-12899: value too large for column “APPS”.“EDI_EMP2”.“ENAME” (actual: 17, maximum: 7)</td>
<td></td>
<td>I</td>
<td></td>
<td>4</td>
<td>Babbbbbbbbbb Chen</td>
<td>06-JAN-24</td>
<td>4000</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> err$_edi_emp2;</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> edi_emp2;</span><br><span class="line"></span><br><span class="line"><span class="comment">--------------------------------------------------------</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp2 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp1</span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_emp2(<span class="string">&#x27;TEST INSERT&#x27;</span>) reject limit unlimited;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp2;</span><br><span class="line"><span class="comment">--------------------------------------------------------</span></span><br><span class="line">update edi_emp2 <span class="keyword">set</span> sal <span class="operator">=</span> <span class="keyword">null</span></span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_emp2(<span class="string">&#x27;TEST UPDATE&#x27;</span>) reject limit unlimited;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp2;</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_row_before_del</span><br><span class="line">before <span class="keyword">delete</span> <span class="keyword">on</span> edi_emp2 <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  lv_number number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  lv_number :<span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> edi_emp2</span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_emp2(<span class="string">&#x27;TEST DELETE&#x27;</span>) reject limit unlimited;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_emp2;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp2;</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_emp1;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_emp2;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> err$_edi_emp2;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> edi_row_before_del;</span><br></pre></td></tr></table></figure>
<h3 id="unusesd-coulumn"><a class="markdownIt-Anchor" href="#unusesd-coulumn">#</a> Unusesd Coulumn</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_test(</span><br><span class="line"> a number,</span><br><span class="line"> b number,</span><br><span class="line"> c number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_test(a, b, c) <span class="keyword">values</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_test <span class="keyword">set</span> unused(c);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_test <span class="keyword">drop</span> unused columns;</span><br></pre></td></tr></table></figure>
<h3 id="virtual-column"><a class="markdownIt-Anchor" href="#virtual-column">#</a> Virtual Column</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_test(</span><br><span class="line"> a number,</span><br><span class="line"> b number,</span><br><span class="line"> c <span class="keyword">as</span> (a <span class="operator">+</span> b)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_test(a, b) <span class="keyword">values</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_test;</span><br></pre></td></tr></table></figure>
<h3 id="dynamic-sql"><a class="markdownIt-Anchor" href="#dynamic-sql">#</a> Dynamic SQL</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t (</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> alter_table_column(table_name  varchar2,</span><br><span class="line">                                               column_name varchar2,</span><br><span class="line">                                               column_type varchar2) <span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;alter table &#x27;</span> <span class="operator">||</span> table_name <span class="operator">||</span> <span class="string">&#x27; modify &#x27;</span> <span class="operator">||</span></span><br><span class="line">                    column_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> column_type;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  alter_table_column(<span class="string">&#x27;edi_t&#x27;</span>, <span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;varchar2(30)&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> alter_table_column;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_tab_name varchar2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;edi_t&#x27;</span>;</span><br><span class="line">  l_id       number :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  l_name     varchar2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;Babb&#x27;</span>;</span><br><span class="line">  l_sql_stmt varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_sql_stmt :<span class="operator">=</span> <span class="string">&#x27;insert into &#x27;</span> <span class="operator">||</span> l_tab_name <span class="operator">||</span> <span class="string">&#x27; values (:id, :name)&#x27;</span>;</span><br><span class="line">  <span class="keyword">execute</span> immediate l_sql_stmt</span><br><span class="line">    <span class="keyword">using</span> l_id, l_name;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_tab_name     varchar2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;edi_t&#x27;</span>;</span><br><span class="line">  l_id           number :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  l_name         varchar2(<span class="number">30</span>) :<span class="operator">=</span> <span class="string">&#x27;Babb Chen&#x27;</span>;</span><br><span class="line">  l_sql_stmt     varchar2(<span class="number">100</span>);</span><br><span class="line">  l_updated_name varchar2(<span class="number">30</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_sql_stmt :<span class="operator">=</span> <span class="string">&#x27;update &#x27;</span> <span class="operator">||</span> l_tab_name <span class="operator">||</span></span><br><span class="line">                <span class="string">&#x27; set name = :1 where id = :2 returning name into :3&#x27;</span>;</span><br><span class="line">  <span class="keyword">execute</span> immediate l_sql_stmt</span><br><span class="line">    <span class="keyword">using</span> l_name, l_id</span><br><span class="line">    returning <span class="keyword">into</span> l_updated_name;</span><br><span class="line">  dbms_output.put_line(l_updated_name);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> edi_update_sal(p_empno number,</span><br><span class="line">                                           p_sal   varchar2,</span><br><span class="line">                                           p_name  <span class="keyword">out</span> varchar2,</span><br><span class="line">                                           p_job   <span class="keyword">out</span> varchar2) <span class="keyword">is</span></span><br><span class="line">  l_sql_stmt varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_sql_stmt :<span class="operator">=</span> <span class="string">&#x27;update edi_t set sal = :1 where empno = :2 returning ename, job into :3, :4&#x27;</span>;</span><br><span class="line">  <span class="keyword">execute</span> immediate l_sql_stmt</span><br><span class="line">    <span class="keyword">using</span> p_sal, p_empno</span><br><span class="line">    returning <span class="keyword">into</span> p_name, p_job;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_sql_block varchar2(<span class="number">100</span>);</span><br><span class="line">  l_name      varchar2(<span class="number">30</span>);</span><br><span class="line">  l_job       varchar2(<span class="number">30</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_sql_block :<span class="operator">=</span> <span class="string">&#x27;begin edi_update_sal(:empno,:sal,:name,:job); end;&#x27;</span>;</span><br><span class="line">  <span class="keyword">execute</span> immediate l_sql_block</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">in</span> <span class="number">7369</span>, <span class="number">9999</span>, <span class="keyword">out</span> l_name, <span class="keyword">out</span> l_job;</span><br><span class="line">  dbms_output.put_line(l_name <span class="operator">||</span> <span class="string">&#x27;:&#x27;</span> <span class="operator">||</span> l_job);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type ref_cursor <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line">  emp_rec_cur ref_cursor;</span><br><span class="line">  emp_rec edi_t<span class="operator">%</span>rowtype;</span><br><span class="line">  l_sql_stmt varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_sql_stmt :<span class="operator">=</span> <span class="string">&#x27;select * from edi_t where deptno = :1&#x27;</span>;</span><br><span class="line">  <span class="keyword">open</span> emp_rec_cur <span class="keyword">for</span> l_sql_stmt <span class="keyword">using</span> <span class="number">10</span>;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_rec_cur <span class="keyword">into</span> emp_rec;</span><br><span class="line">    exit <span class="keyword">when</span> emp_rec_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(emp_rec.empno <span class="operator">||</span> <span class="string">&#x27;-&#x27;</span> <span class="operator">||</span> emp_rec.ename);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> emp_rec_cur;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;update edi_t set mgr = :1 where empno = :2&#x27;</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">null</span>, <span class="number">7369</span>; <span class="comment">--PLS-00457: expressions have to be of SQL types</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;update edi_t set mgr = :1 where empno = :2&#x27;</span></span><br><span class="line">    <span class="keyword">using</span> <span class="string">&#x27;&#x27;</span>, <span class="number">7369</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="foreign-key-refer-to-primary-key-in-same-table"><a class="markdownIt-Anchor" href="#foreign-key-refer-to-primary-key-in-same-table">#</a> Foreign key refer to primary key in same table</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_emp(</span><br><span class="line">  emp_id number <span class="keyword">primary</span> key,</span><br><span class="line">  emp_name varchar2(<span class="number">100</span>),</span><br><span class="line">  mgr_id number <span class="keyword">references</span> edi_emp(emp_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;Babb&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;Babbb&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">3</span>, <span class="string">&#x27;Babbc&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp <span class="keyword">values</span> (<span class="number">4</span>, <span class="string">&#x27;Babb Chen&#x27;</span>, <span class="number">5</span>); <span class="comment">--ORA-02291: integrity constraint (APPS.SYS_C001459559) violated - parent key not found</span></span><br></pre></td></tr></table></figure>
<h3 id="the-number-of-rows-affected"><a class="markdownIt-Anchor" href="#the-number-of-rows-affected">#</a> The number of rows affected</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  n number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t </span><br><span class="line"><span class="keyword">select</span> level</span><br><span class="line">  <span class="keyword">from</span> dual </span><br><span class="line"><span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>N</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>4</td>
</tr>
<tr>
<td>5</td>
</tr>
<tr>
<td>6</td>
</tr>
<tr>
<td>7</td>
</tr>
<tr>
<td>8</td>
</tr>
<tr>
<td>9</td>
</tr>
<tr>
<td>10</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  update edi_t <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">+</span> <span class="number">10</span>;</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Rows Effected: &#x27;</span> <span class="operator">||</span> <span class="keyword">sql</span><span class="operator">%</span>rowcount);</span><br><span class="line">  <span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--Rows Effected: 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">100</span>);</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Rows Effected: &#x27;</span> <span class="operator">||</span> <span class="keyword">sql</span><span class="operator">%</span>rowcount);</span><br><span class="line">  <span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--Rows Effected: 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type l_number_list_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> number;</span><br><span class="line">  l_number_list l_number_list_type :<span class="operator">=</span> l_number_list_type();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> n </span><br><span class="line">    bulk <span class="keyword">collect</span> <span class="keyword">into</span> l_number_list</span><br><span class="line">    <span class="keyword">from</span> edi_t;</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="keyword">sql</span><span class="operator">%</span>rowcount);</span><br><span class="line">  dbms_output.put_line(l_number_list.count);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--10</span></span><br><span class="line"><span class="comment">--10</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  lv_count number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  update edi_t <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">+</span> <span class="number">10</span></span><br><span class="line">  returning <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">into</span> lv_count;</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Rows Effected: &#x27;</span> <span class="operator">||</span> lv_count);</span><br><span class="line">  <span class="keyword">rollback</span>;</span><br><span class="line">  <span class="comment">--Rows Effected: 10</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  lv_number number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">100</span>)</span><br><span class="line">  returning <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">into</span> lv_number;  <span class="comment">--PL/SQL: ORA-00934: group function is not allowed here</span></span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(lv_number);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  lv_number number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">100</span>)</span><br><span class="line">  returning n <span class="keyword">into</span> lv_number;</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(lv_number);</span><br><span class="line">  <span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--100</span></span><br></pre></td></tr></table></figure>
<h3 id="trigger-on-delete-and-truncate"><a class="markdownIt-Anchor" href="#trigger-on-delete-and-truncate">#</a> Trigger on Delete and Truncate</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(name varchar2(<span class="number">30</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;scott&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;babb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_del_trg before</span><br><span class="line">  <span class="keyword">delete</span> <span class="keyword">on</span> edi_t</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  raise_application_error(<span class="number">-20001</span>, <span class="string">&#x27;Deletion not allowed&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> edi_t;  <span class="comment">--ORA-20001: Deletion not allowed</span></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> edi_t;  <span class="comment">--ORA-20001: Truncate not allowed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t; </span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(name varchar2(<span class="number">30</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;scott&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;babb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_truncate_trg before</span><br><span class="line">  <span class="keyword">truncate</span> <span class="keyword">on</span> schema</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if ora_dict_obj_name <span class="operator">=</span> <span class="string">&#x27;EDI_T&#x27;</span> <span class="keyword">and</span> ora_dict_obj_type <span class="operator">=</span> <span class="string">&#x27;TABLE&#x27;</span> <span class="keyword">then</span></span><br><span class="line">    raise_application_error(<span class="number">-20001</span>, <span class="string">&#x27;Truncate not allowed&#x27;</span>);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> edi_t; </span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> edi_t; <span class="comment">--ORA-20001: Truncate not allowed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br><span class="line"><span class="comment">--drop trigger edi_truncate_trg;</span></span><br></pre></td></tr></table></figure>
<h3 id="instead-of-trigger"><a class="markdownIt-Anchor" href="#instead-of-trigger">#</a> Instead of trigger</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_emp <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_dept <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.dept;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> edi_emp_dept_v </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"> <span class="keyword">select</span> e.empno, e.ename, e.job, e.mgr,</span><br><span class="line">        e.hiredate, e.sal, e.deptno, d.dname</span><br><span class="line">   <span class="keyword">from</span> edi_emp e, edi_dept d</span><br><span class="line">  <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp_dept_v(EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, DEPTNO, DNAME)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1001</span>, <span class="string">&#x27;BABB&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>, <span class="string">&#x27;JBN&#x27;</span>, sysdate, <span class="number">1000</span>, <span class="number">60</span>, <span class="string">&#x27;IA&#x27;</span>);  <span class="comment">--ORA-01779: cannot modify a column which maps to a non key-preserved table</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_emp_dept_v_trg </span><br><span class="line">  instead <span class="keyword">of</span> <span class="keyword">insert</span> <span class="keyword">on</span> edi_emp_dept_v</span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_check_exists number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">into</span> l_check_exists</span><br><span class="line">    <span class="keyword">from</span> edi_dept </span><br><span class="line">   <span class="keyword">where</span> deptno <span class="operator">=</span> :new.deptno;</span><br><span class="line">    </span><br><span class="line">  if l_check_exists <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_dept(deptno, dname) <span class="keyword">values</span> (:new.deptno, :new.dname);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">into</span> l_check_exists</span><br><span class="line">    <span class="keyword">from</span> edi_emp</span><br><span class="line">   <span class="keyword">where</span> empno <span class="operator">=</span> :new.empno;</span><br><span class="line">    </span><br><span class="line">  if l_check_exists <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_emp(EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, DEPTNO) </span><br><span class="line">    <span class="keyword">values</span> (:new.EMPNO, :new.ENAME, :new.JOB, :new.MGR, :new.HIREDATE, :new.SAL, :new.DEPTNO);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_emp_dept_v(EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, DEPTNO, DNAME)</span><br><span class="line"><span class="keyword">values</span> (<span class="number">1001</span>, <span class="string">&#x27;BABB&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>, <span class="number">7839</span>, sysdate, <span class="number">1000</span>, <span class="number">60</span>, <span class="string">&#x27;IA&#x27;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_dept;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>DEPTNO</th>
<th>DNAME</th>
<th>LOC</th>
</tr>
</thead>
<tbody>
<tr>
<td>10</td>
<td>ACCOUNTING</td>
<td>NEW YORK</td>
</tr>
<tr>
<td>20</td>
<td>RESEARCH</td>
<td>DALLAS</td>
</tr>
<tr>
<td>30</td>
<td>SALES</td>
<td>CHICAGO</td>
</tr>
<tr>
<td>40</td>
<td>OPERATIONS</td>
<td>BOSTON</td>
</tr>
<tr>
<td><strong>60</strong></td>
<td><strong>IA</strong></td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_emp;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>JOB</th>
<th>MGR</th>
<th>HIREDATE</th>
<th>SAL</th>
<th>COMM</th>
<th>DEPTNO</th>
</tr>
</thead>
<tbody>
<tr>
<td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600.00</td>
<td>300.00</td>
<td>30</td>
</tr>
<tr>
<td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250.00</td>
<td>500.00</td>
<td>30</td>
</tr>
<tr>
<td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250.00</td>
<td>1400.00</td>
<td>30</td>
</tr>
<tr>
<td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850.00</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td></td>
<td>1981-11-17</td>
<td>5000.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500.00</td>
<td>0.00</td>
<td>30</td>
</tr>
<tr>
<td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950.00</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td><strong>1001</strong></td>
<td><strong>BABB</strong></td>
<td><strong>IT</strong></td>
<td><strong>7839</strong></td>
<td><strong>2024-01-08 07:59:46 PM</strong></td>
<td><strong>1000.00</strong></td>
<td></td>
<td><strong>60</strong></td>
</tr>
</tbody>
</table>
<h3 id="constraint"><a class="markdownIt-Anchor" href="#constraint">#</a> Constraint</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">30</span>),</span><br><span class="line">  course_id number,</span><br><span class="line">  course_completed varchar2(<span class="number">1</span>),</span><br><span class="line">  course_complete_date <span class="type">date</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">constraint</span> c1</span><br><span class="line"><span class="keyword">check</span> (</span><br><span class="line">  (nvl(course_completed, <span class="string">&#x27;N&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span> <span class="keyword">and</span> course_complete_date <span class="keyword">is</span> <span class="keyword">null</span>)</span><br><span class="line">  <span class="keyword">or</span> </span><br><span class="line">  (nvl(course_completed, <span class="string">&#x27;N&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> <span class="keyword">and</span> course_complete_date <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;babb&#x27;</span>, <span class="number">1001</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="keyword">null</span>); <span class="comment">--ORA-02290: check constraint (APPS.C1) violated</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;babb&#x27;</span>, <span class="number">1001</span>, <span class="keyword">null</span>, sysdate); <span class="comment">--ORA-02290: check constraint (APPS.C1) violated</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;babb&#x27;</span>, <span class="number">1001</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;aabb&#x27;</span>, <span class="number">1002</span>, <span class="string">&#x27;Y&#x27;</span>, sysdate);</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t (</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">30</span>),</span><br><span class="line">  job varchar2(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;babb&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;aabb&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>, <span class="string">&#x27;babb chen&#x27;</span>, <span class="string">&#x27;CEO&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">unique</span> index i1 <span class="keyword">on</span> </span><br><span class="line">  edi_t (</span><br><span class="line">    <span class="keyword">case</span> <span class="keyword">when</span> job <span class="operator">=</span> <span class="string">&#x27;CEO&#x27;</span> <span class="keyword">then</span> job</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">null</span> <span class="keyword">end</span></span><br><span class="line">  );</span><br><span class="line">  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">4</span>, <span class="string">&#x27;BC&#x27;</span>, <span class="string">&#x27;CEO&#x27;</span>);  <span class="comment">--ORA-00001: unique constraint (APPS.I1) violated</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">4</span>, <span class="string">&#x27;BC&#x27;</span>, <span class="string">&#x27;IT&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br></pre></td></tr></table></figure>
<h3 id="use-ddl-and-dml-inside-function"><a class="markdownIt-Anchor" href="#use-ddl-and-dml-inside-function">#</a> Use DDL and DML inside function</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(c1 number);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_fn <span class="keyword">return</span> number</span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  update edi_t <span class="keyword">set</span> c1 <span class="operator">=</span> c1;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> edi_t_fn <span class="keyword">from</span> dual; <span class="comment">--ORA-14551: cannot perform a DML operation inside a query </span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_fn <span class="keyword">return</span> number</span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">  pragma autonomous_transaction;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  update edi_t <span class="keyword">set</span> c1 <span class="operator">=</span> c1;</span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> edi_t_fn <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EDI_T_FN</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_fn <span class="keyword">return</span> number</span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">  pragma autonomous_transaction;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;create table edi_t1(id number)&#x27;</span>;</span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;insert into edi_t1 values (1)&#x27;</span>;</span><br><span class="line">  <span class="comment">--execute immediate &#x27;drop table edi_t1&#x27;;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"><span class="keyword">select</span> edi_t_fn <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t1;</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br><span class="line"><span class="comment">--drop function edi_t_fn;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="deferrable-novalidate"><a class="markdownIt-Anchor" href="#deferrable-novalidate">#</a> Deferrable novalidate</h3>
<p>Deferrable novalidate can make “primary key” creates NONUNIQUE index.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t( </span><br><span class="line">  <span class="keyword">no</span> number,</span><br><span class="line">  name varchar2(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t</span><br><span class="line"><span class="keyword">select</span> level, chr(ascii(<span class="string">&#x27;A&#x27;</span>) <span class="operator">-</span> <span class="number">1</span> <span class="operator">+</span> level)</span><br><span class="line">  <span class="keyword">from</span> dual <span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> <span class="number">5</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;AA&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>NO</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1</strong></td>
<td><strong>A</strong></td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
</tr>
<tr>
<td><strong>1</strong></td>
<td><strong>AA</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">add</span> <span class="keyword">constraint</span> no_pk <span class="keyword">primary</span> key(<span class="keyword">no</span>); <span class="comment">--ORA-02437: cannot validate (APPS.NO_PK) - primary key violated</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">add</span> <span class="keyword">constraint</span> no_pk <span class="keyword">primary</span> key(<span class="keyword">no</span>) deferrable novalidate;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;AAA&#x27;</span>);  <span class="comment">--ORA-00001: unique constraint (APPS.NO_PK) violated</span></span><br><span class="line">update edi_t <span class="keyword">set</span> <span class="keyword">no</span> <span class="operator">=</span> <span class="number">2</span> <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span>; <span class="comment">--ORA-00001: unique constraint (APPS.NO_PK) violated</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> u.uniqueness, u.<span class="operator">*</span> <span class="keyword">from</span> user_indexes u <span class="keyword">where</span> u.table_name <span class="operator">=</span> <span class="string">&#x27;EDI_T&#x27;</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th><strong>UNIQUENESS</strong></th>
<th>INDEX_NAME</th>
<th>INDEX_TYPE</th>
<th>TABLE_OWNER</th>
<th>TABLE_NAME</th>
<th>TABLE_TYPE</th>
<th>UNIQUENESS</th>
<th>COMPRESSION</th>
<th>PREFIX_LENGTH</th>
<th>TABLESPACE_NAME</th>
<th>INI_TRANS</th>
<th>MAX_TRANS</th>
<th>INITIAL_EXTENT</th>
<th>NEXT_EXTENT</th>
<th>MIN_EXTENTS</th>
<th>MAX_EXTENTS</th>
<th>PCT_INCREASE</th>
<th>PCT_THRESHOLD</th>
<th>INCLUDE_COLUMN</th>
<th>FREELISTS</th>
<th>FREELIST_GROUPS</th>
<th>PCT_FREE</th>
<th>LOGGING</th>
<th>BLEVEL</th>
<th>LEAF_BLOCKS</th>
<th>DISTINCT_KEYS</th>
<th>AVG_LEAF_BLOCKS_PER_KEY</th>
<th>AVG_DATA_BLOCKS_PER_KEY</th>
<th>CLUSTERING_FACTOR</th>
<th>STATUS</th>
<th>NUM_ROWS</th>
<th>SAMPLE_SIZE</th>
<th>LAST_ANALYZED</th>
<th>DEGREE</th>
<th>INSTANCES</th>
<th>PARTITIONED</th>
<th>TEMPORARY</th>
<th>GENERATED</th>
<th>SECONDARY</th>
<th>BUFFER_POOL</th>
<th>FLASH_CACHE</th>
<th>CELL_FLASH_CACHE</th>
<th>USER_STATS</th>
<th>DURATION</th>
<th>PCT_DIRECT_ACCESS</th>
<th>ITYP_OWNER</th>
<th>ITYP_NAME</th>
<th>PARAMETERS</th>
<th>GLOBAL_STATS</th>
<th>DOMIDX_STATUS</th>
<th>DOMIDX_OPSTATUS</th>
<th>FUNCIDX_STATUS</th>
<th>JOIN_INDEX</th>
<th>IOT_REDUNDANT_PKEY_ELIM</th>
<th>DROPPED</th>
<th>VISIBILITY</th>
<th>DOMIDX_MANAGEMENT</th>
<th>SEGMENT_CREATED</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>NONUNIQUE</strong></td>
<td>NO_PK</td>
<td>NORMAL</td>
<td>APPS</td>
<td>EDI_T</td>
<td>TABLE</td>
<td>NONUNIQUE</td>
<td>DISABLED</td>
<td></td>
<td>APPS_TS_TX_DATA</td>
<td>2</td>
<td>255</td>
<td>131072</td>
<td>131072</td>
<td>1</td>
<td>2147483645</td>
<td>0</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>10</td>
<td>YES</td>
<td>0</td>
<td>1</td>
<td>5</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>VALID</td>
<td>6</td>
<td>6</td>
<td>2024-01-09 11:15:27 AM</td>
<td>1</td>
<td>1</td>
<td>NO</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>DEFAULT</td>
<td>DEFAULT</td>
<td>DEFAULT</td>
<td>NO</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>NO</td>
<td></td>
<td></td>
<td></td>
<td>NO</td>
<td>NO</td>
<td>NO</td>
<td>VISIBLE</td>
<td></td>
<td>YES</td>
</tr>
</tbody>
</table>
<h3 id="the-difference-between-varchar210-varchar210-byte-and-varchar210-char"><a class="markdownIt-Anchor" href="#the-difference-between-varchar210-varchar210-byte-and-varchar210-char">#</a> The Difference between varchar2(10), varchar2(10 byte) and varchar2(10 char)</h3>
<ul>
<li><code>VARCHAR2(10 byte)</code>  will support up to 10 bytes of data, which could be as few as two characters in a multi-byte character sets.</li>
<li><code>VARCHAR2(10 char)</code>  could support as much as 40 bytes of information and will support to up 10 characters of data.</li>
<li><code>VARCHAR2(10)</code>  uses the current value of NLS_LENGTH_SEMANTICS to determine the limit for the string. incase of byte, then it’s 10 bytes. incase of char, then it’s 10 characters.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">FROM</span> NLS_DATABASE_PARAMETERS </span><br><span class="line"> <span class="keyword">WHERE</span> <span class="keyword">parameter</span><span class="operator">=</span><span class="string">&#x27;NLS_LENGTH_SEMANTICS&#x27;</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PARAMETER</th>
<th>VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>NLS_LENGTH_SEMANTICS</td>
<td>BYTE</td>
</tr>
</tbody>
</table>
<h2 id="dml"><a class="markdownIt-Anchor" href="#dml">#</a> DML</h2>
<p><code>DML(Data Manipulation Language)</code>  数据操纵语言，SQL 中处理数据等操作统称为数据操纵语言，包括  <code>SELECT, INSERT, UPDATE, DELETE, CALL, EXPLAIN PLAN, LOCK TABLE</code></p>
<h3 id="select-1"><a class="markdownIt-Anchor" href="#select-1">#</a> Select 1</h3>
<p><code>select 1 from table</code>  用于判断是否存在满足条件的数据，如果有都返回 1，类似于  <code>select anyCol from table</code>  一般用于判断结果集是否存在。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">update som_edi_so_import_temp esit</span><br><span class="line">   <span class="keyword">set</span> esit.ret_code          <span class="operator">=</span> <span class="string">&#x27;E&#x27;</span></span><br><span class="line"> <span class="keyword">where</span> esit.ret_code <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">   <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span> (</span><br><span class="line">       <span class="keyword">select</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">from</span> hr_operating_units hou</span><br><span class="line">        <span class="keyword">where</span> hou.name <span class="operator">=</span> esit.ou_name);</span><br></pre></td></tr></table></figure>
<h3 id="select-into"><a class="markdownIt-Anchor" href="#select-into">#</a> Select Into</h3>
<p>当在 PL_SQL 中执行  <code>SELECT ... INTO ...</code>  语句时，如果返回结果集为空，则回触发  <code>NO_DATA_FOUND</code>  错误；<br>
但是当 SELECT 中有字段用到  <code>max, min, sum</code>  等聚合函数时，即使结果集为空，也不会触发  <code>NO_DATA_FOUND</code>  错误， 因为聚合函数  <code>max, sum</code>  在处理的时候如果不存在结果集会自动引入  <code>null</code>  。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当执行该存储过程时，会提示错误</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> RD.EXCEPTION_TEST <span class="keyword">IS</span></span><br><span class="line">test   <span class="type">date</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> END_TIME</span><br><span class="line">    <span class="keyword">INTO</span>   test</span><br><span class="line">    <span class="keyword">FROM</span>   RD.R_LINE_STOP_TIME</span><br><span class="line">    <span class="keyword">WHERE</span>  rownum <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> EXCEPTION_TEST;</span><br><span class="line"><span class="comment">--ORA-01403: no data found</span></span><br><span class="line"><span class="comment">--ORA-06512: at &quot;RD.EXCEPTION_TEST&quot;, line 17</span></span><br><span class="line"><span class="comment">--ORA-06512: at line 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--当执行带有函数的存储过程时，则并不会报 no data found 异常.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> RD.EXCEPTION_TEST <span class="keyword">IS</span></span><br><span class="line">test    <span class="type">date</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">max</span>(END_TIME)</span><br><span class="line">      <span class="keyword">INTO</span> test</span><br><span class="line">      <span class="keyword">FROM</span> RD.R_LINE_STOP_TIME</span><br><span class="line">    <span class="keyword">WHERE</span> rownum <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> EXCEPTION_TEST;</span><br></pre></td></tr></table></figure>
<p>注意，当 <code>SELECT ... INTO ...</code>  触发 ORA-01422: exact fetch returns more than requested number of rows 异常时，会将第一个结果插入，如下虽然产生了异常，后续 l_number 的值为 1.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_number number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">      <span class="keyword">into</span> l_number</span><br><span class="line">      <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual);</span><br><span class="line">  exception</span><br><span class="line">    <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">      dbms_output.put_line(sqlerrm);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  dbms_output.put_line(l_number);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--ORA-01422: exact fetch returns more than requested number of rows</span></span><br><span class="line"><span class="comment">--1</span></span><br></pre></td></tr></table></figure>
<h3 id="scalar-subqueries"><a class="markdownIt-Anchor" href="#scalar-subqueries">#</a> Scalar Subqueries</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_table <span class="keyword">VALUES</span> ((<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> dual), <span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Substr((<span class="keyword">SELECT</span> <span class="string">&#x27;ABC&#x27;</span> <span class="keyword">FROM</span> dual), <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="explicit-defaults"><a class="markdownIt-Anchor" href="#explicit-defaults">#</a> Explicit Defaults</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_table <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;OWNER&#x27;</span>, <span class="keyword">DEFAULT</span>, <span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line">UPDATE my_table <span class="keyword">SET</span> column1 <span class="operator">=</span> <span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>
<h3 id="insert-into"><a class="markdownIt-Anchor" href="#insert-into">#</a> Insert Into</h3>
<p>select 语句如果查询不到数据，insert into 不会产生异常</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> babb_temp(si) <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<h3 id="insert-mutiple"><a class="markdownIt-Anchor" href="#insert-mutiple">#</a> Insert Mutiple</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> babb_test_over(name,class,score)</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="number">45</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="number">55</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">74</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="number">99</span> <span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>
<h3 id="multitable-inserts-insert-all-and-insert-first"><a class="markdownIt-Anchor" href="#multitable-inserts-insert-all-and-insert-first">#</a> Multitable Inserts Insert All and Insert First</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  c varchar2(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t; </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t3 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t; </span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">all</span> </span><br><span class="line">  <span class="keyword">into</span> edi_t1 <span class="keyword">values</span>(c)</span><br><span class="line">  <span class="keyword">into</span> edi_t2 <span class="keyword">values</span>(c)</span><br><span class="line">  <span class="keyword">into</span> edi_t3 <span class="keyword">values</span>(c)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> edi_t;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t1;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t2;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t1;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t2;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t3;</span><br><span class="line"><span class="comment">----------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e(</span><br><span class="line">  ename varchar2(<span class="number">20</span>),</span><br><span class="line">  edeptno number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e10 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e20 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Babb&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Yoyo&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Owen&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Julian&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Rice&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">all</span> </span><br><span class="line">  <span class="keyword">when</span> edeptno <span class="operator">=</span> <span class="number">10</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">into</span> edi_e10 <span class="keyword">values</span>(ename, edeptno)</span><br><span class="line">  <span class="keyword">when</span> edeptno <span class="operator">=</span> <span class="number">20</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">into</span> edi_e20 <span class="keyword">values</span>(ename, edeptno)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> edi_e;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e10;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e20;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e10;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e20;</span><br><span class="line"></span><br><span class="line"><span class="comment">------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e(</span><br><span class="line">  ename varchar2(<span class="number">20</span>),</span><br><span class="line">  salary number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e_low_sal <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e_mid_sal <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_e_high_sal <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Babb&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Yoyo&#x27;</span>, <span class="number">2000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Owen&#x27;</span>, <span class="number">3000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Julian&#x27;</span>, <span class="number">4000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_e <span class="keyword">values</span> (<span class="string">&#x27;Rice&#x27;</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*insert all</span></span><br><span class="line"><span class="comment">  when salary &lt;= 2000 then</span></span><br><span class="line"><span class="comment">    into edi_e_low_sal values (ename, salary)</span></span><br><span class="line"><span class="comment">  when salary &gt; 2000 and salary &lt;= 4000 then</span></span><br><span class="line"><span class="comment">    into edi_e_mid_sal values (ename, salary)</span></span><br><span class="line"><span class="comment">  else</span></span><br><span class="line"><span class="comment">    into edi_e_high_sal values (ename, salary)</span></span><br><span class="line"><span class="comment">select *</span></span><br><span class="line"><span class="comment">  from edi_e;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">first</span> <span class="comment">--找到符合条件的就不再继续往下走</span></span><br><span class="line">  <span class="keyword">when</span> salary <span class="operator">&lt;=</span> <span class="number">2000</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">into</span> edi_e_low_sal <span class="keyword">values</span> (ename, salary)</span><br><span class="line">  <span class="keyword">when</span> salary <span class="operator">&lt;=</span> <span class="number">4000</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">into</span> edi_e_mid_sal <span class="keyword">values</span> (ename, salary)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">into</span> edi_e_high_sal <span class="keyword">values</span> (ename, salary)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> edi_e;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e_low_sal;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e_mid_sal;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_e_high_sal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e_low_sal;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e_mid_sal;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_e_high_sal;</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_region_sales(</span><br><span class="line">  prod_id varchar2(<span class="number">10</span>),</span><br><span class="line">  apac number,</span><br><span class="line">  canada number,</span><br><span class="line">  euro number,</span><br><span class="line">  us number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_region_sales <span class="keyword">values</span> (<span class="string">&#x27;PROD1&#x27;</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_region_sales <span class="keyword">values</span> (<span class="string">&#x27;PROD2&#x27;</span>, <span class="number">500</span> , <span class="number">600</span>, <span class="number">700</span>, <span class="number">800</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_region_sales;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_region_sales_row_wise(</span><br><span class="line">  prod_id varchar2(<span class="number">10</span>),</span><br><span class="line">  region_name varchar2(<span class="number">100</span>),</span><br><span class="line">  sales_numbers number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_region_sales_row_wise</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">from</span> edi_region_sales</span><br><span class="line">unpivot (column_value <span class="keyword">for</span> column_name <span class="keyword">in</span> (apac, canada, euro, us));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_region_sales_row_wise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">into</span> edi_region_sales_row_wise <span class="keyword">values</span> (prod_id, <span class="string">&#x27;APAC&#x27;</span>, apac)</span><br><span class="line">  <span class="keyword">into</span> edi_region_sales_row_wise <span class="keyword">values</span> (prod_id, <span class="string">&#x27;CANADA&#x27;</span>, canada)</span><br><span class="line">  <span class="keyword">into</span> edi_region_sales_row_wise <span class="keyword">values</span> (prod_id, <span class="string">&#x27;EURO&#x27;</span>, euro)</span><br><span class="line">  <span class="keyword">into</span> edi_region_sales_row_wise <span class="keyword">values</span> (prod_id, <span class="string">&#x27;US&#x27;</span>, us)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> edi_region_sales;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_region_sales;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_region_sales_row_wise;</span><br></pre></td></tr></table></figure>
<h3 id="insert-string-date"><a class="markdownIt-Anchor" href="#insert-string-date">#</a> Insert String Date</h3>
<p><code>ALTER SESSION SET nls_date_format = 'YYYY-MM-DD' </code></p>
<p><code>ALTER SESSION SET nls_timestamp_format = 'YYYY-MM-DD HH24:MI:SS.FF'</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建日历表calendar</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> calendar(</span><br><span class="line">  id             <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 日历编号</span></span><br><span class="line">  calendar_date  <span class="type">DATE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span>, <span class="comment">-- 日历日期</span></span><br><span class="line">  calendar_year  <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 日历年</span></span><br><span class="line">  calendar_month <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 日历月</span></span><br><span class="line">  calendar_day   <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 日历日</span></span><br><span class="line">  is_work_day    <span class="type">VARCHAR</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;Y&#x27;</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="comment">-- 是否工作日</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建考勤记录表attendance</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> attendance(</span><br><span class="line">  id         <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY, <span class="comment">-- 考勤记录编号</span></span><br><span class="line">  check_date <span class="type">DATE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 考勤日期</span></span><br><span class="line">  emp_id     <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 员工编号</span></span><br><span class="line">  clock_in   <span class="type">TIMESTAMP</span>, <span class="comment">-- 上班打卡时间</span></span><br><span class="line">  clock_out  <span class="type">TIMESTAMP</span>, <span class="comment">-- 下班打卡时间</span></span><br><span class="line">  <span class="keyword">CONSTRAINT</span> uk_attendance <span class="keyword">UNIQUE</span> (check_date, emp_id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ALTER SESSION SET nls_date_format = &#x27;YYYY-MM-DD&#x27;;</span></span><br><span class="line"><span class="comment">-- ALTER SESSION SET nls_timestamp_format = &#x27;YYYY-MM-DD HH24:MI:SS.FF&#x27;;</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;2021-01-01&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">&#x27;2021-01-02&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">3</span>,<span class="string">&#x27;2021-01-03&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">4</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">5</span>,<span class="string">&#x27;2021-01-05&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> calendar <span class="keyword">VALUES</span> (<span class="number">6</span>,<span class="string">&#x27;2021-01-06&#x27;</span>,<span class="number">2021</span>,<span class="number">1</span>,<span class="number">6</span>,<span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;2021-01-04 08:34:02.374&#x27;</span>,<span class="string">&#x27;2021-01-04 18:33:11.842&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2021-01-04 08:10:31.367&#x27;</span>,<span class="string">&#x27;2021-01-04 19:11:59.19&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">3</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;2021-01-04 08:54:08.807&#x27;</span>,<span class="string">&#x27;2021-01-04 18:27:21.348&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">4</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">4</span>,<span class="string">&#x27;2021-01-04 08:27:55.39&#x27;</span>,<span class="string">&#x27;2021-01-04 18:10:16.862&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">5</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;2021-01-04 08:39:34.557&#x27;</span>,<span class="string">&#x27;2021-01-04 18:36:10.973&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> attendance <span class="keyword">VALUES</span> (<span class="number">6</span>,<span class="string">&#x27;2021-01-04&#x27;</span>,<span class="number">6</span>,<span class="string">&#x27;2021-01-04 08:32:34.859&#x27;</span>,<span class="string">&#x27;2021-01-04 19:29:04.401&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="case-when"><a class="markdownIt-Anchor" href="#case-when">#</a> Case When</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>结尾</th>
<th>碰到没有处理的分支而又缺少 ELSE 子句时</th>
</tr>
</thead>
<tbody>
<tr>
<td>case 语句</td>
<td>end case;</td>
<td>报错 ORA-06592: CASE not found while executing CASE statement</td>
</tr>
<tr>
<td>case 表达式</td>
<td>end</td>
<td>返回 NULL</td>
</tr>
</tbody>
</table>
<p><strong>Sample Case</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> SELECTOR</span><br><span class="line"><span class="keyword">WHEN</span> EXPRESSION <span class="number">1</span> <span class="keyword">THEN</span> STATEMENT <span class="number">1</span>;</span><br><span class="line"><span class="keyword">WHEN</span> EXPRESSION <span class="number">2</span> <span class="keyword">THEN</span> STATEMENT <span class="number">2</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">WHEN</span> EXPRESSION N <span class="keyword">THEN</span> STATEMENT N;</span><br><span class="line"><span class="keyword">ELSE</span> STATEMENT N<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"></span><br><span class="line">if som_edi_temp_d_rec.customer_id <span class="operator">=</span> <span class="string">&#x27;XXX&#x27;</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">case</span> l_edi_shipping_method</span><br><span class="line">      <span class="keyword">when</span> <span class="string">&#x27;S&#x27;</span> <span class="keyword">then</span> l_freight_terms_code :<span class="operator">=</span> <span class="string">&#x27;10FCA&#x27;</span>;</span><br><span class="line">      <span class="keyword">when</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">then</span> l_freight_terms_code :<span class="operator">=</span> <span class="string">&#x27;10FCA&#x27;</span>;</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span> if;</span><br></pre></td></tr></table></figure>
<p><strong>Search Case</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">SEARCH</span> <span class="keyword">CONDITION</span> <span class="number">1</span> <span class="keyword">THEN</span> STATEMENT <span class="number">1</span>;</span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">SEARCH</span> <span class="keyword">CONDITION</span> <span class="number">2</span> <span class="keyword">THEN</span> STATEMENT <span class="number">2</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">WHEN</span> <span class="keyword">SEARCH</span> <span class="keyword">CONDITION</span> N <span class="keyword">THEN</span> STATEMENT N;</span><br><span class="line"><span class="keyword">ELSE</span> STATEMENT N<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> name,score,</span><br><span class="line">   <span class="keyword">case</span></span><br><span class="line">     <span class="keyword">when</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">then</span></span><br><span class="line">      <span class="string">&#x27;优秀&#x27;</span></span><br><span class="line">     <span class="keyword">when</span> score <span class="keyword">between</span> <span class="number">70</span> <span class="keyword">and</span> <span class="number">89</span> <span class="keyword">then</span></span><br><span class="line">      <span class="string">&#x27;良好&#x27;</span></span><br><span class="line">     <span class="keyword">when</span> score <span class="keyword">between</span> <span class="number">60</span> <span class="keyword">and</span> <span class="number">69</span> <span class="keyword">then</span></span><br><span class="line">      <span class="string">&#x27;及格&#x27;</span></span><br><span class="line">     <span class="keyword">when</span> score <span class="operator">&lt;</span> <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">      <span class="string">&#x27;不及格&#x27;</span></span><br><span class="line">   <span class="keyword">end</span> 等级</span><br><span class="line"> <span class="keyword">from</span> test;</span><br></pre></td></tr></table></figure>
<p><strong>Case When and Decode</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;One&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Two&#x27;</span>, <span class="string">&#x27;None&#x27;</span>),</span><br><span class="line">       decode(<span class="number">2</span>, <span class="number">1</span>, <span class="string">&#x27;One&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Two&#x27;</span>, <span class="string">&#x27;None&#x27;</span>)</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>D1</th>
<th>D2</th>
</tr>
</thead>
<tbody>
<tr>
<td>One</td>
<td>Two</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="number">1</span></span><br><span class="line">         <span class="keyword">when</span> <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">          <span class="string">&#x27;One&#x27;</span></span><br><span class="line">         <span class="keyword">when</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">then</span> <span class="comment">--ORA-00932: inconsistent datatypes: expected NUMBER got CHAR</span></span><br><span class="line">          <span class="string">&#x27;Two&#x27;</span> </span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">          <span class="string">&#x27;None&#x27;</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="trigger"><a class="markdownIt-Anchor" href="#trigger">#</a> Trigger</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>JOB</th>
<th>MGR</th>
<th>HIREDATE</th>
<th>SAL</th>
<th>COMM</th>
<th>DEPTNO</th>
</tr>
</thead>
<tbody>
<tr>
<td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600.00</td>
<td>300.00</td>
<td>30</td>
</tr>
<tr>
<td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250.00</td>
<td>500.00</td>
<td>30</td>
</tr>
<tr>
<td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250.00</td>
<td>1400.00</td>
<td>30</td>
</tr>
<tr>
<td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850.00</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td></td>
<td>1981-11-17</td>
<td>5000.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500.00</td>
<td>0.00</td>
<td>30</td>
</tr>
<tr>
<td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950.00</td>
<td></td>
<td>30</td>
</tr>
<tr>
<td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000.00</td>
<td></td>
<td>20</td>
</tr>
<tr>
<td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300.00</td>
<td></td>
<td>10</td>
</tr>
</tbody>
</table>
<p><strong>Compound trigger</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_comp_trigger</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">insert</span> <span class="keyword">or</span> update <span class="keyword">or</span> <span class="keyword">delete</span> <span class="keyword">on</span> edi_t compound <span class="keyword">trigger</span></span><br><span class="line">  </span><br><span class="line">  g_var varchar2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;Demo for Compound Trigger&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  before statement <span class="keyword">is</span></span><br><span class="line">    l_var varchar2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;Before Statement&#x27;</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    dbms_output.put_line(l_var);</span><br><span class="line">    if inserting <span class="keyword">then</span></span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;---Insert&#x27;</span>);</span><br><span class="line">    elsif updating <span class="keyword">then</span></span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;---Update&#x27;</span>);</span><br><span class="line">    elsif deleting <span class="keyword">then</span></span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;---Delete&#x27;</span>);</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">  <span class="keyword">end</span> before statement;</span><br><span class="line">  </span><br><span class="line">  before <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">is</span> </span><br><span class="line">    l_var varchar2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;Before Each Row&#x27;</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    dbms_output.put_line(l_var);</span><br><span class="line">  <span class="keyword">end</span> before <span class="keyword">each</span> <span class="type">row</span>;</span><br><span class="line">  </span><br><span class="line">  after <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">is</span> </span><br><span class="line">    l_var varchar2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;After Each Row&#x27;</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    dbms_output.put_line(l_var);</span><br><span class="line">  <span class="keyword">end</span> after <span class="keyword">each</span> <span class="type">row</span>;</span><br><span class="line">  </span><br><span class="line">  after statement <span class="keyword">is</span></span><br><span class="line">    l_var varchar2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;After Statement&#x27;</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    dbms_output.put_line(l_var);</span><br><span class="line">  <span class="keyword">end</span> after statement;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">update edi_t <span class="keyword">set</span> sal <span class="operator">=</span> sal <span class="operator">*</span> <span class="number">2</span> <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Before Statement</span></span><br><span class="line"><span class="comment">---Update</span></span><br><span class="line"><span class="comment">Before Each Row</span></span><br><span class="line"><span class="comment">After Each Row</span></span><br><span class="line"><span class="comment">Before Each Row</span></span><br><span class="line"><span class="comment">After Each Row</span></span><br><span class="line"><span class="comment">Before Each Row</span></span><br><span class="line"><span class="comment">After Each Row</span></span><br><span class="line"><span class="comment">After Statement</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_log(</span><br><span class="line">  empno number,</span><br><span class="line">  modified_date <span class="type">date</span>,</span><br><span class="line">  desc_of_change varchar2(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_comp_trigger</span><br><span class="line">  <span class="keyword">for</span> update <span class="keyword">on</span> edi_t compound <span class="keyword">trigger</span></span><br><span class="line">  </span><br><span class="line">  type l_log_tab_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> edi_t_log<span class="operator">%</span>rowtype;</span><br><span class="line">  l_log_list l_log_tab_type :<span class="operator">=</span> l_log_tab_type();</span><br><span class="line">  </span><br><span class="line">  before <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">is</span> </span><br><span class="line">    l_log_row edi_t_log<span class="operator">%</span>rowtype;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    l_log_row.empno :<span class="operator">=</span> :old.empno;</span><br><span class="line">    l_log_row.modified_date :<span class="operator">=</span> sysdate;</span><br><span class="line">    l_log_row.desc_of_change :<span class="operator">=</span> <span class="string">&#x27;OLD SAL = &#x27;</span> <span class="operator">||</span> :old.sal <span class="operator">||</span> <span class="string">&#x27;, NEW SAL = &#x27;</span> <span class="operator">||</span> :new.sal;</span><br><span class="line">    </span><br><span class="line">    l_log_list.extend();</span><br><span class="line">    l_log_list(l_log_list.last()) :<span class="operator">=</span> l_log_row;</span><br><span class="line">  <span class="keyword">end</span> before <span class="keyword">each</span> <span class="type">row</span>;</span><br><span class="line">  </span><br><span class="line">  after statement <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    forall i <span class="keyword">in</span> <span class="number">1.</span>.l_log_list.count</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_t_log <span class="keyword">values</span> l_log_list(i);</span><br><span class="line">  <span class="keyword">end</span> after statement;</span><br><span class="line"><span class="keyword">end</span>; </span><br><span class="line"></span><br><span class="line">update edi_t <span class="keyword">set</span> sal <span class="operator">=</span> sal <span class="operator">*</span> <span class="number">2</span> <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_log;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>MODIFIED_DATE</th>
<th>DESC_OF_CHANGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>7782</td>
<td>2024-01-09 10:49:51 AM</td>
<td>OLD SAL = 2450, NEW SAL = 4900</td>
</tr>
<tr>
<td>7839</td>
<td>2024-01-09 10:49:51 AM</td>
<td>OLD SAL = 5000, NEW SAL = 10000</td>
</tr>
<tr>
<td>7934</td>
<td>2024-01-09 10:49:51 AM</td>
<td>OLD SAL = 1300, NEW SAL = 2600</td>
</tr>
</tbody>
</table>
<p><strong>Mutating trigger</strong></p>
<p>Mutating error occurs whenever a ‘row level’ trigger tries to modify or select data from table that is already undergoing change.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_validate_trg</span><br><span class="line">before update <span class="keyword">of</span> sal <span class="keyword">on</span> edi_t</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_ceo_sal number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> sal  <span class="comment">--select</span></span><br><span class="line">    <span class="keyword">into</span> l_ceo_sal </span><br><span class="line">    <span class="keyword">from</span> edi_t </span><br><span class="line">   <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span>;</span><br><span class="line">   </span><br><span class="line">   if (:new.sal <span class="operator">&lt;</span> l_ceo_sal <span class="keyword">and</span> :old.job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;PRESIDENT&#x27;</span>) <span class="keyword">or</span> (:old.job <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span>) <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> edi_t_log <span class="keyword">values</span> (:new.empno, sysdate, <span class="string">&#x27;OLD SAL = &#x27;</span> <span class="operator">||</span> :old.sal <span class="operator">||</span> <span class="string">&#x27;, NEW SAL = &#x27;</span> <span class="operator">||</span> :new.sal);</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> edi_t_log <span class="keyword">values</span> (:new.empno, sysdate, <span class="string">&#x27;Employee salary cannot be more than &#x27;</span> <span class="operator">||</span> l_ceo_sal);</span><br><span class="line">   <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">update edi_t <span class="keyword">set</span> sal <span class="operator">=</span> sal <span class="operator">*</span> <span class="number">2</span> <span class="keyword">where</span> empno <span class="operator">=</span> <span class="number">7369</span>; <span class="comment">--updating</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ORA-04091: table APPS.EDI_T is mutating, trigger/function may not see it</span></span><br><span class="line"><span class="comment">ORA-06512: at &quot;APPS.EDI_VALIDATE_TRG&quot;, line 4</span></span><br><span class="line"><span class="comment">ORA-04088: error during execution of trigger &#x27;APPS.EDI_VALIDATE_TRG&#x27;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_validate_trg</span><br><span class="line"><span class="keyword">for</span> update <span class="keyword">on</span> edi_t compound <span class="keyword">trigger</span></span><br><span class="line">  l_ceo_sal number;</span><br><span class="line">  </span><br><span class="line">  before statement <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> sal</span><br><span class="line">      <span class="keyword">into</span> l_ceo_sal </span><br><span class="line">      <span class="keyword">from</span> edi_t </span><br><span class="line">     <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span>;</span><br><span class="line">  <span class="keyword">end</span> before statement;</span><br><span class="line">  </span><br><span class="line">  before <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">   if (:new.sal <span class="operator">&lt;</span> l_ceo_sal <span class="keyword">and</span> :old.job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;PRESIDENT&#x27;</span>) <span class="keyword">or</span> (:old.job <span class="operator">=</span> <span class="string">&#x27;PRESIDENT&#x27;</span>) <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> edi_t_log <span class="keyword">values</span> (:new.empno, sysdate, <span class="string">&#x27;OLD SAL = &#x27;</span> <span class="operator">||</span> :old.sal <span class="operator">||</span> <span class="string">&#x27;, NEW SAL = &#x27;</span> <span class="operator">||</span> :new.sal);</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">     :new.sal :<span class="operator">=</span> :old.sal;</span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> edi_t_log <span class="keyword">values</span> (:new.empno, sysdate, <span class="string">&#x27;Employee salary cannot be more than &#x27;</span> <span class="operator">||</span> l_ceo_sal);</span><br><span class="line">   <span class="keyword">end</span> if;</span><br><span class="line">  <span class="keyword">end</span> before <span class="keyword">each</span> <span class="type">row</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">update edi_t <span class="keyword">set</span> sal <span class="operator">=</span> sal <span class="operator">*</span> <span class="number">10</span> <span class="keyword">where</span> empno <span class="operator">=</span> <span class="number">7369</span>; <span class="comment">--updating</span></span><br></pre></td></tr></table></figure>
<p><strong>Trigger order of same type on same table</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  id number</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> sequence edi_t_seq; </span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_a</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;A-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_b</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;B-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_c</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;C-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">C-1</span></span><br><span class="line"><span class="comment">B-2</span></span><br><span class="line"><span class="comment">A-3</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_a</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;A-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_b</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> follows edi_t_trg_a</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;B-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg_c</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> follows edi_t_trg_b</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;C-&#x27;</span> <span class="operator">||</span> edi_t_seq.nextval);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">A-4</span></span><br><span class="line"><span class="comment">B-5</span></span><br><span class="line"><span class="comment">C-6</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> edi_t_trg_c;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> edi_t_trg_b;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> edi_t_trg_a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t;</span><br><span class="line"><span class="keyword">drop</span> sequence edi_t_seq;</span><br></pre></td></tr></table></figure>
<h3 id="cursor"><a class="markdownIt-Anchor" href="#cursor">#</a> Cursor</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  <span class="keyword">cursor</span> emp_name_list <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp;</span><br><span class="line">    </span><br><span class="line">  l_name varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> emp_name_list;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_name_list</span><br><span class="line">      <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> emp_name_list<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> emp_name_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SMITH</span></span><br><span class="line"><span class="comment">ALLEN</span></span><br><span class="line"><span class="comment">WARD</span></span><br><span class="line"><span class="comment">JONES</span></span><br><span class="line"><span class="comment">MARTIN</span></span><br><span class="line"><span class="comment">BLAKE</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">SCOTT</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">TURNER</span></span><br><span class="line"><span class="comment">ADAMS</span></span><br><span class="line"><span class="comment">JAMES</span></span><br><span class="line"><span class="comment">FORD</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  <span class="keyword">cursor</span> emp_name_list <span class="keyword">is</span> </span><br><span class="line">     <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp;</span><br><span class="line">  l_name varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">  if <span class="keyword">not</span> emp_name_list<span class="operator">%</span>isopen <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">open</span> emp_name_list;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line">  </span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_name_list <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> emp_name_list<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name  <span class="operator">||</span> <span class="string">&#x27;-&#x27;</span> <span class="operator">||</span> emp_name_list<span class="operator">%</span>rowcount);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  </span><br><span class="line">  if emp_name_list<span class="operator">%</span>isopen <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">close</span> emp_name_list;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SMITH-1</span></span><br><span class="line"><span class="comment">ALLEN-2</span></span><br><span class="line"><span class="comment">WARD-3</span></span><br><span class="line"><span class="comment">JONES-4</span></span><br><span class="line"><span class="comment">MARTIN-5</span></span><br><span class="line"><span class="comment">BLAKE-6</span></span><br><span class="line"><span class="comment">CLARK-7</span></span><br><span class="line"><span class="comment">SCOTT-8</span></span><br><span class="line"><span class="comment">KING-9</span></span><br><span class="line"><span class="comment">TURNER-10</span></span><br><span class="line"><span class="comment">ADAMS-11</span></span><br><span class="line"><span class="comment">JAMES-12</span></span><br><span class="line"><span class="comment">FORD-13</span></span><br><span class="line"><span class="comment">MILLER-14</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Implicit cursor</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">delete</span> <span class="keyword">from</span> edi_t;</span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="keyword">SQL</span><span class="operator">%</span>ROWCOUNT);</span><br><span class="line">  </span><br><span class="line">  if <span class="keyword">SQL</span><span class="operator">%</span>ISOPEN <span class="keyword">then</span> </span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;Implicit Cursor is Opened&#x27;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;Implicit Cursor is Closed&#x27;</span>);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--0</span></span><br><span class="line"><span class="comment">--Implicit Cursor is Closed</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_deptno number;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">cursor</span> emp_name_list(p_deptno number) <span class="keyword">is</span> </span><br><span class="line">     <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp <span class="keyword">where</span> deptno <span class="operator">=</span> p_deptno;</span><br><span class="line">  </span><br><span class="line">  l_name varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;------- EMP from deptno 10 ------&#x27;</span>);</span><br><span class="line">  <span class="keyword">open</span> emp_name_list(<span class="number">10</span>);</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_name_list <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> emp_name_list<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> emp_name_list;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;------- EMP from deptno 20 ------&#x27;</span>);</span><br><span class="line">  <span class="keyword">open</span> emp_name_list(<span class="number">20</span>);</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_name_list <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> emp_name_list<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> emp_name_list;</span><br><span class="line"><span class="keyword">end</span>;   </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">------- EMP from deptno 10 ------</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">------- EMP from deptno 20 ------</span></span><br><span class="line"><span class="comment">SMITH</span></span><br><span class="line"><span class="comment">JONES</span></span><br><span class="line"><span class="comment">SCOTT</span></span><br><span class="line"><span class="comment">ADAMS</span></span><br><span class="line"><span class="comment">FORD</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Ref Cursor</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type ref_cur_type <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line">  </span><br><span class="line">  rc_emp_list_cur ref_cur_type;</span><br><span class="line">  </span><br><span class="line">  l_name varchar2(<span class="number">30</span>);</span><br><span class="line">  l_dept_row scott.dept<span class="operator">%</span>rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> rc_emp_list_cur <span class="keyword">for</span> <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> rc_emp_list_cur <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> rc_emp_list_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> rc_emp_list_cur;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">open</span> rc_emp_list_cur <span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.dept;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> rc_emp_list_cur <span class="keyword">into</span> l_dept_row;</span><br><span class="line">    exit <span class="keyword">when</span> rc_emp_list_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_dept_row.deptno <span class="operator">||</span> <span class="string">&#x27;-&#x27;</span> <span class="operator">||</span> l_dept_row.dname);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> rc_emp_list_cur;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SMITH</span></span><br><span class="line"><span class="comment">ALLEN</span></span><br><span class="line"><span class="comment">WARD</span></span><br><span class="line"><span class="comment">JONES</span></span><br><span class="line"><span class="comment">MARTIN</span></span><br><span class="line"><span class="comment">BLAKE</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">SCOTT</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">TURNER</span></span><br><span class="line"><span class="comment">ADAMS</span></span><br><span class="line"><span class="comment">JAMES</span></span><br><span class="line"><span class="comment">FORD</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">10-ACCOUNTING</span></span><br><span class="line"><span class="comment">20-RESEARCH</span></span><br><span class="line"><span class="comment">30-SALES</span></span><br><span class="line"><span class="comment">40-OPERATIONS</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Ref cursor strongly typed</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type ref_cur_type <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span> <span class="keyword">return</span> scott.emp<span class="operator">%</span>rowtype;</span><br><span class="line">  </span><br><span class="line">  rc_emp_list_cur ref_cur_type;</span><br><span class="line">  </span><br><span class="line">  l_emp_row scott.emp<span class="operator">%</span>rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> rc_emp_list_cur <span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> rc_emp_list_cur <span class="keyword">into</span> l_emp_row;</span><br><span class="line">    exit <span class="keyword">when</span> rc_emp_list_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_emp_row.ename);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> rc_emp_list_cur;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SMITH</span></span><br><span class="line"><span class="comment">ALLEN</span></span><br><span class="line"><span class="comment">WARD</span></span><br><span class="line"><span class="comment">JONES</span></span><br><span class="line"><span class="comment">MARTIN</span></span><br><span class="line"><span class="comment">BLAKE</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">SCOTT</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">TURNER</span></span><br><span class="line"><span class="comment">ADAMS</span></span><br><span class="line"><span class="comment">JAMES</span></span><br><span class="line"><span class="comment">FORD</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>sys_cursor</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  <span class="comment">--type ref_cur_type is ref cursor;</span></span><br><span class="line">  </span><br><span class="line">  rc_emp_list_cur sys_refcursor;</span><br><span class="line">  </span><br><span class="line">  l_name varchar2(<span class="number">30</span>);</span><br><span class="line">  l_dept_row scott.dept<span class="operator">%</span>rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> rc_emp_list_cur <span class="keyword">for</span> <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> rc_emp_list_cur <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> rc_emp_list_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> rc_emp_list_cur;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">open</span> rc_emp_list_cur <span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.dept;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> rc_emp_list_cur <span class="keyword">into</span> l_dept_row;</span><br><span class="line">    exit <span class="keyword">when</span> rc_emp_list_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_dept_row.deptno <span class="operator">||</span> <span class="string">&#x27;-&#x27;</span> <span class="operator">||</span> l_dept_row.dname);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> rc_emp_list_cur;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">SMITH</span></span><br><span class="line"><span class="comment">ALLEN</span></span><br><span class="line"><span class="comment">WARD</span></span><br><span class="line"><span class="comment">JONES</span></span><br><span class="line"><span class="comment">MARTIN</span></span><br><span class="line"><span class="comment">BLAKE</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">SCOTT</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">TURNER</span></span><br><span class="line"><span class="comment">ADAMS</span></span><br><span class="line"><span class="comment">JAMES</span></span><br><span class="line"><span class="comment">FORD</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">10-ACCOUNTING</span></span><br><span class="line"><span class="comment">20-RESEARCH</span></span><br><span class="line"><span class="comment">30-SALES</span></span><br><span class="line"><span class="comment">40-OPERATIONS</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Return cursor</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_fn(p_dept_no number)</span><br><span class="line">  <span class="keyword">return</span> sys_refcursor</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  l_emp_list sys_refcursor;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> l_emp_list <span class="keyword">for</span> <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp <span class="keyword">where</span> deptno <span class="operator">=</span> p_dept_no;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> l_emp_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_ref_cursor sys_refcursor;</span><br><span class="line">  l_name varchar2(<span class="number">30</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_ref_cursor :<span class="operator">=</span> edi_t_fn(<span class="number">10</span>);</span><br><span class="line">  <span class="comment">--open l_ref_cursor;</span></span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> l_ref_cursor <span class="keyword">into</span> l_name;</span><br><span class="line">    exit <span class="keyword">when</span> l_ref_cursor<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">close</span> l_ref_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">CLARK</span></span><br><span class="line"><span class="comment">KING</span></span><br><span class="line"><span class="comment">MILLER</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Current of</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  <span class="keyword">cursor</span> emp_list <span class="keyword">is</span></span><br><span class="line">    <span class="keyword">select</span> empno <span class="keyword">from</span> edi_emp <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span> <span class="keyword">for</span> update;</span><br><span class="line">    </span><br><span class="line">  l_empno number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> emp_list;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> emp_list <span class="keyword">into</span> l_empno;</span><br><span class="line">    exit <span class="keyword">when</span> emp_list<span class="operator">%</span>notfound;</span><br><span class="line">    </span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;Updating &#x27;</span> <span class="operator">||</span> l_empno);</span><br><span class="line">    </span><br><span class="line">    update edi_emp <span class="keyword">set</span> sal <span class="operator">=</span> sal <span class="operator">+</span> <span class="number">9999</span></span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">current</span> <span class="keyword">of</span> emp_list;</span><br><span class="line">    </span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;Updating count &#x27;</span> <span class="operator">||</span> emp_list<span class="operator">%</span>rowcount);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> emp_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Updating 7782</span></span><br><span class="line"><span class="comment">Updating count 1</span></span><br><span class="line"><span class="comment">Updating 7839</span></span><br><span class="line"><span class="comment">Updating count 2</span></span><br><span class="line"><span class="comment">Updating 7934</span></span><br><span class="line"><span class="comment">Updating count 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>Cursor vs Collection</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace type edi_varchar_list <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> edi_get_emps_use_collection(p_deptno    <span class="keyword">in</span> number,</span><br><span class="line">                                                        p_out_name_list <span class="keyword">out</span> edi_varchar_list) <span class="keyword">as</span></span><br><span class="line">	l_varchar_list edi_varchar_list :<span class="operator">=</span> edi_varchar_list();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> ename</span><br><span class="line">    bulk <span class="keyword">collect</span> <span class="keyword">into</span> l_varchar_list</span><br><span class="line">    <span class="keyword">from</span> scott.emp</span><br><span class="line">   <span class="keyword">where</span> deptno <span class="operator">=</span> p_deptno;</span><br><span class="line">   </span><br><span class="line">   p_out_name_list :<span class="operator">=</span> l_varchar_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> edi_get_emps_use_ref_cursor(p_deptno        <span class="keyword">in</span> number,</span><br><span class="line">                                                        p_out_name_list <span class="keyword">out</span> sys_refcursor) <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> p_out_name_list <span class="keyword">for</span></span><br><span class="line">    <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp <span class="keyword">where</span> deptno <span class="operator">=</span> p_deptno;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> edi_use_ref_cursor(p_in      varchar2,</span><br><span class="line">                                               p_out_cur <span class="keyword">out</span> sys_refcursor) <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if p_in <span class="operator">=</span> <span class="string">&#x27;ENAME&#x27;</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">open</span> p_out_cur <span class="keyword">for</span></span><br><span class="line">      <span class="keyword">select</span> ename <span class="keyword">from</span> scott.emp;</span><br><span class="line">  elsif p_in <span class="operator">=</span> <span class="string">&#x27;DNAME&#x27;</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">open</span> p_out_cur <span class="keyword">for</span></span><br><span class="line">      <span class="keyword">select</span> dname <span class="keyword">from</span> scott.dept;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">open</span> p_out_cur <span class="keyword">for</span></span><br><span class="line">      <span class="keyword">select</span> <span class="string">&#x27;Invalid Input&#x27;</span> <span class="keyword">from</span> dual;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> type edi_varchar_list;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> edi_get_emps_use_collection;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> edi_get_emps_use_ref_cursor;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> edi_use_ref_cursor;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>Cursor in package</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package edi_t <span class="keyword">as</span> </span><br><span class="line">  <span class="keyword">cursor</span> normal_cur <span class="keyword">is</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_emp scott.emp<span class="operator">%</span>rowtype;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> edi_t.normal_cur;</span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> edi_t.normal_cur <span class="keyword">into</span> l_emp;</span><br><span class="line">    exit <span class="keyword">when</span> edi_t.normal_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_emp.ename);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="keyword">close</span> edi_t.normal_cur;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Error: PLS-00994: Cursor Variables cannot be declared as part of a package</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package edi_t <span class="keyword">as</span> </span><br><span class="line">  l_ref_cursor sys_refcursor;  </span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Error: PLS-00994: Cursor Variables cannot be declared as part of a package</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package edi_t <span class="keyword">as</span> </span><br><span class="line">  type l_ref_cursor_type <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line">  l_ref_cursor l_ref_cursor_type;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> package edi_t;</span><br></pre></td></tr></table></figure>
<h3 id="ref-cursor"><a class="markdownIt-Anchor" href="#ref-cursor">#</a> Ref Cursor</h3>
<p><code>ref cursor</code>  可以用于定义游标变量，定义游标时不需要指定相应的 select 语句，但是当使用游标时（open）需要指定 select 语句。</p>
<p>使用 pl/sql 编写一个块，可以输入部门号，并显示该部门所有员工姓名和他的工资。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="comment">--定义游标类型</span></span><br><span class="line">type sp_emp_copy_cursor <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line"><span class="comment">--定义一个游标变量</span></span><br><span class="line">test_cursor sp_emp_copy_cursor;</span><br><span class="line">v_ename emp_copy.ename<span class="operator">%</span>type;</span><br><span class="line">v_sal emp_copy.sal<span class="operator">%</span>type;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">--把test_cursor和一个select结合</span></span><br><span class="line">  <span class="keyword">open</span> test_cursor <span class="keyword">for</span> <span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp_copy <span class="keyword">where</span> deptno<span class="operator">=</span><span class="operator">&amp;</span><span class="keyword">no</span>;</span><br><span class="line">  <span class="comment">--循环取出(fethch)</span></span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> test_cursor <span class="keyword">into</span> v_ename,v_sal;</span><br><span class="line">    <span class="comment">--判断test_cursor是否为空</span></span><br><span class="line">    exit <span class="keyword">when</span> test_cursor<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;名字：&#x27;</span><span class="operator">||</span>v_ename<span class="operator">||</span><span class="string">&#x27;工资：&#x27;</span><span class="operator">||</span>v_sal);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  <span class="comment">--关闭游标</span></span><br><span class="line">  <span class="keyword">close</span> test_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p><code>ref cursor</code>  也称为动态游标，直到运行时才知道这条查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="comment">-- dynamic cursor</span></span><br><span class="line">type rc <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line"><span class="comment">-- static cursor</span></span><br><span class="line"><span class="keyword">cursor</span> c <span class="keyword">is</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual;</span><br><span class="line">l_cursor rc;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if (to_char(sysdate,<span class="string">&#x27;dd&#x27;</span>) <span class="operator">=</span> <span class="number">30</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- ref cursor with dynamic sql</span></span><br><span class="line">    <span class="keyword">open</span> l_cursor <span class="keyword">for</span> <span class="string">&#x27;select * from emp&#x27;</span>;</span><br><span class="line">  elsif (to_char(sysdate,<span class="string">&#x27;dd&#x27;</span>) <span class="operator">=</span> <span class="number">29</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- ref cursor with static sql</span></span><br><span class="line">    <span class="keyword">open</span> l_cursor <span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment">-- ref cursor with static sql</span></span><br><span class="line">    <span class="keyword">open</span> l_cursor <span class="keyword">for</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line">  <span class="comment">-- the &quot;normal&quot; static cursor</span></span><br><span class="line">  <span class="keyword">open</span> c;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="rowid-rownum"><a class="markdownIt-Anchor" href="#rowid-rownum">#</a> Rowid Rownum</h3>
<p><code>rownum</code>  使用 SELECT 语句返回的结果集，若希望<strong>按特定条件查询前 N 条记录</strong>，可以使用伪列 rownum 。rownum 是对结果集加的一个伪列，即先查到结果集之后再加上去的一个列 （强调：先要有结果集）。简单的说 rownum 是符合条件结果的序列号。它总是从 1 开始排起的。使用 rownum 时，只能使用 &lt;、&lt;=、!= 符号。</p>
<p><code>rowid</code>  是数据的详细地址，通过 rowid，oracle 可以快速的定位某行具体的数据的位置。rowid 可以分为物理 rowid 和逻辑 rowid 两种。普通的表中的 rowid 是物理 rowid，索引组织表 (IOT) 的 rowid 是逻辑 rowid。当表中有大量重复数据时，可以使用 <strong>rowid 快速删除重复的记录</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1. rownum 使用</span></span><br><span class="line"><span class="comment">--(1) 找到第二行以后的记录</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> rownum <span class="keyword">no</span>,id,name <span class="keyword">from</span> student) <span class="keyword">where</span> <span class="keyword">no</span><span class="operator">&gt;</span><span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--(2) rownum 和排序</span></span><br><span class="line"><span class="comment">--oracle中的rownum是在取数据的时候产生的序号，所以想对指定排序的数据指定rowmun行数据就必须注意了。可以看出，rownum并不是按照name列来生成的序号。系统是按照记录插入时的顺序给记录排的号，rowid也是顺序分配的。</span></span><br><span class="line"><span class="keyword">select</span> rownum,id,name <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> name;</span><br><span class="line">    rownum id     name</span><br><span class="line"><span class="comment">---------- ------ ---------------------------------------------------</span></span><br><span class="line">       <span class="number">3</span> <span class="number">200003</span>  李三</span><br><span class="line">       <span class="number">2</span> <span class="number">200002</span>  王二</span><br><span class="line">       <span class="number">1</span> <span class="number">200001</span>  张一</span><br><span class="line">       <span class="number">4</span> <span class="number">200004</span>  赵四</span><br><span class="line"></span><br><span class="line"><span class="comment">--为了解决这个问题，需要使用子查询</span></span><br><span class="line"><span class="keyword">select</span> rownum,id,name <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student <span class="keyword">order</span> <span class="keyword">by</span> name);</span><br><span class="line">    rownum ID     NAME</span><br><span class="line"><span class="comment">---------- ------ ---------------------------------------------------</span></span><br><span class="line">      <span class="number">1</span> <span class="number">200003</span>   李三</span><br><span class="line">      <span class="number">2</span> <span class="number">200002</span>   王二</span><br><span class="line">      <span class="number">3</span> <span class="number">200001</span>   张一</span><br><span class="line">      <span class="number">4</span> <span class="number">200004</span>   赵四</span><br><span class="line"></span><br><span class="line"><span class="comment">--(3) 更新表的某一列为 rownum</span></span><br><span class="line"></span><br><span class="line">UPDATE T a</span><br><span class="line">   <span class="keyword">SET</span> a.neworder <span class="operator">=</span></span><br><span class="line">       (<span class="keyword">SELECT</span> b.newOrder</span><br><span class="line">          <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> rrownum <span class="keyword">over</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> amount <span class="keyword">DESC</span>) newOrder,</span><br><span class="line">                       ROWID browid</span><br><span class="line">                  <span class="keyword">FROM</span> T) b</span><br><span class="line">         <span class="keyword">WHERE</span> b.browid <span class="operator">=</span> a.rowid)</span><br><span class="line"></span><br><span class="line"><span class="comment">--(4) 更新表不相关的两列</span></span><br><span class="line">将 test_b mac 列覆盖 test_a mac 列</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_a (</span><br><span class="line">   mac varchar2(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_b (</span><br><span class="line">   mac varchar2(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_a <span class="keyword">values</span>(<span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_a <span class="keyword">values</span>(<span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_b <span class="keyword">values</span>(<span class="string">&#x27;ccc&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_b <span class="keyword">values</span>(<span class="string">&#x27;ddd&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  test_a;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  test_b;</span><br><span class="line"></span><br><span class="line">update test_a t</span><br><span class="line">   <span class="keyword">set</span> t.mac <span class="operator">=</span></span><br><span class="line">       (<span class="keyword">select</span> b.mac</span><br><span class="line">          <span class="keyword">from</span> (<span class="keyword">select</span> rownum rn, mac <span class="keyword">from</span> test_a) a,</span><br><span class="line">               (<span class="keyword">select</span> rownum rn, mac <span class="keyword">from</span> test_b) b</span><br><span class="line">         <span class="keyword">where</span> a.rn <span class="operator">=</span> b.rn</span><br><span class="line">           <span class="keyword">and</span> t.mac <span class="operator">=</span> a.mac);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.rowid 的使用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--快速删除重复的记录</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu a</span><br><span class="line"><span class="keyword">where</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="built_in">max</span>(b.rowid)</span><br><span class="line"><span class="keyword">from</span> stu b</span><br><span class="line"><span class="keyword">where</span> a.no <span class="operator">=</span> b.no</span><br><span class="line"><span class="keyword">and</span> a.name <span class="operator">=</span> b.name</span><br><span class="line"><span class="keyword">and</span> a.sex <span class="operator">=</span> b.sex); <span class="comment">--这里 max 使用 min 也可以</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu a</span><br><span class="line"><span class="keyword">where</span> rowid <span class="operator">&lt;</span> (<span class="keyword">select</span> <span class="built_in">max</span>(b.rowid)</span><br><span class="line"><span class="keyword">from</span> stu b</span><br><span class="line"><span class="keyword">where</span> a.no <span class="operator">=</span> b.no</span><br><span class="line"><span class="keyword">and</span> a.name <span class="operator">=</span> b.name</span><br><span class="line"><span class="keyword">and</span> a.sex <span class="operator">=</span> b.sex); <span class="comment">--这里如果把 max 换成 min 的话，前面的 where 子句中需要把&quot;&lt;&quot;改为&quot;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu</span><br><span class="line"><span class="keyword">where</span> rowid <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">select</span> <span class="built_in">max</span>(rowid)</span><br><span class="line"><span class="keyword">from</span> stu t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> t.no, t.name, t.sex); <span class="comment">--使用了 group by，减少了显性的比较条件，提高效率</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu a</span><br><span class="line"><span class="keyword">where</span> rowid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="built_in">max</span>(b.rowid)</span><br><span class="line"><span class="keyword">from</span> stu b</span><br><span class="line"><span class="keyword">where</span> a.no <span class="operator">&lt;</span> b.no</span><br><span class="line"><span class="keyword">and</span> a.name <span class="operator">=</span> b.name); <span class="comment">--取 name 重复学号大的数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="set-operation"><a class="markdownIt-Anchor" href="#set-operation">#</a> Set Operation</h3>
<table>
<thead>
<tr>
<th>操作</th>
<th>描述</th>
<th>重复行</th>
<th>排序</th>
</tr>
</thead>
<tbody>
<tr>
<td>union</td>
<td>并集</td>
<td>不包括</td>
<td>默认规则的排序</td>
</tr>
<tr>
<td>union all</td>
<td>并集</td>
<td>包括</td>
<td>不进行排序</td>
</tr>
<tr>
<td>intersect</td>
<td>交集</td>
<td>不包括</td>
<td>默认规则的排序</td>
</tr>
<tr>
<td>minus</td>
<td>差集</td>
<td>不包括</td>
<td>默认规则的排序</td>
</tr>
</tbody>
</table>
<p>union 和 union all 的区别是，union 会自动压缩多个结果集合中的重复结果，并进行默认排序。而 union all 则将所有的结果全部显示出来，不进行排序。</p>
<h3 id="column-alias"><a class="markdownIt-Anchor" href="#column-alias">#</a> Column Alias</h3>
<p>如果字段别名中有空格等特殊字符，使用双引号引起来</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> fnd_profile.value(<span class="string">&#x27;ORG_ID&#x27;</span>)  &quot;org id&quot;  <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="implicit-conversion"><a class="markdownIt-Anchor" href="#implicit-conversion">#</a> Implicit Conversion</h3>
<table>
<thead>
<tr>
<th>操作</th>
<th>转换</th>
</tr>
</thead>
<tbody>
<tr>
<td>比较 / 算术运算</td>
<td>字符型转换为数值型</td>
</tr>
<tr>
<td>连接时 (||)</td>
<td>数值型转换为字符型</td>
</tr>
<tr>
<td>赋值、调用函数时</td>
<td>定义的变量类型为准</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;1&#x27;</span> <span class="operator">||</span> <span class="number">2</span>  <span class="operator">+</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 14</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="string">&#x27;12&#x27;</span> <span class="operator">&gt;</span> <span class="number">2</span> ; <span class="comment">--12 &gt; 2 but &#x27;12&#x27; &lt; &#x27;2&#x27;</span></span><br><span class="line"><span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>
<h3 id="null"><a class="markdownIt-Anchor" href="#null">#</a> Null</h3>
<p>一般对于可空字段需要做特殊处理，因为 null 与 任何其它字段比较都会返回  <code>undefined</code> ，例如  <code>null = null &amp; null != null &amp; null = 'XXX' &amp; null &lt;&gt; 'XXX'</code>  都不成立。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cursor</span> c_som_edi_temp_d <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">    <span class="keyword">from</span> som_edi_temp_d</span><br><span class="line">   <span class="keyword">where</span> edi_id <span class="operator">=</span> p_edi_id</span><br><span class="line">     <span class="keyword">and</span> nvl(transfer, <span class="string">&#x27;Y&#x27;</span>) <span class="operator">&lt;&gt;</span> <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">null</span> <span class="operator">=</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">null</span> <span class="operator">!=</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">null</span> <span class="operator">&lt;&gt;</span> <span class="string">&#x27;D&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="null-2"><a class="markdownIt-Anchor" href="#null-2">#</a> Null &amp; ‘’</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> length(<span class="string">&#x27;&#x27;</span>), length(<span class="keyword">null</span>) <span class="keyword">from</span> dual; <span class="comment">--&#x27;&#x27; &#x27;&#x27;</span></span><br><span class="line"><span class="keyword">select</span> nvl(<span class="string">&#x27;&#x27;</span>, <span class="number">1</span>) <span class="keyword">from</span> dual; <span class="comment">--1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">is</span> <span class="keyword">null</span>; <span class="comment">--X</span></span><br></pre></td></tr></table></figure>
<h3 id="nulls-first"><a class="markdownIt-Anchor" href="#nulls-first">#</a> Nulls First</h3>
<p><code>nulls first</code>  将 null 查询结果集排在最前面； <code>nulls last</code>  将 null 查询结果集排在最后面。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> som_edi_810_header seh</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> seh.invoice_date nulls <span class="keyword">last</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> som_edi_810_header seh</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> seh.invoice_date nulls <span class="keyword">first</span>;</span><br></pre></td></tr></table></figure>
<h3 id="for-update"><a class="markdownIt-Anchor" href="#for-update">#</a> For Update</h3>
<p><code>for update</code>  和  <code>for update nowait</code>  是对操作的数据行进行加锁，在事务提交前防止其他操作对数据的修改。 <code>for update</code>  和  <code>for update nowait</code>  主要区别在于是否等待，如果不加  <code>nowait</code>  ，在另一个 session 执行  <code>update</code>  时就会等待，直至锁被释放。如果添加了  <code>nowait</code>  在另一个 session 执行  <code>update</code>  时就会报错  <code>ORA-00054: resource busy</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h seh <span class="keyword">where</span> seh.edi_id <span class="operator">=</span> <span class="string">&#x27;15194&#x27;</span> <span class="keyword">for</span> update</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h seh <span class="keyword">where</span> seh.edi_id <span class="operator">=</span> <span class="string">&#x27;15194&#x27;</span> <span class="keyword">for</span> update nowait</span><br></pre></td></tr></table></figure>
<h3 id="escape-character"><a class="markdownIt-Anchor" href="#escape-character">#</a> Escape Character</h3>
<p>oracle 中从第二个  <code>'</code>  开始表示转义符，使用  <code>escape</code>  可以设置其它字符为转义字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#x27;&#x27;&#x27;</span><span class="operator">||</span>sd.ordered_quantity<span class="operator">||</span>chr(<span class="number">39</span>) <span class="keyword">from</span> som_edi_temp_d sd;</span><br><span class="line"><span class="comment">-- 输出 &#x27;30&#x27;, 第三个 &#x27; 被第二个 &#x27; 转义为一个 &#x27;, 也可以使用 chr(39) 直接表示 &#x27;</span></span><br><span class="line"><span class="comment">-- _表示确切的未知字符</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t11 <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%_%&#x27;</span>;</span><br><span class="line">        ID NAME</span><br><span class="line"><span class="comment">---------- --------------------</span></span><br><span class="line">        <span class="number">1</span> baaab</span><br><span class="line">        <span class="number">2</span> ba_ab</span><br><span class="line">        <span class="number">3</span> ba<span class="operator">%</span>ab</span><br><span class="line"><span class="comment">-- escape 设置 \ 为转义符</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t11 <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\_%&#x27;</span> <span class="keyword">escape</span> <span class="string">&#x27;\&#x27;</span>;</span><br><span class="line">        ID NAME</span><br><span class="line"><span class="comment">---------- --------------------</span></span><br><span class="line">        <span class="number">2</span>  ba_ab</span><br></pre></td></tr></table></figure>
<h3 id="quote"><a class="markdownIt-Anchor" href="#quote">#</a> Quote</h3>
<p>plsql 使用单引号作为转义符</p>
<p>最外层的两个单引号作为引号操作符，第二个作为转义符号，第三个单引号是真实的数据输出<br>
 <code>select '''' from dual;</code>  输出  <code>'</code> <br>
q’’ 内的内容会原样输出<br>
 <code>select q'[Route du Nant-d'Avril, 150]' from dual;</code> <br>
 替换字符串中的单引号为双引号<br>
 <code>replace(str, '''', '''''')</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&#x27;&#x27;SQL&#x27;&#x27; is structured query language&#x27;</span> <span class="keyword">as</span> q1,</span><br><span class="line">       q<span class="string">&#x27;@&#x27;</span> <span class="keyword">SQL</span> <span class="string">&#x27; is structured query language@&#x27;</span> <span class="keyword">as</span> q2,</span><br><span class="line">       Q<span class="string">&#x27;@&#x27;</span> <span class="keyword">SQL</span> <span class="string">&#x27; is structured query language@&#x27;</span> <span class="keyword">as</span> q3,</span><br><span class="line">       q<span class="string">&#x27;[&#x27;</span><span class="keyword">SQL</span><span class="string">&#x27; is structured query language]&#x27;</span> <span class="keyword">as</span> q4,</span><br><span class="line">       Q<span class="string">&#x27;[&#x27;</span><span class="keyword">SQL</span><span class="string">&#x27; is structured query language]&#x27;</span> <span class="keyword">as</span> q5</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>Q1</th>
<th>Q2</th>
<th>Q3</th>
<th>Q4</th>
<th>Q5</th>
</tr>
</thead>
<tbody>
<tr>
<td>‘SQL’ is structured query language</td>
<td>‘SQL’ is structured query language</td>
<td>‘SQL’ is structured query language</td>
<td>‘SQL’ is structured query language</td>
<td>‘SQL’ is structured query language</td>
</tr>
</tbody>
</table>
<h3 id="flash-back"><a class="markdownIt-Anchor" href="#flash-back">#</a> Flash Back</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> babb_emp;</span><br><span class="line"><span class="comment">-- 打印 babb_emp 表一分钟前的数据(表名不能用简写形式)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  babb_emp  <span class="keyword">as</span> <span class="keyword">of</span> <span class="type">timestamp</span> (sysdate <span class="operator">-</span> <span class="number">1</span><span class="operator">/</span><span class="number">1440</span>);</span><br><span class="line"><span class="comment">-- 添加条件</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  babb_emp  <span class="keyword">as</span> <span class="keyword">of</span> <span class="type">timestamp</span> (sysdate <span class="operator">-</span> <span class="number">1</span><span class="operator">/</span><span class="number">1440</span>) <span class="keyword">where</span> babb_emp.id <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Retrieve package was drop or replace</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> all_source <span class="keyword">as</span> <span class="keyword">of</span> <span class="type">timestamp</span> to_timestamp(<span class="string">&#x27;20200902 16:00:00&#x27;</span>, <span class="string">&#x27;YYYYMMDD HH24:MI:SS&#x27;</span>)</span><br><span class="line"> <span class="keyword">where</span> name <span class="operator">=</span> <span class="built_in">upper</span>(<span class="string">&#x27;som_edi_custom_utils_pkg&#x27;</span>)</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> type, line</span><br></pre></td></tr></table></figure>
<h3 id="query-clob"><a class="markdownIt-Anchor" href="#query-clob">#</a> Query Clob</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_lob.substr(mpg.name) <span class="keyword">from</span> mpg</span><br></pre></td></tr></table></figure>
<h3 id="update-use-subquery"><a class="markdownIt-Anchor" href="#update-use-subquery">#</a> Update Use Subquery</h3>
<p><code>select 1 from dual where 1 &lt;&gt; 1</code>  查询不到数据，但是会显示更新了 xx 条数据，结果 customer_id 都会更新为 null。<br>
因为没有为 som_edi_temp_d_temp 添加条件会更新这张表的所有数据， <code>select 1 from dual where 1 &lt;&gt; 1</code>  没有数据，customer_id 都会变成 null, 正确的更新做法是为 som_edi_temp_d_temp 添加条件限制要更新这张表的哪些数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update som_edi_temp_d_temp sed</span><br><span class="line">   <span class="keyword">set</span> sed.customer_id <span class="operator">=</span> (</span><br><span class="line">     <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span></span><br><span class="line">   );</span><br></pre></td></tr></table></figure>
<h3 id="trigger-implements-id-autoincrement"><a class="markdownIt-Anchor" href="#trigger-implements-id-autoincrement">#</a> Trigger Implements ID Autoincrement</h3>
<p>注意这里使用的是 BEFORE， 如果使用 AFTER，记录已经写入表中，需要使用 Upadate 更新。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">TRIGGER</span> YSC.som_hub_dn_upload_header_bi1 BEFORE</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">ON</span> som_hub_dn_upload_header <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">WHEN</span> (NEW.header_id <span class="keyword">is</span> <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span> som_hub_dn_upload_header_s.NEXTVAL <span class="keyword">INTO</span> :NEW.header_id <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>Header 插入多条记录时，不使用 Cursor， 使 Line 关联到 Header 的 Unique Header Id.</p>
<ol>
<li>在 Header 上创建 Trigger，当没有提供 Id 时，自动根据索引生成 Id. 或者 直接使用 som_edi_asn_h_s.nextval。</li>
<li>Insert Line 时连接 Header， 条件是可能导致 Header 拆分成多条的 Column.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">TRIGGER</span> som_edi_asn_header_ai before</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">ON</span> som_edi_asn_header <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">WHEN</span> (NEW.header_id <span class="keyword">is</span> <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span> som_edi_asn_h_s.nextval <span class="keyword">INTO</span> :NEW.header_id <span class="keyword">FROM</span> DUAL;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> som_edi_asn_header</span><br><span class="line">    ( <span class="comment">--HEADER_ID, --use trigger</span></span><br><span class="line">      <span class="comment">--HEADER_ID, --or use som_edi_asn_h_s.nextval directly</span></span><br><span class="line">      DELIVERY_ID,</span><br><span class="line">      CUSTOMER_PO,</span><br><span class="line">      ITEM_NO)</span><br><span class="line">  <span class="keyword">select</span> <span class="comment">--l_header_id,</span></span><br><span class="line">         <span class="comment">--som_edi_asn_h_s.nextval</span></span><br><span class="line">      sh.delivery_id,</span><br><span class="line">      sh.customer_po,</span><br><span class="line">      sl.item_no</span><br><span class="line">    <span class="keyword">from</span> som_hub_dn_upload_header sh,</span><br><span class="line">         som_hub_dn_upload_line   sl</span><br><span class="line">   <span class="keyword">where</span> sh.header_id <span class="operator">=</span> sl.header_id</span><br><span class="line">     <span class="keyword">and</span> sh.delivery_id <span class="operator">=</span> p_delivery_id</span><br><span class="line">   <span class="keyword">group</span> <span class="keyword">by</span> sh.delivery_id, sh.customer_po, sl.item_no;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> som_edi_asn_line</span><br><span class="line">  (HEADER_ID,</span><br><span class="line">   PALLET_NO,</span><br><span class="line">   CARTON_NO,</span><br><span class="line">   DEVICE_SERIAL_NUMBER)</span><br><span class="line">  <span class="keyword">select</span> <span class="comment">--l_header_id,</span></span><br><span class="line">          seh.header_id,</span><br><span class="line">          sl.pallet_id,</span><br><span class="line">          sl.carton_id,</span><br><span class="line">          sl.prod_sn,</span><br><span class="line">    <span class="keyword">from</span> som_hub_dn_upload_header  sh,</span><br><span class="line">         som_hub_dn_upload_line    sl,</span><br><span class="line">         som_edi_asn_header        seh</span><br><span class="line">   <span class="keyword">where</span> sh.header_id <span class="operator">=</span> sl.header_id</span><br><span class="line">     <span class="keyword">and</span> sh.delivery_id <span class="operator">=</span> seh.delivery_id</span><br><span class="line">     <span class="keyword">and</span> sh.customer_po <span class="operator">=</span> seh.customer_po</span><br><span class="line">     <span class="keyword">and</span> sl.item_no <span class="operator">=</span> seh.item_no</span><br><span class="line">     <span class="keyword">and</span> sh.delivery_id <span class="operator">=</span> p_delivery_id</span><br><span class="line">     <span class="keyword">and</span> nvl(sh.status, <span class="string">&#x27;N&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="materialize"><a class="markdownIt-Anchor" href="#materialize">#</a> Materialize</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">with</span> t <span class="keyword">as</span></span><br><span class="line">   (<span class="keyword">select</span> <span class="comment">/*+ MATERIALIZE */</span></span><br><span class="line">     som_edi_dachser_pkg.get_hub_invoice(sel.so_line_id) hub_invoice,</span><br><span class="line">     som_edi_dachser_pkg.get_qty_per_pallet(sel.invoice_line_id) qty_per_pallet</span><br><span class="line">      <span class="keyword">from</span> som_commercial_invoice_headers seh,</span><br><span class="line">           som_commercial_invoice_lines   sel</span><br><span class="line">     <span class="keyword">where</span> seh.invoice_header_id <span class="operator">=</span> sel.invoice_header_id</span><br><span class="line">       <span class="keyword">and</span> seh.invoice_no <span class="operator">=</span> p_invoice_no)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="keyword">into</span> l_count</span><br><span class="line">    <span class="keyword">from</span> t</span><br><span class="line">   <span class="keyword">where</span> t.hub_invoice <span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line">      <span class="keyword">or</span> t.qty_per_pallet <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"> if l_count <span class="operator">&lt;&gt;</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    debug(<span class="string">&#x27;Get HUB Invoice No or Calculate Qty Per Pallet error.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    retcode :<span class="operator">=</span> <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"> <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="count-over"><a class="markdownIt-Anchor" href="#count-over">#</a> count(*) over()</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> get_estimated_invoice_date(p_invoice_no  <span class="keyword">in</span> varchar2,</span><br><span class="line">                                    p_invoice_seq <span class="keyword">in</span> varchar2) <span class="keyword">return</span> <span class="type">date</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  l_return <span class="type">date</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">max</span>(<span class="keyword">case</span></span><br><span class="line">                <span class="keyword">when</span> acceptance_id_count <span class="operator">=</span> <span class="number">0</span> <span class="keyword">and</span> acceptance_date_count <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> ship_date</span><br><span class="line">                <span class="keyword">when</span> acceptance_id_count <span class="operator">=</span> total_line_count <span class="keyword">and</span> acceptance_id_count <span class="operator">=</span> acceptance_date_count <span class="keyword">then</span> acceptance_date</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">null</span></span><br><span class="line">               <span class="keyword">end</span>) invoice_date</span><br><span class="line">      <span class="keyword">into</span> l_return</span><br><span class="line">    <span class="keyword">from</span> (<span class="keyword">select</span> asn.ship_date,</span><br><span class="line">                  orde.revrec_signature_date <span class="keyword">as</span> acceptance_date,</span><br><span class="line">                  <span class="built_in">count</span>(orde.contingency_id) <span class="keyword">over</span>() <span class="keyword">as</span> acceptance_id_count,</span><br><span class="line">                  <span class="built_in">count</span>(orde.revrec_signature_date) <span class="keyword">over</span>() <span class="keyword">as</span> acceptance_date_count,</span><br><span class="line">                  <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>() <span class="keyword">as</span> total_line_count</span><br><span class="line">            <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> h.invoice_no,</span><br><span class="line">                                  h.invoice_seq,</span><br><span class="line">                                  h.ship_date,</span><br><span class="line">                                  l.so_line_id</span><br><span class="line">                    <span class="keyword">from</span> som_edi_856_header h, som_edi_856_line l</span><br><span class="line">                    <span class="keyword">where</span> h.edi856_id <span class="operator">=</span> l.edi856_id) asn,</span><br><span class="line">                  oe_order_lines_all orde</span><br><span class="line">            <span class="keyword">where</span> asn.invoice_no <span class="operator">=</span> p_invoice_no</span><br><span class="line">              <span class="keyword">and</span> asn.invoice_seq <span class="operator">=</span> p_invoice_seq</span><br><span class="line">              <span class="keyword">and</span> asn.so_line_id <span class="operator">=</span> orde.line_id(<span class="operator">+</span>));</span><br><span class="line">  exception</span><br><span class="line">    <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">      l_return :<span class="operator">=</span> <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> l_return;</span><br><span class="line"><span class="keyword">end</span> get_estimated_invoice_date;</span><br></pre></td></tr></table></figure>
<h3 id="bulk-connect-into"><a class="markdownIt-Anchor" href="#bulk-connect-into">#</a> Bulk Connect Into</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  type varchar_list_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">100</span>);</span><br><span class="line">  l_list1 varchar_list_type :<span class="operator">=</span> varchar_list_type();</span><br><span class="line">  l_list2 varchar_list_type :<span class="operator">=</span> varchar_list_type();</span><br><span class="line">  l_start_time number;</span><br><span class="line">  l_end_time number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  </span><br><span class="line">  l_start_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h) loop</span><br><span class="line">    l_list1.extend();</span><br><span class="line">    l_list1(l_list1.last()) :<span class="operator">=</span> i.cust_po_number;</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  l_end_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  dbms_output.put_line(l_end_time <span class="operator">-</span> l_start_time);</span><br><span class="line">  </span><br><span class="line">  l_start_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  <span class="keyword">select</span> cust_po_number</span><br><span class="line">    bulk <span class="keyword">collect</span> <span class="keyword">into</span> l_list2 </span><br><span class="line">   <span class="keyword">from</span> som_edi_temp_h;</span><br><span class="line">  l_end_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  dbms_output.put_line(l_end_time <span class="operator">-</span> l_start_time);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--58</span></span><br><span class="line"><span class="comment">--2</span></span><br></pre></td></tr></table></figure>
<h3 id="forall"><a class="markdownIt-Anchor" href="#forall">#</a> Forall</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_temp_h <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  type list_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> som_edi_temp_h<span class="operator">%</span>rowtype;</span><br><span class="line">  l_list2 list_type :<span class="operator">=</span> list_type();</span><br><span class="line">  l_start_time number;</span><br><span class="line">  l_end_time number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">    bulk <span class="keyword">collect</span> <span class="keyword">into</span> l_list2 </span><br><span class="line">   <span class="keyword">from</span> som_edi_temp_h;</span><br><span class="line">  </span><br><span class="line">  l_start_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> l_list2.first..l_list2.last loop</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_t1 <span class="keyword">values</span> l_list2(i);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  l_end_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  dbms_output.put_line(l_end_time <span class="operator">-</span> l_start_time);</span><br><span class="line">  </span><br><span class="line">  l_start_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  forall i <span class="keyword">in</span> l_list2.first..l_list2.last</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_t2 <span class="keyword">values</span> l_list2(i);</span><br><span class="line">  l_end_time :<span class="operator">=</span> dbms_utility.get_time(); </span><br><span class="line">  dbms_output.put_line(l_end_time <span class="operator">-</span> l_start_time);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--37</span></span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t1;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t2;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t (name varchar2(<span class="number">5</span>) <span class="keyword">not</span> <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type name_list_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">100</span>);</span><br><span class="line">  l_name_list name_list_type :<span class="operator">=</span> name_list_type();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_name_list.extend(<span class="number">5</span>);</span><br><span class="line">  l_name_list(<span class="number">1</span>) :<span class="operator">=</span> <span class="keyword">null</span>;</span><br><span class="line">  l_name_list(<span class="number">2</span>) :<span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">  l_name_list(<span class="number">3</span>) :<span class="operator">=</span> <span class="string">&#x27;AA&#x27;</span>;</span><br><span class="line">  l_name_list(<span class="number">4</span>) :<span class="operator">=</span> <span class="string">&#x27;AAA&#x27;</span>;</span><br><span class="line">  l_name_list(<span class="number">5</span>) :<span class="operator">=</span> <span class="string">&#x27;AAAAAAA&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  forall i <span class="keyword">in</span> l_name_list.first..l_name_list.last save exceptions</span><br><span class="line">    <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (l_name_list(i));</span><br><span class="line">exception</span><br><span class="line">  <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;Error count = &#x27;</span> <span class="operator">||</span> <span class="keyword">sql</span><span class="operator">%</span>bulk_exceptions.count);</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span>.<span class="keyword">sql</span><span class="operator">%</span>bulk_exceptions.count loop</span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;Error index position = &#x27;</span> <span class="operator">||</span> <span class="keyword">sql</span><span class="operator">%</span>bulk_exceptions(i).error_index);</span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;Error code = &#x27;</span> <span class="operator">||</span> <span class="keyword">sql</span><span class="operator">%</span>bulk_exceptions(i).error_code);</span><br><span class="line">      dbms_output.put_line(<span class="string">&#x27;Error message = &#x27;</span> <span class="operator">||</span> sqlerrm(<span class="operator">-</span><span class="keyword">sql</span><span class="operator">%</span>bulk_exceptions(i).error_code));</span><br><span class="line">    <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Error count = 2</span></span><br><span class="line"><span class="comment">--Error index position = 1</span></span><br><span class="line"><span class="comment">--Error code = 1400</span></span><br><span class="line"><span class="comment">--Error message = ORA-01400: cannot insert NULL into ()</span></span><br><span class="line"><span class="comment">--Error index position = 5</span></span><br><span class="line"><span class="comment">--Error code = 12899</span></span><br><span class="line"><span class="comment">--Error message = ORA-12899: value too large for column  (actual: , maximum: )</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
</tr>
<tr>
<td>AA</td>
</tr>
<tr>
<td>AAA</td>
</tr>
</tbody>
</table>
<h3 id="view"><a class="markdownIt-Anchor" href="#view">#</a> View</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> som_edi_mes_header_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span>  &quot;dbname&quot; <span class="keyword">as</span> dbname,</span><br><span class="line">          &quot;head_id&quot; <span class="keyword">as</span> head_id,</span><br><span class="line">          &quot;invoice_no&quot; <span class="keyword">as</span> invoice_no,</span><br><span class="line">          &quot;exc_seq&quot; <span class="keyword">as</span> exc_seq,</span><br><span class="line">          &quot;work_order&quot; <span class="keyword">as</span> work_order,</span><br><span class="line">          &quot;part_no&quot; <span class="keyword">as</span> part_no,</span><br><span class="line">          &quot;customer&quot; <span class="keyword">as</span> customer,</span><br><span class="line">          &quot;qty&quot; <span class="keyword">as</span> qty,</span><br><span class="line">          &quot;ctns&quot; <span class="keyword">as</span> ctns,</span><br><span class="line">          &quot;pallets&quot; <span class="keyword">as</span> pallets,</span><br><span class="line">          &quot;po_no&quot; <span class="keyword">as</span> po_no,</span><br><span class="line">          &quot;delivery_no&quot; <span class="keyword">as</span> delivery_no,</span><br><span class="line">          &quot;create_time&quot; <span class="keyword">as</span> create_time,</span><br><span class="line">          &quot;update_time&quot; <span class="keyword">as</span> update_time,</span><br><span class="line">          &quot;country_of_origin&quot; <span class="keyword">as</span> country_of_origin,</span><br><span class="line">          &quot;transfer_flag&quot; <span class="keyword">as</span> transfer_flag,</span><br><span class="line">          &quot;transfer_time&quot; <span class="keyword">as</span> transfer_time,</span><br><span class="line">          &quot;update_by&quot; <span class="keyword">as</span> update_by,</span><br><span class="line">          &quot;model_name&quot; <span class="keyword">as</span> model_name,</span><br><span class="line">          &quot;ver_no&quot; <span class="keyword">as</span> ver_no,</span><br><span class="line">          &quot;tran_create_time&quot; <span class="keyword">as</span> tran_create_time</span><br><span class="line">  <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;SN&#x27;</span> <span class="keyword">as</span> &quot;dbname&quot;, sn.<span class="operator">*</span>  <span class="keyword">from</span> &quot;dbo&quot;.&quot;ssc_t_edi_head&quot;<span class="variable">@mes2edi</span>.sn sn</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;SC&#x27;</span> <span class="keyword">as</span> &quot;dbname&quot;, sc.<span class="operator">*</span>  <span class="keyword">from</span>  &quot;dbo&quot;.&quot;ssc_t_edi_head&quot;<span class="variable">@mes2edi</span>.sc sc</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="comment">--dblink 是 Oracle 连接到 SQLServer DB</span></span><br><span class="line"><span class="comment">--现在不用在 delivery_no 上加双引号，sev.&quot;delivery_no&quot; = &#x27;102234&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> som_edi_mes_header_v sev <span class="keyword">where</span> sev.delivery_no <span class="operator">=</span> <span class="string">&#x27;102234&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="force-view"><a class="markdownIt-Anchor" href="#force-view">#</a> Force View</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> edi_t;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;  <span class="comment">--ORA-00942: table or view does not exist</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace force <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.object_name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>STATUS</th>
<th>OBJECT_NAME</th>
<th>SUBOBJECT_NAME</th>
<th>OBJECT_ID</th>
<th>DATA_OBJECT_ID</th>
<th>OBJECT_TYPE</th>
<th>CREATED</th>
<th>LAST_DDL_TIME</th>
<th>TIMESTAMP</th>
<th>STATUS</th>
<th>TEMPORARY</th>
<th>GENERATED</th>
<th>SECONDARY</th>
<th>NAMESPACE</th>
<th>EDITION_NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>INVALID</td>
<td>EDI_T_V</td>
<td></td>
<td>8462071</td>
<td></td>
<td>VIEW</td>
<td>2024-01-09 11:46:24 AM</td>
<td>2024-01-09 11:46:24 AM</td>
<td>2024-01-09:11:46:24</td>
<td>INVALID</td>
<td>N</td>
<td>N</td>
<td>N</td>
<td>1</td>
<td></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_v; <span class="comment">--ORA-04063: view &quot;APPS.EDI_T_V&quot; has errors</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp <span class="keyword">where</span> deptno <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_v;    </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>JOB</th>
<th>MGR</th>
<th>HIREDATE</th>
<th>SAL</th>
<th>COMM</th>
<th>DEPTNO</th>
</tr>
</thead>
<tbody>
<tr>
<td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td></td>
<td>1981-11-17</td>
<td>5000.00</td>
<td></td>
<td>10</td>
</tr>
<tr>
<td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300.00</td>
<td></td>
<td>10</td>
</tr>
</tbody>
</table>
<h4 id="text-of-force-view"><a class="markdownIt-Anchor" href="#text-of-force-view">#</a> Text of force view</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace force <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> text <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;  <span class="comment">--select * from edi_t</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">select</span> text <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;  <span class="comment">--select * from edi_t</span></span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--INVALID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_v; <span class="comment">--Auto Recompile</span></span><br><span class="line"><span class="keyword">select</span> text <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;  <span class="comment">--select &quot;EMPNO&quot;,&quot;ENAME&quot;,&quot;JOB&quot;,&quot;MGR&quot;,&quot;HIREDATE&quot;,&quot;SAL&quot;,&quot;COMM&quot;,&quot;DEPTNO&quot; from edi_t</span></span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--VALID</span></span><br></pre></td></tr></table></figure>
<h4 id="view-with-read-only-constraint"><a class="markdownIt-Anchor" href="#view-with-read-only-constraint">#</a> View WITH READ ONLY constraint</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(c number);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t; </span><br><span class="line">  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_v <span class="keyword">values</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t</span><br><span class="line"><span class="keyword">with</span> read <span class="keyword">only</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_v <span class="keyword">values</span> (<span class="number">1</span>); <span class="comment">--ORA-42399: cannot perform a DML operation on a read-only view</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br><span class="line"><span class="comment">--drop view edi_t_v;</span></span><br></pre></td></tr></table></figure>
<h4 id="view-with-check-option-constraint"><a class="markdownIt-Anchor" href="#view-with-check-option-constraint">#</a> View WITH CHECK OPTION constraint</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">30</span>),</span><br><span class="line">  dept varchar2(<span class="number">30</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;XX&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;XX&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;XX&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">4</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;YY&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">5</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;YY&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">6</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;YY&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">    <span class="keyword">from</span> edi_t</span><br><span class="line">   <span class="keyword">where</span> dept <span class="operator">=</span> <span class="string">&#x27;XX&#x27;</span></span><br><span class="line">  <span class="keyword">with</span> <span class="keyword">check</span> option;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_v <span class="keyword">values</span> (<span class="number">7</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;XX&#x27;</span>); </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_v <span class="keyword">values</span> (<span class="number">8</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;YY&#x27;</span>); <span class="comment">--ORA-01402: view WITH CHECK OPTION where-clause violation</span></span><br><span class="line">update edi_t_v <span class="keyword">set</span> dept <span class="operator">=</span> <span class="string">&#x27;YY&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>; <span class="comment">--ORA-01402: view WITH CHECK OPTION where-clause violation</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">    <span class="keyword">from</span> edi_t</span><br><span class="line">   <span class="keyword">where</span> dept <span class="operator">=</span> <span class="string">&#x27;XX&#x27;</span></span><br><span class="line">  <span class="keyword">with</span> <span class="keyword">check</span> option <span class="keyword">constraint</span> check_option_constraint;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v2 <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">    <span class="keyword">from</span> edi_t</span><br><span class="line">   <span class="keyword">where</span> dept <span class="operator">=</span> <span class="string">&#x27;YY&#x27;</span></span><br><span class="line">  <span class="keyword">with</span> read <span class="keyword">only</span> <span class="keyword">constraint</span> read_only_constraint;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_views <span class="keyword">where</span> view_name <span class="keyword">in</span> (<span class="string">&#x27;EDI_T_V&#x27;</span>, <span class="string">&#x27;EDI_T_V2&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_constraints <span class="keyword">where</span> table_name <span class="keyword">in</span> (<span class="string">&#x27;EDI_T_V&#x27;</span>, <span class="string">&#x27;EDI_T_V2&#x27;</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>OWNER</th>
<th>CONSTRAINT_NAME</th>
<th>CONSTRAINT_TYPE</th>
<th>TABLE_NAME</th>
<th>SEARCH_CONDITION</th>
<th>R_OWNER</th>
<th>R_CONSTRAINT_NAME</th>
<th>DELETE_RULE</th>
<th>STATUS</th>
<th>DEFERRABLE</th>
<th>DEFERRED</th>
<th>VALIDATED</th>
<th>GENERATED</th>
<th>BAD</th>
<th>RELY</th>
<th>LAST_CHANGE</th>
<th>INDEX_OWNER</th>
<th>INDEX_NAME</th>
<th>INVALID</th>
<th>VIEW_RELATED</th>
</tr>
</thead>
<tbody>
<tr>
<td>APPS</td>
<td>CHECK_OPTION_CONSTRAINT</td>
<td>V</td>
<td>EDI_T_V</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>ENABLED</td>
<td>NOT DEFERRABLE</td>
<td>IMMEDIATE</td>
<td>NOT VALIDATED</td>
<td>USER NAME</td>
<td></td>
<td></td>
<td>2024-01-09 02:41:11 PM</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>APPS</td>
<td>READ_ONLY_CONSTRAINT</td>
<td>O</td>
<td>EDI_T_V2</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>ENABLED</td>
<td>NOT DEFERRABLE</td>
<td>IMMEDIATE</td>
<td>NOT VALIDATED</td>
<td>USER NAME</td>
<td></td>
<td></td>
<td>2024-01-09 02:41:11 PM</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="check-the-list-of-objects-used-in-view"><a class="markdownIt-Anchor" href="#check-the-list-of-objects-used-in-view">#</a> Check the list of objects used in view</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> e.<span class="operator">*</span>, d.dname</span><br><span class="line">    <span class="keyword">from</span> scott.emp e, scott.dept d</span><br><span class="line">   <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_dependencies u <span class="keyword">where</span> u.name <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>NAME</th>
<th>TYPE</th>
<th>REFERENCED_OWNER</th>
<th>REFERENCED_NAME</th>
<th>REFERENCED_TYPE</th>
<th>REFERENCED_LINK_NAME</th>
<th>SCHEMAID</th>
<th>DEPENDENCY_TYPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>EDI_T_V</td>
<td>VIEW</td>
<td>SCOTT</td>
<td>EMP</td>
<td>TABLE</td>
<td></td>
<td>173</td>
<td>HARD</td>
</tr>
<tr>
<td>EDI_T_V</td>
<td>VIEW</td>
<td>SCOTT</td>
<td>DEPT</td>
<td>TABLE</td>
<td></td>
<td>173</td>
<td>HARD</td>
</tr>
</tbody>
</table>
<h4 id="compile-and-recompile-view"><a class="markdownIt-Anchor" href="#compile-and-recompile-view">#</a> Compile and Recompile View</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> edi_t_v <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--VALID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">drop</span> <span class="keyword">column</span> sal;</span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--INVALID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> edi_t <span class="keyword">add</span> sal number;</span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--INVALID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> edi_t_v compile;  <span class="comment">--Compile</span></span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--VALID</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_v;  <span class="comment">--Auto Recompile</span></span><br><span class="line"><span class="keyword">select</span> u.status, u.<span class="operator">*</span> <span class="keyword">from</span> user_objects u <span class="keyword">where</span> u.OBJECT_NAME <span class="operator">=</span> <span class="string">&#x27;EDI_T_V&#x27;</span>; <span class="comment">--VALID</span></span><br></pre></td></tr></table></figure>
<h4 id="inline-view"><a class="markdownIt-Anchor" href="#inline-view">#</a> Inline View</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="keyword">select</span> d.dname <span class="keyword">from</span> scott.dept d <span class="keyword">where</span> d.deptno <span class="operator">=</span> e.deptno) <span class="keyword">as</span> dname,</span><br><span class="line">       round(<span class="built_in">avg</span>(sal))</span><br><span class="line">  <span class="keyword">from</span> scott.emp e</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> deptno;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>DNAME</th>
<th>ROUND(AVG(SAL))</th>
</tr>
</thead>
<tbody>
<tr>
<td>SALES</td>
<td>1567</td>
</tr>
<tr>
<td>RESEARCH</td>
<td>2175</td>
</tr>
<tr>
<td>ACCOUNTING</td>
<td>2917</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.<span class="operator">*</span>, d.avg_sal</span><br><span class="line">  <span class="keyword">from</span> scott.emp e,</span><br><span class="line">       (<span class="keyword">select</span> deptno, <span class="built_in">avg</span>(sal) avg_sal <span class="keyword">from</span> scott.emp <span class="keyword">group</span> <span class="keyword">by</span> deptno) d</span><br><span class="line"> <span class="keyword">where</span> e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line">   <span class="keyword">and</span> e.sal <span class="operator">&gt;</span> d.avg_sal;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>JOB</th>
<th>MGR</th>
<th>HIREDATE</th>
<th>SAL</th>
<th>COMM</th>
<th>DEPTNO</th>
<th>AVG_SAL</th>
</tr>
</thead>
<tbody>
<tr>
<td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850.00</td>
<td></td>
<td>30</td>
<td>1566.666667</td>
</tr>
<tr>
<td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600.00</td>
<td>300.00</td>
<td>30</td>
<td>1566.666667</td>
</tr>
<tr>
<td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000.00</td>
<td></td>
<td>20</td>
<td>2175</td>
</tr>
<tr>
<td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000.00</td>
<td></td>
<td>20</td>
<td>2175</td>
</tr>
<tr>
<td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975.00</td>
<td></td>
<td>20</td>
<td>2175</td>
</tr>
<tr>
<td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td></td>
<td>1981-11-17</td>
<td>5000.00</td>
<td></td>
<td>10</td>
<td>2916.666667</td>
</tr>
</tbody>
</table>
<h3 id="any-and-in"><a class="markdownIt-Anchor" href="#any-and-in">#</a> Any and In</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Any and In</span></span><br><span class="line"><span class="keyword">with</span> t <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> level l</span><br><span class="line">    <span class="keyword">from</span> dual</span><br><span class="line">  <span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> <span class="number">10</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">--select * from t where l in (1, 3, 5)</span></span><br><span class="line"><span class="comment">--select * from t where l = any(1, 3, 5)</span></span><br><span class="line"><span class="comment">--select * from t where l &gt; any(1, 3, 5)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> l <span class="operator">&lt;</span> <span class="keyword">any</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>L</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
<tr>
<td>2</td>
</tr>
<tr>
<td>3</td>
</tr>
<tr>
<td>4</td>
</tr>
</tbody>
</table>
<h3 id="rank-dense_rank-as-aggreate-function-and-analytical-function"><a class="markdownIt-Anchor" href="#rank-dense_rank-as-aggreate-function-and-analytical-function">#</a> RANK &amp; DENSE_RANK as Aggreate function and Analytical function</h3>
<p><strong>Analytical function</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> empno,</span><br><span class="line">       ename,</span><br><span class="line">       sal,</span><br><span class="line">       <span class="built_in">rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) rank,</span><br><span class="line">       <span class="built_in">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) dense_rank</span><br><span class="line">  <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>SAL</th>
<th>RANK</th>
<th>DENSE_RANK</th>
</tr>
</thead>
<tbody>
<tr>
<td>7839</td>
<td>KING</td>
<td>5000.00</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>7902</td>
<td>FORD</td>
<td>3000.00</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>7788</td>
<td>SCOTT</td>
<td>3000.00</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>7566</td>
<td>JONES</td>
<td>2975.00</td>
<td>4</td>
<td>3</td>
</tr>
<tr>
<td>7698</td>
<td>BLAKE</td>
<td>2850.00</td>
<td>5</td>
<td>4</td>
</tr>
<tr>
<td>7782</td>
<td>CLARK</td>
<td>2450.00</td>
<td>6</td>
<td>5</td>
</tr>
<tr>
<td><strong>7499</strong></td>
<td><strong>ALLEN</strong></td>
<td><strong>1600.00</strong></td>
<td><strong>7</strong></td>
<td><strong>6</strong></td>
</tr>
<tr>
<td>7844</td>
<td>TURNER</td>
<td>1500.00</td>
<td>8</td>
<td>7</td>
</tr>
<tr>
<td>7934</td>
<td>MILLER</td>
<td>1300.00</td>
<td>9</td>
<td>8</td>
</tr>
<tr>
<td>7521</td>
<td>WARD</td>
<td>1250.00</td>
<td>10</td>
<td>9</td>
</tr>
<tr>
<td>7654</td>
<td>MARTIN</td>
<td>1250.00</td>
<td>10</td>
<td>9</td>
</tr>
<tr>
<td>7876</td>
<td>ADAMS</td>
<td>1100.00</td>
<td>12</td>
<td>10</td>
</tr>
<tr>
<td>7900</td>
<td>JAMES</td>
<td>950.00</td>
<td>13</td>
<td>11</td>
</tr>
<tr>
<td>7369</td>
<td>SMITH</td>
<td>800.00</td>
<td>14</td>
<td>12</td>
</tr>
</tbody>
</table>
<p><strong>Aggregate function</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">rank</span>(<span class="number">1600</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) rank_of_1600,</span><br><span class="line">       <span class="built_in">dense_rank</span>(<span class="number">1600</span>) <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>) dense_rank_of_1600</span><br><span class="line">  <span class="keyword">from</span> scott.emp;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>RANK_OF_1600</th>
<th>DENSE_RANK_OF_1600</th>
</tr>
</thead>
<tbody>
<tr>
<td>7</td>
<td>6</td>
</tr>
</tbody>
</table>
<h3 id="exclude-duplicate-records-while-insertion"><a class="markdownIt-Anchor" href="#exclude-duplicate-records-while-insertion">#</a> Exclude duplicate records while insertion</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">reate <span class="keyword">table</span> edi_t_target(</span><br><span class="line">  id number <span class="keyword">primary</span> key,</span><br><span class="line">  name varchar2(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">4</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_source <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target <span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">5</span>, <span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">6</span>, <span class="string">&#x27;F&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_source;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
</tbody>
<tbody>
<tr>
<td>ID</td>
<td>NAME</td>
</tr>
<tr>
<td>----</td>
<td>----</td>
</tr>
<tr>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_source; <span class="comment">--ORA-00001: unique constraint (APPS.SYS_C001472303) violated</span></span><br></pre></td></tr></table></figure>
<p><strong>Error log tables</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_errlog.create_error_log(dml_table_name <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;edi_t_target&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_source</span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_t_target reject limit unlimited; </span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_t_target;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
</tr>
<tr>
<td>6</td>
<td>F</td>
</tr>
</tbody>
<tbody>
<tr>
<td>ORA_ERR_NUMBER$</td>
<td>ORA_ERR_MESG$</td>
<td>ORA_ERR_ROWID$</td>
<td>ORA_ERR_OPTYP$</td>
<td>ORA_ERR_TAG$</td>
<td>ID</td>
<td>NAME</td>
</tr>
<tr>
<td>---------------</td>
<td>-----------------------------------------------------------</td>
<td>--------------</td>
<td>--------------</td>
<td>------------</td>
<td>----</td>
<td>----</td>
</tr>
<tr>
<td>1</td>
<td>ORA-00001: unique constraint (APPS.SYS_C001459597) violated</td>
<td></td>
<td>I</td>
<td></td>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>1</td>
<td>ORA-00001: unique constraint (APPS.SYS_C001459597) violated</td>
<td></td>
<td>I</td>
<td></td>
<td>2</td>
<td>B</td>
</tr>
</tbody>
</table>
<p><strong>Hint IGNORE_ROW_ON_DUPKEY_INDEX</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="comment">/*+ IGNORE_ROW_ON_DUPKEY_INDEX(edi_t_target(id)) */</span></span><br><span class="line">       <span class="keyword">into</span> edi_t_target <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
</tr>
<tr>
<td>6</td>
<td>F</td>
</tr>
</tbody>
</table>
<h3 id="exclude-duplicate-records-while-insertion-not-has-primary-key"><a class="markdownIt-Anchor" href="#exclude-duplicate-records-while-insertion-not-has-primary-key">#</a> Exclude duplicate records while insertion not has primary key</h3>
<p><strong>Merge</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_target(</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">10</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">4</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_source <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target <span class="keyword">where</span> id <span class="operator">&lt;=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">5</span>, <span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">6</span>, <span class="string">&#x27;F&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">merge</span> <span class="keyword">into</span> edi_t_target t</span><br><span class="line"><span class="keyword">using</span> edi_t_source s <span class="keyword">on</span> (t.id <span class="operator">=</span> s.id)</span><br><span class="line"><span class="keyword">when</span> <span class="keyword">not</span> matched <span class="keyword">then</span></span><br><span class="line"><span class="keyword">insert</span> (id, name) <span class="keyword">values</span> (s.id, s.name);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A</td>
</tr>
<tr>
<td>2</td>
<td>B</td>
</tr>
<tr>
<td>3</td>
<td>C</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
</tr>
<tr>
<td>6</td>
<td>F</td>
</tr>
</tbody>
</table>
<p><strong>Subquery</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_source</span><br><span class="line">minus</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target</span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">    <span class="keyword">from</span> edi_t_source </span><br><span class="line">   <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> id <span class="keyword">from</span> edi_t_target);</span><br><span class="line">   </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t_target;</span></span><br><span class="line"><span class="comment">--drop table edi_t_source;</span></span><br></pre></td></tr></table></figure>
<h3 id="merge-with-error"><a class="markdownIt-Anchor" href="#merge-with-error">#</a> Merge with error</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_target(</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">5</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t_source(</span><br><span class="line">  id number,</span><br><span class="line">  name varchar2(<span class="number">30</span>),</span><br><span class="line">  resigned varchar2(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_target <span class="keyword">values</span>(<span class="number">4</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;AA&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;BB&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">5</span>, <span class="string">&#x27;E&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t_source <span class="keyword">values</span> (<span class="number">6</span>, <span class="string">&#x27;FFFFFFFFFF&#x27;</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_errlog.create_error_log(dml_table_name <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;edi_t_target&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">merge</span> <span class="keyword">into</span> edi_t_target t</span><br><span class="line">usmerge <span class="keyword">into</span> edi_t_target t</span><br><span class="line"><span class="keyword">using</span> edi_t_source s</span><br><span class="line"><span class="keyword">on</span> (t.id <span class="operator">=</span> s.id)</span><br><span class="line"><span class="keyword">when</span> matched <span class="keyword">then</span></span><br><span class="line">  update <span class="keyword">set</span> name <span class="operator">=</span> s.name </span><br><span class="line">  <span class="keyword">delete</span> <span class="keyword">where</span> s.resigned <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="keyword">when</span> <span class="keyword">not</span> matched <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">values</span> (s.id, s.name) </span><br><span class="line">log errors <span class="keyword">into</span> err$_edi_t_target reject limit unlimited;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t_target;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> err$_edi_t_target;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ID</th>
<th>NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>AA</td>
</tr>
<tr>
<td>2</td>
<td>BB</td>
</tr>
<tr>
<td>4</td>
<td>D</td>
</tr>
<tr>
<td>5</td>
<td>E</td>
</tr>
</tbody>
<tbody>
<tr>
<td>ORA_ERR_NUMBER$</td>
<td>ORA_ERR_MESG$</td>
<td>ORA_ERR_ROWID$</td>
<td>ORA_ERR_OPTYP$</td>
<td>ORA_ERR_TAG$</td>
<td>ID</td>
<td>NAME</td>
</tr>
<tr>
<td>---------------</td>
<td>------------------------------------------------------------</td>
<td>--------------</td>
<td>--------------</td>
<td>------------</td>
<td>----</td>
<td>----------</td>
</tr>
<tr>
<td>12899</td>
<td>ORA-12899: value too large for column “APPS”.“EDI_T_TARGET”.“NAME” (actual: 10, maximum: 5)</td>
<td></td>
<td>I</td>
<td></td>
<td>6</td>
<td>FFFFFFFFFF</td>
</tr>
</tbody>
</table>
<h2 id="dcl"><a class="markdownIt-Anchor" href="#dcl">#</a> DCL</h2>
<p><code>DCL(Data Control Language)</code>  数据控制语言，用来授予或回收访问数据库的某种特权，并控制数据库操纵事务发生的时间及效果，对数据库实行监视等，包括  <code>COMMI, SAVEPOINT, ROLLBACK, SET TRANSACTION</code></p>
<h3 id="savepoint-rollback"><a class="markdownIt-Anchor" href="#savepoint-rollback">#</a> Savepoint Rollback</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SEQUENCE &quot;SUCRE&quot;.&quot;DEPTNO_SEQ&quot;</span><br><span class="line">MINVALUE <span class="number">1</span></span><br><span class="line">MAXVALUE <span class="number">1.00000000000000E+27</span></span><br><span class="line">INCREMENT <span class="keyword">BY</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">201</span></span><br><span class="line">CACHE <span class="number">20</span></span><br><span class="line">NOORDER NOCYCLE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">     v_number number;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">     v_number :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> DEPT <span class="keyword">values</span>(deptno_seq.nextval,v_number,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">     <span class="keyword">savepoint</span> A;</span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> DEPT <span class="keyword">values</span>(deptno_seq.nextval,v_number<span class="operator">+</span><span class="number">1</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">     <span class="keyword">savepoint</span> B;</span><br><span class="line">     <span class="keyword">insert</span> <span class="keyword">into</span> DEPT <span class="keyword">values</span>(deptno_seq.nextval,v_number<span class="operator">+</span><span class="number">2</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">     <span class="keyword">savepoint</span> C;</span><br><span class="line">     <span class="comment">--退回到 A</span></span><br><span class="line">     <span class="keyword">rollback</span> <span class="keyword">to</span> A;</span><br><span class="line">     <span class="comment">--提交，只会提交 point A前面的</span></span><br><span class="line">     <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="autonomous-transaction"><a class="markdownIt-Anchor" href="#autonomous-transaction">#</a> Autonomous Transaction</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t(n number);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>); <span class="comment">--Main Transaction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  pragma autonomous_transaction; <span class="comment">--Autonomous Child Transaction</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>); <span class="comment">--Main Transaction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span>;  <span class="comment">--rollback Main Transaction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"><span class="comment">--2</span></span><br></pre></td></tr></table></figure>
<p><strong>Autonomous transaction usage</strong></p>
<p><strong>Log error</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_log (</span><br><span class="line">  error_no number,</span><br><span class="line">  error_msg varchar2(<span class="number">100</span>)</span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> edi_log_error(p_error_no number, p_error_msg varchar2)</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  pragma autonomous_transaction;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_log <span class="keyword">values</span> (p_error_no, p_error_msg);</span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_err_no number;</span><br><span class="line">  l_err_msg varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="string">&#x27;3$&#x27;</span>);</span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span>(<span class="number">4.3</span>);</span><br><span class="line">exception </span><br><span class="line">  <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">    l_err_no :<span class="operator">=</span> sqlcode;</span><br><span class="line">    l_err_msg :<span class="operator">=</span> sqlerrm;</span><br><span class="line">    edi_log_error(l_err_no, l_err_msg);</span><br><span class="line">    <span class="keyword">rollback</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_log;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ERROR_NO</th>
<th>ERROR_MSG</th>
</tr>
</thead>
<tbody>
<tr>
<td>-1722</td>
<td>ORA-01722: invalid number</td>
</tr>
</tbody>
</table>
<p><strong>Commit inside trigger</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>);  <span class="comment">--ORA-04092: cannot COMMIT in a trigger</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> edi_t_trg</span><br><span class="line">before <span class="keyword">insert</span> <span class="keyword">on</span> edi_t </span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  pragma autonomous_transaction;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">1</span>); </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br></pre></td></tr></table></figure>
<p><strong>Calling function having DML statement in SELECT statement</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_with_dml <span class="keyword">return</span> number <span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span>; </span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> edi_t_with_dml <span class="keyword">from</span> dual;  <span class="comment">--ORA-14551: cannot perform a DML operation inside a query </span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_with_dml <span class="keyword">return</span> number <span class="keyword">as</span></span><br><span class="line">pragma autonomous_transaction;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">insert</span> <span class="keyword">into</span> edi_t <span class="keyword">values</span> (<span class="number">3</span>);</span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span>; </span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> edi_t_with_dml <span class="keyword">from</span> dual; </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop table edi_t;</span></span><br><span class="line"><span class="comment">--drop function edi_t_with_dml;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EDI_T_WITH_DML</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
</tr>
</tbody>
<tbody>
<tr>
<td>ID</td>
</tr>
<tr>
<td>----</td>
</tr>
<tr>
<td>3</td>
</tr>
</tbody>
</table>
<h3 id="erp-request-commit"><a class="markdownIt-Anchor" href="#erp-request-commit">#</a> ERP Request Commit</h3>
<p>ERP Request Error 可以设置 retcode = ‘2’ 会自动 rollback, 没有 Error 会自动 commit, 如果在 Error 的情况下需要更新表中的状态，可以手动 rollback 之前的操作，然后更新错误状态，然后手动 commit。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">procedure</span> insert_so(errbuf   <span class="keyword">out</span> varchar2,</span><br><span class="line">                    retcode  <span class="keyword">out</span> varchar2,</span><br><span class="line">                    p_edi_id <span class="keyword">in</span> number) <span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">     exception</span><br><span class="line">       <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">         retcode :<span class="operator">=</span> <span class="number">2</span>; <span class="comment">--1</span></span><br><span class="line">         l_error_msg :<span class="operator">=</span> l_error_msg <span class="operator">||</span> dbms_utility.format_error_backtrace <span class="operator">||</span> dbms_utility.format_error_stack;</span><br><span class="line">         debug(<span class="string">&#x27;error occured in insert_so: &#x27;</span> <span class="operator">||</span> l_error_msg);</span><br><span class="line"></span><br><span class="line">         <span class="keyword">rollback</span>; <span class="comment">--2</span></span><br><span class="line"></span><br><span class="line">         update som_edi_temp_h seh</span><br><span class="line">            <span class="keyword">set</span> seh.transfer <span class="operator">=</span> <span class="string">&#x27;E&#x27;</span>,</span><br><span class="line">                seh.transfer_date <span class="operator">=</span> sysdate,</span><br><span class="line">                seh.attribute1 <span class="operator">=</span> l_error_msg</span><br><span class="line">          <span class="keyword">where</span> seh.edi_id <span class="operator">=</span> p_edi_id; <span class="comment">--3</span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">commit</span>; <span class="comment">--4</span></span><br><span class="line">   <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span> insert_so;</span><br></pre></td></tr></table></figure>
<h2 id="func-procedure"><a class="markdownIt-Anchor" href="#func-procedure">#</a> Func Procedure</h2>
<h3 id="dbms_output-and-fnd_file"><a class="markdownIt-Anchor" href="#dbms_output-and-fnd_file">#</a> DBMS_OUTPUT and FND_FILE</h3>
<table>
<thead>
<tr>
<th>code</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>dbms_output.put(’’)</td>
<td>Output content to buffer</td>
</tr>
<tr>
<td>dbms_output.put_line(’’)</td>
<td>Output content to console and newline</td>
</tr>
<tr>
<td>fnd_file.put(fnd_file.output, ‘’)</td>
<td>Writes text to a file, without appending any new line characters</td>
</tr>
<tr>
<td>fnd_file.new_line(fnd_file.output, 1)</td>
<td>Writes line terminators to a file (new line character)</td>
</tr>
<tr>
<td>fnd_file.put_line(fnd_file.output, ‘’)</td>
<td>Writes text to a file followed by a new line character</td>
</tr>
</tbody>
</table>
<p>注意： <code>dbms_output.put</code>  只会输出内容到缓存； <code>dbms_output.new_line</code>  输出缓存内容并换行.</p>
<h3 id="package-create"><a class="markdownIt-Anchor" href="#package-create">#</a> Package Create</h3>
<p>第一次创建 oracle packge 时可能提示编译错误，但 plsql 并不会指出具体的错误，这时需要右键  <code>Edit Spec &amp; Body</code>  重新打开 package 编译就可以看见具体的错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- package head</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package apps.sms_po_requisitions_log_pkg <span class="keyword">is</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Author  : 11435</span></span><br><span class="line">  <span class="comment">-- Created : 2019/2/1 9:45:48</span></span><br><span class="line">  <span class="comment">-- Purpose : ASCP REQUISITIONS LOG</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">procedure</span> put_csv(p_value <span class="keyword">in</span> varchar2, p_separator <span class="keyword">in</span> varchar2 <span class="keyword">default</span> <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> sms_po_requisitions_log_pkg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- package body</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package body apps.sms_po_requisitions_log_pkg <span class="keyword">is</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">procedure</span> put_csv(p_value <span class="keyword">in</span> varchar2, p_separator <span class="keyword">in</span> varchar2 <span class="keyword">default</span> <span class="string">&#x27;,&#x27;</span>) <span class="keyword">is</span></span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         Test In PL/SQL</span></span><br><span class="line"><span class="comment">         dbms_output.put      : output content to buffer</span></span><br><span class="line"><span class="comment">         dbms_output.new_line : output buffer to console and newline</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        dbms_output.put(<span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> p_value <span class="operator">||</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> p_separator);</span><br><span class="line">   exception</span><br><span class="line">       <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">           raise;</span><br><span class="line">   <span class="keyword">end</span> put_csv;</span><br><span class="line"><span class="keyword">end</span> sms_po_requisitions_log_pkg;</span><br></pre></td></tr></table></figure>
<h3 id="package-compile-error"><a class="markdownIt-Anchor" href="#package-compile-error">#</a> Package Compile Error</h3>
<p>PLS-004010: duplicate fields in RECORD, TABLE or argument list are not permitted<br>
 原因：在 procedure 参数和定义部分同时定义了 p_seq_id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">procedure</span> proc_855(errbuf         <span class="keyword">out</span> varchar2,</span><br><span class="line">                   retcode        <span class="keyword">out</span> varchar2,</span><br><span class="line">                   p_seq_id       <span class="keyword">in</span> number) <span class="keyword">is</span></span><br><span class="line">p_seq_id         number;</span><br></pre></td></tr></table></figure>
<h3 id="procedure"><a class="markdownIt-Anchor" href="#procedure">#</a> Procedure</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建存储过程</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> p_babb_test(num <span class="keyword">out</span> number)</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">--select 语句中必须使用 into</span></span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">into</span> num <span class="keyword">from</span> scott.emp;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--调用存储过程</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  a number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p_babb_test(a);</span><br><span class="line">  dbms_output.put_line(a);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">--删除存储过程</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> p_babb_test;</span><br></pre></td></tr></table></figure>
<h3 id="synonym"><a class="markdownIt-Anchor" href="#synonym">#</a> Synonym</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- CREATE [OR REPLACE] [PUBLIC] SYNONYM [schema.] synonym_name</span></span><br><span class="line"><span class="comment">-- FOR [schema.] object_name [@dblink_name];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--before</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> app.suppliers;</span><br><span class="line"></span><br><span class="line"><span class="comment">--create synonym</span></span><br><span class="line"><span class="keyword">CREATE</span> PUBLIC SYNONYM suppliers</span><br><span class="line"><span class="keyword">FOR</span> app.suppliers;</span><br><span class="line"></span><br><span class="line"><span class="comment">--now</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> suppliers;</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop</span></span><br><span class="line"><span class="keyword">drop</span> public SYNONYM suppliers;</span><br><span class="line"></span><br><span class="line"><span class="comment">--没有 public 创建的 synonym 仅对当前 owner 有效</span></span><br><span class="line"><span class="keyword">CREATE</span> SYNONYM suppliers</span><br><span class="line"><span class="keyword">FOR</span> app.suppliers;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有 synonym</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_synonyms sn <span class="keyword">where</span> sn.SYNONYM_NAME <span class="keyword">like</span> <span class="string">&#x27;SOM_EDI%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--Synonym 可以用在 dblink 对应的 object。</span></span><br><span class="line"><span class="keyword">create</span> synonym edi_mes_head <span class="keyword">for</span> &quot;dbo&quot;.&quot;ssc_t_edi_head&quot;<span class="variable">@mes2edi</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_mes_head <span class="keyword">where</span> &quot;delivery_no&quot; <span class="keyword">in</span> (<span class="string">&#x27;102234&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="default-param"><a class="markdownIt-Anchor" href="#default-param">#</a> Default Param</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> HelloWorld3 (</span><br><span class="line">  p_user_name VARCHAR2,</span><br><span class="line">  p_val1 VARCHAR2 <span class="keyword">DEFAULT</span> <span class="string">&#x27; Good Moning,&#x27;</span>,</span><br><span class="line">  p_val2 VARCHAR2 <span class="keyword">DEFAULT</span> <span class="string">&#x27; Nice to Meet you&#x27;</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Hello &#x27;</span> <span class="operator">||</span> p_user_name <span class="operator">||</span> p_val1 <span class="operator">||</span> p_val2 <span class="operator">||</span> <span class="string">&#x27;!&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> HelloWorld3;</span><br><span class="line"> <span class="operator">/</span></span><br><span class="line"><span class="keyword">Procedure</span> created.</span><br><span class="line"></span><br><span class="line"><span class="comment">--指定参数名称调用</span></span><br><span class="line"><span class="comment">--当最后2个参数是有默认的时候，跳過中間的那個。</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">HelloWorld3(<span class="string">&#x27;Edward&#x27;</span>);</span><br><span class="line">HelloWorld3(<span class="string">&#x27;Edward&#x27;</span>, p_val1 <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27; Good Night,&#x27;</span>);</span><br><span class="line">HelloWorld3(<span class="string">&#x27;Edward&#x27;</span>, p_val1 <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27; Good Night,&#x27;</span>, p_val2 <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;Bye&#x27;</span>);</span><br><span class="line">HelloWorld3(<span class="string">&#x27;Edward&#x27;</span>, p_val2 <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27; HeiHei &#x27;</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Hello Edward Good Moning, Nice to Meet you!</span></span><br><span class="line"><span class="comment">Hello Edward Good Night, Nice to Meet you!</span></span><br><span class="line"><span class="comment">Hello Edward Good Night,Bye!</span></span><br><span class="line"><span class="comment">Hello Edward Good Moning, HeiHei !</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="sum-count"><a class="markdownIt-Anchor" href="#sum-count">#</a> Sum Count</h3>
<table>
<thead>
<tr>
<th>group/no group</th>
<th>sum()</th>
<th>count()</th>
</tr>
</thead>
<tbody>
<tr>
<td>no group 捞不到数据</td>
<td>null</td>
<td>0</td>
</tr>
<tr>
<td>group 捞不到数据</td>
<td>no data found</td>
<td>no data found</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--没有数据返回0</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">--有 group by 会先 group by, 此时什么都不会返回</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span> <span class="keyword">group</span> <span class="keyword">by</span> test.name;</span><br><span class="line"><span class="comment">--没有数据返回 null</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">--没有数据什么都不会返回</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(test.qty) <span class="keyword">from</span> test <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>  <span class="keyword">group</span> <span class="keyword">by</span> test.name;</span><br><span class="line"><span class="comment">--没有数据什么都不会返回</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(test.qty) <span class="keyword">from</span> test <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>  <span class="keyword">group</span> <span class="keyword">by</span> test.qty;</span><br><span class="line"><span class="comment">--返回 null</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">null</span> <span class="operator">+</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--如果查不到数据min()返回空,此时into不会出错</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">min</span>(setd.po_line) <span class="keyword">into</span> l_po_line <span class="keyword">from</span> som_edi_temp_d setd;</span><br><span class="line"><span class="comment">--如果查不到数据会产生错误</span></span><br><span class="line"><span class="keyword">select</span> setd.po_line <span class="keyword">into</span> l_po_line <span class="keyword">from</span> som_edi_temp_d setd;</span><br></pre></td></tr></table></figure>
<h3 id="count-distinct"><a class="markdownIt-Anchor" href="#count-distinct">#</a> Count Distinct</h3>
<p>查找一个 pallet 下有几个不同的 carton</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> sel.carton_id_value)</span><br><span class="line">  <span class="keyword">from</span> som_edi_856_line sel</span><br><span class="line"><span class="keyword">where</span> sel.edi856_id <span class="operator">=</span> p_edi856_id</span><br><span class="line">  <span class="keyword">and</span> sel.pallet_id_value <span class="operator">=</span> p_pallet_id</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sel.pallet_id_value;</span><br></pre></td></tr></table></figure>
<h3 id="instr-substr"><a class="markdownIt-Anchor" href="#instr-substr">#</a> Instr Substr</h3>
<p><code>instr(sourceString,destString,start,appearPosition)</code></p>
<p><code>instr</code>  在一个字符串中查找指定的字符，返回被查找到的指定的字符的位置。可以从右向左查找即开始位置为负。查找不到返回 0。</p>
<p><code>substr(cExpression,nStartPosition [,nCharactersReturned])</code></p>
<p><code>substr</code>  是从给定的字符表达式或字段中返回一个子字符串。</p>
<p>example: 返回不包含目录的文件名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substr(<span class="string">&#x27;c:\test\test.xlsx&#x27;</span>,</span><br><span class="line">              instr(<span class="string">&#x27;c:\test\test.xlsx&#x27;</span>, <span class="string">&#x27;\&#x27;</span>, <span class="number">-1</span>, <span class="number">1</span>) <span class="operator">+</span> <span class="number">1</span>,</span><br><span class="line">              length(<span class="string">&#x27;c:\test\test.xlsx&#x27;</span>) <span class="operator">-</span> instr(<span class="string">&#x27;c:\test\test.xlsx&#x27;</span>, <span class="string">&#x27;\&#x27;</span>, <span class="number">-1</span>, <span class="number">1</span>))</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--test.xlsx</span></span><br></pre></td></tr></table></figure>
<h3 id="option-filter"><a class="markdownIt-Anchor" href="#option-filter">#</a> Option Filter</h3>
<p>edi_id 是一个栏位并不是一个变量，如果没有传入 p_edi_id 则 edi_id 栏位不为空的情况下 edi_id = edi_id 恒成立 (null=null 不成立)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cursor</span> c_edi_id <span class="keyword">is</span></span><br><span class="line">  <span class="keyword">select</span> edi_id</span><br><span class="line">  <span class="keyword">from</span>   som_edi_temp_h</span><br><span class="line">  <span class="keyword">where</span>  transfer <span class="keyword">in</span> (<span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">  <span class="keyword">and</span>    edi_id <span class="operator">=</span> nvl(p_edi_id, edi_id)</span><br><span class="line">  <span class="keyword">and</span>    customer_id <span class="operator">=</span> nvl(p_customer_id, customer_id)</span><br><span class="line">  <span class="keyword">and</span>    <span class="built_in">trim</span>(cust_po_number) <span class="operator">=</span> nvl(<span class="built_in">trim</span>(p_customer_po),cust_po_number)</span><br><span class="line">  <span class="keyword">and</span>    edi_type <span class="operator">=</span> nvl(p_edi_type, edi_type)</span><br><span class="line">  <span class="keyword">order</span> <span class="keyword">by</span> edi_id;</span><br></pre></td></tr></table></figure>
<h3 id="to_char"><a class="markdownIt-Anchor" href="#to_char">#</a> TO_CHAR</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--获取系统当前的分钟数mi,获取月份是mm</span></span><br><span class="line"><span class="keyword">select</span> to_char(sysdate,<span class="string">&#x27;mi&#x27;</span>)  <span class="keyword">as</span> nowMinute <span class="keyword">from</span> dual</span><br><span class="line"></span><br><span class="line"><span class="comment">--数字转换为字符串，并保留小数位数</span></span><br><span class="line"><span class="keyword">select</span> to_char(<span class="number">3.145</span>, <span class="string">&#x27;9999990.00&#x27;</span>), length(to_char(<span class="number">3.145</span>, <span class="string">&#x27;9999990.00&#x27;</span>))  <span class="keyword">from</span> dual; <span class="comment">--       3.15 11</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">trim</span>(to_char(<span class="number">3.145</span>, <span class="string">&#x27;9999990.00&#x27;</span>)), length(<span class="built_in">trim</span>(to_char(<span class="number">3.145</span>, <span class="string">&#x27;9999990.00&#x27;</span>)))  <span class="keyword">from</span> dual; <span class="comment">--3.15 4</span></span><br></pre></td></tr></table></figure>
<h3 id="chr-ascii"><a class="markdownIt-Anchor" href="#chr-ascii">#</a> CHR ASCII</h3>
<p>在 oracle 中 chr () 函数和 ascii () 是一对反函数。chr () 函数将 ASCII 码转换为字符：字符 –&gt; ASCII 码；ascii () 函数将字符转换为 ASCII 码：ASCII 码 –&gt; 字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> chr(<span class="number">65</span>) <span class="keyword">from</span> dual;</span><br><span class="line">CHR(<span class="number">65</span>)</span><br><span class="line"><span class="comment">-------</span></span><br><span class="line">A</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span> <span class="keyword">select</span> ascii(<span class="string">&#x27;A&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line">ASCII(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="comment">----------</span></span><br><span class="line"><span class="number">65</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--chr(0)表示的是字符串的结束符</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_text (a varchar2(<span class="number">100</span>));</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_text <span class="keyword">values</span>(<span class="string">&#x27;1234&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> length(a), <span class="string">&#x27;-&#x27;</span><span class="operator">||</span>a<span class="operator">||</span><span class="string">&#x27;-&#x27;</span> <span class="keyword">from</span> t_text;</span><br><span class="line">LENGTH(A) <span class="string">&#x27;-&#x27;</span><span class="operator">||</span>A<span class="operator">||</span><span class="string">&#x27;-&#x27;</span></span><br><span class="line"><span class="comment">---------- --------------------------</span></span><br><span class="line">         <span class="number">4</span> <span class="number">-1234</span><span class="operator">-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--这时候没有问题,现在加一个chr(0)</span></span><br><span class="line">update t_text <span class="keyword">set</span> a <span class="operator">=</span> a<span class="operator">||</span>chr(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">select</span> length(a),<span class="string">&#x27;-&#x27;</span><span class="operator">||</span>a<span class="operator">||</span><span class="string">&#x27;-&#x27;</span> <span class="keyword">from</span> t_text;</span><br><span class="line"></span><br><span class="line">LENGTH(A) <span class="string">&#x27;-&#x27;</span><span class="operator">||</span>A<span class="operator">||</span><span class="string">&#x27;-&#x27;</span></span><br><span class="line"><span class="comment">---------- -------------------------</span></span><br><span class="line"><span class="number">5</span> <span class="number">-1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--chr(0)后面的东西没法显示出来</span></span><br><span class="line">update t_text <span class="keyword">set</span> a <span class="operator">=</span> a<span class="operator">||</span><span class="string">&#x27;5678&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> length(a),<span class="string">&#x27;-&#x27;</span><span class="operator">||</span>a<span class="operator">||</span><span class="string">&#x27;-&#x27;</span> <span class="keyword">from</span> t_text;</span><br><span class="line">LENGTH(A) <span class="string">&#x27;-&#x27;</span><span class="operator">||</span>A<span class="operator">||</span><span class="string">&#x27;-&#x27;</span></span><br><span class="line"><span class="comment">---------- --------------------------</span></span><br><span class="line">         <span class="number">9</span> <span class="number">-1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--可以使用substr</span></span><br><span class="line"><span class="keyword">select</span> substr(a,<span class="number">6</span>,<span class="number">4</span>) <span class="keyword">from</span> t_text;</span><br><span class="line">SUBSTR(A,<span class="number">6</span>,<span class="number">4</span>)</span><br><span class="line"><span class="comment">-------------</span></span><br><span class="line"><span class="number">5678</span></span><br></pre></td></tr></table></figure>
<h3 id="trunc-extract-date"><a class="markdownIt-Anchor" href="#trunc-extract-date">#</a> Trunc Extract Date</h3>
<p><code>trunc</code>  用于截取日期，默认截取日期到日，截取之后的类型仍然为  <code>date</code>  类型</p>
<p><code>extract</code>  可以从日期和时间戳提取年月日等，返回  <code>number</code>  类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE) <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-12-19</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;MM&#x27;</span>) <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-12-1</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;YYYY&#x27;</span>) <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-1-1</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;DD&#x27;</span>) <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-12-19</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;HH&#x27;</span>) 或 HH24 <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-12-19 14:00:00</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;MI&#x27;</span>) <span class="keyword">FROM</span> DUAL; <span class="comment">--2012-12-19 14:30:00</span></span><br><span class="line"><span class="keyword">SELECT</span> TRUNC(SYSDATE,<span class="string">&#x27;SS&#x27;</span>) <span class="keyword">FROM</span> DUAL; <span class="comment">-- 会出现 bad precison specifier，直接用SYSDATE不用TRUNC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">extract</span>(<span class="keyword">year</span> <span class="keyword">from</span> systimestamp) <span class="keyword">year</span></span><br><span class="line">      ,<span class="built_in">extract</span>(<span class="keyword">month</span> <span class="keyword">from</span> systimestamp) <span class="keyword">month</span></span><br><span class="line">      ,<span class="built_in">extract</span>(<span class="keyword">day</span> <span class="keyword">from</span> systimestamp) <span class="keyword">day</span></span><br><span class="line"><span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">extract</span>(<span class="keyword">year</span> <span class="keyword">from</span> sysdate) <span class="keyword">year</span></span><br><span class="line">      ,<span class="built_in">extract</span>(<span class="keyword">month</span> <span class="keyword">from</span> sysdate) <span class="keyword">month</span></span><br><span class="line">      ,<span class="built_in">extract</span>(<span class="keyword">day</span> <span class="keyword">from</span> sysdate) <span class="keyword">day</span></span><br><span class="line"><span class="keyword">from</span> dual</span><br></pre></td></tr></table></figure>
<h3 id="decode"><a class="markdownIt-Anchor" href="#decode">#</a> Decode</h3>
<p><code>decode(条件,值1,返回值1,值2,返回值2,...值n,返回值n,缺省值)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> decode(sign(变量<span class="number">1</span> <span class="operator">-</span> 变量<span class="number">2</span>), <span class="number">-1</span>, 变量<span class="number">1</span>, 变量<span class="number">2</span>) <span class="keyword">from</span> dual; <span class="comment">--取较小值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--注意: select 1 from dual where null = null; 中 null = null 不成立，但是在 decode 中是满足的，应该是使用 is null。</span></span><br><span class="line"><span class="keyword">select</span> decode(ship_loc.city, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, ship_loc.city <span class="operator">||</span> <span class="string">&#x27;, &#x27;</span>); <span class="comment">--变量处理</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> table_subject</span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> decode(subject_name, <span class="string">&#x27;语文&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;数学&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;外语&#x27;</span>, <span class="number">3</span>); <span class="comment">--根据文字排序</span></span><br></pre></td></tr></table></figure>
<p><strong>decode 注意事项</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--decode 隐式转换以第一个返回值(如果是 null 当作 varchar)为基准</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--number 不能转换为 sysdate</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">null</span>, sysdate, <span class="number">1</span>) <span class="keyword">from</span> dual; <span class="comment">--ORA-00932: inconsistent datatypes: expected DATE got NUMBER</span></span><br><span class="line"><span class="comment">--varchar 可以转换为日期，但必须是指定格式</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">null</span>, sysdate, <span class="string">&#x27;a&#x27;</span>) <span class="keyword">from</span> dual; <span class="comment">--ORA-01858: a non-numeric character was found where a numeric was expected</span></span><br><span class="line"><span class="comment">--尝试将字符串 &#x27;1&#x27; 转换为日期</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">null</span>, sysdate, <span class="string">&#x27;1&#x27;</span>) <span class="keyword">from</span> dual; <span class="comment">--ORA-01840: input value not long enough for date format</span></span><br><span class="line"><span class="comment">--&#x27;15-JAN-20&#x27; 是 Server 指定 Format 格式可以转换为日期</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">null</span>, sysdate, <span class="string">&#x27;15-JAN-20&#x27;</span>) <span class="keyword">from</span> dual; <span class="comment">--2020/1/15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--&#x27;a&#x27; 是 varchar，sysdate 总是可以转换为 varchar, 返回 Server 指定 Format 格式</span></span><br><span class="line"><span class="keyword">select</span> decode(sysdate, <span class="keyword">null</span>, <span class="string">&#x27;a&#x27;</span>, sysdate) <span class="keyword">from</span> dual; <span class="comment">--14-JAN-20</span></span><br><span class="line"><span class="comment">-- null 当作 varchar，sysdate 总是可以转换为 varchar, 返回 Server 指定 Format 格式</span></span><br><span class="line"><span class="keyword">select</span> decode(sysdate, <span class="keyword">null</span>, <span class="keyword">null</span>, sysdate) <span class="keyword">from</span> dual; <span class="comment">--14-JAN-20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--null 当作 varchar, 转换第二个返回值为 varchar</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">null</span>, <span class="number">2</span>) <span class="keyword">from</span> dual <span class="comment">--返回字符 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--ORA-01790: expression must have same datatype as corresponding expression</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">null</span>, <span class="string">&#x27;2&#x27;</span>) <span class="keyword">from</span> dual <span class="comment">-- 字符 2</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual; <span class="comment">--数字 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--use to_number or case statment solve ORA-01790 error</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, to_number(<span class="keyword">null</span>), <span class="number">2</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">null</span> <span class="keyword">else</span> <span class="number">2</span> <span class="keyword">end</span> <span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br></pre></td></tr></table></figure>
<p><strong>decode and union 注意事项</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--null 当作 varchar, 转换第二个返回值为 varchar</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">null</span>, <span class="number">2</span>) <span class="keyword">from</span> dual <span class="comment">--返回字符 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--ORA-01790: expression must have same datatype as corresponding expression</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, <span class="keyword">null</span>, <span class="string">&#x27;2&#x27;</span>) <span class="keyword">from</span> dual <span class="comment">-- 字符 2</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual; <span class="comment">--数字 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--use to_number or case statment solve ORA-01790 error</span></span><br><span class="line"><span class="keyword">select</span> decode(<span class="number">1</span>, <span class="number">2</span>, to_number(<span class="keyword">null</span>), <span class="number">2</span>) <span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">null</span> <span class="keyword">else</span> <span class="number">2</span> <span class="keyword">end</span> <span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br></pre></td></tr></table></figure>
<p><strong>decode(null, null, null, null) union</strong></p>
<p>use sql only</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">null</span> <span class="keyword">from</span> dual</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> decode(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>) <span class="keyword">from</span> dual <span class="comment">--no error</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> to_char(<span class="keyword">null</span>) <span class="keyword">from</span> dual <span class="comment">--ORA-01790: expression must have same datatype as corresponding expression</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<p>use plsql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">  l_number number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">      <span class="keyword">into</span> l_number</span><br><span class="line">      <span class="keyword">from</span> (<span class="keyword">select</span> decode(<span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>) <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">2</span> <span class="keyword">from</span> dual); <span class="operator">=</span><span class="operator">=</span><span class="comment">--ORA-01790: expression must have same datatype as corresponding expression</span></span><br><span class="line">  exception</span><br><span class="line">    <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">      dbms_output.put_line(sqlerrm);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  dbms_output.put_line(l_number);</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="listagg"><a class="markdownIt-Anchor" href="#listagg">#</a> Listagg</h3>
<p>同组字符串拼接函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> temp <span class="keyword">as</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Guangzhou&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Shanghai&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Beijing&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;New York&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;Bostom&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;Japan&#x27;</span> nation ,<span class="string">&#x27;Tokyo&#x27;</span> city <span class="keyword">from</span> dual</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> nation, <span class="built_in">listagg</span>(city,<span class="string">&#x27;,&#x27;</span>)  <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> city <span class="keyword">desc</span>), <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">from</span> temp</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> nation;</span><br><span class="line"></span><br><span class="line">nation  citylistagg                   <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">------  --------------------------    --------</span></span><br><span class="line">China   Shanghai,Guangzhou,Beijing    <span class="number">3</span></span><br><span class="line">Japan   Tokyo                         <span class="number">1</span></span><br><span class="line">USA     <span class="keyword">New</span> York,Bostom               <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- null, &#x27;&#x27; 不会包含在 listagg 连接的字符串中, 需要进行 nvl 处理</span></span><br><span class="line"><span class="keyword">with</span> temp <span class="keyword">as</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Guangzhou&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation , <span class="keyword">null</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;New York&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;Bostom&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;Japan&#x27;</span> nation ,<span class="string">&#x27;Tokyo&#x27;</span> city <span class="keyword">from</span> dual</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> nation, <span class="built_in">listagg</span>(city,<span class="string">&#x27;,&#x27;</span>)  <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> city <span class="keyword">desc</span>), <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">from</span> temp</span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> nation;</span><br><span class="line"></span><br><span class="line">nation  citylistagg                   <span class="built_in">count</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">------  --------------------------    --------</span></span><br><span class="line">China   Guangzhou                     <span class="number">3</span></span><br><span class="line">Japan   Tokyo                         <span class="number">1</span></span><br><span class="line">USA     <span class="keyword">New</span> York,Bostom               <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--partitiobn by 不会影响记录条数</span></span><br><span class="line"><span class="keyword">with</span> temp <span class="keyword">as</span>(</span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Guangzhou&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Shanghai&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;China&#x27;</span> nation ,<span class="string">&#x27;Beijing&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;New York&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;USA&#x27;</span> nation ,<span class="string">&#x27;Bostom&#x27;</span> city <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;Japan&#x27;</span> nation ,<span class="string">&#x27;Tokyo&#x27;</span> city <span class="keyword">from</span> dual</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> nation,</span><br><span class="line">       <span class="built_in">listagg</span>(city, <span class="string">&#x27;,&#x27;</span>)  <span class="keyword">within</span> <span class="keyword">group</span>(<span class="keyword">order</span> <span class="keyword">by</span> city <span class="keyword">desc</span>) <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> nation) <span class="keyword">as</span> citylistagg,</span><br><span class="line">       <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> nation) <span class="keyword">as</span> g_total,</span><br><span class="line">       <span class="comment">--count(1) over(partition by 1) as total</span></span><br><span class="line">      <span class="built_in">count</span>(<span class="number">1</span>) <span class="keyword">over</span>() <span class="keyword">as</span> total</span><br><span class="line"><span class="keyword">from</span> temp;</span><br><span class="line"></span><br><span class="line">NATION  CITYLISTAGG                   G_TOTAL   TOTAL</span><br><span class="line"><span class="comment">------  --------------------------    --------  ------</span></span><br><span class="line">China   Shanghai,Guangzhou,Beijing    <span class="number">3</span>         <span class="number">6</span></span><br><span class="line">China   Shanghai,Guangzhou,Beijing    <span class="number">3</span>         <span class="number">6</span></span><br><span class="line">China   Shanghai,Guangzhou,Beijing    <span class="number">3</span>         <span class="number">6</span></span><br><span class="line">Japan   Tokyo                         <span class="number">1</span>         <span class="number">6</span></span><br><span class="line">USA     <span class="keyword">New</span> York,Bostom               <span class="number">2</span>         <span class="number">6</span></span><br><span class="line">USA     <span class="keyword">New</span> York,Bostom               <span class="number">2</span>         <span class="number">6</span></span><br></pre></td></tr></table></figure>
<h3 id="length"><a class="markdownIt-Anchor" href="#length">#</a> Length</h3>
<p>对  <code>'' 和 null</code>  会返回空，不会返回  <code>0</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> length(<span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"><span class="keyword">select</span> length(<span class="keyword">null</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="decimal"><a class="markdownIt-Anchor" href="#decimal">#</a> Decimal</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1.0</span>;</span><br><span class="line"><span class="comment">-- 1</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">1.0</span> <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">-- 1</span></span><br></pre></td></tr></table></figure>
<h3 id="any-is-null"><a class="markdownIt-Anchor" href="#any-is-null">#</a> Any is Null</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual <span class="keyword">where</span> greatest(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">null</span>, sysdate) <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual <span class="keyword">where</span> least(<span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="keyword">null</span>, sysdate) <span class="keyword">is</span> <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<h3 id="str-clean"><a class="markdownIt-Anchor" href="#str-clean">#</a> Str Clean</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Remove all CR/LF, trim the left and right spaces, tabs</span></span><br><span class="line"><span class="keyword">function</span> str_clean(p_str <span class="keyword">in</span> varchar2) <span class="keyword">return</span> varchar2</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  l_return varchar2(<span class="number">1000</span>);</span><br><span class="line">  l_tab_space varchar2(<span class="number">10</span>) :<span class="operator">=</span> chr(<span class="number">9</span>) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Standard ASCII Characters</span></span><br><span class="line"><span class="comment">   * Decimal    Description</span></span><br><span class="line"><span class="comment">   * 9         Horizontal tab (HT)</span></span><br><span class="line"><span class="comment">   * 10         Line feed (LF)</span></span><br><span class="line"><span class="comment">   * 13         Carriage return (CR)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">--translate(p_str, &#x27;a&#x27; || chr(10) || chr(13), &#x27;a&#x27;): a translate to a, chr(10) &amp; chr(13) replace to empty</span></span><br><span class="line">    <span class="comment">--ltrim(str, l_tab_space): trim left tab and space behavior like translate, such as &#x27;chr(9) chr(9) a&#x27; will trim to &#x27;a&#x27;</span></span><br><span class="line">    <span class="comment">--if use trim twice select trim(trim(chr(9) from chr(9) || &#x27; &#x27; || chr(9) ||  &#x27;a&#x27;)) from dual; will got &#x27;chr(9) a&#x27;</span></span><br><span class="line">    <span class="keyword">select</span> rtrim(ltrim(<span class="built_in">translate</span>(p_str, <span class="string">&#x27;a&#x27;</span> <span class="operator">||</span> chr(<span class="number">10</span>) <span class="operator">||</span> chr(<span class="number">13</span>), <span class="string">&#x27;a&#x27;</span>), l_tab_space), l_tab_space)</span><br><span class="line">      <span class="keyword">into</span> l_return</span><br><span class="line">      <span class="keyword">from</span> dual;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> l_return;</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span> str_clean;</span><br></pre></td></tr></table></figure>
<h3 id="right-and-pad-str"><a class="markdownIt-Anchor" href="#right-and-pad-str">#</a> Right and Pad Str</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substr(<span class="string">&#x27;abc&#x27;</span>, <span class="number">-2</span>) <span class="keyword">from</span> dual; <span class="comment">--bc</span></span><br><span class="line"><span class="keyword">select</span> substr(<span class="string">&#x27;abc&#x27;</span>, <span class="number">-2</span>) <span class="keyword">from</span> dual;<span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;abc&#x27;</span>, <span class="number">4</span>, <span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">--0abc</span></span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;abcde&#x27;</span>, <span class="number">4</span>, <span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">--abcd</span></span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;&#x27;</span>, <span class="number">4</span>, <span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;0&#x27;</span>, <span class="number">4</span>, <span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">--0000</span></span><br><span class="line"><span class="keyword">select</span> lpad(<span class="string">&#x27;0&#x27;</span>, <span class="number">4</span>) <span class="keyword">from</span> dual; <span class="comment">--   0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> right_str(p_str     <span class="keyword">in</span> varchar2,</span><br><span class="line">                   p_length  <span class="keyword">in</span> number,</span><br><span class="line">                   p_pad_str <span class="keyword">in</span> varchar2 <span class="keyword">default</span> <span class="string">&#x27; &#x27;</span>) <span class="keyword">return</span> varchar2</span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">  l_return varchar2(<span class="number">4000</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">case</span></span><br><span class="line">             <span class="keyword">when</span> length(p_str) <span class="operator">&gt;=</span> p_length <span class="keyword">then</span></span><br><span class="line">               substr(p_str, <span class="number">-1</span> <span class="operator">*</span> p_length)</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">               lpad(nvl(p_str, p_pad_str), p_length, p_pad_str)</span><br><span class="line">           <span class="keyword">end</span> </span><br><span class="line">      <span class="keyword">into</span> l_return</span><br><span class="line">      <span class="keyword">from</span> dual;</span><br><span class="line">  exception</span><br><span class="line">    <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">      l_return :<span class="operator">=</span> <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> l_return;</span><br><span class="line"><span class="keyword">end</span> right_str;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> right_str(<span class="string">&#x27;abc&#x27;</span>, <span class="number">4</span>, <span class="number">0</span>) <span class="keyword">from</span> dual; <span class="comment">--0abc</span></span><br></pre></td></tr></table></figure>
<h3 id="nocopy"><a class="markdownIt-Anchor" href="#nocopy">#</a> NOCOPY</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--NOCOPY Pass by Reference</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> proc_p1 (</span><br><span class="line">                    param_value <span class="keyword">IN</span> <span class="keyword">OUT</span> VARCHAR2</span><br><span class="line">                ) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    param_value :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED INSIDE PROCEDURE&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> SERVEROUTPUT <span class="keyword">ON</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">    lv_var VARCHAR2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    lv_var :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED IN anonymous block&#x27;</span>;</span><br><span class="line">    proc_p1(lv_var);</span><br><span class="line">    dbms_output.put_line(lv_var);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> proc_copy(param_value <span class="keyword">IN</span> <span class="keyword">OUT</span> VARCHAR2) <span class="keyword">AS</span></span><br><span class="line">  x NUMBER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  param_value :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED INSIDE PROCEDURE&#x27;</span>;</span><br><span class="line">  x        :<span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> serveroutput <span class="keyword">on</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  lv_var VARCHAR2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- To check the proc_copy</span></span><br><span class="line">  lv_var :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED IN anonymous block&#x27;</span>;</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    proc_copy(lv_var);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">NULL</span>;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(lv_var);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">PROCEDURE</span> proc_nocopy(param_value <span class="keyword">IN</span> <span class="keyword">OUT</span> NOCOPY VARCHAR2) <span class="keyword">AS</span></span><br><span class="line">  x NUMBER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  param_value :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED INSIDE PROCEDURE&#x27;</span>;</span><br><span class="line">  x        :<span class="operator">=</span> <span class="number">1</span> <span class="operator">/</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> serveroutput <span class="keyword">on</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  lv_var VARCHAR2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- To check the proc_nocopy -- NOCOPY</span></span><br><span class="line">  lv_var :<span class="operator">=</span> <span class="string">&#x27;ASSIGNED IN anonymous block&#x27;</span>;</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">    proc_nocopy(lv_var);</span><br><span class="line">  EXCEPTION</span><br><span class="line">    <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">      <span class="keyword">NULL</span>;</span><br><span class="line">  <span class="keyword">END</span>;</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(lv_var);  <span class="comment">-- ASSIGNED INSIDE PROCEDURE</span></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> proc_copy;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> proc_nocopy;</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package edi_demo_package <span class="keyword">as</span> </span><br><span class="line">  type nest_tab_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">4000</span>);</span><br><span class="line">  lv_nest_tab_var nest_tab_type :<span class="operator">=</span> nest_tab_type();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">procedure</span> p_copy(param_value <span class="keyword">in</span> <span class="keyword">out</span> nest_tab_type);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">procedure</span> p_no_copy(param_value <span class="keyword">in</span> <span class="keyword">out</span> nocopy nest_tab_type);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace package body edi_demo_package <span class="keyword">as</span> </span><br><span class="line">  <span class="keyword">procedure</span> p_copy(param_value <span class="keyword">in</span> <span class="keyword">out</span> nest_tab_type) <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">procedure</span> p_no_copy(param_value <span class="keyword">in</span> <span class="keyword">out</span> nocopy nest_tab_type) <span class="keyword">as</span> </span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  lv_start_time number;</span><br><span class="line">  lv_end_time   number;</span><br><span class="line">  lv_last_index number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.50000</span> loop</span><br><span class="line">    edi_demo_package.lv_nest_tab_var.extend;</span><br><span class="line">    lv_last_index :<span class="operator">=</span> edi_demo_package.lv_nest_tab_var.last();</span><br><span class="line">    edi_demo_package.lv_nest_tab_var(lv_last_index) :<span class="operator">=</span> lpad(<span class="string">&#x27;A&#x27;</span>, <span class="number">4000</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  lv_start_time :<span class="operator">=</span> dbms_utility.get_time;</span><br><span class="line">  edi_demo_package.p_copy(edi_demo_package.lv_nest_tab_var);</span><br><span class="line">  lv_end_time :<span class="operator">=</span> dbms_utility.get_time;</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;COPY = &#x27;</span> <span class="operator">||</span> (lv_end_time <span class="operator">-</span> lv_start_time)); <span class="comment">-- COPY = 31</span></span><br><span class="line">  </span><br><span class="line">  lv_start_time :<span class="operator">=</span> dbms_utility.get_time;</span><br><span class="line">  edi_demo_package.p_no_copy(edi_demo_package.lv_nest_tab_var);</span><br><span class="line">  lv_end_time :<span class="operator">=</span> dbms_utility.get_time;</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;NOCOPY = &#x27;</span> <span class="operator">||</span> (lv_end_time <span class="operator">-</span> lv_start_time)); <span class="comment">-- NOCOPY = 0</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> package edi_demo_package;</span><br></pre></td></tr></table></figure>
<h3 id="piplined"><a class="markdownIt-Anchor" href="#piplined">#</a> PIPLINED</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace type edi_t_varchar_list <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_get_emp_list <span class="keyword">return</span> edi_t_varchar_list <span class="keyword">as</span></span><br><span class="line">  l_name_list edi_t_varchar_list :<span class="operator">=</span> edi_t_varchar_list();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp) loop</span><br><span class="line">    dbms_lock.sleep(<span class="number">1</span>);</span><br><span class="line">    l_name_list.extend();</span><br><span class="line">    l_name_list(l_name_list.last()) :<span class="operator">=</span> i.ename;</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> l_name_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">from</span> <span class="keyword">table</span>(edi_t_get_emp_list()) </span><br><span class="line"> <span class="keyword">where</span> rownum <span class="operator">&lt;=</span> <span class="number">3</span>;   <span class="comment">--Cost 14s</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_get_emp_list_p <span class="keyword">return</span> edi_t_varchar_list pipelined <span class="keyword">as</span></span><br><span class="line">  l_name_list edi_t_varchar_list :<span class="operator">=</span> edi_t_varchar_list();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> scott.emp) loop</span><br><span class="line">    dbms_lock.sleep(<span class="number">1</span>);</span><br><span class="line">    pipe <span class="type">row</span>(i.ename);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">from</span> <span class="keyword">table</span>(edi_t_get_emp_list_p())</span><br><span class="line"> <span class="keyword">where</span> rownum <span class="operator">&lt;=</span> <span class="number">3</span>; <span class="comment">--Cost 3s</span></span><br></pre></td></tr></table></figure>
<h3 id="add_months-and-interval-month"><a class="markdownIt-Anchor" href="#add_months-and-interval-month">#</a> add_months and interval ‘’ month</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> add_months(to_date(<span class="string">&#x27;20240229&#x27;</span>, <span class="string">&#x27;yyyymmdd&#x27;</span>), <span class="number">12</span>) <span class="keyword">from</span> dual; <span class="comment">--2025-02-28</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--2025 不是闰年，2 月份只有 28 天没有 29 天</span></span><br><span class="line"><span class="keyword">select</span> to_date(<span class="string">&#x27;20240229&#x27;</span>, <span class="string">&#x27;yyyymmdd&#x27;</span>) <span class="operator">+</span> <span class="type">interval</span> <span class="string">&#x27;12&#x27;</span> <span class="keyword">month</span> <span class="keyword">from</span> dual; <span class="comment">--ORA-01839: date not valid for month specified</span></span><br></pre></td></tr></table></figure>
<h3 id="date-literal-and-timestamp-literal"><a class="markdownIt-Anchor" href="#date-literal-and-timestamp-literal">#</a> Date Literal and Timestamp Literal</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">date</span> <span class="string">&#x27;2007-06-15&#x27;</span>, <span class="comment">--date literal</span></span><br><span class="line">       <span class="type">date</span> <span class="string">&#x27;2007-06-15&#x27;</span> <span class="operator">+</span> <span class="number">14.5</span> <span class="operator">/</span> <span class="number">24</span>,</span><br><span class="line">       <span class="built_in">cast</span> (<span class="type">timestamp</span> <span class="string">&#x27;2007-06-15 14:30:00&#x27;</span> <span class="keyword">as</span> <span class="type">date</span>),</span><br><span class="line">       to_date(<span class="string">&#x27;2007-06-15 14:30&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD HH24:MI&#x27;</span>),</span><br><span class="line">       to_date(<span class="string">&#x27;2007-06-15 02:30 PM&#x27;</span>, <span class="string">&#x27;YYYY-MM-DD HH12:MI AM&#x27;</span>)</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> V$TIMEZONE_NAMES;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">  <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 14:30:00 +00:00&#x27;</span>,</span><br><span class="line">  <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 09:30:00 -05:00&#x27;</span>,</span><br><span class="line">  <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 10:30:00 Canada/Eastern&#x27;</span>,</span><br><span class="line">  <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 10:30:00 Canada/Eastern EDT&#x27;</span></span><br><span class="line"><span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="timestamp-timezone"><a class="markdownIt-Anchor" href="#timestamp-timezone">#</a> Timestamp Timezone</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> t <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 14:30:00 +00:00&#x27;</span> <span class="keyword">as</span> d <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 09:30:00 -05:00&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 10:30:00 Canada/Eastern&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> <span class="type">TIMESTAMP</span> <span class="string">&#x27;2007-06-15 10:30:00 Canada/Eastern EDT&#x27;</span> <span class="keyword">from</span> dual</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> d <span class="keyword">as</span> test_time_value,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="keyword">LOCAL</span> <span class="keyword">as</span> session_time_zone_time,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE SESSIONTIMEZONE <span class="keyword">as</span> session_time_zone_time2,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE DBTIMEZONE <span class="keyword">as</span> db_time_zone_time,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;+01:00&#x27;</span> <span class="keyword">as</span> utc_plus_1_time,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;-03:30&#x27;</span> <span class="keyword">as</span> utc_minus_3_30_time,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;Australia/Sydney&#x27;</span> <span class="keyword">as</span> sydney_time,</span><br><span class="line">       d <span class="keyword">AT</span> <span class="type">TIME</span> ZONE <span class="string">&#x27;UTC&#x27;</span> <span class="keyword">AS</span> utc_zone_time,</span><br><span class="line">       sys_extract_utc(d) <span class="keyword">as</span> utc_time</span><br><span class="line">  <span class="keyword">from</span> t;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">select</span> to_timestamp_tz(<span class="string">&#x27;December 12, 2023 4:30 AM 05:00&#x27;</span>, <span class="string">&#x27;Month dd, yyyy hh:mi AM TZH:TZM&#x27;</span>),</span><br><span class="line">       to_timestamp_tz(<span class="string">&#x27;December 12, 2023 4:30 AM 05:00&#x27;</span>, <span class="string">&#x27;Month dd, yyyy hh:mi AM TZH:TZM&#x27;</span>) <span class="keyword">AT</span> <span class="keyword">LOCAL</span></span><br><span class="line"> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="date-and-times-exact-formatting-with-the-fx-modifier"><a class="markdownIt-Anchor" href="#date-and-times-exact-formatting-with-the-fx-modifier">#</a> Date and Times Exact Formatting with the FX Modifier</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  to_date( <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;yyyy&#x27;</span> )                <span class="keyword">as</span> a, <span class="comment">-- three digit year, not four</span></span><br><span class="line">  to_timestamp( <span class="string">&#x27;2007    12&#x27;</span>, <span class="string">&#x27;yyyy mm&#x27;</span> ) <span class="keyword">as</span> b, <span class="comment">-- extra spaces</span></span><br><span class="line">  to_timestamp_tz( <span class="string">&#x27;2007/12&#x27;</span>, <span class="string">&#x27;yyyy-mm&#x27;</span> ) <span class="keyword">as</span> c  <span class="comment">-- &quot;/&quot; instead of &quot;-&quot;</span></span><br><span class="line"><span class="keyword">from</span> dual ;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr>
<td>0123-01-01</td>
<td>01-DEC-07 12.00.00.000000000 AM</td>
<td>01-DEC-07 12.00.00.000000000 AM +08:00</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_date( <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;FXyyyy&#x27;</span> ) <span class="keyword">as</span> a <span class="keyword">from</span> dual ; <span class="comment">--ORA-01862: the numeric value does not match the length of the format item</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> to_timestamp( <span class="string">&#x27;2007    12&#x27;</span>, <span class="string">&#x27;FXyyyy mm&#x27;</span> ) <span class="keyword">as</span> b <span class="keyword">from</span> dual; <span class="comment">--ORA-01858: a non-numeric character was found where a numeric was expected</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> to_timestamp_tz( <span class="string">&#x27;2007/12&#x27;</span>, <span class="string">&#x27;FXyyyy-mm&#x27;</span> ) <span class="keyword">as</span> c <span class="keyword">from</span> dual; <span class="comment">--ORA-01861: literal does not match format string</span></span><br></pre></td></tr></table></figure>
<h3 id="dates-and-times-fill-mode-formatting-with-the-fm-modifier"><a class="markdownIt-Anchor" href="#dates-and-times-fill-mode-formatting-with-the-fm-modifier">#</a> Dates and Times Fill Mode Formatting with the FM Modifier</h3>
<p>The Fill Mode modifier, FM, toggles the suppression of blank padding in character format elements like “MONTH” and leading zeros in numeric format elements like “YYYY”.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  sysdate <span class="keyword">as</span> input,</span><br><span class="line">  <span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> to_char( sysdate, <span class="string">&#x27;MONTH&#x27;</span>   ) <span class="operator">||</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">as</span> without_fm ,</span><br><span class="line">  <span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> to_char( sysdate, <span class="string">&#x27;FMMONTH&#x27;</span> ) <span class="operator">||</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">as</span> with_fm</span><br><span class="line"><span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>INPUT</th>
<th>WITHOUT_FM</th>
<th>WITH_FM</th>
</tr>
</thead>
<tbody>
<tr>
<td>2024-01-06 02:52:09 PM</td>
<td>&quot;JANUARY  &quot;</td>
<td>“JANUARY”</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  sysdate <span class="keyword">as</span> input,</span><br><span class="line">  <span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> to_char( sysdate, <span class="string">&#x27;MM&#x27;</span>   ) <span class="operator">||</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">as</span> without_fm ,</span><br><span class="line">  <span class="string">&#x27;&quot;&#x27;</span> <span class="operator">||</span> to_char( sysdate, <span class="string">&#x27;FMMM&#x27;</span> ) <span class="operator">||</span> <span class="string">&#x27;&quot;&#x27;</span> <span class="keyword">as</span> with_fm</span><br><span class="line"><span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>INPUT</th>
<th>WITHOUT_FM</th>
<th>WITH_FM</th>
</tr>
</thead>
<tbody>
<tr>
<td>2024-01-06 03:02:59 PM</td>
<td>“01”</td>
<td>“1”</td>
</tr>
</tbody>
</table>
<h3 id="date-and-times-format-suffixes"><a class="markdownIt-Anchor" href="#date-and-times-format-suffixes">#</a> Date and Times Format Suffixes</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TH   - converts numbers to ordinal numbers</span><br><span class="line"></span><br><span class="line">SP   - converts numbers to words</span><br><span class="line"></span><br><span class="line">SPTH - converts numbers to ordinal words</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  to_char( <span class="type">timestamp</span> <span class="string">&#x27;2007-04-03 02:01:01&#x27;</span>, <span class="string">&#x27;yyyyTH, mmTH, ddTH, hhTH, miTH, ssTH&#x27;</span> ) output,</span><br><span class="line">  to_char( <span class="type">timestamp</span> <span class="string">&#x27;2007-04-03 02:01:01&#x27;</span>, <span class="string">&#x27;FMyyyyTH, mmTH, ddTH, hhTH, miTH, ssTH&#x27;</span> ) <span class="keyword">as</span> output1,</span><br><span class="line">  to_char( <span class="type">timestamp</span> <span class="string">&#x27;2000-04-03 02:01:00&#x27;</span>, <span class="string">&#x27;mmSP, ddSP, hh24SP, miSP, ssSP&#x27;</span> ) <span class="keyword">as</span> output2,</span><br><span class="line">  to_char( <span class="type">timestamp</span> <span class="string">&#x27;2000-04-03 02:01:00&#x27;</span>, <span class="string">&#x27;mmSPTH, ddTHSP hh24SPTH, miTHSP, ssSPTH&#x27;</span> ) <span class="keyword">as</span> output3</span><br><span class="line"><span class="keyword">from</span> dual ;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>OUTPUT</th>
<th>OUTPUT1</th>
<th>OUTPUT2</th>
<th>OUTPUT3</th>
</tr>
</thead>
<tbody>
<tr>
<td>2007th, 04th, 03rd, 02nd, 01st, 01st</td>
<td>2007th, 4th, 3rd, 2nd, 1st, 1st</td>
<td>four, three, two, one, zero</td>
<td>fourth, third second, first, zeroeth</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--The formatting suffixes appear to have problems dealing with some values like zeros and negative years </span></span><br><span class="line"><span class="keyword">select</span> to_char( <span class="type">timestamp</span> <span class="string">&#x27;2007-04-03 02:01:00&#x27;</span>, <span class="string">&#x27;ssTH&#x27;</span> ) <span class="keyword">as</span> output</span><br><span class="line"><span class="keyword">from</span> dual;  <span class="comment">--ORA-01877: string is too long for internal buffer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> to_char( <span class="type">timestamp</span> <span class="string">&#x27;-1001-01-01 00:00:00&#x27;</span>, <span class="string">&#x27;syyyySP&#x27;</span> ) <span class="keyword">as</span> output</span><br><span class="line"><span class="keyword">from</span> dual;  <span class="comment">--ORA-01877: string is too long for internal buffer</span></span><br></pre></td></tr></table></figure>
<h3 id="function-return-more-value"><a class="markdownIt-Anchor" href="#function-return-more-value">#</a> Function return more value</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_t_fn(p_deptno <span class="keyword">in</span> number)</span><br><span class="line">  <span class="keyword">return</span> sys.odcivarchar2list</span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line">  l_name_list sys.odcivarchar2list;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> s.ename </span><br><span class="line">    bulk <span class="keyword">collect</span> <span class="keyword">into</span> l_name_list</span><br><span class="line">    <span class="keyword">from</span> scott.emp s</span><br><span class="line">   <span class="keyword">where</span> s.deptno <span class="operator">=</span> p_deptno;</span><br><span class="line">   </span><br><span class="line"> <span class="keyword">return</span> l_name_list;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span>(edi_t_fn(<span class="number">20</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop function edi_t_fn;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>COLUMN_VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>SMITH</td>
</tr>
<tr>
<td>JONES</td>
</tr>
<tr>
<td>SCOTT</td>
</tr>
<tr>
<td>ADAMS</td>
</tr>
<tr>
<td>FORD</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace type edi_cube_obj <span class="keyword">as</span> object (</span><br><span class="line">  name varchar2(<span class="number">50</span>),</span><br><span class="line">  <span class="keyword">value</span> number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace type edi_cube_tab_obj <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> edi_cube_obj;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_squre_cube(p_number number) <span class="keyword">return</span> edi_cube_tab_obj</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">  l_var edi_cube_tab_obj :<span class="operator">=</span> edi_cube_tab_obj();</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_var.extend();</span><br><span class="line">  l_var(l_var.last()) :<span class="operator">=</span> edi_cube_obj(<span class="string">&#x27;SQUARE&#x27;</span>, p_number <span class="operator">*</span> p_number);</span><br><span class="line">  </span><br><span class="line">  l_var.extend();</span><br><span class="line">  l_var(l_var.last()) :<span class="operator">=</span> edi_cube_obj(<span class="string">&#x27;CUBE&#x27;</span>, p_number <span class="operator">*</span>  p_number <span class="operator">*</span> p_number);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> l_var;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">table</span>(edi_squre_cube(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">--drop type edi_cube_obj;</span></span><br><span class="line"><span class="comment">--drop type edi_cube_tab_obj;</span></span><br><span class="line"><span class="comment">--drop function edi_squre_cube;</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>NAME</th>
<th>VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQUARE</td>
<td>4</td>
</tr>
<tr>
<td>CUBE</td>
<td>8</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> edi_squre_cube(p_number number) <span class="keyword">return</span> sys_refcursor</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">  l_ret_cursor sys_refcursor;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">open</span> l_ret_cursor <span class="keyword">for</span> </span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;SQURE&#x27;</span> <span class="keyword">as</span> name, p_number <span class="operator">*</span> p_number <span class="keyword">as</span> <span class="keyword">value</span> <span class="keyword">from</span> dual</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;CUBE&#x27;</span>, p_number <span class="operator">*</span> p_number <span class="operator">*</span> p_number <span class="keyword">from</span> dual;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> l_ret_cursor;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  type ref_cur <span class="keyword">is</span> <span class="keyword">ref</span> <span class="keyword">cursor</span>;</span><br><span class="line">  l_cur ref_cur;</span><br><span class="line">  l_name varchar2(<span class="number">10</span>);</span><br><span class="line">  l_value number;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_cur :<span class="operator">=</span> edi_squre_cube(<span class="number">2</span>);</span><br><span class="line">  </span><br><span class="line">  loop</span><br><span class="line">    <span class="keyword">fetch</span> l_cur <span class="keyword">into</span> l_name, l_value;</span><br><span class="line">    exit <span class="keyword">when</span> l_cur<span class="operator">%</span>notfound;</span><br><span class="line">    dbms_output.put_line(l_name <span class="operator">||</span> <span class="string">&#x27;=&#x27;</span> <span class="operator">||</span> l_value);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--SQURE=4</span></span><br><span class="line"><span class="comment">--CUBE=8</span></span><br></pre></td></tr></table></figure>
<h3 id="replace-non-breaking-space-u00a0"><a class="markdownIt-Anchor" href="#replace-non-breaking-space-u00a0">#</a> Replace Non-breaking space (\u00A0)</h3>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cudXRmOC1jaGFydGFibGUuZGUvdW5pY29kZS11dGY4LXRhYmxlLnBsP3N0YXJ0PTEyOCZhbXA7bnVtYmVyPTEyOCZhbXA7bmFtZXM9LSZhbXA7dXRmOD0weA==">UTF-8 encoding table and Unicode characters</span></p>
</blockquote>
<p>Non-breaking space unicode point is  <code>U+00A0</code> ，UTF-8 represention is  <code>0xc2 0xa0</code></p>
<table>
<thead>
<tr>
<th>Unicode code point</th>
<th>character</th>
<th>UTF-8 (hex.)</th>
</tr>
</thead>
<tbody>
<tr>
<td>U+00A0</td>
<td> </td>
<td>0xc2 0xa0</td>
</tr>
</tbody>
</table>
<p>In PL/SQL Developer Hex Tab show charcter’s unicode point not UTF-8 represention. And the order is reversed, the  <code>U+00A0</code>  is show  <code>A000</code> .</p>
<img data-src="/2019/06/06/oracle/1733735140904.png" class="">
<img data-src="/2019/06/06/oracle/1733735246220.png" class="">
<p>In VSCode use Hex Editor Extension.</p>
<img data-src="/2019/06/06/oracle/1733740196611.png" class="">
<p>Use  <code>CHR(160 USING NCHAR_CS)</code>  or  <code>NCHAR(160)</code>  replace Non-breaking space</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> carrier_no,</span><br><span class="line">       replace(carrier_no, CHR(<span class="number">160</span> <span class="keyword">USING</span> NCHAR_CS), <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">       replace(carrier_no, NCHR(<span class="number">160</span>), <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  <span class="keyword">from</span> som_edi_test;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vZGF0YWJhc2Uvb3JhY2xlL29yYWNsZS1kYXRhYmFzZS8xOS9zcWxyZi9DSFIuaHRtbCNHVUlELTM1RkVFMDA3LUQ0OUMtNDU2Mi1BOTA0LTA0MTE4NkFDODkyOA==">SQL Language Reference</span></p>
</blockquote>
<p><code>CHR</code>  returns the character having the binary equivalent to <em> <code>n</code> </em> as a  <code>VARCHAR2</code>  value in either the database character set or, if you specify  <code>USING</code>   <code>NCHAR_CS</code> , the national character set.</p>
<p>For single-byte character sets, if  <code>n</code>  &gt; 256, then Oracle Database returns the binary equivalent of  <code>n</code>   <code>mod</code>   <code>256</code> . <strong>For multibyte character sets,  <code>n</code>  must resolve to one entire code point.</strong> Invalid code points are not validated, and the result of specifying invalid code points is indeterminate.</p>
<p>This function takes as an argument a  <code>NUMBER</code>  value, or any value that can be implicitly converted to  <code>NUMBER</code> , and returns a character.</p>
<blockquote>
<p>Note:Use of the  <code>CHR</code>  function (either with or without the optional  <code>USING</code>   <code>NCHAR_CS</code>  clause) results in code that is not portable between ASCII- and EBCDIC-based machine architectures.</p>
</blockquote>
<p><code>NCHR</code>  returns the character having the binary equivalent to <em> <code>number</code> </em> in the national character set. The value returned is always  <code>NVARCHAR2</code> . This function is equivalent to using the  <code>CHR</code>  function with the  <code>USING</code>   <code>NCHAR_CS</code>  clause.</p>
<p>This function takes as an argument a  <code>NUMBER</code>  value, or any value that can be implicitly converted to  <code>NUMBER</code> , and returns a character.</p>
<h3 id="oracle-regex-bracket-expression-include-and-"><a class="markdownIt-Anchor" href="#oracle-regex-bracket-expression-include-and-">#</a> Oracle Regex Bracket expression include ] and -</h3>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vZW4vZGF0YWJhc2Uvb3JhY2xlL29yYWNsZS1kYXRhYmFzZS8yMy9zcWxyZi9NdWx0aWxpbmd1YWwtUmVndWxhci1FeHByZXNzaW9uLVN5bnRheC5odG1s">Multilingual Regular Expression Syntax</span></p>
</blockquote>
<table>
<thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>[ ]</td>
<td>Bracket expression for specifying a matching list that should match any one of the expressions represented in the list. A non-matching list expression begins with a circumflex (^) and specifies a list that matches any character except for the expressions represented in the list.<br /><strong>To specify a right bracket (]) in the bracket expression, place it first in the list (after the initial circumflex (^), if any).</strong><br /><strong>To specify a hyphen in the bracket expression, place it first in the list (after the initial circumflex (^), if any), last in the list, or as an ending range point in a range expression.</strong></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> regexp_instr(<span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;[][0-9a-z_ ().,;&#123;&#125;&#x27;&#x27;&quot;/-]&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">       regexp_instr(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;[][0-9a-z_ ().,;&#123;&#125;&#x27;&#x27;&quot;/-]&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">       regexp_instr(<span class="string">&#x27;]-&#x27;</span> <span class="operator">||</span> nchr(<span class="number">160</span>), <span class="string">&#x27;[^][0-9a-z_ ().,;&#123;&#125;&#x27;&#x27;&quot;/-]&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br><span class="line"><span class="comment">--1 1 3</span></span><br></pre></td></tr></table></figure>
<h2 id="cte"><a class="markdownIt-Anchor" href="#cte">#</a> CTE</h2>
<h3 id="caculate-pi"><a class="markdownIt-Anchor" href="#caculate-pi">#</a> Caculate PI</h3>
<p>半径为 1 的正方形中包含半径为 1 的 1/4 圆，落在圆中的概率为 1/4 圆的面积除以正方形的面积即  <code>1/4 * PI * 1 * 1 / 1 * 1 = 1/4 * PI</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> t(n, x, y) <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> <span class="number">1</span>, dbms_random.value, dbms_random.value <span class="keyword">from</span> dual</span><br><span class="line">  <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> n<span class="operator">+</span><span class="number">1</span>, dbms_random.value, dbms_random.value <span class="keyword">from</span> t</span><br><span class="line">  <span class="keyword">where</span> n <span class="operator">&lt;=</span> <span class="number">1000000</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="number">4</span> <span class="operator">*</span> <span class="built_in">sum</span>(<span class="number">1</span> <span class="operator">-</span> <span class="built_in">floor</span>(x <span class="operator">*</span> x <span class="operator">+</span> y <span class="operator">*</span> y)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> PI <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>
<h3 id="snail-climbing-well"><a class="markdownIt-Anchor" href="#snail-climbing-well">#</a> Snail climbing well</h3>
<p>一口井深二十米，蜗牛白天向上爬五米，晚上向下滑三米，问第几天能爬出井？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> t(n, high) <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> <span class="number">1</span>, <span class="number">5</span> <span class="keyword">from</span> dual</span><br><span class="line">  <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">  <span class="keyword">select</span> n <span class="operator">+</span> <span class="number">1</span>, high <span class="operator">+</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="built_in">mod</span>(n <span class="operator">+</span> <span class="number">1</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> <span class="number">-2</span> <span class="keyword">else</span> <span class="number">5</span> <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">from</span> t</span><br><span class="line">  <span class="keyword">where</span> high <span class="operator">&lt;</span> <span class="number">20</span> </span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">max</span>(n<span class="operator">+</span><span class="number">1</span>) <span class="operator">/</span> <span class="number">2</span> <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>
<h2 id="plsql"><a class="markdownIt-Anchor" href="#plsql">#</a> PLSQL</h2>
<h3 id="sqlcode-sqlerrm"><a class="markdownIt-Anchor" href="#sqlcode-sqlerrm">#</a> Sqlcode Sqlerrm</h3>
<p>Oracle 内置函数  <code>SQLCODE</code>  和  <code>SQLERRM</code>  是一般用在异常  <code>OTHERS</code>  处理器中，分别用来返回 Oracle 的错误代码和错误消息。</p>
<p>在一个内在的异常中，SQLCODE 返回 Oracle 错误的序号，而 SQLERRM 返回的是相应的错误消息。</p>
<ul>
<li>SQLCODE 返回 +100, SQLERRM 返回 “ORA-01403：NO DATA FOUND”;</li>
<li>SQLCODE 返回 +1, SQLERRM 返回的是 “User-Defined Exception”;</li>
<li>SQLCODE 返回 0, SQLERRM 返回 “ORA-0000：normal, successful completion”。</li>
</ul>
<h3 id="error-backtrace"><a class="markdownIt-Anchor" href="#error-backtrace">#</a> Error Backtrace</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">   l_char varchar2(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">into</span> l_char <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="number">1</span> <span class="operator">&lt;&gt;</span> <span class="number">1</span>;</span><br><span class="line">exception <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- format_error_backtrace会打印出错行号</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;format_error_backtrace: &#x27;</span> <span class="operator">||</span> dbms_utility.format_error_backtrace);</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;format_error_stack: &#x27;</span><span class="operator">||</span> dbms_utility.format_error_stack);</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;format_call_stack: &#x27;</span> <span class="operator">||</span> dbms_utility.format_call_stack);</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;sqlerrm: &#x27;</span> <span class="operator">||</span> sqlerrm);</span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;sqlcode: &#x27;</span> <span class="operator">||</span> sqlcode);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">format_error_backtrace: ORA-06512: at line 4</span></span><br><span class="line"><span class="comment">format_error_stack: ORA-01403: no data found</span></span><br><span class="line"><span class="comment">format_call_stack: ----- PL/SQL Call Stack -----</span></span><br><span class="line"><span class="comment">  object      line  object</span></span><br><span class="line"><span class="comment">  handle    number  name</span></span><br><span class="line"><span class="comment">0x458e9f088         8  anonymous block</span></span><br><span class="line"><span class="comment">sqlerrm: ORA-01403: no data found</span></span><br><span class="line"><span class="comment">sqlcode: 100</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>注意：<br>
dbms_output.put 只会输出内容到缓存<br>
 dbms_output.new_line 输出缓存内容并换行</p>
<h3 id="array"><a class="markdownIt-Anchor" href="#array">#</a> Array</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--固定数组</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type type_array <span class="keyword">is</span> varray(<span class="number">10</span>) <span class="keyword">of</span> varchar2(<span class="number">20</span>); <span class="comment">--一维数组，字符串类型</span></span><br><span class="line">  var_array type_array :<span class="operator">=</span> type_array(<span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">--数组的长度用count(索引是從1開始的)</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. var_array.count loop</span><br><span class="line">    dbms_output.put_line(var_array(i));</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--可变数组</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type type_array <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> varchar2(<span class="number">20</span>) index <span class="keyword">by</span> binary_integer;</span><br><span class="line">  var_array type_array;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">--下标必须是连续的,并且索引从1开始</span></span><br><span class="line">  var_array(<span class="number">1</span>) :<span class="operator">=</span> <span class="string">&#x27;java&#x27;</span>;</span><br><span class="line">  var_array(<span class="number">2</span>) :<span class="operator">=</span> <span class="string">&#x27;php&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. var_array.count loop</span><br><span class="line">    dbms_output.put_line(var_array(i));</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--类似二维数组</span></span><br><span class="line"><span class="comment">--IS TABLE OF：指定是一个集合的表的数组类型，简单的来说就是一个可以存储一列多行的数据类型。</span></span><br><span class="line"><span class="comment">--INDEX BY BINARY_INTEGER：指索引组织类型。</span></span><br><span class="line"><span class="comment">--BULK COLLECT：指是一个成批聚合类型，简单的来说，它可以存储一个多行多列存储类型，采用BULK COLLECT可以将查询结果一次性地加载到集合中。</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">  type type_array <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> som_edi_temp_d<span class="operator">%</span>rowtype index <span class="keyword">by</span> binary_integer;</span><br><span class="line">  var_array type_array;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">select</span> <span class="operator">*</span> bulk <span class="keyword">collect</span> <span class="keyword">into</span> var_array <span class="keyword">from</span> som_edi_temp_d;</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. <span class="number">10</span> loop</span><br><span class="line">    dbms_output.put_line(<span class="string">&#x27;订单id: &#x27;</span> <span class="operator">||</span> var_array(i).edi_id <span class="operator">||</span> <span class="string">&#x27;, 订单类型: &#x27;</span> <span class="operator">||</span> var_array(i)</span><br><span class="line">                         .edi_type);</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--数组的相关属性</span></span><br><span class="line">COUNT             返回集合中元素的个数</span><br><span class="line"><span class="keyword">DELETE</span>            删除集合中所有元素</span><br><span class="line"><span class="keyword">DELETE</span>(x)         删除元素下标为x的元素，对VARRAY非法</span><br><span class="line"><span class="keyword">DELETE</span>(x,y)       删除元素下标从X到Y的元素，对VARRAY非法</span><br><span class="line">EXIST(x)          如果集合元素x已经初始化，则返回<span class="literal">TRUE</span>, 否则返回<span class="literal">FALSE</span></span><br><span class="line">EXTEND            在集合末尾添加一个元素，对Index_by非法</span><br><span class="line">EXTEND(x)         在集合末尾添加x个元素，对Index_by非法</span><br><span class="line">EXTEND(x,n)       在集合末尾添加元素n的x个副本，对Index_by非法</span><br><span class="line"><span class="keyword">FIRST</span>             返回集合中的第一个元素的下标号，对于VARRAY集合始终返回<span class="number">1</span>。</span><br><span class="line"><span class="keyword">LAST</span>              返回集合中最后一个元素的下标号，对于VARRAY返回值始终等于COUNT.</span><br><span class="line">LIMIT             返回VARRY集合的最大的元素个数，Index_by集合和嵌套表无用</span><br><span class="line">NEXT(x)           返回在第x个元素之后及紧挨着它的元素值，如果x是最后一个元素，返回null.</span><br><span class="line">PRIOR(x)          返回在第x个元素之前紧挨着它的元素的值，如果x是第一个元素，则返回<span class="keyword">null</span>。</span><br><span class="line">TRIM              从集合末端开始删除一个元素，对于index_by不合法</span><br><span class="line"><span class="built_in">TRIM</span>(x)           从集合末端开始删除x个元素</span><br></pre></td></tr></table></figure>
<h3 id="multiset"><a class="markdownIt-Anchor" href="#multiset">#</a> Multiset</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> </span><br><span class="line">  type num_tab_type <span class="keyword">is</span> <span class="keyword">table</span> <span class="keyword">of</span> number;</span><br><span class="line">  l_num_list1 num_tab_type :<span class="operator">=</span> num_tab_type(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line">  l_num_list2 num_tab_type :<span class="operator">=</span> num_tab_type(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>);</span><br><span class="line">  l_num_list3 num_tab_type;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="comment">--l_num_list3 := l_num_list1 multiset union all l_num_list2;</span></span><br><span class="line">  <span class="comment">--l_num_list3 := l_num_list1 multiset union distinct l_num_list2;</span></span><br><span class="line">  <span class="comment">--l_num_list3 := l_num_list1 multiset intersect l_num_list2;</span></span><br><span class="line">  <span class="comment">--l_num_list3 := l_num_list1 multiset except l_num_list2;</span></span><br><span class="line">  l_num_list3 :<span class="operator">=</span> l_num_list1 <span class="keyword">multiset</span> <span class="keyword">except</span> <span class="keyword">distinct</span> l_num_list2;</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. l_num_list3.count loop</span><br><span class="line">    dbms_output.put_line(l_num_list3(i));</span><br><span class="line">  <span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="dbms_lock-sleep"><a class="markdownIt-Anchor" href="#dbms_lock-sleep">#</a> DBMS_LOCK Sleep</h3>
<p>DBMS_SESSION.SLEEP Replaces DBMS_LOCK.SLEEP in Oracle 18c.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Time 1: &#x27;</span> <span class="operator">||</span> to_char(systimestamp, <span class="string">&#x27;hh24:mi:ss.ff&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Pause for 1 second.</span></span><br><span class="line">  dbms_lock.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Time 2: &#x27;</span> <span class="operator">||</span> to_char(systimestamp, <span class="string">&#x27;hh24:mi:ss.ff&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- Pause for half a second.</span></span><br><span class="line">  dbms_lock.sleep(<span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;Time 3: &#x27;</span> <span class="operator">||</span> to_char(systimestamp, <span class="string">&#x27;hh24:mi:ss.ff&#x27;</span>));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--Time 1: 16:19:00.959801000</span></span><br><span class="line"><span class="comment">--Time 2: 16:19:01.960960000</span></span><br><span class="line"><span class="comment">--Time 3: 16:19:02.461997000</span></span><br></pre></td></tr></table></figure>
<h3 id="dbms_random"><a class="markdownIt-Anchor" href="#dbms_random">#</a> DBMS_RANDOM</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_seed  BINARY_INTEGER;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">--l_seed := TO_NUMBER(TO_CHAR(SYSDATE,&#x27;YYYYDDMMSS&#x27;));</span></span><br><span class="line">  l_seed :<span class="operator">=</span> TO_NUMBER(TO_CHAR(<span class="type">timestamp</span> <span class="string">&#x27;2024-01-13 12:00:00&#x27;</span>,<span class="string">&#x27;YYYYDDMMSS&#x27;</span>));</span><br><span class="line">  DBMS_RANDOM.initialize (val <span class="operator">=</span><span class="operator">&gt;</span> l_seed);</span><br><span class="line">  <span class="keyword">FOR</span> cur_rec <span class="keyword">IN</span> <span class="number">1</span> .<span class="number">.10</span> LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;----&#x27;</span>);</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;value                      : &#x27;</span> <span class="operator">||</span> TO_CHAR(DBMS_RANDOM.value));</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;value(low =&gt; 1, high =&gt; 10): &#x27;</span> <span class="operator">||</span> TO_CHAR(DBMS_RANDOM.value(low <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">1</span>, high <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">10</span>)));</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line">  DBMS_RANDOM.terminate;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">FOR</span> cur_rec <span class="keyword">IN</span> <span class="number">1</span> .<span class="number">.10</span> LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;----&#x27;</span>);</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;value                      : &#x27;</span> <span class="operator">||</span> TO_CHAR(DBMS_RANDOM.value));</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;value(low =&gt; 1, high =&gt; 10): &#x27;</span> <span class="operator">||</span> TO_CHAR(DBMS_RANDOM.value(low <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">1</span>, high <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">10</span>)));</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<h3 id="dbms_utilitycomma_to_table-table_to_comma"><a class="markdownIt-Anchor" href="#dbms_utilitycomma_to_table-table_to_comma">#</a> DBMS_UTILITY.comma_to_table &amp; table_to_comma</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_list1   VARCHAR2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;A,B,C,D,E,F,G,H,I,J&#x27;</span>;</span><br><span class="line">  l_list2   VARCHAR2(<span class="number">50</span>);</span><br><span class="line">  l_tablen  BINARY_INTEGER;</span><br><span class="line">  l_tab     DBMS_UTILITY.uncl_array;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  DBMS_OUTPUT.put_line(<span class="string">&#x27;l_list1 : &#x27;</span> <span class="operator">||</span> l_list1);</span><br><span class="line"></span><br><span class="line">  DBMS_UTILITY.comma_to_table (</span><br><span class="line">     list   <span class="operator">=</span><span class="operator">&gt;</span> l_list1,</span><br><span class="line">     tablen <span class="operator">=</span><span class="operator">&gt;</span> l_tablen,</span><br><span class="line">     tab    <span class="operator">=</span><span class="operator">&gt;</span> l_tab);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FOR</span> i <span class="keyword">IN</span> <span class="number">1</span> .. l_tablen LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(i <span class="operator">||</span> <span class="string">&#x27; : &#x27;</span> <span class="operator">||</span> l_tab(i));</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  DBMS_UTILITY.table_to_comma (</span><br><span class="line">     tab    <span class="operator">=</span><span class="operator">&gt;</span> l_tab,</span><br><span class="line">     tablen <span class="operator">=</span><span class="operator">&gt;</span> l_tablen,</span><br><span class="line">     list   <span class="operator">=</span><span class="operator">&gt;</span> l_list2);</span><br><span class="line"></span><br><span class="line">  DBMS_OUTPUT.put_line(<span class="string">&#x27;l_list2 : &#x27;</span> <span class="operator">||</span> l_list2);</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">l_list1 : A,B,C,D,E,F,G,H,I,J</span></span><br><span class="line"><span class="comment">1 : A</span></span><br><span class="line"><span class="comment">2 : B</span></span><br><span class="line"><span class="comment">3 : C</span></span><br><span class="line"><span class="comment">4 : D</span></span><br><span class="line"><span class="comment">5 : E</span></span><br><span class="line"><span class="comment">6 : F</span></span><br><span class="line"><span class="comment">7 : G</span></span><br><span class="line"><span class="comment">8 : H</span></span><br><span class="line"><span class="comment">9 : I</span></span><br><span class="line"><span class="comment">10 : J</span></span><br><span class="line"><span class="comment">l_list2 : A,B,C,D,E,F,G,H,I,J</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="other"><a class="markdownIt-Anchor" href="#other">#</a> Other</h2>
<h3 id="plsql-use-as-assignment"><a class="markdownIt-Anchor" href="#plsql-use-as-assignment">#</a> PLSQL use := as assignment</h3>
<p>PLSQL uses  <code>:=</code>  as the assignment operator to avoid confusion with equality. equality use  <code>=</code>  directly.</p>
<h3 id="tnsping"><a class="markdownIt-Anchor" href="#tnsping">#</a> Tnsping</h3>
<p>tnsping 可以检查 Oracle 是否连通， <code>tnsping instance</code></p>
<blockquote>
<p>tnsping TEST</p>
</blockquote>
<h3 id="sql-plus-connect-db"><a class="markdownIt-Anchor" href="#sql-plus-connect-db">#</a> SQL Plus Connect DB</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">sqlplus name<span class="operator">/</span>pwd<span class="variable">@ip</span>:port<span class="operator">/</span>service_name</span><br><span class="line"></span><br><span class="line"><span class="comment">--------tnsnames.ora--------</span></span><br><span class="line">DEV <span class="operator">=</span></span><br><span class="line">  (DESCRIPTION <span class="operator">=</span></span><br><span class="line">    (ADDRESS_LIST <span class="operator">=</span></span><br><span class="line">      (ADDRESS <span class="operator">=</span> (PROTOCOL <span class="operator">=</span> tcp)(HOST <span class="operator">=</span> xxx)(PORT <span class="operator">=</span> yyy))</span><br><span class="line">    )</span><br><span class="line">    (CONNECT_DATA <span class="operator">=</span></span><br><span class="line">      (SERVICE_NAME <span class="operator">=</span> DEV1)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"><span class="comment">--------tnsnames.ora--------</span></span><br></pre></td></tr></table></figure>
<h3 id="db-link"><a class="markdownIt-Anchor" href="#db-link">#</a> DB Link</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询数据库 db_link (user_db_links, all_db_links, dba_db_links)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_db_links;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以跨不同 DB 查询远程数据库数据，如下在 Oracle 中查询 SQLServer 中的资料</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> &quot;dbo&quot;.&quot;ssc_t_edi_head&quot;<span class="variable">@sqlserver</span>_db_link <span class="keyword">where</span> &quot;delivery_no&quot; <span class="operator">=</span> <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 获取当前数据库 ip</span></span><br><span class="line"><span class="keyword">select</span> utl_inaddr.get_host_address <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 Oracle Prod 环境中 Test 环境的 DB Link: test_db_link</span></span><br><span class="line"><span class="comment">-- 可以通过如下方式把 Prod 环境中的资料写到 Test 环境中</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> ysc_edi_inbound_header<span class="variable">@test</span>_db_link <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ysc_edi_inbound_header;</span><br></pre></td></tr></table></figure>
<h3 id="build-id-seq"><a class="markdownIt-Anchor" href="#build-id-seq">#</a> Build Id Seq</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> level <span class="keyword">as</span> id <span class="keyword">from</span> dual <span class="keyword">connect</span> <span class="keyword">by</span>  level <span class="operator">&lt;</span> <span class="number">5</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1 1</span></span><br><span class="line"><span class="comment">2 2</span></span><br><span class="line"><span class="comment">3 3</span></span><br><span class="line"><span class="comment">4 4</span></span><br><span class="line"><span class="comment">5 5</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">select</span> rownum <span class="keyword">as</span> id <span class="keyword">from</span> xmltable(<span class="string">&#x27;1 to 10&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> level <span class="operator">+</span> <span class="number">5</span> <span class="keyword">as</span> id <span class="keyword">from</span> dual <span class="keyword">connect</span> <span class="keyword">by</span>  level <span class="operator">&lt;=</span> <span class="number">10</span> <span class="operator">-</span> <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--可以使用 connect by 生成测试数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> TMP_TABLE <span class="keyword">select</span> <span class="string">&#x27;TMP&#x27;</span><span class="operator">||</span> lpad(rownum, <span class="number">7</span>, <span class="number">0</span>), rownum, sysdate <span class="keyword">from</span> dual <span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> <span class="number">1000000</span>;</span><br></pre></td></tr></table></figure>
<h3 id="placeholder"><a class="markdownIt-Anchor" href="#placeholder">#</a> &amp; Placeholder</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dual <span class="keyword">where</span> <span class="number">1</span> <span class="operator">=</span> <span class="operator">&amp;</span>p;</span><br><span class="line"></span><br><span class="line">DUMMY</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">X</span><br></pre></td></tr></table></figure>
<img data-src="/2019/06/06/oracle/ampersand.png" class="" title="ampersand">
<h3 id="plsql-developer-autoreplace"><a class="markdownIt-Anchor" href="#plsql-developer-autoreplace">#</a> PL/SQL Developer AutoReplace</h3>
<p>Tools/Preferences/User Interface/Editor/AutoReplace</p>
<img data-src="/2019/06/06/oracle/1700298428670.png" class="">
<p>snippet.txt</p>
<p>可以在名称前添加特殊符号，防止与表名简写冲突，例如 #，测试发现 ！不可以 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">w<span class="operator">=</span><span class="keyword">where</span></span><br><span class="line">f<span class="operator">=</span><span class="keyword">from</span></span><br><span class="line">o<span class="operator">=</span><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">dt<span class="operator">=</span><span class="keyword">delete</span></span><br><span class="line">sf<span class="operator">=</span><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span></span><br><span class="line">df<span class="operator">=</span><span class="keyword">delete</span> <span class="keyword">from</span></span><br><span class="line">sc<span class="operator">=</span><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span></span><br><span class="line">g<span class="operator">=</span><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">tt<span class="operator">=</span><span class="keyword">truncate</span> <span class="keyword">table</span></span><br><span class="line">dr<span class="operator">=</span><span class="keyword">drop</span> <span class="keyword">table</span></span><br><span class="line">ct<span class="operator">=</span><span class="keyword">create</span> <span class="keyword">table</span></span><br><span class="line">sd<span class="operator">=</span><span class="keyword">select</span> <span class="keyword">distinct</span></span><br><span class="line">qs<span class="operator">=</span><span class="keyword">select</span> som_edi_custom_utils_pkg.str_quotify(<span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> dual</span><br><span class="line">qstr<span class="operator">=</span>qstr.tpl</span><br><span class="line">#qstr<span class="operator">=</span>qstr.tpl</span><br></pre></td></tr></table></figure>
<p>qstr.tpl</p>
<p>Define AutoReplace MultiLines</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> som_edi_custom_utils_pkg.str_quotify(<span class="string">&#x27;</span></span><br><span class="line"><span class="string">  [#]</span></span><br><span class="line"><span class="string">&#x27;</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="calculate-luhn-checksum"><a class="markdownIt-Anchor" href="#calculate-luhn-checksum">#</a> Calculate Luhn Checksum</h3>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTHVobl9hbGdvcml0aG0=">Luhn algorithm - Wikipedia</span></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> calculate_luhn_checksum(p_number <span class="keyword">in</span> varchar2) <span class="keyword">return</span> number <span class="keyword">is</span></span><br><span class="line">    l_digit      number;</span><br><span class="line">    l_multiplier number;</span><br><span class="line">    l_sum_digits number;</span><br><span class="line">    l_sum        number :<span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span> .. length(p_number) loop</span><br><span class="line">        l_digit      :<span class="operator">=</span> to_number(substr(p_number, <span class="operator">-</span>i, <span class="number">1</span>));</span><br><span class="line">        l_multiplier :<span class="operator">=</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="built_in">mod</span>(i, <span class="number">2</span>) <span class="operator">!=</span> <span class="number">0</span> <span class="keyword">then</span> <span class="number">2</span> <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span>;</span><br><span class="line">        l_sum_digits :<span class="operator">=</span> <span class="built_in">mod</span>(l_digit <span class="operator">*</span> l_multiplier, <span class="number">10</span>) <span class="operator">+</span> trunc(l_digit <span class="operator">*</span> l_multiplier <span class="operator">/</span> <span class="number">10</span>);</span><br><span class="line">        l_sum        :<span class="operator">=</span> l_sum <span class="operator">+</span> l_sum_digits;</span><br><span class="line">      <span class="keyword">end</span> loop;</span><br><span class="line">    </span><br><span class="line">      l_sum :<span class="operator">=</span> <span class="built_in">mod</span>(<span class="number">10</span> <span class="operator">-</span> <span class="built_in">mod</span>(l_sum, <span class="number">10</span>), <span class="number">10</span>);</span><br><span class="line">    exception</span><br><span class="line">      <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">        raise;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> l_sum;</span><br><span class="line"> <span class="keyword">end</span> calculate_luhn_checksum;</span><br></pre></td></tr></table></figure>
<h3 id="edi-parse"><a class="markdownIt-Anchor" href="#edi-parse">#</a> EDI Parse</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> edi_t (</span><br><span class="line">  id number,</span><br><span class="line">  data varchar2(<span class="number">4000</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> edi_t</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>, <span class="string">&#x27;ISA*00*          *00*          *ZZ*123456789ABCDEF*14*XXXXXXXTEST    *230420*1008*U*00401*000000009*0*T*&gt;&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span>, <span class="string">&#x27;GS*SH*123456789ABCDEF*XXXXXXXTESTT*20230420*1008*000000009*X*004010&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span>, <span class="string">&#x27;ST*861*0001&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">4</span>, <span class="string">&#x27;BRA*ABC0001*20130719*00*2&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">5</span>, <span class="string">&#x27;DTM*050*20130719&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">6</span>, <span class="string">&#x27;N1*WH*270711&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">7</span>, <span class="string">&#x27;RCD**144*EA&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">8</span>, <span class="string">&#x27;LIN*000001*BP*ITEM1&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">9</span>, <span class="string">&#x27;REF*LS*PALLET101&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">10</span>, <span class="string">&#x27;RCD**144*EA&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">11</span>, <span class="string">&#x27;LIN*000001*BP*ITEM1&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">12</span>, <span class="string">&#x27;REF*LS*PALLET102&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">13</span>, <span class="string">&#x27;RCD**120*EA&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">14</span>, <span class="string">&#x27;LIN*000002*BP*ITEM2&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">15</span>, <span class="string">&#x27;REF*LS*PALLET201&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">16</span>, <span class="string">&#x27;RCD**120*EA&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">17</span>, <span class="string">&#x27;LIN*000002*BP*ITEM2&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">18</span>, <span class="string">&#x27;REF*LS*PALLET202&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">19</span>, <span class="string">&#x27;CTT*4&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">20</span>, <span class="string">&#x27;SE*18*000090001&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">21</span>, <span class="string">&#x27;GE*1*000000009&#x27;</span> <span class="keyword">from</span> dual <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="number">22</span>, <span class="string">&#x27;IEA*1*000000009&#x27;</span> <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> edi_t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> t <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> id, data, regexp_substr(data, <span class="string">&#x27;(.*?\*)&#123;&#x27;</span> <span class="operator">||</span> (column_value <span class="operator">-</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#125;([^\*]*)&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">2</span>) <span class="keyword">as</span> w, column_value <span class="operator">-</span> <span class="number">1</span> <span class="keyword">as</span> r</span><br><span class="line">    <span class="keyword">from</span> edi_t,</span><br><span class="line">         <span class="keyword">table</span>(<span class="built_in">cast</span>(<span class="keyword">multiset</span> (<span class="keyword">select</span> level l</span><br><span class="line">                                <span class="keyword">from</span> dual</span><br><span class="line">                             <span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> regexp_count(data, <span class="string">&#x27;\*&#x27;</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="keyword">as</span> sys.odcinumberlist)</span><br><span class="line">               )</span><br><span class="line">),</span><br><span class="line">t1 <span class="keyword">as</span> (</span><br><span class="line">   <span class="keyword">select</span> id, data, <span class="keyword">case</span> <span class="keyword">when</span> r <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> w <span class="keyword">else</span> <span class="keyword">null</span> <span class="keyword">end</span> <span class="keyword">as</span> s, w, r <span class="keyword">from</span> t</span><br><span class="line">),</span><br><span class="line">t2 <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> id, data, <span class="built_in">last_value</span>(s ignore nulls) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> id, r) s, w, r</span><br><span class="line">    <span class="keyword">from</span> t1</span><br><span class="line">   <span class="keyword">order</span> <span class="keyword">by</span> id, r</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">from</span> t2</span><br><span class="line"><span class="comment">--where s = &#x27;RCD&#x27; and r = 2;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> t <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> id, data, regexp_substr(data, <span class="string">&#x27;(.*?\*)&#123;&#x27;</span> <span class="operator">||</span> (l <span class="operator">-</span> <span class="number">1</span>) <span class="operator">||</span> <span class="string">&#x27;&#125;([^\*]*)&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">2</span>) <span class="keyword">as</span> w, l <span class="operator">-</span> <span class="number">1</span> <span class="keyword">as</span> r</span><br><span class="line">    <span class="keyword">from</span> edi_t,</span><br><span class="line">         (</span><br><span class="line">            <span class="keyword">select</span> level l</span><br><span class="line">              <span class="keyword">from</span> dual</span><br><span class="line">            <span class="keyword">connect</span> <span class="keyword">by</span> level <span class="operator">&lt;=</span> (<span class="keyword">select</span> <span class="built_in">max</span>(regexp_count(data, <span class="string">&#x27;\*&#x27;</span>) <span class="operator">+</span> <span class="number">1</span>) <span class="keyword">from</span> edi_t)</span><br><span class="line">         )</span><br><span class="line">   <span class="keyword">where</span> l <span class="operator">&lt;=</span> regexp_count(data, <span class="string">&#x27;\*&#x27;</span>) <span class="operator">+</span> <span class="number">1</span> </span><br><span class="line">),</span><br><span class="line">t1 <span class="keyword">as</span> (</span><br><span class="line">   <span class="keyword">select</span> id, data, <span class="keyword">case</span> <span class="keyword">when</span> r <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> w <span class="keyword">else</span> <span class="keyword">null</span> <span class="keyword">end</span> <span class="keyword">as</span> s, w, r <span class="keyword">from</span> t</span><br><span class="line">),</span><br><span class="line">t2 <span class="keyword">as</span> (</span><br><span class="line">  <span class="keyword">select</span> id, data, <span class="built_in">last_value</span>(s ignore nulls) <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> id, r) s, w, r</span><br><span class="line">    <span class="keyword">from</span> t1</span><br><span class="line">   <span class="keyword">order</span> <span class="keyword">by</span> id, r</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">  <span class="keyword">from</span> t2;</span><br></pre></td></tr></table></figure>
<h3 id="create-a-unique-filename-using-only-datetime"><a class="markdownIt-Anchor" href="#create-a-unique-filename-using-only-datetime">#</a> Create a unique filename using only DateTime</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">execute</span> immediate <span class="string">&#x27;select 1 from som_edi_test_header for update&#x27;</span>;</span><br><span class="line">          </span><br><span class="line">  <span class="keyword">select</span> <span class="built_in">max</span>(sh.creation_date)</span><br><span class="line">    <span class="keyword">into</span> l_max_creation_date</span><br><span class="line">    <span class="keyword">from</span> som_edi_test_header sh;</span><br><span class="line">          </span><br><span class="line">  update som_edi_test_header sh</span><br><span class="line">     <span class="keyword">set</span> sh.creation_date <span class="operator">=</span> l_max_creation_date <span class="operator">+</span> <span class="type">interval</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">second</span> <span class="comment">--`sh.creation_date = sh.creation_date + interval &#x27;1&#x27; second` can not be used here, because the programs run concurrently, `sh.creation_date + &#x27;1&#x27; second` maybe already exists. </span></span><br><span class="line">   <span class="keyword">where</span> sh.header_id <span class="operator">=</span> p_header_id</span><br><span class="line">     <span class="keyword">and</span> to_char(sh.creation_date, <span class="string">&#x27;yyyymmddhh24miss&#x27;</span>) <span class="keyword">in</span></span><br><span class="line">         (<span class="keyword">select</span> to_char(creation_date, <span class="string">&#x27;yyyymmddhh24miss&#x27;</span>)</span><br><span class="line">            <span class="keyword">from</span> som_edi_test_header</span><br><span class="line">           <span class="keyword">where</span> header_id <span class="operator">!=</span> p_header_id); <span class="comment">--The current record needs to be excluded here, or condition is always true.</span></span><br><span class="line">          </span><br><span class="line">  <span class="keyword">commit</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">select</span> <span class="string">&#x27;ASN&#x27;</span></span><br><span class="line">         <span class="operator">||</span> <span class="string">&#x27;_&#x27;</span> <span class="operator">||</span> to_char(sh.creation_date, <span class="string">&#x27;yyyymmddhh24miss&#x27;</span>)</span><br><span class="line">         <span class="operator">||</span> <span class="string">&#x27;.csv&#x27;</span></span><br><span class="line">   <span class="keyword">into</span> l_asn_filename</span><br><span class="line">   <span class="keyword">from</span> som_edi_test_header sh</span><br><span class="line">  <span class="keyword">where</span> sh.header_id <span class="operator">=</span> p_header_id;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="create-a-unique-filename-using-counter-and-date"><a class="markdownIt-Anchor" href="#create-a-unique-filename-using-counter-and-date">#</a> Create a unique filename using Counter and Date</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span> </span><br><span class="line">    <span class="keyword">execute</span> immediate <span class="string">&#x27;select 1 from som_edi_test_header for update&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    update som_edi_test_header seh</span><br><span class="line">       <span class="keyword">set</span> seh.file_counter <span class="operator">=</span> </span><br><span class="line">           (<span class="keyword">select</span> nvl(<span class="built_in">max</span>(sh.file_counter), <span class="number">0</span>) <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">              <span class="keyword">from</span> som_edi_test_header sh</span><br><span class="line">             <span class="keyword">where</span> sh.transfer_flag <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> </span><br><span class="line">               <span class="keyword">and</span> sh.creation_date <span class="operator">&gt;=</span> trunc(sysdate)</span><br><span class="line">               <span class="keyword">and</span> sh.creation_date <span class="operator">&lt;</span> trunc(sysdate) <span class="operator">+</span> <span class="type">interval</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">day</span>)</span><br><span class="line">     <span class="keyword">where</span> seh.header_id <span class="operator">=</span> p_header_id;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">--Not commit here, commit after the transfer_flag is &#x27;Y&#x27;. Because the where condition includes transfer_flag = &#x27;Y&#x27;</span></span><br><span class="line">    <span class="comment">--If the where not condition includes transfer_flag = &#x27;Y&#x27;, then an rror(transfer_flag != &#x27;Y&#x27;) will add up the file_counter, the file_counter will not continuous</span></span><br><span class="line">    <span class="comment">--commit; </span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;ASN&#x27;</span></span><br><span class="line">        <span class="operator">||</span> <span class="string">&#x27;_&#x27;</span> <span class="operator">||</span> to_char(sh.creation_date, <span class="string">&#x27;yyyymmdd&#x27;</span>)</span><br><span class="line">        <span class="operator">||</span> <span class="string">&#x27;_&#x27;</span> <span class="operator">||</span> sh.file_counter</span><br><span class="line">        <span class="operator">||</span> <span class="string">&#x27;.txt&#x27;</span></span><br><span class="line">      <span class="keyword">into</span> l_asn_filename</span><br><span class="line">      <span class="keyword">from</span> som_edi_test_header sh       </span><br><span class="line">      <span class="keyword">where</span> sh.header_id <span class="operator">=</span> p_header_id</span><br><span class="line">     <span class="keyword">group</span> <span class="keyword">by</span> sh.creation_date, sh.file_counter;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">--Logical Code</span></span><br><span class="line">       </span><br><span class="line">  if nvl(retcode, <span class="string">&#x27;0&#x27;</span>) <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">then</span></span><br><span class="line">    update som_edi_test_header sh</span><br><span class="line">       <span class="keyword">set</span> sh.file_name <span class="operator">=</span> l_asn_filename,</span><br><span class="line">           sh.transfer_flag <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span>,</span><br><span class="line">           sh.transfer_date <span class="operator">=</span> sysdate</span><br><span class="line">     <span class="keyword">where</span> sh.header_id <span class="operator">=</span> p_header_id;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">commit</span>; <span class="comment">--Commit Here</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">rollback</span>;</span><br><span class="line">                                  </span><br><span class="line">    update som_edi_test_header sh</span><br><span class="line">       <span class="keyword">set</span> sh.file_name <span class="operator">=</span> l_asn_filename,</span><br><span class="line">           sh.transfer_flag <span class="operator">=</span> <span class="string">&#x27;N&#x27;</span>,</span><br><span class="line">           sh.transfer_date <span class="operator">=</span> sysdate</span><br><span class="line">     <span class="keyword">where</span> sh.header_id <span class="operator">=</span> p_header_id;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">commit</span>;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="caculate-count-and-counter"><a class="markdownIt-Anchor" href="#caculate-count-and-counter">#</a> Caculate Count and Counter</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;QCLD&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">      <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(), <span class="number">6</span>, <span class="string">&#x27;R&#x27;</span>) <span class="comment">--Containter Count</span></span><br><span class="line">      <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> container_value), <span class="number">11</span>, <span class="string">&#x27;R&#x27;</span>)  <span class="comment">--Containter Counter</span></span><br><span class="line">      <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;CTN&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;R&#x27;</span>) </span><br><span class="line">      <span class="operator">||</span> <span class="keyword">case</span> <span class="keyword">when</span> sel.container_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span> </span><br><span class="line">           chr(<span class="number">10</span>)</span><br><span class="line">           <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;QREF&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;R&#x27;</span>)    </span><br><span class="line">           <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;SI&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;R&#x27;</span>)                 </span><br><span class="line">           <span class="operator">||</span> som_edi_cisco_pkg.char_format(sel.container_value, <span class="number">30</span>, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">null</span></span><br><span class="line">         <span class="keyword">end</span>                                                            </span><br><span class="line">      data,</span><br><span class="line">      sel.container_value</span><br><span class="line">   <span class="keyword">from</span> som_edi_856_header seh,</span><br><span class="line">        som_edi_856_line   sel</span><br><span class="line">  <span class="keyword">where</span> seh.edi856_id <span class="operator">=</span> sel.edi856_id</span><br><span class="line">    <span class="keyword">and</span> seh.edi856_id <span class="operator">=</span> <span class="number">60214</span></span><br><span class="line">    <span class="keyword">and</span> seh.customer_po <span class="operator">=</span> <span class="string">&#x27;2020417008&#x27;</span></span><br><span class="line">  <span class="keyword">group</span> <span class="keyword">by</span> sel.container_value</span><br><span class="line">  <span class="keyword">order</span> <span class="keyword">by</span> sel.container_value;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>DATA</th>
<th>CONTAINER_VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>QCLD  <code>2</code>       <code>1</code>           CTN  QREF SI  AC001</td>
<td>AC001</td>
</tr>
<tr>
<td>QCLD  <code>2</code>       <code>2</code>           CTN  QREF SI  AC002</td>
<td>AC002</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  som_edi_cisco_pkg.char_format(<span class="string">&#x27;ZCLD&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;R&#x27;</span>)                                                 </span><br><span class="line">        <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">over</span>(), <span class="number">6</span>, <span class="string">&#x27;R&#x27;</span>) <span class="comment">--Carton Count                    </span></span><br><span class="line">        <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="built_in">count</span>(<span class="operator">*</span>), <span class="number">11</span>, <span class="string">&#x27;R&#x27;</span>)  <span class="comment">--Item Count in Carton                   </span></span><br><span class="line">        <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;BOX&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">        <span class="operator">||</span> <span class="keyword">case</span> <span class="keyword">when</span> sel.carton_id_value <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">then</span></span><br><span class="line">             chr(<span class="number">10</span>)</span><br><span class="line">             <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;ZREF&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">             <span class="operator">||</span> som_edi_cisco_pkg.char_format(<span class="string">&#x27;97&#x27;</span>, <span class="number">4</span>, <span class="string">&#x27;R&#x27;</span>)                                          </span><br><span class="line">             <span class="operator">||</span> som_edi_cisco_pkg.char_format(sel.carton_id_value, <span class="number">30</span>, <span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">           <span class="keyword">else</span> </span><br><span class="line">             <span class="keyword">null</span></span><br><span class="line">           <span class="keyword">end</span>                                                               </span><br><span class="line">        data,</span><br><span class="line">        sel.carton_id_value</span><br><span class="line">     <span class="keyword">from</span> som_edi_856_header seh,</span><br><span class="line">          som_edi_856_line   sel</span><br><span class="line">    <span class="keyword">where</span> seh.edi856_id <span class="operator">=</span> sel.edi856_id</span><br><span class="line">      <span class="keyword">and</span> seh.edi856_id <span class="operator">=</span> <span class="number">60214</span></span><br><span class="line">      <span class="keyword">and</span> seh.customer_po <span class="operator">=</span> <span class="string">&#x27;2020417008&#x27;</span></span><br><span class="line">      <span class="keyword">and</span> nvl(sel.container_value, <span class="string">&#x27;N/A&#x27;</span>) <span class="operator">=</span> nvl(<span class="string">&#x27;AC001&#x27;</span>, <span class="string">&#x27;N/A&#x27;</span>)</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> sel.carton_id_value</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> sel.carton_id_value;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>DATA</th>
<th>CARTON_ID_VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td>ZCLD  <code>12</code>      <code>4</code>           BOX  ZREF 97  TCT001</td>
<td>TCT001</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT002</td>
<td>TCT002</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT003</td>
<td>TCT003</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT004</td>
<td>TCT004</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT005</td>
<td>TCT005</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT006</td>
<td>TCT006</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT007</td>
<td>TCT007</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT008</td>
<td>TCT008</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT009</td>
<td>TCT009</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT010</td>
<td>TCT010</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT011</td>
<td>TCT011</td>
</tr>
<tr>
<td>ZCLD 12    4          BOX  ZREF 97  TCT012</td>
<td>TCT012</td>
</tr>
</tbody>
</table>
<h2 id="erp-and-form"><a class="markdownIt-Anchor" href="#erp-and-form">#</a> ERP and Form</h2>
<h3 id="erp-request-recursive-call"><a class="markdownIt-Anchor" href="#erp-request-recursive-call">#</a> ERP Request recursive call</h3>
<p>有的时候程式 Parent Request 调用 Sub Request 时不小心将 Parrent Request 需要调用的 Sub Request 的名字写成了自己，会造成循环调用 Request 无法停止，这时可以将 Request 调用的 Package 故意修改成编译产生错误的形式，然后编译，此时 Request 会错误然后停止。</p>
<h3 id="erp-request-concurrent"><a class="markdownIt-Anchor" href="#erp-request-concurrent">#</a> ERP Request Concurrent</h3>
<p>在一个 Parent Request 中先后调用两个 Sub Request 时，不能依赖它们的先后执行顺序，并且这两个 Sub Request 不应该共用同一张表的同一个 Flag。 以 A 和 B 两个 Request 对同一个表 T 生成不同的 A_ASN, B_ASN 为例，具体为 A 抓取表 T 的 transfer_flag 为 ‘N’ 的资料，生成 A_ASN, 然后将 transfer_flag 更新为 ‘Y’,<br>
B 抓取表 T 的 transfer_flag 为 ‘N’ 的资料，生成 B_ASN, 然后将 transfer_flag 更新为 ‘Y’。可能的结果有：</p>
<p>A 执行生成 A_ASN, B 执行生成 B_ASN，A 更新 transfer_flag, B 更新 transfer_flag</p>
<p>A 执行生成 A_ASN, A 更新 transfer_flag, B 此时抓不到资料</p>
<p>B 执行生成 B_ASN, B 更新 transfer_flag，A 此时抓不到资料</p>
<p>…</p>
<p>这种代码可能测试时总是第一种期望的情况，但是这里是存在问题的，ERP 网络环境，表结构，程式结构的更改都可能造成下一次的运行结果与上一次不一致。</p>
<h3 id="erp-form-error"><a class="markdownIt-Anchor" href="#erp-form-error">#</a> ERP Form Error</h3>
<p>在做 Transact Move Orders 时弹出错误： <code>累计拣货数量超过报关数量</code></p>
<ol>
<li>搜索  <code>累计拣货数量超过报关数量</code> ，检查 form 的 trigger 都没有发现相关代码和描述</li>
<li>在 plsql 中使用  <code>select * from all_source s where s.TEXT like '%累计拣货数量超过报关数量%';</code>  结果在一个 table trigger 中找到相关文字，查看 trigger 代码可以看到实际原因是报关资料抄写没有抄写成功。</li>
</ol>
<h3 id="erp-form-setting-item-property-to-unspecified"><a class="markdownIt-Anchor" href="#erp-form-setting-item-property-to-unspecified">#</a> ERP Form setting item property to Unspecified</h3>
<p>How to set item propert to  <code>Unspecified</code>  value. For example, i have radio button with Background color sets to ‘gray’ and i want set it to  <code>Unspecified</code>  to get transparency effect and i can’t do this. If i set property value to blank forms builder shout “color by this name does not exist”.</p>
<p>Answser: Go to the item in question and press the ‘Inherit’ button in the ‘Property Palette’.</p>
<h3 id="get-form-rquest-name-and-excustion-file-name"><a class="markdownIt-Anchor" href="#get-form-rquest-name-and-excustion-file-name">#</a> Get Form Rquest Name and Excustion File Name</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> fv.USER_EXECUTABLE_NAME, fv.EXECUTION_FILE_NAME</span><br><span class="line">  <span class="keyword">from</span> FND_EXECUTABLES_FORM_V fv</span><br><span class="line"> <span class="keyword">where</span> <span class="built_in">upper</span>(fv.USER_EXECUTABLE_NAME) <span class="keyword">like</span> <span class="string">&#x27;SOMP%EDI%&#x27;</span></span><br><span class="line">    <span class="keyword">or</span> <span class="built_in">upper</span>(fv.USER_EXECUTABLE_NAME) <span class="keyword">like</span> <span class="string">&#x27;SOMP%HUB%&#x27;</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> fv.USER_EXECUTABLE_NAME</span><br><span class="line"></span><br><span class="line"><span class="comment">--USER_EXECUTABLE_NAME	           EXECUTION_FILE_NAME</span></span><br><span class="line"><span class="comment">--SOMP3101: EDI Outbound 855/865   SOM_EDI855865_OUTBOUND_PKG.MAIN</span></span><br><span class="line"><span class="comment">--SOMP4031: HUB ASN	               som_hub_pkg.asn</span></span><br></pre></td></tr></table></figure>
<h3 id="get-organization-id-and-code-from-mtl_parameters"><a class="markdownIt-Anchor" href="#get-organization-id-and-code-from-mtl_parameters">#</a> Get Organization ID and CODE from MTL_PARAMETERS</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> mp.organization_id,</span><br><span class="line">       mp.organization_code</span><br><span class="line">  <span class="keyword">from</span> mtl_parameters mp;</span><br><span class="line"><span class="comment">-- organization_id  organization_code</span></span><br><span class="line"><span class="comment">-- 85               SN</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> mp.organization_code</span><br><span class="line">  <span class="keyword">from</span> oe_order_lines_all ol,</span><br><span class="line">       mtl_parameters     mp</span><br><span class="line"> <span class="keyword">where</span> ol.ship_from_org_id <span class="operator">=</span> mp.organization_id;</span><br></pre></td></tr></table></figure>
<h3 id="set_policy_context"><a class="markdownIt-Anchor" href="#set_policy_context">#</a> SET_POLICY_CONTEXT</h3>
<p>oe_transaction_types_v 直接查询会查不到数据，需要设置 CONTEXT.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  MO_GLOBAL.SET_POLICY_CONTEXT(<span class="string">&#x27;S&#x27;</span>, <span class="number">81</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> oe_transaction_types_v;</span><br></pre></td></tr></table></figure>
<h3 id="get-profile"><a class="markdownIt-Anchor" href="#get-profile">#</a> Get Profile</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> fnd_profile.value(<span class="string">&#x27;ORG_ID&#x27;</span>)</span><br><span class="line">  <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>
<h3 id="get-flexfield"><a class="markdownIt-Anchor" href="#get-flexfield">#</a> Get FlexField</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1. fnd_flex_value_sets 这张表记录了所有值集的名称和值集id</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> fnd_flex_value_sets</span><br><span class="line"> <span class="keyword">where</span> <span class="built_in">upper</span>(flex_value_set_name) <span class="operator">=</span> <span class="string">&#x27;NOTES_STATUS&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--2. fnd_flex_values这张表记录了每一个值集对应的可选值</span></span><br><span class="line"><span class="keyword">select</span> flex_value</span><br><span class="line">  <span class="keyword">from</span> fnd_flex_values</span><br><span class="line"> <span class="keyword">where</span> flex_value_set_id <span class="keyword">in</span></span><br><span class="line">       (<span class="keyword">select</span> flex_value_set_id</span><br><span class="line">          <span class="keyword">from</span> fnd_flex_value_sets</span><br><span class="line">         <span class="keyword">where</span> <span class="built_in">upper</span>(flex_value_set_name) <span class="operator">=</span> <span class="string">&#x27;NOTES_STATUS&#x27;</span>);</span><br><span class="line"><span class="comment">--flex_value</span></span><br><span class="line"><span class="comment">--10</span></span><br><span class="line"><span class="comment">--20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--3. fnd_flex_values_tl对应每一个值集对应的可选值的说明</span></span><br><span class="line"><span class="keyword">select</span> description</span><br><span class="line">  <span class="keyword">from</span> fnd_flex_values_tl</span><br><span class="line"> <span class="keyword">where</span> flex_value_id <span class="keyword">in</span></span><br><span class="line">       (<span class="keyword">select</span> flex_value_id</span><br><span class="line">          <span class="keyword">from</span> fnd_flex_values</span><br><span class="line">         <span class="keyword">where</span> flex_value_set_id <span class="keyword">in</span></span><br><span class="line">               (<span class="keyword">select</span> flex_value_set_id</span><br><span class="line">                  <span class="keyword">from</span> fnd_flex_value_sets</span><br><span class="line">                 <span class="keyword">where</span> <span class="built_in">upper</span>(flex_value_set_name) <span class="operator">=</span> <span class="string">&#x27;NOTES_STATUS&#x27;</span>));</span><br></pre></td></tr></table></figure>
<h3 id="request-check"><a class="markdownIt-Anchor" href="#request-check">#</a> Request Check</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> r.argument1, r.argument2, r.request_date</span><br><span class="line">  <span class="keyword">from</span> sfn_fnd_concurrent_requests r,</span><br><span class="line">       fnd_concurrent_programs_tl t</span><br><span class="line"> <span class="keyword">where</span>  <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">   <span class="keyword">and</span> t.concurrent_program_id <span class="operator">=</span> r.concurrent_program_id</span><br><span class="line">   <span class="comment">--and r.request_id = 33534323</span></span><br><span class="line">   <span class="comment">--and r.concurrent_program_id = 62486</span></span><br><span class="line">   <span class="keyword">and</span> r.last_update_date <span class="operator">&gt;</span> to_date(<span class="string">&#x27;2020-05-01 18:14:15&#x27;</span>, <span class="string">&#x27;yyyy-mm-dd hh24:mi:ss&#x27;</span>)</span><br><span class="line">   <span class="keyword">and</span> t.user_concurrent_program_name <span class="operator">=</span> <span class="string">&#x27;SOMP4024: 3C3 Invoice OUTPUT&#x27;</span></span><br><span class="line">   <span class="keyword">and</span> r.status_code <span class="operator">=</span> <span class="string">&#x27;E&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="in-trigger-call-erp-request"><a class="markdownIt-Anchor" href="#in-trigger-call-erp-request">#</a> In Trigger call ERP Request</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span></span><br><span class="line">  if som_edi_broadcom_po_insert_pkg.check_is_broadcom(:new.vendor_id) <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> <span class="keyword">then</span></span><br><span class="line">      l_result :<span class="operator">=</span> fnd_request.set_mode(<span class="literal">true</span>);</span><br><span class="line">      l_req_id :<span class="operator">=</span> fnd_request.submit_request(application  <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;YSC&#x27;</span>,</span><br><span class="line">                                            program      <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;SOMP4081&#x27;</span>,</span><br><span class="line">                                            description  <span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">null</span>,</span><br><span class="line">                                            start_time   <span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">null</span>,</span><br><span class="line">                                            sub_request  <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">false</span>,</span><br><span class="line">                                            argument1    <span class="operator">=</span><span class="operator">&gt;</span> :new.po_header_id);</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line">exception</span><br><span class="line">    <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<h3 id="in-plsql-call-erp-request"><a class="markdownIt-Anchor" href="#in-plsql-call-erp-request">#</a> In PL/SQL call ERP Request</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--Initialize apps environment in pl/sql developer, not needed if called by ERP Request.</span></span><br><span class="line"><span class="comment">--1175:MIS, 50705:SC_OM_SUPERUSER, 660:ONT</span></span><br><span class="line"><span class="comment">--select fu.user_id from fnd_user fu where fu.user_name = &#x27;MIS&#x27;--1175</span></span><br><span class="line"><span class="comment">--select fr.responsibility_id, fr.application_id from fnd_responsibility fr where fr.responsibility_key = &#x27;SC_OM_SUPERUSER&#x27;--50705,660</span></span><br><span class="line"><span class="comment">--fnd_global.APPS_INITIALIZE(user_id =&gt; 1175, resp_id =&gt; 50705, resp_appl_id =&gt; 660);</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">select</span> fu.user_id</span><br><span class="line">     <span class="keyword">into</span> l_user_id</span><br><span class="line">     <span class="keyword">from</span> fnd_user fu</span><br><span class="line">    <span class="keyword">where</span> fu.user_name <span class="operator">=</span> <span class="string">&#x27;MIS&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">   <span class="keyword">select</span> fr.responsibility_id, fr.application_id </span><br><span class="line">     <span class="keyword">into</span> l_responsibility_id, l_application_id</span><br><span class="line">     <span class="keyword">from</span> fnd_responsibility fr</span><br><span class="line">    <span class="keyword">where</span> fr.responsibility_key <span class="operator">=</span> <span class="string">&#x27;SC_OM_SUPERUSER&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">    fnd_global.APPS_INITIALIZE(user_id <span class="operator">=</span><span class="operator">&gt;</span> l_user_id, resp_id <span class="operator">=</span><span class="operator">&gt;</span> l_responsibility_id, resp_appl_id <span class="operator">=</span><span class="operator">&gt;</span> l_application_id);</span><br><span class="line">  exception</span><br><span class="line">   <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">     l_err_msg :<span class="operator">=</span> <span class="string">&#x27;APPS_INITIALIZE Error: &#x27;</span> <span class="operator">||</span> sqlerrm;</span><br><span class="line">     debug_error;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">          </span><br><span class="line">  l_req_id :<span class="operator">=</span> fnd_request.submit_request(application  <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;YSC&#x27;</span>,</span><br><span class="line">                                         program      <span class="operator">=</span><span class="operator">&gt;</span> <span class="string">&#x27;SOMP4057&#x27;</span>,</span><br><span class="line">                                         description  <span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">null</span>,</span><br><span class="line">                                         start_time   <span class="operator">=</span><span class="operator">&gt;</span> <span class="keyword">null</span>,</span><br><span class="line">                                         sub_request  <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">false</span>,</span><br><span class="line">                                         argument1    <span class="operator">=</span><span class="operator">&gt;</span> l_file_name);</span><br><span class="line">                                                </span><br><span class="line">  if l_req_id <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span> </span><br><span class="line">   l_err_msg :<span class="operator">=</span> <span class="string">&#x27;Call SOMP4057 Error&#x27;</span>;</span><br><span class="line">  <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>
<p>如果调用成功，可以通过 ERP / View / Find Requests 查看到对应的 Request。</p>
<h3 id="customer-address-relation"><a class="markdownIt-Anchor" href="#customer-address-relation">#</a> Customer Address Relation</h3>
<img data-src="/2019/06/06/oracle/customer-address-relation.png" class="">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> som_edi_customer_sites_v <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> party.party_name,</span><br><span class="line">       party.duns_number_c duns_number,</span><br><span class="line">       cust_acct.cust_account_id,  <span class="comment">--mtl_customer_items.customer_id</span></span><br><span class="line">       cust_acct.account_number,</span><br><span class="line">       cust_acct.attribute19 <span class="keyword">as</span> edi_customer_no,</span><br><span class="line">       site_use.org_id,         <span class="comment">--Operating Unit</span></span><br><span class="line">       site_use.status,</span><br><span class="line">       site_use.site_use_id,    <span class="comment">--Order ship_to_org_id/invoice_to_org_id</span></span><br><span class="line">       site_use.site_use_code,  <span class="comment">--SHIP_TO/BILL_TO</span></span><br><span class="line">       site_use.location,</span><br><span class="line">       site_use.attribute2 <span class="keyword">as</span> edi_ship_bill_to_code,</span><br><span class="line">       site_use.attribute3 <span class="keyword">as</span> edi_ship_bill_to_customer,</span><br><span class="line">       site_use.attribute4 <span class="keyword">as</span> customer_site_name, <span class="comment">--Title for Customer Site</span></span><br><span class="line">       site_use.attribute5 <span class="keyword">as</span> edi_region_code,</span><br><span class="line">       party_site.party_site_number,</span><br><span class="line">       loc.address1,</span><br><span class="line">       loc.address2,</span><br><span class="line">       loc.address3,</span><br><span class="line">       loc.country, <span class="comment">--US</span></span><br><span class="line">       loc.city,</span><br><span class="line">       loc.state,</span><br><span class="line">       loc.province,</span><br><span class="line">       loc.postal_code,</span><br><span class="line">       territory.territory_short_name,  <span class="comment">--United States</span></span><br><span class="line">       territory.iso_territory_code, <span class="comment">--USA</span></span><br><span class="line">       territory.iso_numeric_code <span class="comment">--country_code</span></span><br><span class="line">  <span class="keyword">from</span> hz_parties             party,</span><br><span class="line">       hz_cust_accounts       cust_acct,</span><br><span class="line">       hz_cust_acct_sites_all acct_site,</span><br><span class="line">       hz_cust_site_uses_all  site_use,</span><br><span class="line">       hz_party_sites         party_site,</span><br><span class="line">       hz_locations           loc,</span><br><span class="line">       fnd_territories_vl     territory</span><br><span class="line"> <span class="keyword">where</span> party.party_id <span class="operator">=</span> cust_acct.party_id</span><br><span class="line">   <span class="keyword">and</span> cust_acct.cust_account_id <span class="operator">=</span> acct_site.cust_account_id</span><br><span class="line">   <span class="keyword">and</span> acct_site.cust_acct_site_id <span class="operator">=</span> site_use.cust_acct_site_id</span><br><span class="line">   <span class="keyword">and</span> acct_site.party_site_id <span class="operator">=</span> party_site.party_site_id</span><br><span class="line">   <span class="keyword">and</span> party_site.location_id <span class="operator">=</span> loc.location_id</span><br><span class="line">   <span class="keyword">and</span> loc.country <span class="operator">=</span> territory.territory_code(<span class="operator">+</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="oracle-userenvlang-and-nls_lang"><a class="markdownIt-Anchor" href="#oracle-userenvlang-and-nls_lang">#</a> Oracle userenv(‘LANG’)  and NLS_LANG</h3>
<p>为什么 Oracle 安装完成之后要在注册表中设置 NLS_LANG ？</p>
<p>NLS_LANG 的设定会影响到 userenv (‘LANG’)，如果设定不正确，可能导致使用 userenv (‘LANG’) 的查询不到资料。</p>
<img data-src="/2019/06/06/oracle/1733398740191.png" class="">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> get_order_salesperson(p_delivery_id <span class="keyword">in</span> varchar2) <span class="keyword">return</span> varchar2 </span><br><span class="line"><span class="keyword">is</span> </span><br><span class="line">  l_return   varchar2(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> rss.resource_name <span class="keyword">into</span> l_return</span><br><span class="line">      <span class="keyword">from</span> wsh_new_deliveries           wnd,</span><br><span class="line">            wsh_delivery_assignments     wda,</span><br><span class="line">            wsh_delivery_details         wdd,</span><br><span class="line">            oe_order_headers_all         ooh,</span><br><span class="line">            hr_all_organization_units_tl hou,</span><br><span class="line">          (<span class="keyword">SELECT</span> JRE.RESOURCE_NAME, JRS.SALESREP_ID, JRS.ORG_ID, JRS.SALESREP_NUMBER</span><br><span class="line">            <span class="keyword">FROM</span> JTF_RS_SALESREPS         JRS,</span><br><span class="line">                  JTF_RS_RESOURCE_EXTNS    JRR,</span><br><span class="line">                  JTF_RS_RESOURCE_EXTNS_TL JRE</span><br><span class="line">            <span class="keyword">WHERE</span> JRS.RESOURCE_ID <span class="operator">=</span> JRR.RESOURCE_ID</span><br><span class="line">              <span class="keyword">AND</span> JRE.LANGUAGE <span class="operator">=</span> USERENV(<span class="string">&#x27;LANG&#x27;</span>)</span><br><span class="line">              <span class="keyword">AND</span> JRR.RESOURCE_ID <span class="operator">=</span> JRE.RESOURCE_ID</span><br><span class="line">              <span class="keyword">AND</span> JRR.CATEGORY <span class="operator">=</span> JRE.CATEGORY</span><br><span class="line">              <span class="keyword">AND</span> JRR.CATEGORY <span class="keyword">IN</span></span><br><span class="line">                  (<span class="string">&#x27;EMPLOYEE&#x27;</span>, <span class="string">&#x27;OTHER&#x27;</span>, <span class="string">&#x27;PARTY&#x27;</span>, <span class="string">&#x27;PARTNER&#x27;</span>, <span class="string">&#x27;SUPPLIER_CONTACT&#x27;</span>)</span><br><span class="line">            ) rss</span><br><span class="line">      <span class="keyword">where</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">and</span> wnd.delivery_id <span class="operator">=</span> p_delivery_id</span><br><span class="line">        <span class="keyword">and</span> wdd.delivery_detail_id <span class="operator">=</span> wda.delivery_detail_id</span><br><span class="line">        <span class="keyword">and</span> wnd.delivery_id <span class="operator">=</span> wda.delivery_id</span><br><span class="line">        <span class="keyword">and</span> wdd.source_header_id <span class="operator">=</span> ooh.header_id</span><br><span class="line">        <span class="keyword">and</span> ooh.salesrep_id <span class="operator">=</span> rss.salesrep_id</span><br><span class="line">        <span class="keyword">and</span> rss.org_id <span class="operator">=</span> hou.organization_id</span><br><span class="line">        <span class="keyword">and</span> hou.language <span class="operator">=</span> userenv(<span class="string">&#x27;LANG&#x27;</span>) </span><br><span class="line">      <span class="keyword">group</span> <span class="keyword">by</span> rss.resource_name;</span><br><span class="line">    exception</span><br><span class="line">      <span class="keyword">when</span> others <span class="keyword">then</span></span><br><span class="line">        l_return :<span class="operator">=</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> l_return;</span><br><span class="line"><span class="keyword">end</span> get_order_salesperson;</span><br></pre></td></tr></table></figure>
<p><strong>SIMPLIFIED CHINESE_CHINA.ZHS16GBK</strong></p>
<img data-src="/2019/06/06/oracle/1733398848152.png" class="">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> userenv(<span class="string">&#x27;LANG&#x27;</span>) <span class="keyword">from</span> dual; <span class="comment">--ZHS</span></span><br></pre></td></tr></table></figure>
<p><strong>AMERICAN_AMERICA.ZHS16GBK</strong></p>
<img data-src="/2019/06/06/oracle/1733398884848.png" class="">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> userenv(<span class="string">&#x27;LANG&#x27;</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--US</span></span><br></pre></td></tr></table></figure>
<h3 id="erp-term"><a class="markdownIt-Anchor" href="#erp-term">#</a> ERP Term</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>EDI</td>
<td>Electronic Data Interchange 电子数据交换</td>
</tr>
<tr>
<td>ETD</td>
<td>Estimated Time of Departure 预计出发时间，出货日</td>
</tr>
<tr>
<td>ETA</td>
<td>Estimated Time of Arrival 预计抵达时间，到货日</td>
</tr>
<tr>
<td>EXW</td>
<td>Ex Works 工厂交货</td>
</tr>
<tr>
<td>FOB</td>
<td>Free On Board 离岸价格</td>
</tr>
<tr>
<td>FCA</td>
<td>Free Carrier 货交承运人</td>
</tr>
<tr>
<td>RMA</td>
<td>Return Material Authorization 退料审查。是处理用户不良产品退货、换货的主要流程。</td>
</tr>
<tr>
<td>VMI</td>
<td>Vendor Managed Inventory 供应商管理库存</td>
</tr>
<tr>
<td>Incoterm</td>
<td>International Commercial Term 贸易条款</td>
</tr>
<tr>
<td>Freight Terms</td>
<td>运输条款</td>
</tr>
<tr>
<td>Payment Term</td>
<td>付款条款，一般是按照合同约定多少天付款，如: 0600</td>
</tr>
<tr>
<td>SCAC</td>
<td>Standard Carrier Alpha Code The Standard Carrier Alpha Code, a two-to-four letter identification, is used by the transportation industry to identify freight carriers in computer systems and shipping documents such as Bill of Lading, Freight Bill, Packing List, and Purchase Order.</td>
</tr>
</tbody>
</table>

      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-12-17 09:51:33" itemprop="dateModified" datetime="2024-12-17T09:51:33+08:00">2024-12-17</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2019/06/06/python-fire/" itemprop="url" rel="prev" data-background-image="&#x2F;anime&#x2F;index&#x2F;幻灵镇魂曲.jpg" title="Python Fire">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Python Fire</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2019/06/06/oracle-trigger/" itemprop="url" rel="next" data-background-image="&#x2F;anime&#x2F;index&#x2F;动物狂想曲-1.jpg" title="Oracle Trigger">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Oracle Trigger</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ddl"><span class="toc-number">1.</span> <span class="toc-text"> DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#db-objects"><span class="toc-number">1.1.</span> <span class="toc-text"> DB Objects</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#table-columns"><span class="toc-number">1.2.</span> <span class="toc-text"> Table Columns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get_ddl"><span class="toc-number">1.3.</span> <span class="toc-text"> GET_DDL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#db-dynamic-message"><span class="toc-number">1.4.</span> <span class="toc-text"> DB Dynamic Message</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#vsession"><span class="toc-number">1.4.1.</span> <span class="toc-text"> v$session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vsql"><span class="toc-number">1.4.2.</span> <span class="toc-text"> v$sql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vdatabase"><span class="toc-number">1.4.3.</span> <span class="toc-text"> v$database</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vversion"><span class="toc-number">1.4.4.</span> <span class="toc-text"> v$version</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-primary-key-and-index"><span class="toc-number">1.5.</span> <span class="toc-text"> Create Primary Key and Index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rename-table-name"><span class="toc-number">1.6.</span> <span class="toc-text"> Rename Table Name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#alter-table-columns"><span class="toc-number">1.7.</span> <span class="toc-text"> Alter Table Columns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#recover-the-dropped-table"><span class="toc-number">1.8.</span> <span class="toc-text"> Recover the Dropped Table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#read-only-table"><span class="toc-number">1.9.</span> <span class="toc-text"> Read Only Table</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#read-only-kekword"><span class="toc-number">1.9.1.</span> <span class="toc-text"> Read Only KekWord</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trigger-implements"><span class="toc-number">1.9.2.</span> <span class="toc-text"> Trigger Implements</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#grant-select-only"><span class="toc-number">1.9.3.</span> <span class="toc-text"> Grant Select Only</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handle-exception-from-constraint"><span class="toc-number">1.10.</span> <span class="toc-text"> Handle Exception From Constraint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#error-logging-table"><span class="toc-number">1.11.</span> <span class="toc-text"> Error Logging Table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unusesd-coulumn"><span class="toc-number">1.12.</span> <span class="toc-text"> Unusesd Coulumn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#virtual-column"><span class="toc-number">1.13.</span> <span class="toc-text"> Virtual Column</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic-sql"><span class="toc-number">1.14.</span> <span class="toc-text"> Dynamic SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreign-key-refer-to-primary-key-in-same-table"><span class="toc-number">1.15.</span> <span class="toc-text"> Foreign key refer to primary key in same table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-number-of-rows-affected"><span class="toc-number">1.16.</span> <span class="toc-text"> The number of rows affected</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trigger-on-delete-and-truncate"><span class="toc-number">1.17.</span> <span class="toc-text"> Trigger on Delete and Truncate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#instead-of-trigger"><span class="toc-number">1.18.</span> <span class="toc-text"> Instead of trigger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#constraint"><span class="toc-number">1.19.</span> <span class="toc-text"> Constraint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#use-ddl-and-dml-inside-function"><span class="toc-number">1.20.</span> <span class="toc-text"> Use DDL and DML inside function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deferrable-novalidate"><span class="toc-number">1.21.</span> <span class="toc-text"> Deferrable novalidate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#the-difference-between-varchar210-varchar210-byte-and-varchar210-char"><span class="toc-number">1.22.</span> <span class="toc-text"> The Difference between varchar2(10), varchar2(10 byte) and varchar2(10 char)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dml"><span class="toc-number">2.</span> <span class="toc-text"> DML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#select-1"><span class="toc-number">2.1.</span> <span class="toc-text"> Select 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select-into"><span class="toc-number">2.2.</span> <span class="toc-text"> Select Into</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scalar-subqueries"><span class="toc-number">2.3.</span> <span class="toc-text"> Scalar Subqueries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#explicit-defaults"><span class="toc-number">2.4.</span> <span class="toc-text"> Explicit Defaults</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert-into"><span class="toc-number">2.5.</span> <span class="toc-text"> Insert Into</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert-mutiple"><span class="toc-number">2.6.</span> <span class="toc-text"> Insert Mutiple</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multitable-inserts-insert-all-and-insert-first"><span class="toc-number">2.7.</span> <span class="toc-text"> Multitable Inserts Insert All and Insert First</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#insert-string-date"><span class="toc-number">2.8.</span> <span class="toc-text"> Insert String Date</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#case-when"><span class="toc-number">2.9.</span> <span class="toc-text"> Case When</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trigger"><span class="toc-number">2.10.</span> <span class="toc-text"> Trigger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cursor"><span class="toc-number">2.11.</span> <span class="toc-text"> Cursor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-cursor"><span class="toc-number">2.12.</span> <span class="toc-text"> Ref Cursor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rowid-rownum"><span class="toc-number">2.13.</span> <span class="toc-text"> Rowid Rownum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-operation"><span class="toc-number">2.14.</span> <span class="toc-text"> Set Operation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#column-alias"><span class="toc-number">2.15.</span> <span class="toc-text"> Column Alias</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#implicit-conversion"><span class="toc-number">2.16.</span> <span class="toc-text"> Implicit Conversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null"><span class="toc-number">2.17.</span> <span class="toc-text"> Null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#null-2"><span class="toc-number">2.18.</span> <span class="toc-text"> Null &amp; ‘’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nulls-first"><span class="toc-number">2.19.</span> <span class="toc-text"> Nulls First</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for-update"><span class="toc-number">2.20.</span> <span class="toc-text"> For Update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#escape-character"><span class="toc-number">2.21.</span> <span class="toc-text"> Escape Character</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#quote"><span class="toc-number">2.22.</span> <span class="toc-text"> Quote</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flash-back"><span class="toc-number">2.23.</span> <span class="toc-text"> Flash Back</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#query-clob"><span class="toc-number">2.24.</span> <span class="toc-text"> Query Clob</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update-use-subquery"><span class="toc-number">2.25.</span> <span class="toc-text"> Update Use Subquery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trigger-implements-id-autoincrement"><span class="toc-number">2.26.</span> <span class="toc-text"> Trigger Implements ID Autoincrement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#materialize"><span class="toc-number">2.27.</span> <span class="toc-text"> Materialize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count-over"><span class="toc-number">2.28.</span> <span class="toc-text"> count(*) over()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bulk-connect-into"><span class="toc-number">2.29.</span> <span class="toc-text"> Bulk Connect Into</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#forall"><span class="toc-number">2.30.</span> <span class="toc-text"> Forall</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#view"><span class="toc-number">2.31.</span> <span class="toc-text"> View</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#force-view"><span class="toc-number">2.31.1.</span> <span class="toc-text"> Force View</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#text-of-force-view"><span class="toc-number">2.31.2.</span> <span class="toc-text"> Text of force view</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view-with-read-only-constraint"><span class="toc-number">2.31.3.</span> <span class="toc-text"> View WITH READ ONLY constraint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#view-with-check-option-constraint"><span class="toc-number">2.31.4.</span> <span class="toc-text"> View WITH CHECK OPTION constraint</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#check-the-list-of-objects-used-in-view"><span class="toc-number">2.31.5.</span> <span class="toc-text"> Check the list of objects used in view</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compile-and-recompile-view"><span class="toc-number">2.31.6.</span> <span class="toc-text"> Compile and Recompile View</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#inline-view"><span class="toc-number">2.31.7.</span> <span class="toc-text"> Inline View</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#any-and-in"><span class="toc-number">2.32.</span> <span class="toc-text"> Any and In</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rank-dense_rank-as-aggreate-function-and-analytical-function"><span class="toc-number">2.33.</span> <span class="toc-text"> RANK &amp; DENSE_RANK as Aggreate function and Analytical function</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exclude-duplicate-records-while-insertion"><span class="toc-number">2.34.</span> <span class="toc-text"> Exclude duplicate records while insertion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exclude-duplicate-records-while-insertion-not-has-primary-key"><span class="toc-number">2.35.</span> <span class="toc-text"> Exclude duplicate records while insertion not has primary key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#merge-with-error"><span class="toc-number">2.36.</span> <span class="toc-text"> Merge with error</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dcl"><span class="toc-number">3.</span> <span class="toc-text"> DCL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#savepoint-rollback"><span class="toc-number">3.1.</span> <span class="toc-text"> Savepoint Rollback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#autonomous-transaction"><span class="toc-number">3.2.</span> <span class="toc-text"> Autonomous Transaction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-request-commit"><span class="toc-number">3.3.</span> <span class="toc-text"> ERP Request Commit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#func-procedure"><span class="toc-number">4.</span> <span class="toc-text"> Func Procedure</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms_output-and-fnd_file"><span class="toc-number">4.1.</span> <span class="toc-text"> DBMS_OUTPUT and FND_FILE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package-create"><span class="toc-number">4.2.</span> <span class="toc-text"> Package Create</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#package-compile-error"><span class="toc-number">4.3.</span> <span class="toc-text"> Package Compile Error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#procedure"><span class="toc-number">4.4.</span> <span class="toc-text"> Procedure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synonym"><span class="toc-number">4.5.</span> <span class="toc-text"> Synonym</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#default-param"><span class="toc-number">4.6.</span> <span class="toc-text"> Default Param</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sum-count"><span class="toc-number">4.7.</span> <span class="toc-text"> Sum Count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count-distinct"><span class="toc-number">4.8.</span> <span class="toc-text"> Count Distinct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#instr-substr"><span class="toc-number">4.9.</span> <span class="toc-text"> Instr Substr</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#option-filter"><span class="toc-number">4.10.</span> <span class="toc-text"> Option Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#to_char"><span class="toc-number">4.11.</span> <span class="toc-text"> TO_CHAR</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chr-ascii"><span class="toc-number">4.12.</span> <span class="toc-text"> CHR ASCII</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trunc-extract-date"><span class="toc-number">4.13.</span> <span class="toc-text"> Trunc Extract Date</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decode"><span class="toc-number">4.14.</span> <span class="toc-text"> Decode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#listagg"><span class="toc-number">4.15.</span> <span class="toc-text"> Listagg</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#length"><span class="toc-number">4.16.</span> <span class="toc-text"> Length</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#decimal"><span class="toc-number">4.17.</span> <span class="toc-text"> Decimal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#any-is-null"><span class="toc-number">4.18.</span> <span class="toc-text"> Any is Null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#str-clean"><span class="toc-number">4.19.</span> <span class="toc-text"> Str Clean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#right-and-pad-str"><span class="toc-number">4.20.</span> <span class="toc-text"> Right and Pad Str</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nocopy"><span class="toc-number">4.21.</span> <span class="toc-text"> NOCOPY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#piplined"><span class="toc-number">4.22.</span> <span class="toc-text"> PIPLINED</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#add_months-and-interval-month"><span class="toc-number">4.23.</span> <span class="toc-text"> add_months and interval ‘’ month</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#date-literal-and-timestamp-literal"><span class="toc-number">4.24.</span> <span class="toc-text"> Date Literal and Timestamp Literal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timestamp-timezone"><span class="toc-number">4.25.</span> <span class="toc-text"> Timestamp Timezone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#date-and-times-exact-formatting-with-the-fx-modifier"><span class="toc-number">4.26.</span> <span class="toc-text"> Date and Times Exact Formatting with the FX Modifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dates-and-times-fill-mode-formatting-with-the-fm-modifier"><span class="toc-number">4.27.</span> <span class="toc-text"> Dates and Times Fill Mode Formatting with the FM Modifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#date-and-times-format-suffixes"><span class="toc-number">4.28.</span> <span class="toc-text"> Date and Times Format Suffixes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#function-return-more-value"><span class="toc-number">4.29.</span> <span class="toc-text"> Function return more value</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#replace-non-breaking-space-u00a0"><span class="toc-number">4.30.</span> <span class="toc-text"> Replace Non-breaking space (\u00A0)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle-regex-bracket-expression-include-and-"><span class="toc-number">4.31.</span> <span class="toc-text"> Oracle Regex Bracket expression include ] and -</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cte"><span class="toc-number">5.</span> <span class="toc-text"> CTE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#caculate-pi"><span class="toc-number">5.1.</span> <span class="toc-text"> Caculate PI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#snail-climbing-well"><span class="toc-number">5.2.</span> <span class="toc-text"> Snail climbing well</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#plsql"><span class="toc-number">6.</span> <span class="toc-text"> PLSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sqlcode-sqlerrm"><span class="toc-number">6.1.</span> <span class="toc-text"> Sqlcode Sqlerrm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#error-backtrace"><span class="toc-number">6.2.</span> <span class="toc-text"> Error Backtrace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#array"><span class="toc-number">6.3.</span> <span class="toc-text"> Array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multiset"><span class="toc-number">6.4.</span> <span class="toc-text"> Multiset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms_lock-sleep"><span class="toc-number">6.5.</span> <span class="toc-text"> DBMS_LOCK Sleep</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms_random"><span class="toc-number">6.6.</span> <span class="toc-text"> DBMS_RANDOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dbms_utilitycomma_to_table-table_to_comma"><span class="toc-number">6.7.</span> <span class="toc-text"> DBMS_UTILITY.comma_to_table &amp; table_to_comma</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#other"><span class="toc-number">7.</span> <span class="toc-text"> Other</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#plsql-use-as-assignment"><span class="toc-number">7.1.</span> <span class="toc-text"> PLSQL use :&#x3D; as assignment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tnsping"><span class="toc-number">7.2.</span> <span class="toc-text"> Tnsping</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sql-plus-connect-db"><span class="toc-number">7.3.</span> <span class="toc-text"> SQL Plus Connect DB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#db-link"><span class="toc-number">7.4.</span> <span class="toc-text"> DB Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#build-id-seq"><span class="toc-number">7.5.</span> <span class="toc-text"> Build Id Seq</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#placeholder"><span class="toc-number">7.6.</span> <span class="toc-text"> &amp; Placeholder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plsql-developer-autoreplace"><span class="toc-number">7.7.</span> <span class="toc-text"> PL&#x2F;SQL Developer AutoReplace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calculate-luhn-checksum"><span class="toc-number">7.8.</span> <span class="toc-text"> Calculate Luhn Checksum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#edi-parse"><span class="toc-number">7.9.</span> <span class="toc-text"> EDI Parse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-a-unique-filename-using-only-datetime"><span class="toc-number">7.10.</span> <span class="toc-text"> Create a unique filename using only DateTime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#create-a-unique-filename-using-counter-and-date"><span class="toc-number">7.11.</span> <span class="toc-text"> Create a unique filename using Counter and Date</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#caculate-count-and-counter"><span class="toc-number">7.12.</span> <span class="toc-text"> Caculate Count and Counter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#erp-and-form"><span class="toc-number">8.</span> <span class="toc-text"> ERP and Form</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-request-recursive-call"><span class="toc-number">8.1.</span> <span class="toc-text"> ERP Request recursive call</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-request-concurrent"><span class="toc-number">8.2.</span> <span class="toc-text"> ERP Request Concurrent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-form-error"><span class="toc-number">8.3.</span> <span class="toc-text"> ERP Form Error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-form-setting-item-property-to-unspecified"><span class="toc-number">8.4.</span> <span class="toc-text"> ERP Form setting item property to Unspecified</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-form-rquest-name-and-excustion-file-name"><span class="toc-number">8.5.</span> <span class="toc-text"> Get Form Rquest Name and Excustion File Name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-organization-id-and-code-from-mtl_parameters"><span class="toc-number">8.6.</span> <span class="toc-text"> Get Organization ID and CODE from MTL_PARAMETERS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set_policy_context"><span class="toc-number">8.7.</span> <span class="toc-text"> SET_POLICY_CONTEXT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-profile"><span class="toc-number">8.8.</span> <span class="toc-text"> Get Profile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-flexfield"><span class="toc-number">8.9.</span> <span class="toc-text"> Get FlexField</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#request-check"><span class="toc-number">8.10.</span> <span class="toc-text"> Request Check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in-trigger-call-erp-request"><span class="toc-number">8.11.</span> <span class="toc-text"> In Trigger call ERP Request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#in-plsql-call-erp-request"><span class="toc-number">8.12.</span> <span class="toc-text"> In PL&#x2F;SQL call ERP Request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#customer-address-relation"><span class="toc-number">8.13.</span> <span class="toc-text"> Customer Address Relation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle-userenvlang-and-nls_lang"><span class="toc-number">8.14.</span> <span class="toc-text"> Oracle userenv(‘LANG’)  and NLS_LANG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#erp-term"><span class="toc-number">8.15.</span> <span class="toc-text"> ERP Term</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2019/06/06/bat/" rel="bookmark" title="Window Bat">Window Bat</a></li><li class="active"><a href="/2019/06/06/oracle/" rel="bookmark" title="Oracle">Oracle</a></li><li><a href="/2019/06/06/python/" rel="bookmark" title="Python">Python</a></li><li><a href="/2019/10/12/linux-vim/" rel="bookmark" title="Vim">Vim</a></li><li><a href="/2020/09/01/sql-advance/" rel="bookmark" title="SQL Advance">SQL Advance</a></li><li><a href="/2021/01/01/a-resource/" rel="bookmark" title="Resources">Resources</a></li><li><a href="/2021/04/06/japanese/" rel="bookmark" title="Japanese">Japanese</a></li><li><a href="/2021/04/25/excel/" rel="bookmark" title="Excel Basic">Excel Basic</a></li><li><a href="/2021/05/06/edi-flow/" rel="bookmark" title="EDI Flow">EDI Flow</a></li><li><a href="/2021/05/13/r-tutorial/" rel="bookmark" title="R tutorial">R tutorial</a></li><li><a href="/2021/07/10/rust-for-node/" rel="bookmark" title="Deep Dive into Rust for Node.js Developers">Deep Dive into Rust for Node.js Developers</a></li><li><a href="/2021/07/20/python-daily-tool/" rel="bookmark" title="Daily Tool">Daily Tool</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">366</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">51</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item codepen" data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL2xoY2hlbjc0" title="https:&#x2F;&#x2F;codepen.io&#x2F;lhchen74"><i class="ic i-address-card"></i></span>
      <span class="exturl item anki" data-url="aHR0cHM6Ly9hbmtpd2ViLm5ldC9kZWNrcy8=" title="https:&#x2F;&#x2F;ankiweb.net&#x2F;decks&#x2F;"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

    
  <li class="item">
    <a href="/anime/" rel="section"><i class="ic i-magic"></i>Anime</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2019/06/06/python-fire/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2019/06/06/oracle-trigger/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ D E W</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2019/06/06/oracle/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
