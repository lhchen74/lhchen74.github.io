



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="rust" />


<link rel="canonical" href="https://lhchen74.github.io/2020/09/07/rust-wasm-application/">



  <title>
Single Page Applications using Rust |
Dew's World = 露の世</title>
<meta name="generator" content="Hexo 5.4.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Single Page Applications using Rust
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2020-09-07 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2020-09-07T00:00:00+08:00">2020-09-07</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Dew's World</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclhfehz7j20zk0m8u0x.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclj9410cj20zk0m8h12.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipewf5l51j20zk0m8b29.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicitf0kl1j20zk0m87fe.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciuja1j1j20zk0m8kjl.jpg"></li>
          <li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2020/09/07/rust-wasm-application/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>reproduce: <span class="exturl" data-url="aHR0cDovL3d3dy5zaGVzaGJhYnUuY29tL3Bvc3RzL3J1c3Qtd2FzbS15ZXctc2luZ2xlLXBhZ2UtYXBwbGljYXRpb24v">Single Page Applications using Rust</span></p>
</blockquote>
<h1 id="single-page-applications-using-rust"><a class="markdownIt-Anchor" href="#single-page-applications-using-rust">#</a> Single Page Applications using Rust</h1>
<p>WebAssembly (wasm) allows code written in languages other than JavaScript to run on browsers. If you haven’t been paying attention, all the major browsers support wasm and <span class="exturl" data-url="aHR0cHM6Ly9jYW5pdXNlLmNvbS8jZmVhdD13YXNt">globally more than 90% of users</span> have browsers that can run wasm.</p>
<p>Since Rust compiles to wasm, is it possible to build SPAs (Single Page Applications) purely in Rust and without writing a single line of JavaScript? The short answer is YES! Read on to learn more or visit the <span class="exturl" data-url="aHR0cHM6Ly9ydXN0bWFydC15ZXcubmV0bGlmeS5hcHAv">demo site</span> if you can’t contain your excitement!</p>
<p>We’ll be building a simple ecommerce site called “RustMart” that will have 2 pages:</p>
<ul>
<li>HomePage - list all the products that the customer can add to cart</li>
<li>ProductDetailPage - show the product details when a product card is clicked</li>
</ul>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-1.png" alt="img"></p>
<p>I’m using this example as it tests the minimal set of capabilities required to build modern SPAs:</p>
<ul>
<li>Navigate between multiple pages without page reload</li>
<li>Make network requests without page reload</li>
<li>Ability to reuse UI components across multiple pages</li>
<li>Update components in different layers of the UI hierarchy</li>
</ul>
<h2 id="setup"><a class="markdownIt-Anchor" href="#setup">#</a> Setup</h2>
<p>Follow this <span class="exturl" data-url="aHR0cHM6Ly93d3cucnVzdC1sYW5nLm9yZy90b29scy9pbnN0YWxs">link</span> to install Rust if you haven’t done so already.</p>
<p>Install these Rust tools:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo install wasm-pack          <span class="comment"># Compile Rust to Wasm and generate JS interop code</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cargo install cargo-make         <span class="comment"># Task runner</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cargo install simple-http-server <span class="comment"># Simple server to serve assets</span></span></span><br></pre></td></tr></table></figure>
<p>Create a new project:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo new --lib rustmart &amp;&amp; <span class="built_in">cd</span> rustmart</span></span><br></pre></td></tr></table></figure>
<p>We’ll be using the <a target="_blank" rel="noopener" href="https://yew.rs/"> <code>Yew</code> </a> library to build UI components. Let’s add this and wasm dependencies to  <code>Cargo.toml</code> :</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[lib]</span></span><br><span class="line"><span class="attr">crate-type</span> = [<span class="string">&quot;cdylib&quot;</span>, <span class="string">&quot;rlib&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">yew</span> = <span class="string">&quot;0.17&quot;</span></span><br><span class="line"><span class="attr">wasm-bindgen</span> = <span class="string">&quot;0.2&quot;</span></span><br></pre></td></tr></table></figure>
<p>Create a new file named  <code>Makefile.toml</code>  and add this:</p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[tasks.build]</span></span><br><span class="line"><span class="attr">command</span> = <span class="string">&quot;wasm-pack&quot;</span></span><br><span class="line"><span class="attr">args</span> = [<span class="string">&quot;build&quot;</span>, <span class="string">&quot;--dev&quot;</span>, <span class="string">&quot;--target&quot;</span>, <span class="string">&quot;web&quot;</span>, <span class="string">&quot;--out-name&quot;</span>, <span class="string">&quot;wasm&quot;</span>, <span class="string">&quot;--out-dir&quot;</span>, <span class="string">&quot;./static&quot;</span>]</span><br><span class="line"><span class="attr">watch</span> = &#123; ignore_pattern = <span class="string">&quot;static/*&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">[tasks.serve]</span></span><br><span class="line"><span class="attr">command</span> = <span class="string">&quot;simple-http-server&quot;</span></span><br><span class="line"><span class="attr">args</span> = [<span class="string">&quot;-i&quot;</span>, <span class="string">&quot;./static/&quot;</span>, <span class="string">&quot;-p&quot;</span>, <span class="string">&quot;3000&quot;</span>, <span class="string">&quot;--nocache&quot;</span>, <span class="string">&quot;--try-file&quot;</span>, <span class="string">&quot;./static/index.html&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>Start the build task:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo make build</span></span><br></pre></td></tr></table></figure>
<p>If you’re new to Rust, I’ve written some <span class="exturl" data-url="aHR0cDovL3d3dy5zaGVzaGJhYnUuY29tL3RhZ3MvUnVzdC1CZWdpbm5lcnMv">guides for beginners</span> which will help you follow this post better.</p>
<h2 id="hello-world"><a class="markdownIt-Anchor" href="#hello-world">#</a> Hello World</h2>
<p>Let’s start with a simple “hello world” example:</p>
<p>Create  <code>static/index.html</code>  and add this:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>RustMart<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">import</span> init <span class="keyword">from</span> <span class="string">&quot;/wasm.js&quot;</span>;</span></span><br><span class="line">      init();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Add this to  <code>src/lib.rs</code> :</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/lib.rs</span></span><br><span class="line"><span class="keyword">use</span> wasm_bindgen::prelude::*;</span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Hello</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> Hello &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = ();</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = ();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(_: Self::Properties, _: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        html! &#123; &lt;span&gt;&#123;&quot;Hello World!&quot;&#125;&lt;/span&gt; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[wasm_bindgen(start)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run_app</span></span>() &#123;</span><br><span class="line">    App::&lt;Hello&gt;::new().mount_to_body();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Lot of things going on but you can see that we’re creating a new component named “Hello” that renders  <code>&lt;span&gt;Hello World!&lt;/span&gt;</code>  into the DOM. We’ll learn more about Yew components later.</p>
<p>Start the serve task in a new terminal and load  <code>http://localhost:3000</code>  in your browser</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo make serve</span></span><br></pre></td></tr></table></figure>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-1.png" alt="img"></p>
<p>It works!! It’s only “hello world” but this is fully written in Rust.</p>
<p>Let’s learn about components and other SPA concepts before proceeding further.</p>
<h2 id="thinking-in-components"><a class="markdownIt-Anchor" href="#thinking-in-components">#</a> Thinking in Components</h2>
<p>Building UIs by composing components and passing data in a unidirectional way is a paradigm shift in the frontend world. It’s a huge improvement in the way we reason about UI and it’s very hard to go back to imperative DOM manipulation once you get used to this.</p>
<p>A  <code>Component</code>  in libraries like React, Vue, Yew, Flutter etc have these features:</p>
<ul>
<li>Ability to be composed into bigger components</li>
<li><code>Props</code>  - Pass data and callbacks from that component to its child components.</li>
<li><code>State</code>  - Manipulate state local to that component.</li>
<li><code>AppState</code>  - Manipulate global state.</li>
<li>Listen to lifecycle events like “Instantiated”, “Mounted in DOM” etc</li>
<li>Perform side effects like fetching remote data, manipulating localstorage etc</li>
</ul>
<p>A component gets updated (re-rendered) when one of the following happens:</p>
<ul>
<li>Parent component is re-rendered</li>
<li><code>Props</code>  changes</li>
<li><code>State</code>  changes</li>
<li><code>AppState</code>  changes</li>
</ul>
<p>So, instead of imperatively updating the UI when user interaction, network requests etc happen, we update the data (Props, State, AppState) and the UI is updated based on this data. This what someone means when they say “UI is a function of state”.</p>
<p>The exact details differ across different libraries but this should give you a general idea. If you’re new to this, this way of thinking might take sometime to “click” and get used to.</p>
<h2 id="homepage"><a class="markdownIt-Anchor" href="#homepage">#</a> HomePage</h2>
<p>Let’s build the HomePage first. We’ll be building the HomePage as a monolithic component and later decompose it into smaller reusable components.</p>
<p>Let’s create the following files:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/home.rs</span></span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Home</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> Home &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = ();</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = ();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(_: Self::Properties, _: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        html! &#123; &lt;span&gt;&#123;&quot;Home Sweet Home!&quot;&#125;&lt;/span&gt; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// src/pages/mod.rs</span></span><br><span class="line"><span class="keyword">mod</span> home;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> home::Home;</span><br></pre></td></tr></table></figure>
<p>Let’s update the  <code>src/lib.rs</code>  to import the HomePage component:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">  // src/lib.rs</span><br><span class="line"><span class="addition">+ mod pages;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ use pages::Home;</span></span><br><span class="line">  use wasm_bindgen::prelude::*;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- struct Hello &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- impl Component for Hello &#123;</span></span><br><span class="line"><span class="deletion">-     type Message = ();</span></span><br><span class="line"><span class="deletion">-     type Properties = ();</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn create(_: Self::Properties, _: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line"><span class="deletion">-         Self &#123;&#125;</span></span><br><span class="line"><span class="deletion">-     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn update(&amp;mut self, _: Self::Message) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="deletion">-         true</span></span><br><span class="line"><span class="deletion">-     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="deletion">-         true</span></span><br><span class="line"><span class="deletion">-     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn view(&amp;self) -&gt; Html &#123;</span></span><br><span class="line"><span class="deletion">-         html! &#123; &lt;span&gt;&#123;&quot;Hello World!&quot;&#125;&lt;/span&gt; &#125;</span></span><br><span class="line"><span class="deletion">-     &#125;</span></span><br><span class="line"><span class="deletion">- &#125;</span></span><br><span class="line"></span><br><span class="line">  #[wasm_bindgen(start)]</span><br><span class="line">  pub fn run_app() &#123;</span><br><span class="line"><span class="deletion">-   App::&lt;Hello&gt;::new().mount_to_body();</span></span><br><span class="line"><span class="addition">+   App::&lt;Home&gt;::new().mount_to_body();</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Now, you should see “Home Sweet Home!” instead of “Hello World!” rendered in your browser.</p>
<p>Let’s start designing the  <code>State</code>  of this component:</p>
<ul>
<li>We need to store a list of products retrieved from server</li>
<li>Store the products the user has added to cart</li>
</ul>
<p>We create a simple struct to hold the  <code>Product</code>  details:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Product</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    description: <span class="built_in">String</span>,</span><br><span class="line">    image: <span class="built_in">String</span>,</span><br><span class="line">    price: <span class="built_in">f64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We then create a new struct  <code>State</code>  with field called  <code>products</code>  to hold the products from server:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">State</span></span> &#123;</span><br><span class="line">    products: <span class="built_in">Vec</span>&lt;Product&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here’s the full list of changes in the HomePage component:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ struct Product &#123;</span></span><br><span class="line"><span class="addition">+     id: i32,</span></span><br><span class="line"><span class="addition">+     name: String,</span></span><br><span class="line"><span class="addition">+     description: String,</span></span><br><span class="line"><span class="addition">+     image: String,</span></span><br><span class="line"><span class="addition">+     price: f64,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ struct State &#123;</span></span><br><span class="line"><span class="addition">+     products: Vec&lt;Product&gt;,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- pub struct Home &#123;&#125;</span></span><br><span class="line"><span class="addition">+ pub struct Home &#123;</span></span><br><span class="line"><span class="addition">+     state: State,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  impl Component for Home &#123;</span><br><span class="line">      type Message = ();</span><br><span class="line">      type Properties = ();</span><br><span class="line"></span><br><span class="line">      fn create(_: Self::Properties, _: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span><br><span class="line"><span class="addition">+       let products: Vec&lt;Product&gt; = vec![</span></span><br><span class="line"><span class="addition">+           Product &#123;</span></span><br><span class="line"><span class="addition">+               id: 1,</span></span><br><span class="line"><span class="addition">+               name: &quot;Apple&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               description: &quot;An apple a day keeps the doctor away&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               image: &quot;/products/apple.png&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               price: 3.65,</span></span><br><span class="line"><span class="addition">+           &#125;,</span></span><br><span class="line"><span class="addition">+           Product &#123;</span></span><br><span class="line"><span class="addition">+               id: 2,</span></span><br><span class="line"><span class="addition">+               name: &quot;Banana&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               description: &quot;An old banana leaf was once young and green&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               image: &quot;/products/banana.png&quot;.to_string(),</span></span><br><span class="line"><span class="addition">+               price: 7.99,</span></span><br><span class="line"><span class="addition">+           &#125;,</span></span><br><span class="line"><span class="addition">+       ];</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-       Self &#123;&#125;</span></span><br><span class="line"><span class="addition">+       Self &#123;</span></span><br><span class="line"><span class="addition">+           state: State &#123;</span></span><br><span class="line"><span class="addition">+               products,</span></span><br><span class="line"><span class="addition">+           &#125;,</span></span><br><span class="line"><span class="addition">+       &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn update(&amp;mut self, _: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">          true</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">          true</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line"><span class="addition">+        let products: Vec&lt;Html&gt; = self</span></span><br><span class="line"><span class="addition">+            .state</span></span><br><span class="line"><span class="addition">+            .products</span></span><br><span class="line"><span class="addition">+            .iter()</span></span><br><span class="line"><span class="addition">+            .map(|product: &amp;Product| &#123;</span></span><br><span class="line"><span class="addition">+                html! &#123;</span></span><br><span class="line"><span class="addition">+                  &lt;div&gt;</span></span><br><span class="line"><span class="addition">+                    &lt;img src=&#123;&amp;product.image&#125;/&gt;</span></span><br><span class="line"><span class="addition">+                    &lt;div&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+                    &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+                  &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+                &#125;</span></span><br><span class="line"><span class="addition">+            &#125;)</span></span><br><span class="line"><span class="addition">+            .collect();</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+        html! &#123; &lt;span&gt;&#123;products&#125;&lt;/span&gt; &#125;</span></span><br><span class="line"><span class="deletion">-        html! &#123; &lt;span&gt;&#123;&quot;Home!&quot;&#125;&lt;/span&gt; &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>The  <code>create</code>  lifecycle method is invoked when the component is created and this is where we set the initial state. For the time being, we’ve created a mock list of products and assigned it to the  <code>products</code>  inside the state as initial value. Later, we’ll fetch this list using network request.</p>
<p>The  <code>view</code>  lifecycle method is invoked when the component is rendered. Here we’ve iterated over  <code>products</code>  inside state to generate product cards. If you’re familiar with React, this is same as the  <code>render</code>  method and the  <code>html!</code>  macro is similar to  <code>JSX</code> .</p>
<p>Save some random images as  <code>static/products/apple.png</code>  and  <code>static/products/banana.png</code>  and you’ll get this UI:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-2.png" alt="img"></p>
<p>Let’s implement the “add to cart” functionality:</p>
<ul>
<li>We keep track of all products added to cart in a new state field called  <code>cart_products</code></li>
<li>We render a “add to cart” button for each product</li>
<li>Add logic to update the  <code>cart_products</code>  state when “add to cart” button is clicked</li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ #[derive(Clone)]</span></span><br><span class="line">  struct Product &#123;</span><br><span class="line">      id: i32,</span><br><span class="line">      name: String,</span><br><span class="line">      description: String,</span><br><span class="line">      image: String,</span><br><span class="line">      price: f64,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ struct CartProduct &#123;</span></span><br><span class="line"><span class="addition">+     product: Product,</span></span><br><span class="line"><span class="addition">+     quantity: i32,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  struct State &#123;</span><br><span class="line">      products: Vec&lt;Product&gt;,</span><br><span class="line"><span class="addition">+     cart_products: Vec&lt;CartProduct&gt;,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pub struct Home &#123;</span><br><span class="line">      state: State,</span><br><span class="line"><span class="addition">+     link: ComponentLink&lt;Self&gt;,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ pub enum Msg &#123;</span></span><br><span class="line"><span class="addition">+     AddToCart(i32),</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  impl Component for Home &#123;</span><br><span class="line"><span class="deletion">-   type Message = ();</span></span><br><span class="line"><span class="addition">+   type Message = Msg;</span></span><br><span class="line">    type Properties = ();</span><br><span class="line"></span><br><span class="line"><span class="deletion">-   fn create(_: Self::Properties, _: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line"><span class="addition">+   fn create(_: Self::Properties, link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line">        let products: Vec&lt;Product&gt; = vec![</span><br><span class="line">            Product &#123;</span><br><span class="line">                id: 1,</span><br><span class="line">                name: &quot;Apple&quot;.to_string(),</span><br><span class="line">                description: &quot;An apple a day keeps the doctor away&quot;.to_string(),</span><br><span class="line">                image: &quot;/products/apple.png&quot;.to_string(),</span><br><span class="line">                price: 3.65,</span><br><span class="line">            &#125;,</span><br><span class="line">            Product &#123;</span><br><span class="line">                id: 2,</span><br><span class="line">                name: &quot;Banana&quot;.to_string(),</span><br><span class="line">                description: &quot;An old banana leaf was once young and green&quot;.to_string(),</span><br><span class="line">                image: &quot;/products/banana.png&quot;.to_string(),</span><br><span class="line">                price: 7.99,</span><br><span class="line">            &#125;,</span><br><span class="line">        ];</span><br><span class="line"><span class="addition">+       let cart_products = vec![];</span></span><br><span class="line"></span><br><span class="line">        Self &#123;</span><br><span class="line">            state: State &#123;</span><br><span class="line">                products,</span><br><span class="line"><span class="addition">+               cart_products,</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="addition">+           link,</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-   fn update(&amp;mut self, _: Self::Message) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+   fn update(&amp;mut self, message: Self::Message) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+       match message &#123;</span></span><br><span class="line"><span class="addition">+           Msg::AddToCart(product_id) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+               let product = self</span></span><br><span class="line"><span class="addition">+                   .state</span></span><br><span class="line"><span class="addition">+                   .products</span></span><br><span class="line"><span class="addition">+                   .iter()</span></span><br><span class="line"><span class="addition">+                   .find(|p: &amp;&amp;Product| p.id == product_id)</span></span><br><span class="line"><span class="addition">+                   .unwrap();</span></span><br><span class="line"><span class="addition">+               let cart_product = self</span></span><br><span class="line"><span class="addition">+                   .state</span></span><br><span class="line"><span class="addition">+                   .cart_products</span></span><br><span class="line"><span class="addition">+                   .iter_mut()</span></span><br><span class="line"><span class="addition">+                   .find(|cp: &amp;&amp;mut CartProduct| cp.product.id == product_id);</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+               if let Some(cp) = cart_product &#123;</span></span><br><span class="line"><span class="addition">+                   cp.quantity += 1;</span></span><br><span class="line"><span class="addition">+               &#125; else &#123;</span></span><br><span class="line"><span class="addition">+                   self.state.cart_products.push(CartProduct &#123;</span></span><br><span class="line"><span class="addition">+                       product: product.clone(),</span></span><br><span class="line"><span class="addition">+                       quantity: 1,</span></span><br><span class="line"><span class="addition">+                   &#125;)</span></span><br><span class="line"><span class="addition">+               &#125;</span></span><br><span class="line"><span class="addition">+               true</span></span><br><span class="line"><span class="addition">+           &#125;</span></span><br><span class="line"><span class="addition">+       &#125;</span></span><br><span class="line"><span class="deletion">-       true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        true</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">        let products: Vec&lt;Html&gt; = self</span><br><span class="line">            .state</span><br><span class="line">            .products</span><br><span class="line">            .iter()</span><br><span class="line">            .map(|product: &amp;Product| &#123;</span><br><span class="line"><span class="addition">+              let product_id = product.id;</span></span><br><span class="line">                html! &#123;</span><br><span class="line">                  &lt;div&gt;</span><br><span class="line">                    &lt;img src=&#123;&amp;product.image&#125;/&gt;</span><br><span class="line">                    &lt;div&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span><br><span class="line"><span class="addition">+                   &lt;button onclick=self.link.callback(move |_| Msg::AddToCart(product_id))&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span></span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .collect();</span><br><span class="line"></span><br><span class="line"><span class="addition">+       let cart_value = self</span></span><br><span class="line"><span class="addition">+           .state</span></span><br><span class="line"><span class="addition">+           .cart_products</span></span><br><span class="line"><span class="addition">+           .iter()</span></span><br><span class="line"><span class="addition">+           .fold(0.0, |acc, cp| acc + (cp.quantity as f64 * cp.product.price));</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-       html! &#123; &lt;span&gt;&#123;products&#125;&lt;/span&gt; &#125;</span></span><br><span class="line"><span class="addition">+       html! &#123;</span></span><br><span class="line"><span class="addition">+         &lt;div&gt;</span></span><br><span class="line"><span class="addition">+           &lt;span&gt;&#123;format!(&quot;Cart Value: &#123;:.2&#125;&quot;, cart_value)&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="addition">+           &lt;span&gt;&#123;products&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="addition">+         &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+       &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>clone</code>  - We’ve derived the <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/clone/trait.Clone.html"> <code>Clone</code> </a> trait in  <code>Product</code>  struct so we can save the cloned  <code>Product</code>  into  <code>CartProduct</code>  whenever the user adds them to cart.</li>
<li><code>update</code>  - This method is the place where the logic to update the component  <code>State</code>  or perform side-effects (like network requests) exist. It is invoked using a  <code>Message</code>  enum that contains all the actions the component supports. When we return  <code>true</code>  from this method, the component is re-rendered. In the above code, when the user clicks the “Add To Cart” button, we send a  <code>Msg::AddToCart</code>  message to  <code>update</code> . Inside  <code>update</code> , this either adds the product to  <code>cart_product</code>  if it doesn’t exist or it increments the quantity.</li>
<li><code>link</code>  - This allows us to register callbacks that can trigger our  <code>update</code>  lifecycle method.</li>
</ul>
<p>If you’ve used <span class="exturl" data-url="aHR0cHM6Ly9yZWR1eC5qcy5vcmcv">Redux</span> before,  <code>update</code>  is similar to <a target="_blank" rel="noopener" href="https://redux.js.org/basics/reducers"> <code>Reducer</code> </a> (for state updates) and <a target="_blank" rel="noopener" href="https://redux.js.org/basics/actions#action-creators"> <code>Action Creator</code> </a> (for side-effects),  <code>Message</code>  is similar to <a target="_blank" rel="noopener" href="https://redux.js.org/basics/actions"> <code>Action</code> </a> and  <code>link</code>  is similar to <a target="_blank" rel="noopener" href="https://redux.js.org/basics/store#dispatching-actions"> <code>Dispatch</code> </a>.</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-2.png" alt="img"></p>
<p>Here’s how the UI looks like, try clicking the “Add To Cart” button and see the changes in “Cart Value”:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-3.png" alt="img"></p>
<h2 id="fetching-data"><a class="markdownIt-Anchor" href="#fetching-data">#</a> Fetching Data</h2>
<p>We’ll move the product data from the  <code>create</code>  function to  <code>static/products/products.json</code>  and query it using the <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"> <code>fetch</code> </a> api.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Apple&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;An apple a day keeps the doctor away&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;/products/apple.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">3.65</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Banana&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;An old banana leaf was once young and green&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;/products/banana.png&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span>: <span class="number">7.99</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Yew exposes common browser apis like fetch, localstorage etc through something called <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnJzL3lldy8wLjE3LjIveWV3L3NlcnZpY2VzL2luZGV4Lmh0bWw=">“services”</span>. We can use the  <code>FetchService</code>  to make network requests. It requires  <code>anyhow</code>  and  <code>serde</code>  crates, let’s install them:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  [package]</span><br><span class="line">  name = &quot;rustmart&quot;</span><br><span class="line">  version = &quot;0.1.0&quot;</span><br><span class="line">  authors = [&quot;sheshbabu &lt;sheshbabu@gmail.com&gt;&quot;]</span><br><span class="line">  edition = &quot;2018&quot;</span><br><span class="line"></span><br><span class="line">  [lib]</span><br><span class="line">  crate-type = [&quot;cdylib&quot;, &quot;rlib&quot;]</span><br><span class="line"></span><br><span class="line">  [dependencies]</span><br><span class="line">  yew = &quot;0.17&quot;</span><br><span class="line">  wasm-bindgen = &quot;0.2&quot;</span><br><span class="line"><span class="addition">+ anyhow = &quot;1.0.32&quot;</span></span><br><span class="line"><span class="addition">+ serde = &#123; version = &quot;1.0&quot;, features = [&quot;derive&quot;] &#125;</span></span><br></pre></td></tr></table></figure>
<p>Let’s extract the  <code>Product</code>  and  <code>CartProduct</code>  to  <code>src/types.rs</code>  so we can share it across multiple files:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> serde::&#123;Deserialize, Serialize&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Deserialize, Serialize, Clone, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Product</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> id: <span class="built_in">i32</span>,</span><br><span class="line">    <span class="keyword">pub</span> name: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> description: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> image: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">pub</span> price: <span class="built_in">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Clone, Debug)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">CartProduct</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> product: Product,</span><br><span class="line">    <span class="keyword">pub</span> quantity: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ve made both structs and their fields public, and have derived the  <code>Deserialize</code>  and  <code>Serialize</code>  traits.</p>
<p>We’ll use the <span class="exturl" data-url="aHR0cDovL3d3dy5zaGVzaGJhYnUuY29tL3Bvc3RzL29yZ2FuaXppbmctaHR0cC1yZXF1ZXN0cy11c2luZy1hcGktbW9kdWxlLXBhdHRlcm4v">API module pattern</span> and create a separate module called  <code>src/api.rs</code>  to hold our fetch logic:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/api.rs</span></span><br><span class="line"><span class="keyword">use</span> crate::types::Product;</span><br><span class="line"><span class="keyword">use</span> anyhow::Error;</span><br><span class="line"><span class="keyword">use</span> yew::callback::Callback;</span><br><span class="line"><span class="keyword">use</span> yew::format::&#123;Json, Nothing&#125;;</span><br><span class="line"><span class="keyword">use</span> yew::services::fetch::&#123;FetchService, FetchTask, Request, Response&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">type</span> <span class="title">FetchResponse</span></span>&lt;T&gt; = Response&lt;Json&lt;<span class="built_in">Result</span>&lt;T, Error&gt;&gt;&gt;;</span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">FetchCallback</span></span>&lt;T&gt; = Callback&lt;FetchResponse&lt;T&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">get_products</span></span>(callback: FetchCallback&lt;<span class="built_in">Vec</span>&lt;Product&gt;&gt;) -&gt; FetchTask &#123;</span><br><span class="line">    <span class="keyword">let</span> req = Request::get(<span class="string">&quot;/products/products.json&quot;</span>)</span><br><span class="line">        .body(Nothing)</span><br><span class="line">        .unwrap();</span><br><span class="line"></span><br><span class="line">    FetchService::fetch(req, callback).unwrap()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The  <code>FetchService</code>  api is a bit awkward - it takes in a request object and callback as arguments and returns something called a “FetchTask”. One surprising gotcha here is that the network request gets aborted if this “FetchTask” is dropped. So we return this and store it in our component.</p>
<p>Let’s update  <code>lib.rs</code>  to add these new modules into the <span class="exturl" data-url="aHR0cDovL3d3dy5zaGVzaGJhYnUuY29tL3Bvc3RzL3J1c3QtbW9kdWxlLXN5c3RlbS8=">module tree</span>:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  // src/lib.rs</span><br><span class="line"><span class="addition">+ mod api;</span></span><br><span class="line"><span class="addition">+ mod types;</span></span><br><span class="line">  mod pages;</span><br><span class="line"></span><br><span class="line">  use pages::Home;</span><br><span class="line">  use wasm_bindgen::prelude::*;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line">  #[wasm_bindgen(start)]</span><br><span class="line">  pub fn run_app() &#123;</span><br><span class="line">      App::&lt;Home&gt;::new().mount_to_body();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Finally, let’s update our HomePage component:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ use crate::api;</span></span><br><span class="line"><span class="addition">+ use crate::types::&#123;CartProduct, Product&#125;;</span></span><br><span class="line"><span class="addition">+ use anyhow::Error;</span></span><br><span class="line"><span class="addition">+ use yew::format::Json;</span></span><br><span class="line"><span class="addition">+ use yew::services::fetch::FetchTask;</span></span><br><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- #[derive(Clone)]</span></span><br><span class="line"><span class="deletion">- struct Product &#123;</span></span><br><span class="line"><span class="deletion">-     id: i32,</span></span><br><span class="line"><span class="deletion">-     name: String,</span></span><br><span class="line"><span class="deletion">-     description: String,</span></span><br><span class="line"><span class="deletion">-     image: String,</span></span><br><span class="line"><span class="deletion">-     price: f64,</span></span><br><span class="line"><span class="deletion">- &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- struct CartProduct &#123;</span></span><br><span class="line"><span class="deletion">-     product: Product,</span></span><br><span class="line"><span class="deletion">-     quantity: i32,</span></span><br><span class="line"><span class="deletion">- &#125;</span></span><br><span class="line"></span><br><span class="line">  struct State &#123;</span><br><span class="line">      products: Vec&lt;Product&gt;,</span><br><span class="line">      cart_products: Vec&lt;CartProduct&gt;,</span><br><span class="line"><span class="addition">+     get_products_error: Option&lt;Error&gt;,</span></span><br><span class="line"><span class="addition">+     get_products_loaded: bool,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pub struct Home &#123;</span><br><span class="line">      state: State,</span><br><span class="line">      link: ComponentLink&lt;Self&gt;,</span><br><span class="line"><span class="addition">+     task: Option&lt;FetchTask&gt;,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pub enum Msg &#123;</span><br><span class="line">      AddToCart(i32),</span><br><span class="line"><span class="addition">+     GetProducts,</span></span><br><span class="line"><span class="addition">+     GetProductsSuccess(Vec&lt;Product&gt;),</span></span><br><span class="line"><span class="addition">+     GetProductsError(Error),</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  impl Component for Home &#123;</span><br><span class="line">      type Message = Msg;</span><br><span class="line">      type Properties = ();</span><br><span class="line"></span><br><span class="line">      fn create(_: Self::Properties, link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span><br><span class="line"><span class="deletion">-         let products: Vec&lt;Product&gt; = vec![</span></span><br><span class="line"><span class="deletion">-             Product &#123;</span></span><br><span class="line"><span class="deletion">-                 id: 1,</span></span><br><span class="line"><span class="deletion">-                 name: &quot;Apple&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 description: &quot;An apple a day keeps the doctor away&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 image: &quot;/products/apple.png&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 price: 3.65,</span></span><br><span class="line"><span class="deletion">-             &#125;,</span></span><br><span class="line"><span class="deletion">-             Product &#123;</span></span><br><span class="line"><span class="deletion">-                 id: 2,</span></span><br><span class="line"><span class="deletion">-                 name: &quot;Banana&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 description: &quot;An old banana leaf was once young and green&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 image: &quot;/products/banana.png&quot;.to_string(),</span></span><br><span class="line"><span class="deletion">-                 price: 7.99,</span></span><br><span class="line"><span class="deletion">-             &#125;,</span></span><br><span class="line"><span class="deletion">-         ];</span></span><br><span class="line"><span class="addition">+         let products = vec![];</span></span><br><span class="line">          let cart_products = vec![];</span><br><span class="line"></span><br><span class="line"><span class="addition">+         link.send_message(Msg::GetProducts);</span></span><br><span class="line"></span><br><span class="line">          Self &#123;</span><br><span class="line">              state: State &#123;</span><br><span class="line">                  products,</span><br><span class="line">                  cart_products,</span><br><span class="line"><span class="addition">+                 get_products_error: None,</span></span><br><span class="line"><span class="addition">+                 get_products_loaded: false,</span></span><br><span class="line">              &#125;,</span><br><span class="line">              link,</span><br><span class="line"><span class="addition">+             task: None,</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn update(&amp;mut self, message: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">          match message &#123;</span><br><span class="line"><span class="addition">+             Msg::GetProducts =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 self.state.get_products_loaded = false;</span></span><br><span class="line"><span class="addition">+                 let handler =</span></span><br><span class="line"><span class="addition">+                     self.link</span></span><br><span class="line"><span class="addition">+                         .callback(move |response: api::FetchResponse&lt;Vec&lt;Product&gt;&gt;| &#123;</span></span><br><span class="line"><span class="addition">+                             let (_, Json(data)) = response.into_parts();</span></span><br><span class="line"><span class="addition">+                             match data &#123;</span></span><br><span class="line"><span class="addition">+                                 Ok(products) =&gt; Msg::GetProductsSuccess(products),</span></span><br><span class="line"><span class="addition">+                                 Err(err) =&gt; Msg::GetProductsError(err),</span></span><br><span class="line"><span class="addition">+                             &#125;</span></span><br><span class="line"><span class="addition">+                         &#125;);</span></span><br><span class="line"><span class="addition">+                 self.task = Some(api::get_products(handler));</span></span><br><span class="line"><span class="addition">+                 true</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+             Msg::GetProductsSuccess(products) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 self.state.products = products;</span></span><br><span class="line"><span class="addition">+                 self.state.get_products_loaded = true;</span></span><br><span class="line"><span class="addition">+                 true</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+             Msg::GetProductsError(error) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 self.state.get_products_error = Some(error);</span></span><br><span class="line"><span class="addition">+                 self.state.get_products_loaded = true;</span></span><br><span class="line"><span class="addition">+                 true</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line">              Msg::AddToCart(product_id) =&gt; &#123;</span><br><span class="line">                  let product = self</span><br><span class="line">                      .state</span><br><span class="line">                      .products</span><br><span class="line">                      .iter()</span><br><span class="line">                      .find(|p: &amp;&amp;Product| p.id == product_id)</span><br><span class="line">                      .unwrap();</span><br><span class="line">                  let cart_product = self</span><br><span class="line">                      .state</span><br><span class="line">                      .cart_products</span><br><span class="line">                      .iter_mut()</span><br><span class="line">                      .find(|cp: &amp;&amp;mut CartProduct| cp.product.id == product_id);</span><br><span class="line"></span><br><span class="line">                  if let Some(cp) = cart_product &#123;</span><br><span class="line">                      cp.quantity += 1;</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                      self.state.cart_products.push(CartProduct &#123;</span><br><span class="line">                          product: product.clone(),</span><br><span class="line">                          quantity: 1,</span><br><span class="line">                      &#125;)</span><br><span class="line">                  &#125;</span><br><span class="line">                  true</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">          true</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">          let products: Vec&lt;Html&gt; = self</span><br><span class="line">              .state</span><br><span class="line">              .products</span><br><span class="line">              .iter()</span><br><span class="line">              .map(|product: &amp;Product| &#123;</span><br><span class="line">                  let product_id = product.id;</span><br><span class="line">                  html! &#123;</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                      &lt;img src=&#123;&amp;product.image&#125;/&gt;</span><br><span class="line">                      &lt;div&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;button onclick=self.link.callback(move |_| Msg::AddToCart(product_id))&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .collect();</span><br><span class="line"></span><br><span class="line">          let cart_value = self</span><br><span class="line">              .state</span><br><span class="line">              .cart_products</span><br><span class="line">              .iter()</span><br><span class="line">              .fold(0.0, |acc, cp| acc + (cp.quantity as f64 * cp.product.price));</span><br><span class="line"></span><br><span class="line"><span class="addition">+         if !self.state.get_products_loaded &#123;</span></span><br><span class="line"><span class="addition">+             html! &#123;</span></span><br><span class="line"><span class="addition">+               &lt;div&gt;&#123;&quot;Loading ...&quot;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+         &#125; else if let Some(_) = self.state.get_products_error &#123;</span></span><br><span class="line"><span class="addition">+             html! &#123;</span></span><br><span class="line"><span class="addition">+               &lt;div&gt;</span></span><br><span class="line"><span class="addition">+                 &lt;span&gt;&#123;&quot;Error loading products! :(&quot;&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="addition">+               &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+         &#125; else &#123;</span></span><br><span class="line">              html! &#123;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                  &lt;span&gt;&#123;format!(&quot;Cart Value: &#123;:.2&#125;&quot;, cart_value)&#125;&lt;/span&gt;</span><br><span class="line">                  &lt;span&gt;&#123;products&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &#125;</span><br><span class="line"><span class="addition">+         &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Quite a number of changes, but you should be able to understand most of them.</p>
<ul>
<li>We’ve replaced the hardcoded products list in  <code>create</code>  with an empty array. We’re also sending a message  <code>Msg::GetProducts</code>  to  <code>update</code>  which calls the  <code>get_products</code>  method in the  <code>api</code>  module. The returned  <code>FetchTask</code>  is stored in  <code>task</code> .</li>
<li>When the network request succeeds, the  <code>Msg::GetProductsSuccess</code>  message is called with products list or  <code>Msg::GetProductsError</code>  with error.</li>
<li>These two messages set the  <code>products</code>  and  <code>get_products_error</code>  fields in state respectively. They also set the  <code>get_products_loaded</code>  state to true after the request is fulfilled.</li>
<li>In the  <code>view</code>  method, we’ve used conditional rendering to render either the loading view, error view or products view based on the component’s state.</li>
</ul>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-3.png" alt="img"></p>
<h2 id="splitting-into-reusable-components"><a class="markdownIt-Anchor" href="#splitting-into-reusable-components">#</a> Splitting into reusable components</h2>
<p>Let’s extract the “product card” component into its own module so we can reuse it in other pages.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/product_card.rs</span></span><br><span class="line"><span class="keyword">use</span> crate::types::Product;</span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">ProductCard</span></span> &#123;</span><br><span class="line">    props: Props,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Properties, Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Props</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> product: Product,</span><br><span class="line">    <span class="keyword">pub</span> on_add_to_cart: Callback&lt;()&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> ProductCard &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = ();</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = Props;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(props: Self::Properties, _link: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; props &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _msg: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _props: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        <span class="keyword">let</span> onclick = <span class="keyword">self</span>.props.on_add_to_cart.reform(|_| ());</span><br><span class="line"></span><br><span class="line">        html! &#123;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;img src=&#123;&amp;<span class="keyword">self</span>.props.product.image&#125;/&gt;</span><br><span class="line">            &lt;div&gt;&#123;&amp;self.props.product.name&#125;&lt;/div&gt;</span><br><span class="line">            &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;self.props.product.price&#125;&lt;/div&gt;</span><br><span class="line">            &lt;button onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// src/components/mod.rs</span></span><br><span class="line"><span class="keyword">mod</span> product_card;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">use</span> product_card::ProductCard;</span><br><span class="line">  <span class="comment">// src/lib.rs</span></span><br><span class="line">  <span class="keyword">mod</span> api;</span><br><span class="line">+ <span class="keyword">mod</span> components;</span><br><span class="line">  <span class="keyword">mod</span> pages;</span><br><span class="line">  <span class="keyword">mod</span> types;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// No changes</span></span><br><span class="line">  <span class="comment">// src/pages/home.rs</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">use</span> crate::api;</span><br><span class="line">+ <span class="keyword">use</span> crate::components::ProductCard;</span><br><span class="line">  <span class="keyword">use</span> crate::types::&#123;CartProduct, Product&#125;;</span><br><span class="line">  <span class="keyword">use</span> anyhow::Error;</span><br><span class="line">  <span class="keyword">use</span> yew::format::Json;</span><br><span class="line">  <span class="keyword">use</span> yew::prelude::*;</span><br><span class="line">  <span class="keyword">use</span> yew::services::fetch::FetchTask;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// No changes</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">impl</span> Component <span class="keyword">for</span> Home &#123;</span><br><span class="line">      <span class="comment">// No changes</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">          <span class="keyword">let</span> products: <span class="built_in">Vec</span>&lt;Html&gt; = <span class="keyword">self</span></span><br><span class="line">              .state</span><br><span class="line">              .products</span><br><span class="line">              .iter()</span><br><span class="line">              .map(|product: &amp;Product| &#123;</span><br><span class="line">                  <span class="keyword">let</span> product_id = product.id;</span><br><span class="line">                  html! &#123;</span><br><span class="line">-                   &lt;div&gt;</span><br><span class="line">-                     &lt;img src=&#123;&amp;product.image&#125;/&gt;</span><br><span class="line">-                     &lt;div&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span><br><span class="line">-                     &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span><br><span class="line">-                     &lt;button onclick=self.link.callback(move |_| Msg::AddToCart(product_id))&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">-                   &lt;/div&gt;</span><br><span class="line">+                   &lt;ProductCard product=&#123;product&#125; on_add_to_cart=<span class="keyword">self</span>.link.callback(<span class="keyword">move</span> |_| Msg::AddToCart(product_id))/&gt;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .collect();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// No changes</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Pretty straightforward, except for  <code>Properties</code> ,  <code>Callback</code>  and  <code>reform</code> .</p>
<ul>
<li><code>Properties</code>  - As mentioned in the beginning of the post, “Properties” or “Props” are input to a component. If you think of components as functions, then Props are the function arguments.</li>
<li>For the  <code>ProductCard</code>  component, we’re passing the  <code>Product</code>  struct as well as a  <code>on_add_to_cart</code>  callback. This component doesn’t hold any state, so when user clicks on the “Add To Cart” button, this component calls the parent component to update the  <code>cart_products</code>  state. This callback is represented using the  <code>Callback&lt;T&gt;</code>  type and to call this from child component, we either use  <code>emit</code>  or  <code>reform</code>  methods on the callback.</li>
</ul>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-4.png" alt="img"></p>
<h2 id="styling"><a class="markdownIt-Anchor" href="#styling">#</a> Styling</h2>
<p>The UI looks barebones as we haven’t added any styles.</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-3.png" alt="img"></p>
<p>We can either use the <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRNTC9HbG9iYWxfYXR0cmlidXRlcy9jbGFzcw==">class attribute</span> or <span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0VsZW1lbnRDU1NJbmxpbmVTdHlsZS9zdHlsZQ==">inline styles</span> with Yew. Let’s add some styles so the UI looks good.</p>
<p>Let’s create a new CSS file  <code>static/styles.css</code> , add it to  <code>static/index.html</code>  and then we can start using the classes in our components.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  // src/pages/home.rs</span><br><span class="line"></span><br><span class="line">  html! &#123;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line"><span class="deletion">-     &lt;span&gt;&#123;format!(&quot;Cart Value: &#123;:.2&#125;&quot;, cart_value)&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="deletion">-     &lt;span&gt;&#123;products&#125;&lt;/span&gt;</span></span><br><span class="line"><span class="addition">+     &lt;div class=&quot;navbar&quot;&gt;</span></span><br><span class="line"><span class="addition">+         &lt;div class=&quot;navbar_title&quot;&gt;&#123;&quot;RustMart&quot;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+         &lt;div class=&quot;navbar_cart_value&quot;&gt;&#123;format!(&quot;$&#123;:.2&#125;&quot;, cart_value)&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+     &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+     &lt;div class=&quot;product_card_list&quot;&gt;&#123;products&#125;&lt;/div&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  // src/components/product_card.rs</span><br><span class="line"></span><br><span class="line">  html! &#123;</span><br><span class="line"><span class="deletion">-   &lt;div&gt;</span></span><br><span class="line"><span class="deletion">-     &lt;img src=&#123;&amp;self.props.product.image&#125;/&gt;</span></span><br><span class="line"><span class="deletion">-     &lt;div&gt;&#123;&amp;self.props.product.name&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="deletion">-     &lt;div&gt;&#123;&quot;$&quot;&#125;&#123;&amp;self.props.product.price&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="deletion">-     &lt;button onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="deletion">-   &lt;/div&gt;</span></span><br><span class="line"><span class="addition">+   &lt;div class=&quot;product_card_container&quot;&gt;</span></span><br><span class="line"><span class="addition">+     &lt;img class=&quot;product_card_image&quot; src=&#123;&amp;self.props.product.image&#125;/&gt;</span></span><br><span class="line"><span class="addition">+     &lt;div class=&quot;product_card_name&quot;&gt;&#123;&amp;self.props.product.name&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+     &lt;div class=&quot;product_card_price&quot;&gt;&#123;&quot;$&quot;&#125;&#123;&amp;self.props.product.price&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+     &lt;button class=&quot;product_atc_button&quot; onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="addition">+   &lt;/div&gt;</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>After adding the styles and a few more products, here’s how the UI looks like:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-4.png" alt="img"></p>
<p>CSS changes are outside the scope of this post, please refer to the <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NoZXNoYmFidS9ydXN0bWFydC15ZXctZXhhbXBsZQ==">GitHub repo</span>.</p>
<h2 id="routing"><a class="markdownIt-Anchor" href="#routing">#</a> Routing</h2>
<p>In server rendered pages (Jinja, ERB, JSP etc), each page the user sees is mapped to a different template file. For example, when the user navigates to “/login”, it’s rendered in server using “login.html” and when the user goes to “/settings”, it’s rendered using “settings.html”. Using unique urls for different UI pages is also useful for bookmarking and sharing.</p>
<p>Since SPAs only have one html page (the “Single Page” in SPA), we should be able to replicate the above behavior. This is done using a  <code>Router</code> . A Router maps different url paths (with query params, fragments etc) to different page components and helps in navigating between multiple pages without reloading.</p>
<p>For our application, we’ll be using this mapping:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/            =&gt; HomePage</span><br><span class="line">/product/:id =&gt; ProductDetailPage</span><br></pre></td></tr></table></figure>
<p>Let’s install  <code>yew-router</code> :</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  [package]</span><br><span class="line">  name = &quot;rustmart&quot;</span><br><span class="line">  version = &quot;0.1.0&quot;</span><br><span class="line">  authors = [&quot;sheshbabu &lt;sheshbabu@gmail.com&gt;&quot;]</span><br><span class="line">  edition = &quot;2018&quot;</span><br><span class="line"></span><br><span class="line">  [lib]</span><br><span class="line">  crate-type = [&quot;cdylib&quot;, &quot;rlib&quot;]</span><br><span class="line"></span><br><span class="line">  [dependencies]</span><br><span class="line">  yew = &quot;0.17&quot;</span><br><span class="line"><span class="addition">+ yew-router = &quot;0.14.0&quot;</span></span><br><span class="line">  wasm-bindgen = &quot;0.2&quot;</span><br><span class="line">  log = &quot;0.4.6&quot;</span><br><span class="line">  wasm-logger = &quot;0.2.0&quot;</span><br><span class="line">  anyhow = &quot;1.0.32&quot;</span><br><span class="line">  serde = &#123; version = &quot;1.0&quot;, features = [&quot;derive&quot;] &#125;</span><br></pre></td></tr></table></figure>
<p>Let’s add the routes in a dedicated file so it’s easier to see all available routes at a glance:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/route.rs</span></span><br><span class="line"><span class="keyword">use</span> yew_router::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Switch, Debug, Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">Route</span></span> &#123;</span><br><span class="line">    <span class="meta">#[to = <span class="meta-string">&quot;/&quot;</span>]</span></span><br><span class="line">    HomePage,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For the time being, it only has one route. We’ll add more later.</p>
<p>Let’s create a new file called  <code>src/app.rs</code>  to replace  <code>HomePage</code>  as the new root component:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"><span class="keyword">use</span> yew_router::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::pages::Home;</span><br><span class="line"><span class="keyword">use</span> crate::route::Route;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">App</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> App &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = ();</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = ();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(_: Self::Properties, _link: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _msg: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        <span class="keyword">let</span> render = Router::render(|switch: Route| <span class="keyword">match</span> switch &#123;</span><br><span class="line">            Route::HomePage =&gt; html! &#123;&lt;Home/&gt;&#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        html! &#123;</span><br><span class="line">            &lt;Router&lt;Route, ()&gt; render=render/&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s make the corresponding change in  <code>lib.rs</code> :</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  mod api;</span><br><span class="line"><span class="addition">+ mod app;</span></span><br><span class="line">  mod components;</span><br><span class="line">  mod pages;</span><br><span class="line"><span class="addition">+ mod route;</span></span><br><span class="line">  mod types;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- use pages::Home;</span></span><br><span class="line">  use wasm_bindgen::prelude::*;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line"></span><br><span class="line">  #[wasm_bindgen(start)]</span><br><span class="line">  pub fn run_app() &#123;</span><br><span class="line">      wasm_logger::init(wasm_logger::Config::default());</span><br><span class="line"><span class="deletion">-     App::&lt;Home&gt;::new().mount_to_body();</span></span><br><span class="line"><span class="addition">+     App::&lt;app::App&gt;::new().mount_to_body();</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>This is how our component hierarchy looks like so far:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-5.png" alt="img"></p>
<h2 id="productdetailpage"><a class="markdownIt-Anchor" href="#productdetailpage">#</a> ProductDetailPage</h2>
<p>Now that we have a router in place, let’s use it to navigate from one page to another. Since it’s a SPA, we should avoid page reload while navigating.</p>
<p>Let’s add a route for ProductDetailPage under  <code>/product/:id</code> . When the user clicks on a  <code>ProductCard</code> , it will go to its detail page with the  <code>id</code>  in the route passed as a Prop.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  // src/route.rs</span><br><span class="line">  use yew_router::prelude::*;</span><br><span class="line"></span><br><span class="line">  #[derive(Switch, Debug, Clone)]</span><br><span class="line">  pub enum Route &#123;</span><br><span class="line"><span class="addition">+     #[to = &quot;/product/&#123;id&#125;&quot;]</span></span><br><span class="line"><span class="addition">+     ProductDetail(i32),</span></span><br><span class="line">      #[to = &quot;/&quot;]</span><br><span class="line">      HomePage,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Note that the order of the routes above determines which page gets rendered first. For example, the url  <code>/product/2</code>  matches both  <code>/product/&#123;id&#125;</code>  and  <code>/</code>  but since we wrote  <code>/product/&#123;id&#125;</code>  first, the  <code>ProductDetail</code>  page gets rendered instead of  <code>Home</code> .</p>
<p>Add this route to  <code>app.rs</code> :</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  use yew::prelude::*;</span><br><span class="line">  use yew_router::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="deletion">- use crate::pages::&#123;Home&#125;;</span></span><br><span class="line"><span class="addition">+ use crate::pages::&#123;Home, ProductDetail&#125;;</span></span><br><span class="line">  use crate::route::Route;</span><br><span class="line"></span><br><span class="line">  pub struct App &#123;&#125;</span><br><span class="line"></span><br><span class="line">  impl Component for App &#123;</span><br><span class="line">      // No changes</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">          let render = Router::render(|switch: Route| match switch &#123;</span><br><span class="line"><span class="addition">+             Route::ProductDetail(id) =&gt; html! &#123;&lt;ProductDetail id=id/&gt;&#125;,</span></span><br><span class="line">              Route::HomePage =&gt; html! &#123;&lt;Home/&gt;&#125;,</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          html! &#123;</span><br><span class="line">              &lt;Router&lt;Route, ()&gt; render=render/&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Let’s update the  <code>ProductCard</code>  so clicking on the product image, name or price takes us to this new page:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  // src/components/product_card.rs</span><br><span class="line"><span class="addition">+ use crate::route::Route;</span></span><br><span class="line">  use crate::types::Product;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line"><span class="addition">+ use yew_router::components::RouterAnchor;</span></span><br><span class="line"></span><br><span class="line">  // No changes</span><br><span class="line"></span><br><span class="line">  impl Component for ProductCard &#123;</span><br><span class="line">      // No changes</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line"><span class="addition">+         type Anchor = RouterAnchor&lt;Route&gt;;</span></span><br><span class="line">          let onclick = self.props.on_add_to_cart.reform(|_| ());</span><br><span class="line"></span><br><span class="line">          html! &#123;</span><br><span class="line">              &lt;div class=&quot;product_card_container&quot;&gt;</span><br><span class="line"><span class="addition">+                 &lt;Anchor route=Route::ProductDetail(self.props.product.id) classes=&quot;product_card_anchor&quot;&gt;</span></span><br><span class="line">                      &lt;img class=&quot;product_card_image&quot; src=&#123;&amp;self.props.product.image&#125;/&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_name&quot;&gt;&#123;&amp;self.props.product.name&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_price&quot;&gt;&#123;&quot;$&quot;&#125;&#123;&amp;self.props.product.price&#125;&lt;/div&gt;</span><br><span class="line"><span class="addition">+                 &lt;/Anchor&gt;</span></span><br><span class="line">                  &lt;button class=&quot;product_atc_button&quot; onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Notice how we used  <code>classes</code>  instead of  <code>class</code>  for  <code>Anchor</code> .</p>
<p>We’ll create files named  <code>static/products/1.json</code> ,  <code>static/products/2.json</code>  etc with mock data:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Apple&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;An apple a day keeps the doctor away&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;image&quot;</span>: <span class="string">&quot;/products/apple.png&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>: <span class="number">3.65</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Let’s update the  <code>api.rs</code>  module with the new route:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  use crate::types::Product;</span><br><span class="line">  use anyhow::Error;</span><br><span class="line">  use yew::callback::Callback;</span><br><span class="line">  use yew::format::&#123;Json, Nothing&#125;;</span><br><span class="line">  use yew::services::fetch::&#123;FetchService, FetchTask, Request, Response&#125;;</span><br><span class="line"></span><br><span class="line">  pub type FetchResponse&lt;T&gt; = Response&lt;Json&lt;Result&lt;T, Error&gt;&gt;&gt;;</span><br><span class="line">  type FetchCallback&lt;T&gt; = Callback&lt;FetchResponse&lt;T&gt;&gt;;</span><br><span class="line"></span><br><span class="line">  pub fn get_products(callback: FetchCallback&lt;Vec&lt;Product&gt;&gt;) -&gt; FetchTask &#123;</span><br><span class="line">      let req = Request::get(&quot;/products/products.json&quot;)</span><br><span class="line">          .body(Nothing)</span><br><span class="line">          .unwrap();</span><br><span class="line"></span><br><span class="line">      FetchService::fetch(req, callback).unwrap()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ pub fn get_product(id: i32, callback: FetchCallback&lt;Product&gt;) -&gt; FetchTask &#123;</span></span><br><span class="line"><span class="addition">+     let req = Request::get(format!(&quot;/products/&#123;&#125;.json&quot;, id))</span></span><br><span class="line"><span class="addition">+         .body(Nothing)</span></span><br><span class="line"><span class="addition">+         .unwrap();</span></span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+     FetchService::fetch(req, callback).unwrap()</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br></pre></td></tr></table></figure>
<p>Finally, here’s the  <code>ProductDetail</code>  page component:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/pages/product_detail.rs</span></span><br><span class="line"><span class="keyword">use</span> crate::api;</span><br><span class="line"><span class="keyword">use</span> crate::types::Product;</span><br><span class="line"><span class="keyword">use</span> anyhow::Error;</span><br><span class="line"><span class="keyword">use</span> yew::format::Json;</span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"><span class="keyword">use</span> yew::services::fetch::FetchTask;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">State</span></span> &#123;</span><br><span class="line">    product: <span class="built_in">Option</span>&lt;Product&gt;,</span><br><span class="line">    get_product_error: <span class="built_in">Option</span>&lt;Error&gt;,</span><br><span class="line">    get_product_loaded: <span class="built_in">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">ProductDetail</span></span> &#123;</span><br><span class="line">    props: Props,</span><br><span class="line">    state: State,</span><br><span class="line">    link: ComponentLink&lt;<span class="keyword">Self</span>&gt;,</span><br><span class="line">    task: <span class="built_in">Option</span>&lt;FetchTask&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Properties, Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Props</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> id: <span class="built_in">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">Msg</span></span> &#123;</span><br><span class="line">    GetProduct,</span><br><span class="line">    GetProductSuccess(Product),</span><br><span class="line">    GetProductError(Error),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> ProductDetail &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = Msg;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = Props;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(props: Self::Properties, link: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        link.send_message(Msg::GetProduct);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            props,</span><br><span class="line">            state: State &#123;</span><br><span class="line">                product: <span class="literal">None</span>,</span><br><span class="line">                get_product_error: <span class="literal">None</span>,</span><br><span class="line">                get_product_loaded: <span class="literal">false</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            link,</span><br><span class="line">            task: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, message: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="keyword">match</span> message &#123;</span><br><span class="line">            Msg::GetProduct =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> handler = <span class="keyword">self</span></span><br><span class="line">                    .link</span><br><span class="line">                    .callback(<span class="keyword">move</span> |response: api::FetchResponse&lt;Product&gt;| &#123;</span><br><span class="line">                        <span class="keyword">let</span> (_, Json(data)) = response.into_parts();</span><br><span class="line">                        <span class="keyword">match</span> data &#123;</span><br><span class="line">                            <span class="literal">Ok</span>(product) =&gt; Msg::GetProductSuccess(product),</span><br><span class="line">                            <span class="literal">Err</span>(err) =&gt; Msg::GetProductError(err),</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">self</span>.task = <span class="literal">Some</span>(api::get_product(<span class="keyword">self</span>.props.id, handler));</span><br><span class="line">                <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            Msg::GetProductSuccess(product) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.state.product = <span class="literal">Some</span>(product);</span><br><span class="line">                <span class="keyword">self</span>.state.get_product_loaded = <span class="literal">true</span>;</span><br><span class="line">                <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">            Msg::GetProductError(error) =&gt; &#123;</span><br><span class="line">                <span class="keyword">self</span>.state.get_product_error = <span class="literal">Some</span>(error);</span><br><span class="line">                <span class="keyword">self</span>.state.get_product_loaded = <span class="literal">true</span>;</span><br><span class="line">                <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(<span class="keyword">ref</span> product) = <span class="keyword">self</span>.state.product &#123;</span><br><span class="line">            html! &#123;</span><br><span class="line">                &lt;div class=<span class="string">&quot;product_detail_container&quot;</span>&gt;</span><br><span class="line">                    &lt;img class=<span class="string">&quot;product_detail_image&quot;</span> src=&#123;&amp;product.image&#125;/&gt;</span><br><span class="line">                    &lt;div class=&quot;product_card_name&quot;&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div style=&quot;margin: 10px 0; line-height: 24px;&quot;&gt;&#123;&amp;product.description&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;product_card_price&quot;&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;button class=&quot;product_atc_button&quot;&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> !<span class="keyword">self</span>.state.get_product_loaded &#123;</span><br><span class="line">            html! &#123;</span><br><span class="line">                &lt;div class=<span class="string">&quot;loading_spinner_container&quot;</span>&gt;</span><br><span class="line">                    &lt;div class=&quot;loading_spinner&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;loading_spinner_text&quot;&gt;&#123;&quot;Loading ...&quot;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            html! &#123;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;span&gt;&#123;&quot;Error loading product! :(&quot;&#125;&lt;/span&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Very similar to the HomePage component. Let’s also add this file to the module tree:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  // src/pages/mod.rs</span><br><span class="line">  mod home;</span><br><span class="line"><span class="addition">+ mod product_detail;</span></span><br><span class="line"></span><br><span class="line">  pub use home::Home;</span><br><span class="line"><span class="addition">+ pub use product_detail::ProductDetail;</span></span><br></pre></td></tr></table></figure>
<p>This is how it looks like:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-5.png" alt="img"></p>
<p>We can now move between multiple pages without refreshing the page!</p>
<h2 id="state-management"><a class="markdownIt-Anchor" href="#state-management">#</a> State Management</h2>
<p>One thing you might have noticed in the  <code>ProductDetail</code>  page is that clicking on the “Add To Cart” button doesn’t update the cart. This is because the state that holds the list of products in cart  <code>cart_products</code>  currently resides inside  <code>Home</code>  page component:<br>
<img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-6.png" alt="img"></p>
<p>To share state between two components, we can either:</p>
<ul>
<li>Hoist the state to a common ancestor</li>
<li>Move state to global app state</li>
</ul>
<p>The  <code>App</code>  component is a common ancestor to both  <code>ProductDetail</code>  and  <code>Home</code> . We can move the  <code>cart_products</code>  state there and pass it as props to  <code>ProductDetail</code>  and  <code>Home</code> .</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-7.png" alt="img"></p>
<p>This works fine for shallow component hierarchies but when you have deep component hierarchy (which is common in larger SPAs), you’ll need to pass this state through multiple layers of components (which might not have use for this prop) to reach the desired node. This is called “Prop Drilling”.</p>
<p>You can see that  <code>cart_products</code>  is now passed from  <code>App</code>  to  <code>AddToCart</code>  component via  <code>ProductDetail</code>  and  <code>Home</code>  even though they have no use for this state. Imagine the same scenario with components many layers deep.</p>
<p>This is the problem the global state solves. Here’s how it would look like:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-8.png" alt="img"></p>
<p>Notice how there’s a direct link between the components that need this state and the global state.</p>
<p>Unfortunately, Yew doesn’t seem to have a <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lld3N0YWNrL3lldy9pc3N1ZXMvNTc2">good solution</span> for this. The recommended solution is to use  <code>Agents</code>  for broadcasting state changes via pubsub. This is something I stay away from as it gets messy fast. I hope in future we see something similar to React’s <span class="exturl" data-url="aHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2NvbnRleHQuaHRtbA==">Context</span>, Redux or Mobx etc.</p>
<p>Let’s solve our problem by hoisting the state.</p>
<h2 id="hoisting-state"><a class="markdownIt-Anchor" href="#hoisting-state">#</a> Hoisting State</h2>
<p>We’ll be refactoring our code by moving  <code>cart_products</code>  state to  <code>App</code>  and extracting  <code>Navbar</code>  and  <code>AtcButton</code>  as separate components:</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/rust-wasm-yew-single-page-application-9.png" alt="img"></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/navbar.rs</span></span><br><span class="line"><span class="keyword">use</span> crate::types::CartProduct;</span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Navbar</span></span> &#123;</span><br><span class="line">    props: Props,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Properties, Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Props</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> cart_products: <span class="built_in">Vec</span>&lt;CartProduct&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> Navbar &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = ();</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = Props;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(props: Self::Properties, _link: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; props &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, _msg: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, props: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="keyword">self</span>.props = props;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        <span class="keyword">let</span> cart_value = <span class="keyword">self</span></span><br><span class="line">            .props</span><br><span class="line">            .cart_products</span><br><span class="line">            .iter()</span><br><span class="line">            .fold(<span class="number">0.0</span>, |acc, cp| acc + (cp.quantity <span class="keyword">as</span> <span class="built_in">f64</span> * cp.product.price));</span><br><span class="line"></span><br><span class="line">        html! &#123;</span><br><span class="line">            &lt;div class=<span class="string">&quot;navbar&quot;</span>&gt;</span><br><span class="line">                &lt;div class=&quot;navbar_title&quot;&gt;&#123;&quot;RustMart&quot;&#125;&lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;navbar_cart_value&quot;&gt;&#123;format!(&quot;$&#123;:.2&#125;&quot;, cart_value)&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice how we started using the  <code>change</code>  lifecycle methods in the  <code>Navbar</code>  component. When the props sent from parent changes, we need to update the props inside the component so the UI re-renders.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/components/atc_button.rs</span></span><br><span class="line"><span class="keyword">use</span> crate::types::Product;</span><br><span class="line"><span class="keyword">use</span> yew::prelude::*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">AtcButton</span></span> &#123;</span><br><span class="line">    props: Props,</span><br><span class="line">    link: ComponentLink&lt;<span class="keyword">Self</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Properties, Clone)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Props</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> product: Product,</span><br><span class="line">    <span class="keyword">pub</span> on_add_to_cart: Callback&lt;Product&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">Msg</span></span> &#123;</span><br><span class="line">    AddToCart,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Component <span class="keyword">for</span> AtcButton &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Message</span></span> = Msg;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Properties</span></span> = Props;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">create</span></span>(props: Self::Properties, link: ComponentLink&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; props, link &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">update</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, msg: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="keyword">match</span> msg &#123;</span><br><span class="line">            Msg::AddToCart =&gt; <span class="keyword">self</span>.props.on_add_to_cart.emit(<span class="keyword">self</span>.props.product.clone()),</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">change</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, props: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">        <span class="keyword">self</span>.props = props;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">view</span></span>(&amp;<span class="keyword">self</span>) -&gt; Html &#123;</span><br><span class="line">        <span class="keyword">let</span> onclick = <span class="keyword">self</span>.link.callback(|_| Msg::AddToCart);</span><br><span class="line"></span><br><span class="line">        html! &#123;</span><br><span class="line">          &lt;button class=&quot;product_atc_button&quot; onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">// src/components/mod.rs</span></span><br><span class="line">+ <span class="keyword">mod</span> atc_button;</span><br><span class="line">+ <span class="keyword">mod</span> navbar;</span><br><span class="line">  <span class="keyword">mod</span> product_card;</span><br><span class="line"></span><br><span class="line">+ <span class="keyword">pub</span> <span class="keyword">use</span> atc_button::AtcButton;</span><br><span class="line">+ <span class="keyword">pub</span> <span class="keyword">use</span> navbar::Navbar;</span><br><span class="line">  <span class="keyword">pub</span> <span class="keyword">use</span> product_card::ProductCard;</span><br></pre></td></tr></table></figure>
<p>Use the new  <code>AtcButton</code>  in  <code>ProductCard</code>  and  <code>ProductDetail</code> :</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">  // src/components/product_card.rs</span><br><span class="line"><span class="addition">+ use crate::components::AtcButton;</span></span><br><span class="line">  use crate::route::Route;</span><br><span class="line">  use crate::types::Product;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line">  use yew_router::components::RouterAnchor;</span><br><span class="line"></span><br><span class="line">  pub struct ProductCard &#123;</span><br><span class="line">      props: Props,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #[derive(Properties, Clone)]</span><br><span class="line">  pub struct Props &#123;</span><br><span class="line">      pub product: Product,</span><br><span class="line"><span class="deletion">-     pub on_add_to_cart: Callback&lt;()&gt;,</span></span><br><span class="line"><span class="addition">+     pub on_add_to_cart: Callback&lt;Product&gt;,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  impl Component for ProductCard &#123;</span><br><span class="line">      // No changes</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">          type Anchor = RouterAnchor&lt;Route&gt;;</span><br><span class="line"><span class="deletion">-         let onclick = self.props.on_add_to_cart.reform(|_| ());</span></span><br><span class="line"></span><br><span class="line">          html! &#123;</span><br><span class="line">              &lt;div class=&quot;product_card_container&quot;&gt;</span><br><span class="line">                  &lt;Anchor route=Route::ProductDetail(self.props.product.id) classes=&quot;product_card_anchor&quot;&gt;</span><br><span class="line">                      &lt;img class=&quot;product_card_image&quot; src=&#123;&amp;self.props.product.image&#125;/&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_name&quot;&gt;&#123;&amp;self.props.product.name&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_price&quot;&gt;&#123;&quot;$&quot;&#125;&#123;&amp;self.props.product.price&#125;&lt;/div&gt;</span><br><span class="line">                  &lt;/Anchor&gt;</span><br><span class="line"><span class="deletion">-                 &lt;button class=&quot;product_atc_button&quot; onclick=onclick&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="addition">+                 &lt;AtcButton product=self.props.product.clone() on_add_to_cart=self.props.on_add_to_cart.clone() /&gt;</span></span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // src/pages/product_detail.rs</span><br><span class="line">  use crate::api;</span><br><span class="line"><span class="addition">+ use crate::components::AtcButton;</span></span><br><span class="line">  use crate::types::Product;</span><br><span class="line">  use anyhow::Error;</span><br><span class="line">  use yew::format::Json;</span><br><span class="line">  use yew::prelude::*;</span><br><span class="line">  use yew::services::fetch::FetchTask;</span><br><span class="line"></span><br><span class="line">  // No changes</span><br><span class="line"></span><br><span class="line">  #[derive(Properties, Clone)]</span><br><span class="line">  pub struct Props &#123;</span><br><span class="line">      pub id: i32,</span><br><span class="line"><span class="addition">+     pub on_add_to_cart: Callback&lt;Product&gt;,</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  impl Component for ProductDetail &#123;</span><br><span class="line">      // No changes</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">          if let Some(ref product) = self.state.product &#123;</span><br><span class="line">              html! &#123;</span><br><span class="line">                  &lt;div class=&quot;product_detail_container&quot;&gt;</span><br><span class="line">                      &lt;img class=&quot;product_detail_image&quot; src=&#123;&amp;product.image&#125;/&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_name&quot;&gt;&#123;&amp;product.name&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;div style=&quot;margin: 10px 0; line-height: 24px;&quot;&gt;&#123;&amp;product.description&#125;&lt;/div&gt;</span><br><span class="line">                      &lt;div class=&quot;product_card_price&quot;&gt;&#123;&quot;$&quot;&#125;&#123;&amp;product.price&#125;&lt;/div&gt;</span><br><span class="line"><span class="deletion">-                     &lt;button class=&quot;product_atc_button&quot;&gt;&#123;&quot;Add To Cart&quot;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="addition">+                     &lt;AtcButton product=product.clone() on_add_to_cart=self.props.on_add_to_cart.clone() /&gt;</span></span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          // No changes</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Finally, move the  <code>cart_products</code>  state from  <code>Home</code>  to  <code>App</code> :</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line">  // src/app.rs</span><br><span class="line"><span class="addition">+ use crate::components::Navbar;</span></span><br><span class="line"><span class="addition">+ use crate::types::&#123;CartProduct, Product&#125;;</span></span><br><span class="line">  use yew::prelude::*;</span><br><span class="line">  use yew_router::prelude::*;</span><br><span class="line"></span><br><span class="line">  use crate::pages::&#123;Home, ProductDetail&#125;;</span><br><span class="line">  use crate::route::Route;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ struct State &#123;</span></span><br><span class="line"><span class="addition">+     cart_products: Vec&lt;CartProduct&gt;,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- pub struct App &#123;&#125;</span></span><br><span class="line"><span class="addition">+ pub struct App &#123;</span></span><br><span class="line"><span class="addition">+     state: State,</span></span><br><span class="line"><span class="addition">+     link: ComponentLink&lt;Self&gt;,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+ pub enum Msg &#123;</span></span><br><span class="line"><span class="addition">+     AddToCart(Product),</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  impl Component for App &#123;</span><br><span class="line"><span class="deletion">-     type Message = ();</span></span><br><span class="line"><span class="addition">+     type Message = Msg;</span></span><br><span class="line">      type Properties = ();</span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn create(_: Self::Properties, _link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line"><span class="addition">+     fn create(_: Self::Properties, link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line"><span class="addition">+         let cart_products = vec![];</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-         Self &#123;&#125;</span></span><br><span class="line"><span class="addition">+         Self &#123;</span></span><br><span class="line"><span class="addition">+             state: State &#123; cart_products &#125;,</span></span><br><span class="line"><span class="addition">+             link,</span></span><br><span class="line"><span class="addition">+         &#125;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn update(&amp;mut self, _msg: Self::Message) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+     fn update(&amp;mut self, message: Self::Message) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+         match message &#123;</span></span><br><span class="line"><span class="addition">+             Msg::AddToCart(product) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 let cart_product = self</span></span><br><span class="line"><span class="addition">+                     .state</span></span><br><span class="line"><span class="addition">+                     .cart_products</span></span><br><span class="line"><span class="addition">+                     .iter_mut()</span></span><br><span class="line"><span class="addition">+                     .find(|cp: &amp;&amp;mut CartProduct| cp.product.id == product.id);</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+                 if let Some(cp) = cart_product &#123;</span></span><br><span class="line"><span class="addition">+                     cp.quantity += 1;</span></span><br><span class="line"><span class="addition">+                 &#125; else &#123;</span></span><br><span class="line"><span class="addition">+                     self.state.cart_products.push(CartProduct &#123;</span></span><br><span class="line"><span class="addition">+                         product: product.clone(),</span></span><br><span class="line"><span class="addition">+                         quantity: 1,</span></span><br><span class="line"><span class="addition">+                     &#125;)</span></span><br><span class="line"><span class="addition">+                 &#125;</span></span><br><span class="line"><span class="addition">+                 true</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+         &#125;</span></span><br><span class="line"><span class="deletion">-         true</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span><br><span class="line">          false</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line"><span class="addition">+         let handle_add_to_cart = self</span></span><br><span class="line"><span class="addition">+             .link</span></span><br><span class="line"><span class="addition">+             .callback(|product: Product| Msg::AddToCart(product));</span></span><br><span class="line"><span class="addition">+         let cart_products = self.state.cart_products.clone();</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-         let render = Router::render(|switch: Route| match switch &#123;</span></span><br><span class="line"><span class="deletion">-           Route::ProductDetail(id) =&gt; html! &#123;&lt;ProductDetail id=id/&gt;&#125;,</span></span><br><span class="line"><span class="deletion">-           Route::HomePage =&gt; html! &#123;&lt;Home/&gt;&#125;,</span></span><br><span class="line"><span class="addition">+         let render = Router::render(move |switch: Route| match switch &#123;</span></span><br><span class="line"><span class="addition">+             Route::ProductDetail(id) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 html! &#123;&lt;ProductDetail id=id on_add_to_cart=handle_add_to_cart.clone() /&gt;&#125;</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line"><span class="addition">+             Route::HomePage =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                 html! &#123;&lt;Home cart_products=cart_products.clone() on_add_to_cart=handle_add_to_cart.clone()/&gt;&#125;</span></span><br><span class="line"><span class="addition">+             &#125;</span></span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          html! &#123;</span><br><span class="line"><span class="addition">+             &lt;&gt;</span></span><br><span class="line"><span class="addition">+                 &lt;Navbar cart_products=self.state.cart_products.clone() /&gt;</span></span><br><span class="line">                  &lt;Router&lt;Route, ()&gt; render=render/&gt;</span><br><span class="line"><span class="addition">+             &lt;/&gt;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // src/pages/home.rs</span><br><span class="line">  // No changes</span><br><span class="line"></span><br><span class="line">  struct State &#123;</span><br><span class="line">      products: Vec&lt;Product&gt;,</span><br><span class="line"><span class="deletion">-     cart_products: Vec&lt;CartProduct&gt;,</span></span><br><span class="line">      get_products_error: Option&lt;Error&gt;,</span><br><span class="line">      get_products_loaded: bool,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="addition">+ #[derive(Properties, Clone)]</span></span><br><span class="line"><span class="addition">+ pub struct Props &#123;</span></span><br><span class="line"><span class="addition">+     pub cart_products: Vec&lt;CartProduct&gt;,</span></span><br><span class="line"><span class="addition">+     pub on_add_to_cart: Callback&lt;Product&gt;,</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br><span class="line">  pub struct Home &#123;</span><br><span class="line"><span class="addition">+     props: Props,</span></span><br><span class="line">      state: State,</span><br><span class="line">      link: ComponentLink&lt;Self&gt;,</span><br><span class="line">      task: Option&lt;FetchTask&gt;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pub enum Msg &#123;</span><br><span class="line"><span class="deletion">-     AddToCart(i32),</span></span><br><span class="line">      GetProducts,</span><br><span class="line">      GetProductsSuccess(Vec&lt;Product&gt;),</span><br><span class="line">      GetProductsError(Error),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  impl Component for Home &#123;</span><br><span class="line">      type Message = Msg;</span><br><span class="line"><span class="deletion">-     type Properties = ();</span></span><br><span class="line"><span class="addition">+     type Properties = Props;</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn create(_: Self::Properties, link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line"><span class="addition">+     fn create(props: Self::Properties, link: ComponentLink&lt;Self&gt;) -&gt; Self &#123;</span></span><br><span class="line">          let products = vec![];</span><br><span class="line"><span class="deletion">-         let cart_products = vec![];</span></span><br><span class="line"></span><br><span class="line">          link.send_message(Msg::GetProducts);</span><br><span class="line"></span><br><span class="line">          Self &#123;</span><br><span class="line">              props,</span><br><span class="line">              state: State &#123;</span><br><span class="line">                  products,</span><br><span class="line"><span class="deletion">-                 cart_products,</span></span><br><span class="line">                  get_products_error: None,</span><br><span class="line">                  get_products_loaded: false,</span><br><span class="line">              &#125;,</span><br><span class="line">              link,</span><br><span class="line">              task: None,</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn update(&amp;mut self, message: Self::Message) -&gt; ShouldRender &#123;</span><br><span class="line">          match message &#123;</span><br><span class="line">              Msg::GetProducts =&gt; &#123;</span><br><span class="line">                  self.state.get_products_loaded = false;</span><br><span class="line">                  let handler =</span><br><span class="line">                      self.link</span><br><span class="line">                          .callback(move |response: api::FetchResponse&lt;Vec&lt;Product&gt;&gt;| &#123;</span><br><span class="line">                              let (_, Json(data)) = response.into_parts();</span><br><span class="line">                              match data &#123;</span><br><span class="line">                                  Ok(products) =&gt; Msg::GetProductsSuccess(products),</span><br><span class="line">                                  Err(err) =&gt; Msg::GetProductsError(err),</span><br><span class="line">                              &#125;</span><br><span class="line">                          &#125;);</span><br><span class="line"></span><br><span class="line">                  self.task = Some(api::get_products(handler));</span><br><span class="line">                  true</span><br><span class="line">              &#125;</span><br><span class="line">              Msg::GetProductsSuccess(products) =&gt; &#123;</span><br><span class="line">                  self.state.products = products;</span><br><span class="line">                  self.state.get_products_loaded = true;</span><br><span class="line">                  true</span><br><span class="line">              &#125;</span><br><span class="line">              Msg::GetProductsError(error) =&gt; &#123;</span><br><span class="line">                  self.state.get_products_error = Some(error);</span><br><span class="line">                  self.state.get_products_loaded = true;</span><br><span class="line">                  true</span><br><span class="line">              &#125;</span><br><span class="line"><span class="deletion">-             Msg::AddToCart(product_id) =&gt; &#123;</span></span><br><span class="line"><span class="deletion">-                 let product = self</span></span><br><span class="line"><span class="deletion">-                     .state</span></span><br><span class="line"><span class="deletion">-                     .products</span></span><br><span class="line"><span class="deletion">-                     .iter()</span></span><br><span class="line"><span class="deletion">-                     .find(|p: &amp;&amp;Product| p.id == product_id)</span></span><br><span class="line"><span class="deletion">-                     .unwrap();</span></span><br><span class="line"><span class="deletion">-                 let cart_product = self</span></span><br><span class="line"><span class="deletion">-                     .state</span></span><br><span class="line"><span class="deletion">-                     .cart_products</span></span><br><span class="line"><span class="deletion">-                     .iter_mut()</span></span><br><span class="line"><span class="deletion">-                     .find(|cp: &amp;&amp;mut CartProduct| cp.product.id == product_id);</span></span><br><span class="line"><span class="deletion">-                 if let Some(cp) = cart_product &#123;</span></span><br><span class="line"><span class="deletion">-                     cp.quantity += 1;</span></span><br><span class="line"><span class="deletion">-                 &#125; else &#123;</span></span><br><span class="line"><span class="deletion">-                     self.state.cart_products.push(CartProduct &#123;</span></span><br><span class="line"><span class="deletion">-                         product: product.clone(),</span></span><br><span class="line"><span class="deletion">-                         quantity: 1,</span></span><br><span class="line"><span class="deletion">-                     &#125;)</span></span><br><span class="line"><span class="deletion">-                 &#125;</span></span><br><span class="line"><span class="deletion">-                 true</span></span><br><span class="line"><span class="deletion">-             &#125;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="deletion">-     fn change(&amp;mut self, _: Self::Properties) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+     fn change(&amp;mut self, props: Self::Properties) -&gt; ShouldRender &#123;</span></span><br><span class="line"><span class="addition">+         self.props = props;</span></span><br><span class="line">          true</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      fn view(&amp;self) -&gt; Html &#123;</span><br><span class="line">          let products: Vec&lt;Html&gt; = self</span><br><span class="line">              .state</span><br><span class="line">              .products</span><br><span class="line">              .iter()</span><br><span class="line">              .map(|product: &amp;Product| &#123;</span><br><span class="line"><span class="deletion">-                 let product_id = product.id;</span></span><br><span class="line">                  html! &#123;</span><br><span class="line"><span class="deletion">-                   &lt;ProductCard product=&#123;product&#125; on_add_to_cart=self.link.callback(move |_| Msg::AddToCart(product_id))/&gt;</span></span><br><span class="line"><span class="addition">+                   &lt;ProductCard product=&#123;product&#125; on_add_to_cart=self.props.on_add_to_cart.clone()/&gt;</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .collect();</span><br><span class="line"></span><br><span class="line"><span class="deletion">-        let cart_value = self</span></span><br><span class="line"><span class="deletion">-            .state</span></span><br><span class="line"><span class="deletion">-            .cart_products</span></span><br><span class="line"><span class="deletion">-            .iter()</span></span><br><span class="line"><span class="deletion">-            .fold(0.0, |acc, cp| acc + (cp.quantity as f64 * cp.product.price));</span></span><br><span class="line"></span><br><span class="line">          if !self.state.get_products_loaded &#123;</span><br><span class="line">              // No changes</span><br><span class="line">          &#125; else if let Some(_) = self.state.get_products_error &#123;</span><br><span class="line">              // No changes</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">              html! &#123;</span><br><span class="line"><span class="deletion">-               &lt;div&gt;</span></span><br><span class="line"><span class="deletion">-                 &lt;div class=&quot;navbar&quot;&gt;</span></span><br><span class="line"><span class="deletion">-                     &lt;div class=&quot;navbar_title&quot;&gt;&#123;&quot;RustMart&quot;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="deletion">-                     &lt;div class=&quot;navbar_cart_value&quot;&gt;&#123;format!(&quot;$&#123;:.2&#125;&quot;, cart_value)&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="deletion">-                 &lt;/div&gt;</span></span><br><span class="line">                  &lt;div class=&quot;product_card_list&quot;&gt;&#123;products&#125;&lt;/div&gt;</span><br><span class="line"><span class="deletion">-               &lt;/div&gt;</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Now we can finally add to cart from  <code>ProductDetail</code>  page and we can also see the navbar in all pages</p>
<p><img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-6.png" alt="img"><br>
<img data-src="http://www.sheshbabu.com/images/2020-rust-wasm-yew-single-page-application/image-4.png" alt="img"></p>
<p>We’ve successfully built a SPA fully in Rust!</p>
<p>I’ve hosted the demo <span class="exturl" data-url="aHR0cHM6Ly9ydXN0bWFydC15ZXcubmV0bGlmeS5hcHAv">here</span> and the code is in this <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NoZXNoYmFidS9ydXN0bWFydC15ZXctZXhhbXBsZQ==">GitHub repo</span>. If you have questions or suggestions, please contact me at sheshbabu [at] <span class="exturl" data-url="aHR0cDovL2dtYWlsLmNvbQ==">gmail.com</span>.</p>
<h2 id="conclusion"><a class="markdownIt-Anchor" href="#conclusion">#</a> Conclusion</h2>
<p>The Yew community has done a good job designing abstractions like  <code>html!</code> ,  <code>Component</code>  etc so someone like me who’s familiar with React can immediately start being productive. It definitely has some rough edges like FetchTask, lack of <a target="_blank" rel="noopener" href="https://redux.js.org/introduction/motivation"><em>predictable</em></a> state management and the documentation is sparse, but has potential to become a good alternative to React, Vue etc once these issues are fixed.</p>
<p>Thanks for reading! Feel free to follow me in <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9zaGVzaGJhYnU=">Twitter</span> for more posts like this 😃</p>
<p>Tagged under: <span class="exturl" data-url="aHR0cDovL3d3dy5zaGVzaGJhYnUuY29tL3RhZ3MvUnVzdC8=">Rust</span></p>
<p>Published on: 11 Aug 2020</p>

      <div class="tags">
          <a href="/tags/rust/" rel="tag"><i class="ic i-tag"></i> rust</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2021-03-10 21:18:12" itemprop="dateModified" datetime="2021-03-10T21:18:12+08:00">2021-03-10</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2020/09/04/english-question/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclga70tsj20zk0m84mr.jpg" title="英语疑问句：5 种句型构建指南">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>英语疑问句：5 种句型构建指南</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2020/09/07/rust-error/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipesrnqv3j20zk0m8ava.jpg" title="Beginner&#39;s guide to Error Handling in Rust">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Beginner's guide to Error Handling in Rust</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#single-page-applications-using-rust"><span class="toc-number">1.</span> <span class="toc-text"> Single Page Applications using Rust</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#setup"><span class="toc-number">1.1.</span> <span class="toc-text"> Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hello-world"><span class="toc-number">1.2.</span> <span class="toc-text"> Hello World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thinking-in-components"><span class="toc-number">1.3.</span> <span class="toc-text"> Thinking in Components</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#homepage"><span class="toc-number">1.4.</span> <span class="toc-text"> HomePage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fetching-data"><span class="toc-number">1.5.</span> <span class="toc-text"> Fetching Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#splitting-into-reusable-components"><span class="toc-number">1.6.</span> <span class="toc-text"> Splitting into reusable components</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#styling"><span class="toc-number">1.7.</span> <span class="toc-text"> Styling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#routing"><span class="toc-number">1.8.</span> <span class="toc-text"> Routing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#productdetailpage"><span class="toc-number">1.9.</span> <span class="toc-text"> ProductDetailPage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#state-management"><span class="toc-number">1.10.</span> <span class="toc-text"> State Management</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hoisting-state"><span class="toc-number">1.11.</span> <span class="toc-text"> Hoisting State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#conclusion"><span class="toc-number">1.12.</span> <span class="toc-text"> Conclusion</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">232</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">26</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;twitter.com&#x2F;yourname"><i class="ic i-twitter"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yourname"><i class="ic i-zhihu"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPXlvdXJpZA==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;yourid"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20veW91cm5hbWU=" title="https:&#x2F;&#x2F;weibo.com&#x2F;yourname"><i class="ic i-weibo"></i></span>
      <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS95b3VybmFtZQ==" title="https:&#x2F;&#x2F;about.me&#x2F;yourname"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a>
  </li>

    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>links</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2020/09/04/english-question/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2020/09/07/rust-error/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2021</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ Dew's World</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2020/09/07/rust-wasm-application/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
