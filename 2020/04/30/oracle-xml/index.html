



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CFira%20Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db,xml" />


<link rel="canonical" href="https://lhchen74.github.io/2020/04/30/oracle-xml/">



  <title>
Oracle XML |
D E W = 露の世</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle XML
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2020-04-30 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2020-04-30T00:00:00+08:00">2020-04-30</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">D E W</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/anime/index/轻音少女.jpg"></li>
          <li class="item" data-background-image="/anime/index/樱花庄的宠物女孩.jpg"></li>
          <li class="item" data-background-image="/anime/index/龙猫-3.jpg"></li>
          <li class="item" data-background-image="/anime/index/多罗罗.jpg"></li>
          <li class="item" data-background-image="/anime/index/地狱少女.jpg"></li>
          <li class="item" data-background-image="/anime/index/可塑性记忆-1.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2020/04/30/oracle-xml/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="从关系数据库生成-xml"><a class="markdownIt-Anchor" href="#从关系数据库生成-xml">#</a> 从关系数据库生成 XML</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create the tables</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customers (</span><br><span class="line">  customer_id <span class="type">INTEGER</span> <span class="keyword">CONSTRAINT</span> customers_pk <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  first_name VARCHAR2(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  last_name VARCHAR2(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  dob <span class="type">DATE</span>,</span><br><span class="line">  phone VARCHAR2(<span class="number">12</span>),</span><br><span class="line">  type number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- insert sample data into customers table</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">  customer_id, first_name, last_name, dob, phone, type</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;Brown&#x27;</span>, <span class="string">&#x27;01-JAN-1965&#x27;</span>, <span class="string">&#x27;800-555-1211&#x27;</span>, <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">  customer_id, first_name, last_name, dob, phone, type</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, <span class="string">&#x27;Cynthia&#x27;</span>, <span class="string">&#x27;Green&#x27;</span>, <span class="string">&#x27;05-FEB-1968&#x27;</span>, <span class="string">&#x27;800-555-1212&#x27;</span>, <span class="number">0</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">  customer_id, first_name, last_name, dob, phone, type</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">3</span>, <span class="string">&#x27;Steve&#x27;</span>, <span class="string">&#x27;White&#x27;</span>, <span class="string">&#x27;16-MAR-1971&#x27;</span>, <span class="string">&#x27;800-555-1213&#x27;</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">  customer_id, first_name, last_name, dob, phone, type</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">4</span>, <span class="string">&#x27;Gail&#x27;</span>, <span class="string">&#x27;Black&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;800-555-1214&#x27;</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers (</span><br><span class="line">  customer_id, first_name, last_name, dob, phone, type</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">5</span>, <span class="string">&#x27;Doreen&#x27;</span>, <span class="string">&#x27;Blue&#x27;</span>, <span class="string">&#x27;20-MAY-1970&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- commit the transaction</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>CUSTOMER_ID</th>
<th>FIRST_NAME</th>
<th>LAST_NAME</th>
<th>DOB</th>
<th>PHONE</th>
<th>TYPE</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>John</td>
<td>Brown</td>
<td>1/1/1965</td>
<td>800-555-1211</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>Cynthia</td>
<td>Green</td>
<td>2/5/1968</td>
<td>800-555-1212</td>
<td>0</td>
</tr>
<tr>
<td>3</td>
<td>Steve</td>
<td>White</td>
<td>3/16/1971</td>
<td>800-555-1213</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>Gail</td>
<td>Black</td>
<td></td>
<td>800-555-1214</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>Doreen</td>
<td>Blue</td>
<td>5/20/1970</td>
<td></td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="xmlelement"><a class="markdownIt-Anchor" href="#xmlelement">#</a> XMLELEMENT</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer&quot;,</span><br><span class="line">    XMLELEMENT(&quot;customer_id&quot;, customer_id),</span><br><span class="line">    XMLELEMENT(&quot;name&quot;, first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name)</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer&gt;&lt;customer_id&gt;1&lt;/customer_id&gt;&lt;name&gt;John Brown&lt;/name&gt;&lt;/customer&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer&gt;&lt;customer_id&gt;2&lt;/customer_id&gt;&lt;name&gt;Cynthia Green&lt;/name&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlattributes"><a class="markdownIt-Anchor" href="#xmlattributes">#</a> XMLATTRIBUTES</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer&quot;,</span><br><span class="line">    XMLATTRIBUTES(</span><br><span class="line">      customer_id <span class="keyword">AS</span> &quot;id&quot;,</span><br><span class="line">      first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name <span class="keyword">AS</span> &quot;name&quot;,</span><br><span class="line">      TO_CHAR(dob, <span class="string">&#x27;MM/DD/YYYY&#x27;</span>) <span class="keyword">AS</span> &quot;dob&quot;</span><br><span class="line">    )</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer id=&quot;1&quot; name=&quot;John Brown&quot; dob=&quot;01/01/1965&quot;&gt;&lt;/customer&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer id=&quot;2&quot; name=&quot;Cynthia Green&quot; dob=&quot;02/05/1968&quot;&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlforest"><a class="markdownIt-Anchor" href="#xmlforest">#</a> XMLFOREST</h3>
<p><code>XMLFOREST</code>  不会包含值为空的 Tag.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer&quot;,</span><br><span class="line">    XMLFOREST(</span><br><span class="line">      customer_id <span class="keyword">AS</span> &quot;id&quot;,</span><br><span class="line">      first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name <span class="keyword">AS</span> &quot;name&quot;,</span><br><span class="line">      TO_CHAR(dob, <span class="string">&#x27;MM/DD/YYYY&#x27;</span>) <span class="keyword">AS</span> &quot;dob&quot;,</span><br><span class="line">      <span class="string">&#x27;&#x27;</span> <span class="keyword">AS</span> <span class="string">&#x27;empty&#x27;</span></span><br><span class="line">    )</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer&gt;&lt;id&gt;1&lt;/id&gt;&lt;name&gt;John Brown&lt;/name&gt;&lt;dob&gt;01/01/1965&lt;/dob&gt;&lt;/customer&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer&gt;&lt;id&gt;2&lt;/id&gt;&lt;name&gt;Cynthia Green&lt;/name&gt;&lt;dob&gt;02/05/1968&lt;/dob&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlagg"><a class="markdownIt-Anchor" href="#xmlagg">#</a> XMLAGG</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer_in_group&quot;,</span><br><span class="line">    XMLATTRIBUTES(type <span class="keyword">as</span> &quot;type&quot;),</span><br><span class="line">    XMLAGG(</span><br><span class="line">      XMLELEMENT(&quot;name&quot;, first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name)</span><br><span class="line">    )</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> type;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer_in_group type=&quot;0&quot;&gt;&lt;name&gt;John Brown&lt;/name&gt;&lt;name&gt;Cynthia Green&lt;/name&gt;&lt;/customer_in_group&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer_in_group type=&quot;1&quot;&gt;&lt;name&gt;Steve White&lt;/name&gt;&lt;name&gt;Doreen Blue&lt;/name&gt;&lt;name&gt;Gail Black&lt;/name&gt;&lt;/customer_in_group&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlcolattval"><a class="markdownIt-Anchor" href="#xmlcolattval">#</a> XMLCOLATTVAL</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer&quot;,</span><br><span class="line">    XMLCOLATTVAL(</span><br><span class="line">      customer_id <span class="keyword">AS</span> &quot;id&quot;,</span><br><span class="line">      dob <span class="keyword">as</span> &quot;dob&quot;</span><br><span class="line">    )</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer&gt;&lt;column name = &quot;id&quot;&gt;1&lt;/column&gt;&lt;column name = &quot;dob&quot;&gt;1965-01-01&lt;/column&gt;&lt;/customer&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer&gt;&lt;column name = &quot;id&quot;&gt;2&lt;/column&gt;&lt;column name = &quot;dob&quot;&gt;1968-02-05&lt;/column&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlconcat"><a class="markdownIt-Anchor" href="#xmlconcat">#</a> XMLCONCAT</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLCONCAT(</span><br><span class="line">    XMLELEMENT(&quot;name&quot;, first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name),</span><br><span class="line">    XMLELEMENT(&quot;phone&quot;, phone)</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;name&gt;John Brown&lt;/name&gt;&lt;phone&gt;800-555-1211&lt;/phone&gt;</code></td>
</tr>
<tr>
<td><code>&lt;name&gt;Cynthia Green&lt;/name&gt;&lt;phone&gt;800-555-1212&lt;/phone&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlparse"><a class="markdownIt-Anchor" href="#xmlparse">#</a> XMLPARSE</h3>
<p>表达式前面</p>
<ul>
<li>CONTENT 意味着表达式必须解析为有效的 XML 值。</li>
<li>DOCUMENT 意味着表达式必须解析为带有唯一根元素的 XML 文档。</li>
</ul>
<p>表达式后面</p>
<ul>
<li>WELLFORMED 意味着保证表达式解析为具有良好格式的 XML 文档。如果可以保证我们的字符串总是解析为格式良好的 XML 文档，那么我们可以使用  <code>WELLFORMED</code>  关键字来避免数据库执行多余的有效性检查。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLPARSE(</span><br><span class="line">    CONTENT</span><br><span class="line">    <span class="string">&#x27;&lt;customer&gt;&lt;customer_id&gt;1&lt;/customer_id&gt;&lt;name&gt;John Brown&lt;/name&gt;&lt;/customer&gt;&#x27;</span></span><br><span class="line">    WELLFORMED</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customer</span><br><span class="line"> <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMER</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer&gt;&lt;customer_id&gt;1&lt;/customer_id&gt;&lt;name&gt;John Brown&lt;/name&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlpi"><a class="markdownIt-Anchor" href="#xmlpi">#</a> XMLPI</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLPI(</span><br><span class="line">  NAME &quot;xml-stylesheet&quot;,</span><br><span class="line">  <span class="string">&#x27;type=&quot;text/css&quot; href=&quot;example.css&quot;&#x27;</span></span><br><span class="line">).GETSTRINGVAL() <span class="keyword">AS</span> xml_sheet_pi</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_SHEET_PI</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;?xml-stylesheet type=&quot;text/css&quot; href=&quot;example.css&quot;?&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlcomment"><a class="markdownIt-Anchor" href="#xmlcomment">#</a> XMLCOMMENT</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLCOMMENT(</span><br><span class="line">  <span class="string">&#x27;An example XML comment&#x27;</span></span><br><span class="line">).GETSTRINGVAL() <span class="keyword">AS</span> xml_comment</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_COMMENT</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;!--An example XML comment--&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlcdata"><a class="markdownIt-Anchor" href="#xmlcdata">#</a> XMLCDATA</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLELEMENT(</span><br><span class="line">    &quot;customer&quot;,</span><br><span class="line">    XMLELEMENT(&quot;customer_id&quot;, customer_id),</span><br><span class="line">    XMLELEMENT(&quot;name&quot;, XMLCDATA(first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name))</span><br><span class="line">  ).GETSTRINGVAL() <span class="keyword">AS</span> xml_customers</span><br><span class="line">  <span class="keyword">FROM</span> customers</span><br><span class="line"> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_CUSTOMERS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;customer&gt;&lt;customer_id&gt;1&lt;/customer_id&gt;&lt;name&gt;&lt;![CDATA[John Brown]]&gt;&lt;/name&gt;&lt;/customer&gt;</code></td>
</tr>
<tr>
<td><code>&lt;customer&gt;&lt;customer_id&gt;2&lt;/customer_id&gt;&lt;name&gt;&lt;![CDATA[Cynthia Green]]&gt;&lt;/name&gt;&lt;/customer&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlsequence"><a class="markdownIt-Anchor" href="#xmlsequence">#</a> XMLSEQUENCE</h3>
<p>XMLSEQUENCE () 函数可以生成 XMLSequenceType 对象，XMLSequenceType 对象是 XMLType 对象的变长数组。因为 XMLSEQUENCE () 函数后返回一个变长数组，所以可以在查询的 FROM 子句中使用该函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">VALUE</span>(list_of_values).GETSTRINGVAL() order_values</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(</span><br><span class="line">    XMLSEQUENCE(</span><br><span class="line">      <span class="built_in">EXTRACT</span>(</span><br><span class="line">        XMLType(<span class="string">&#x27;&lt;A&gt;&lt;B&gt;PLACED&lt;/B&gt;&lt;B&gt;PENDING&lt;/B&gt;&lt;B&gt;SHIPPED&lt;/B&gt;&lt;/A&gt;&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;/A/B&#x27;</span></span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  ) list_of_values;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>ORDER_VALUES</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;B&gt;PLACED&lt;/B&gt;</code></td>
</tr>
<tr>
<td><code>&lt;B&gt;PENDING&lt;/B&gt;</code></td>
</tr>
<tr>
<td><code>&lt;B&gt;SHIPPED&lt;/B&gt;</code></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> xml_tab <span class="keyword">OF</span> XMLTYPE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xmltype XMLTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> sys_xmlagg(</span><br><span class="line">           xmlelement(</span><br><span class="line">             &quot;EMP&quot;,</span><br><span class="line">             xmlforest(e.empno, e.ename, e.job, e.mgr, e.hiredate, e.sal, e.comm)</span><br><span class="line">           )</span><br><span class="line">         )</span><br><span class="line">  <span class="keyword">INTO</span>   l_xmltype</span><br><span class="line">  <span class="keyword">FROM</span>   scott.emp e;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> xml_tab <span class="keyword">VALUES</span> (l_xmltype);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//EMPNO/text()&#x27;</span>).getNumberVal() <span class="keyword">AS</span> empno,</span><br><span class="line">       <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//ENAME/text()&#x27;</span>).getStringVal() <span class="keyword">AS</span> ename,</span><br><span class="line">       <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//JOB/text()&#x27;</span>).getStringVal() <span class="keyword">AS</span> job,</span><br><span class="line">       <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//MGR/text()&#x27;</span>).getNumberVal() <span class="keyword">AS</span> mgr,</span><br><span class="line">       <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//HIREDATE/text()&#x27;</span>).getStringVal() <span class="keyword">AS</span> hiredate,</span><br><span class="line">       <span class="built_in">extract</span>(<span class="keyword">value</span>(d), <span class="string">&#x27;//SAL/text()&#x27;</span>).getNumberVal() <span class="keyword">AS</span> sal</span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">       <span class="keyword">table</span>(xmlsequence(<span class="built_in">extract</span>(<span class="keyword">value</span>(x), <span class="string">&#x27;/ROWSET/EMP&#x27;</span>))) d;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>EMPNO</th>
<th>ENAME</th>
<th>JOB</th>
<th>MGR</th>
<th>HIREDATE</th>
<th>SAL</th>
</tr>
</thead>
<tbody>
<tr>
<td>7369</td>
<td>SMITH</td>
<td>CLERK</td>
<td>7902</td>
<td>1980-12-17</td>
<td>800</td>
</tr>
<tr>
<td>7499</td>
<td>ALLEN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-20</td>
<td>1600</td>
</tr>
<tr>
<td>7521</td>
<td>WARD</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-02-22</td>
<td>1250</td>
</tr>
<tr>
<td>7566</td>
<td>JONES</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-04-02</td>
<td>2975</td>
</tr>
<tr>
<td>7654</td>
<td>MARTIN</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-28</td>
<td>1250</td>
</tr>
<tr>
<td>7698</td>
<td>BLAKE</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-05-01</td>
<td>2850</td>
</tr>
<tr>
<td>7782</td>
<td>CLARK</td>
<td>MANAGER</td>
<td>7839</td>
<td>1981-06-09</td>
<td>2450</td>
</tr>
<tr>
<td>7788</td>
<td>SCOTT</td>
<td>ANALYST</td>
<td>7566</td>
<td>1982-12-09</td>
<td>3000</td>
</tr>
<tr>
<td>7839</td>
<td>KING</td>
<td>PRESIDENT</td>
<td></td>
<td>1981-11-17</td>
<td>5000</td>
</tr>
<tr>
<td>7844</td>
<td>TURNER</td>
<td>SALESMAN</td>
<td>7698</td>
<td>1981-09-08</td>
<td>1500</td>
</tr>
<tr>
<td>7876</td>
<td>ADAMS</td>
<td>CLERK</td>
<td>7788</td>
<td>1983-01-12</td>
<td>1100</td>
</tr>
<tr>
<td>7900</td>
<td>JAMES</td>
<td>CLERK</td>
<td>7698</td>
<td>1981-12-03</td>
<td>950</td>
</tr>
<tr>
<td>7902</td>
<td>FORD</td>
<td>ANALYST</td>
<td>7566</td>
<td>1981-12-03</td>
<td>3000</td>
</tr>
<tr>
<td>7934</td>
<td>MILLER</td>
<td>CLERK</td>
<td>7782</td>
<td>1982-01-23</td>
<td>1300</td>
</tr>
</tbody>
</table>
<h3 id="xmlserialize"><a class="markdownIt-Anchor" href="#xmlserialize">#</a> XMLSERIALIZE</h3>
<p>将表达式的求值结果表示为字符串或 LOB (大对象) 类型 XML 数据。</p>
<ul>
<li>CONTENT 意味着表达式必须解析为有效的 XML 值。</li>
<li>DOCUMENT 意味着表达式必须解析为带有唯一根元素的 XML 文档。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLSERIALIZE(</span><br><span class="line">    CONTENT XMLType(<span class="string">&#x27;&lt;order_status&gt;SHIPPED&lt;/order_status&gt;&#x27;</span>)</span><br><span class="line">) <span class="keyword">AS</span> xml_order_status</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_ORDER_STATUS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;CLOB&gt;</code></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLSERIALIZE(</span><br><span class="line">    CONTENT XMLType(<span class="string">&#x27;&lt;order_status&gt;SHIPPED&lt;/order_status&gt;&#x27;</span>) <span class="keyword">AS</span> <span class="type">BLOB</span></span><br><span class="line">) <span class="keyword">AS</span> xml_order_status</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_ORDER_STATUS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;BLOB&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="xmlquery"><a class="markdownIt-Anchor" href="#xmlquery">#</a> XMLQUERY</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLQUERY(</span><br><span class="line">    <span class="string">&#x27;(1, 2 + 5, &quot;D&quot;, 100 to 102, &lt;A&gt;text&lt;/A&gt;)&#x27;</span></span><br><span class="line">    RETURNING CONTENT</span><br><span class="line">) <span class="keyword">AS</span> xml_output</span><br><span class="line"><span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_OUTPUT</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 7 D 100 101 102<A>text</A></td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> create_xml_resources <span class="keyword">AS</span></span><br><span class="line">  v_result <span class="type">BOOLEAN</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- create string containing XML for products</span></span><br><span class="line">  v_products VARCHAR2(<span class="number">300</span>):<span class="operator">=</span></span><br><span class="line">    <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">    <span class="string">&#x27;&lt;products&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">      <span class="string">&#x27;&lt;product product_id=&quot;1&quot; product_type_id=&quot;1&quot; name=&quot;Modern Science&quot; price=&quot;19.95&quot;/&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">      <span class="string">&#x27;&lt;product product_id=&quot;2&quot; product_type_id=&quot;1&quot; name=&quot;Chemistry&quot; price=&quot;30&quot;/&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">      <span class="string">&#x27;&lt;product product_id=&quot;3&quot; product_type_id=&quot;2&quot; name=&quot;Supernova&quot; price=&quot;25.99&quot;/&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">    <span class="string">&#x27;&lt;/products&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- create string containing XML for product types</span></span><br><span class="line">  v_product_types VARCHAR2(<span class="number">300</span>):<span class="operator">=</span></span><br><span class="line">    <span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">    <span class="string">&#x27;&lt;product_types&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">      <span class="string">&#x27;&lt;product_type product_type_id=&quot;1&quot; name=&quot;Book&quot;/&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">      <span class="string">&#x27;&lt;product_type product_type_id=&quot;2&quot; name=&quot;Video&quot;/&gt;&#x27;</span> <span class="operator">||</span></span><br><span class="line">    <span class="string">&#x27;&lt;/product_types&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- create resource for products</span></span><br><span class="line">  v_result :<span class="operator">=</span> DBMS_XDB.CREATERESOURCE(<span class="string">&#x27;/public/products.xml&#x27;</span>, v_products);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- create resource for product types</span></span><br><span class="line">  v_result :<span class="operator">=</span> DBMS_XDB.CREATERESOURCE(<span class="string">&#x27;/public/product_types.xml&#x27;</span>, v_product_types);</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span> create_xml_resources;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> create_xml_resources();</span><br></pre></td></tr></table></figure>
<p>XMLQUERY 从  <code>/public/products.xml</code>  资源中检索产品。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLQUERY(</span><br><span class="line">  <span class="string">&#x27;for $product in doc(&quot;/public/products.xml&quot;)/products/product</span></span><br><span class="line"><span class="string">   return &lt;product name=&quot;&#123;$product/@name&#125;&quot;/&gt;&#x27;</span></span><br><span class="line">   RETURNING CONTENT</span><br><span class="line">).GETSTRINGVAL() <span class="keyword">AS</span> xml_products</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_PRODUCTS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;product name=&quot;Modern Science&quot;&gt;&lt;/product&gt;&lt;product name=&quot;Chemistry&quot;&gt;&lt;/product&gt;&lt;product name=&quot;Supernova&quot;&gt;&lt;/product&gt;</code></td>
</tr>
</tbody>
</table>
<p>XMLQUERY 从  <code>/public/products.xml</code>  和  <code>/public/product_types.xml</code>  资源中检索价格大于 20 的产品以及它们的产品类型。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLQUERY(</span><br><span class="line">  <span class="string">&#x27;for $product in doc(&quot;/public/products.xml&quot;)/products/product</span></span><br><span class="line"><span class="string">   let $product_type := doc(&quot;/public/product_types.xml&quot;)//product_type[@product_type_id = $product/@product_type_id]/@name</span></span><br><span class="line"><span class="string">   where $product/@price &gt; 20</span></span><br><span class="line"><span class="string">   order by $product/@product_id</span></span><br><span class="line"><span class="string">   return &lt;product name=&quot;&#123;$product/@name&#125;&quot; product_type=&quot;&#123;$product_type&#125;&quot;/&gt;&#x27;</span></span><br><span class="line">   RETURNING CONTENT</span><br><span class="line">).GETSTRINGVAL() <span class="keyword">AS</span> xml_query_results</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_QUERY_RESULTS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;product name=&quot;Chemistry&quot; product_type=&quot;Book&quot;&gt;&lt;/product&gt;&lt;product name=&quot;Supernova&quot; product_type=&quot;Video&quot;&gt;&lt;/product&gt;</code></td>
</tr>
</tbody>
</table>
<p>XMLQUERY 从  <code>/public/products.xml</code>  和  <code>/public/product_types.xml</code>  资源中检索产品类型，每种产品类型的产品数量和每种产品类型中产品的平均价格。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> XMLQUERY(</span><br><span class="line">  <span class="string">&#x27;for $product_type in doc(&quot;/public/product_types.xml&quot;)/product_types/product_type</span></span><br><span class="line"><span class="string">   let $product := doc(&quot;/public/products.xml&quot;)//product[@product_type_id = $product_type/@product_type_id]</span></span><br><span class="line"><span class="string">   return</span></span><br><span class="line"><span class="string">     &lt;product</span></span><br><span class="line"><span class="string">       name=&quot;&#123;$product_type/@name&#125;&quot;</span></span><br><span class="line"><span class="string">       num_products=&quot;&#123;count($product)&#125;&quot;</span></span><br><span class="line"><span class="string">       average_price=&quot;&#123;xs:integer(avg($product/@price))&#125;&quot;</span></span><br><span class="line"><span class="string">       /&gt;&#x27;</span></span><br><span class="line">   RETURNING CONTENT</span><br><span class="line">).GETSTRINGVAL() <span class="keyword">AS</span> xml_query_results</span><br><span class="line"><span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>XML_QUERY_RESULTS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;product name=&quot;Book&quot; num_products=&quot;2&quot; average_price=&quot;24&quot;&gt;&lt;/product&gt;&lt;product name=&quot;Video&quot; num_products=&quot;1&quot; average_price=&quot;25&quot;&gt;&lt;/product&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="pivot-xml"><a class="markdownIt-Anchor" href="#pivot-xml">#</a> PIVOT XML</h3>
<p>Adding the  <code>XML</code>  keyword to the  <code>PIVOT</code>  operator allows us to convert the generated pivot results to XML format. It also makes the  <code>PIVOT</code>  a little more flexible, allowing us to replace the hard coded IN clause with a subquery, or the ANY wildcard.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> pivot_test (</span><br><span class="line">  id            number,</span><br><span class="line">  customer_id   number,</span><br><span class="line">  product_code  varchar2(<span class="number">5</span>),</span><br><span class="line">  quantity      number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="string">&#x27;B&#x27;</span>, <span class="number">20</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">3</span>, <span class="number">1</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">30</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">4</span>, <span class="number">2</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">40</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">5</span>, <span class="number">2</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">50</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">6</span>, <span class="number">3</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">60</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">7</span>, <span class="number">3</span>, <span class="string">&#x27;B&#x27;</span>, <span class="number">70</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">8</span>, <span class="number">3</span>, <span class="string">&#x27;C&#x27;</span>, <span class="number">80</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">9</span>, <span class="number">3</span>, <span class="string">&#x27;D&#x27;</span>, <span class="number">90</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> pivot_test <span class="keyword">values</span> (<span class="number">10</span>, <span class="number">4</span>, <span class="string">&#x27;A&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">   <span class="keyword">from</span> (<span class="keyword">select</span> product_code, quantity</span><br><span class="line">           <span class="keyword">from</span> pivot_test)</span><br><span class="line">pivot xml (<span class="built_in">sum</span>(quantity) <span class="keyword">as</span> sum_quantity <span class="keyword">for</span> (product_code) <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">distinct</span> product_code </span><br><span class="line">                                                                  <span class="keyword">from</span> pivot_test</span><br><span class="line">                                                                 <span class="keyword">where</span> id <span class="operator">&lt;</span> <span class="number">10</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PivotSet</span>&gt;</span><span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>210<span class="tag">&lt;/<span class="name">column</span>&gt;</span>&lt;/</span><br><span class="line">item&gt;<span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>90<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span>&lt;</span><br><span class="line">item&gt;<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>C<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>160<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>D<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>90<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">PivotSet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> (<span class="keyword">select</span> product_code, quantity</span><br><span class="line">          <span class="keyword">from</span> pivot_test)</span><br><span class="line">pivot xml (<span class="built_in">sum</span>(quantity) <span class="keyword">as</span> sum_quantity <span class="keyword">for</span> (product_code) <span class="keyword">in</span> (<span class="keyword">any</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PivotSet</span>&gt;</span><span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>A<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>210<span class="tag">&lt;/<span class="name">column</span>&gt;</span>&lt;/</span><br><span class="line">item&gt;<span class="tag">&lt;<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>B<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>90<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span>&lt;</span><br><span class="line">item&gt;<span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>C<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>160<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span><span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;PRODUCT_CODE&quot;</span>&gt;</span>D<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;<span class="name">column</span> <span class="attr">name</span> = <span class="string">&quot;SUM_QUANTITY&quot;</span>&gt;</span>90<span class="tag">&lt;/<span class="name">column</span>&gt;</span><span class="tag">&lt;/<span class="name">item</span>&gt;</span><span class="tag">&lt;/<span class="name">PivotSet</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="将-xml-文件保存到数据库中"><a class="markdownIt-Anchor" href="#将-xml-文件保存到数据库中">#</a> 将 XML 文件保存到数据库中</h2>
<p><strong>示例 XML 文件</strong></p>
<p>purchase_order.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">purchase_order</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">customer_order_id</span>&gt;</span>176<span class="tag">&lt;/<span class="name">customer_order_id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">order_date</span>&gt;</span>2007-05-17<span class="tag">&lt;/<span class="name">order_date</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">customer_name</span>&gt;</span>Best Products 456 Inc.<span class="tag">&lt;/<span class="name">customer_name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">street</span>&gt;</span>10 Any Street<span class="tag">&lt;/<span class="name">street</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">city</span>&gt;</span>Any City<span class="tag">&lt;/<span class="name">city</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">state</span>&gt;</span>CA<span class="tag">&lt;/<span class="name">state</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">zip</span>&gt;</span>94440<span class="tag">&lt;/<span class="name">zip</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">phone_number</span>&gt;</span>555-121-1234<span class="tag">&lt;/<span class="name">phone_number</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">products</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">product_id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">product_id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Supernova video<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">quantity</span>&gt;</span>5<span class="tag">&lt;/<span class="name">quantity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">product_id</span>&gt;</span>2<span class="tag">&lt;/<span class="name">product_id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>Oracle SQL book<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">quantity</span>&gt;</span>4<span class="tag">&lt;/<span class="name">quantity</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">products</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">purchase_order</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>创建示例 XML 模式</strong></p>
<ul>
<li>对象类型 t_product 用来表示产品。</li>
<li>嵌套表类型 t_nested_table_product，用来表示产品的嵌套表。</li>
<li>表 purchase_order，用来保存购货单。</li>
</ul>
<p>purchase_order 中的 xml_purchase_order 类型是 XMLType，允许存储 XML 数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create the types</span></span><br><span class="line"><span class="keyword">CREATE</span> TYPE t_product <span class="keyword">AS</span> OBJECT (</span><br><span class="line">  product_id <span class="type">INTEGER</span>,</span><br><span class="line">  name VARCHAR2(<span class="number">15</span>),</span><br><span class="line">  quantity <span class="type">INTEGER</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TYPE t_nested_table_product <span class="keyword">AS</span> <span class="keyword">TABLE</span> <span class="keyword">OF</span> t_product;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create the table</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> purchase_order (</span><br><span class="line">  purchase_order_id <span class="type">INTEGER</span> <span class="keyword">CONSTRAINT</span> purchase_order_pk <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  customer_order_id <span class="type">INTEGER</span>,</span><br><span class="line">  order_date <span class="type">DATE</span>,</span><br><span class="line">  customer_name VARCHAR2(<span class="number">25</span>),</span><br><span class="line">  street VARCHAR2(<span class="number">15</span>),</span><br><span class="line">  city VARCHAR2(<span class="number">15</span>),</span><br><span class="line">  state VARCHAR2(<span class="number">2</span>),</span><br><span class="line">  zip VARCHAR2(<span class="number">5</span>),</span><br><span class="line">  phone_number VARCHAR2(<span class="number">12</span>),</span><br><span class="line">  products t_nested_table_product,</span><br><span class="line">  xml_purchase_order XMLType</span><br><span class="line">)</span><br><span class="line">NESTED <span class="keyword">TABLE</span> products</span><br><span class="line">STORE <span class="keyword">AS</span> nested_products;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create the directory (you may need to modify this line)</span></span><br><span class="line"><span class="comment">-- then copy purchase_order.xml to the directory and grant permission `chmod &#x27;/usr/tmp/edi/purchase_order.xml&#x27; 777`</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE DIRECTORY XML_FILES_DIR <span class="keyword">AS</span> <span class="string">&#x27;/usr/tmp/edi&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> ALL_DIRECTORIES <span class="keyword">WHERE</span> DIRECTORY_NAME <span class="operator">=</span> <span class="string">&#x27;XML_FILES_DIR&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- add a row to the table</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> purchase_order (</span><br><span class="line">  purchase_order_id,</span><br><span class="line">  xml_purchase_order</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>,</span><br><span class="line">  XMLType(</span><br><span class="line">    BFILENAME(<span class="string">&#x27;XML_FILES_DIR&#x27;</span>, <span class="string">&#x27;purchase_order.xml&#x27;</span>),  <span class="comment">-- 指向外部文件的指针</span></span><br><span class="line">    NLS_CHARSET_ID(<span class="string">&#x27;AL32UTF8&#x27;</span>) <span class="comment">-- 标准 UTF-8 编码</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> purchase_order;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PURCHASE_ORDER_ID</th>
<th>CUSTOMER_ORDER_ID</th>
<th>ORDER_DATE</th>
<th>CUSTOMER_NAME</th>
<th>STREET</th>
<th>CITY</th>
<th>STATE</th>
<th>ZIP</th>
<th>PHONE_NUMBER</th>
<th>PRODUCTS</th>
<th>XML_PURCHASE_ORDER</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><code>&lt;Collection&gt;</code></td>
<td><code>&lt;XMLTYPE&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="extract"><a class="markdownIt-Anchor" href="#extract">#</a> EXTRACT</h3>
<p>EXTRACT () 函数的返回值是 XMLType 对象。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/customer_order_id&#x27;</span>) cust_order_id,</span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/order_date&#x27;</span>) order_date,</span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/customer_name&#x27;</span>) cust_name,</span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/phone_number&#x27;</span>) phone_number</span><br><span class="line">  <span class="keyword">FROM</span> purchase_order</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>CUST_ORDER_ID</th>
<th>ORDER_DATE</th>
<th>CUST_NAME</th>
<th>PHONE_NUMBER</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;XMLTYPE&gt;</code></td>
<td><code>&lt;XMLTYPE&gt;</code></td>
<td><code>&lt;XMLTYPE&gt;</code></td>
<td><code>&lt;XMLTYPE&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="extractvalue"><a class="markdownIt-Anchor" href="#extractvalue">#</a> EXTRACTVALUE</h3>
<p>EXTRACTVALUE () 函数的返回值是字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/customer_order_id&#x27;</span>) cust_order_id,</span><br><span class="line">    EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/order_date&#x27;</span>) order_date,</span><br><span class="line">    EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/customer_name&#x27;</span>) cust_name,</span><br><span class="line">    EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/phone_number&#x27;</span>) phone_number</span><br><span class="line">  <span class="keyword">FROM</span> purchase_order</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>CUST_ORDER_ID</th>
<th>ORDER_DATE</th>
<th>CUST_NAME</th>
<th>PHONE_NUMBER</th>
</tr>
</thead>
<tbody>
<tr>
<td>176</td>
<td>2007-05-17</td>
<td>Best Products 456 Inc.</td>
<td>555-121-1234</td>
</tr>
</tbody>
</table>
<p>检索所有商品。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order//products&#x27;</span>).GETSTRINGVAL() xml_products</span><br><span class="line">  <span class="keyword">FROM</span> purchase_order</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>xml_products</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">products</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">product</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product_id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">product_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Supernova video<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quantity</span>&gt;</span>5<span class="tag">&lt;/<span class="name">quantity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">product</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">product_id</span>&gt;</span>2<span class="tag">&lt;/<span class="name">product_id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Oracle SQL book<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">quantity</span>&gt;</span>4<span class="tag">&lt;/<span class="name">quantity</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">product</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">products</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>检索产品 #2.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/products/product[2]&#x27;</span>).GETSTRINGVAL() xml_product</span><br><span class="line">  <span class="keyword">FROM</span> purchase_order</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>检索 “Supernova video” 产品。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">   <span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order/products/product[name=&quot;Supernova video&quot;]&#x27;</span>).GETSTRINGVAL() xml_product</span><br><span class="line"> <span class="keyword">FROM</span> purchase_order</span><br><span class="line"><span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>使用 EXISTSNODE () 函数检查 XML 元素是否存在，如果元素存在 EXISTSNODE () 函数返回 1，否则返回 0。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">SELECT</span> <span class="string">&#x27;EXISTS&#x27;</span></span><br><span class="line">  <span class="keyword">FROM</span> purchase_order</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">   <span class="keyword">AND</span> EXISTSNODE(</span><br><span class="line">     xml_purchase_order,</span><br><span class="line">     <span class="string">&#x27;/purchase_order/products/product[product_id=1]&#x27;</span>) <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--EXISTS</span></span><br></pre></td></tr></table></figure>
<p>XMLSEQUENCE 将产品检索为 XMLType 对象的变长数组</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product.column_value<span class="comment">--.GETSTRINGVAL()</span></span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">       XMLSEQUENCE(<span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order//product&#x27;</span>))</span><br><span class="line">      <span class="keyword">FROM</span> purchase_order</span><br><span class="line">     <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>) product;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PRODUCT.COLUMN_VALUE</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;XMLTYPE&gt;</code></td>
</tr>
<tr>
<td><code>&lt;XMLTYPE&gt;</code></td>
</tr>
</tbody>
</table>
<p>使用 EXTRACTVALUE () 函数将产品的 product_id, name 和 quantity 检索为字符串。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    EXTRACTVALUE(product.column_value, <span class="string">&#x27;/product/product_id&#x27;</span>) <span class="keyword">AS</span> product_id,</span><br><span class="line">    EXTRACTVALUE(product.column_value, <span class="string">&#x27;/product/name&#x27;</span>) <span class="keyword">AS</span> name,</span><br><span class="line">    EXTRACTVALUE(product.column_value, <span class="string">&#x27;/product/quantity&#x27;</span>) <span class="keyword">AS</span> quantity</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">       XMLSEQUENCE(<span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order//product&#x27;</span>))</span><br><span class="line">      <span class="keyword">FROM</span> purchase_order</span><br><span class="line">     <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> <span class="number">1</span>) product;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PRODUCT_ID</th>
<th>NAME</th>
<th>QUANTITY</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Supernova video</td>
<td>5</td>
</tr>
<tr>
<td>2</td>
<td>Oracle SQL book</td>
<td>4</td>
</tr>
</tbody>
</table>
<p><strong>更新示例 XML 模式中的信息</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> update_purchase_order(</span><br><span class="line">  p_purchase_order_id <span class="keyword">IN</span> purchase_order.purchase_order_id<span class="operator">%</span>TYPE</span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_count <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- declare a nested table to store products</span></span><br><span class="line">  v_nested_table_products t_nested_table_product :<span class="operator">=</span></span><br><span class="line">    t_nested_table_product();</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- declare a type to represent a product record</span></span><br><span class="line">  TYPE t_product_record <span class="keyword">IS</span> RECORD (</span><br><span class="line">    product_id <span class="type">INTEGER</span>,</span><br><span class="line">    name VARCHAR2(<span class="number">15</span>),</span><br><span class="line">    quantity <span class="type">INTEGER</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- declare a REF CURSOR type to point to product records</span></span><br><span class="line">  TYPE t_product_cursor <span class="keyword">IS</span> <span class="keyword">REF</span> <span class="keyword">CURSOR</span> <span class="keyword">RETURN</span> t_product_record;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- declare a cursor</span></span><br><span class="line">  v_product_cursor t_product_cursor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- declare a variable to store a product record</span></span><br><span class="line">  v_product t_product_record;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- open v_product_cursor to read the product_id, name, and quantity for</span></span><br><span class="line">  <span class="comment">-- each product stored in the XML of the xml_purchase_order column</span></span><br><span class="line">  <span class="comment">-- in the purchase_order table</span></span><br><span class="line">  <span class="keyword">OPEN</span> v_product_cursor <span class="keyword">FOR</span></span><br><span class="line">  <span class="keyword">SELECT</span></span><br><span class="line">    EXTRACTVALUE(product.COLUMN_VALUE, <span class="string">&#x27;/product/product_id&#x27;</span>)</span><br><span class="line">      <span class="keyword">AS</span> product_id,</span><br><span class="line">    EXTRACTVALUE(product.COLUMN_VALUE, <span class="string">&#x27;/product/name&#x27;</span>) <span class="keyword">AS</span> name,</span><br><span class="line">    EXTRACTVALUE(product.COLUMN_VALUE, <span class="string">&#x27;/product/quantity&#x27;</span>) <span class="keyword">AS</span> quantity</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">TABLE</span>(</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">      XMLSEQUENCE(<span class="built_in">EXTRACT</span>(xml_purchase_order, <span class="string">&#x27;/purchase_order//product&#x27;</span>))</span><br><span class="line">    <span class="keyword">FROM</span> purchase_order</span><br><span class="line">    <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> p_purchase_order_id</span><br><span class="line">  ) product;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- loop over the contents of v_product_cursor</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="comment">-- fetch the product records from v_product_cursor and exit when there</span></span><br><span class="line">    <span class="comment">-- are no more records found</span></span><br><span class="line">    <span class="keyword">FETCH</span> v_product_cursor <span class="keyword">INTO</span> v_product;</span><br><span class="line">    EXIT <span class="keyword">WHEN</span> v_product_cursor<span class="operator">%</span>NOTFOUND;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- extend v_nested_table_products so that a product can be stored in it</span></span><br><span class="line">    v_nested_table_products.EXTEND;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- create a new product and store it in v_nested_table_products</span></span><br><span class="line">    v_nested_table_products(v_count) :<span class="operator">=</span></span><br><span class="line">      t_product(v_product.product_id, v_product.name, v_product.quantity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- display the new product stored in v_nested_table_products</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;product_id = &#x27;</span> <span class="operator">||</span></span><br><span class="line">      v_nested_table_products(v_count).product_id);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;name = &#x27;</span> <span class="operator">||</span></span><br><span class="line">      v_nested_table_products(v_count).name);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;quantity = &#x27;</span> <span class="operator">||</span></span><br><span class="line">      v_nested_table_products(v_count).quantity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- increment v_count ready for the next iteration of the loop</span></span><br><span class="line">    v_count :<span class="operator">=</span> v_count <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- close v_product_cursor</span></span><br><span class="line">  <span class="keyword">CLOSE</span> v_product_cursor;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- update the purchase_order table using the values extracted from the</span></span><br><span class="line">  <span class="comment">-- XML stored in the xml_purchase_order column (the products nested</span></span><br><span class="line">  <span class="comment">-- table is set to v_nested_table_products already populated by the</span></span><br><span class="line">  <span class="comment">-- previous loop)</span></span><br><span class="line">  UPDATE purchase_order</span><br><span class="line">  <span class="keyword">SET</span></span><br><span class="line">    customer_order_id <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order,</span><br><span class="line">        <span class="string">&#x27;/purchase_order/customer_order_id&#x27;</span>),</span><br><span class="line">    order_date <span class="operator">=</span></span><br><span class="line">      TO_DATE(EXTRACTVALUE(xml_purchase_order,</span><br><span class="line">        <span class="string">&#x27;/purchase_order/order_date&#x27;</span>), <span class="string">&#x27;YYYY-MM-DD&#x27;</span>),</span><br><span class="line">    customer_name <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/customer_name&#x27;</span>),</span><br><span class="line">    street <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/street&#x27;</span>),</span><br><span class="line">    city <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/city&#x27;</span>),</span><br><span class="line">    state <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/state&#x27;</span>),</span><br><span class="line">    zip <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/zip&#x27;</span>),</span><br><span class="line">    phone_number <span class="operator">=</span></span><br><span class="line">      EXTRACTVALUE(xml_purchase_order, <span class="string">&#x27;/purchase_order/phone_number&#x27;</span>),</span><br><span class="line">    products <span class="operator">=</span> v_nested_table_products</span><br><span class="line">  <span class="keyword">WHERE</span> purchase_order_id <span class="operator">=</span> p_purchase_order_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- commit the transaction</span></span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span> update_purchase_order;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> update_purchase_order();</span><br></pre></td></tr></table></figure>
<h2 id="practice-example"><a class="markdownIt-Anchor" href="#practice-example">#</a> Practice Example</h2>
<h3 id="generate-html-table-from-db-table"><a class="markdownIt-Anchor" href="#generate-html-table-from-db-table">#</a> Generate HTML Table from DB Table</h3>
<ol>
<li>多个 XMLELEMENT 可以使用 XMLFOREST 简化，但是 XMLFOREST 不会包含值为空的 Tag, 这里 po_release_number 可能为空，所以不使用 XMLFOREST。</li>
<li>一个 PO_NUMBER 可以包含多条记录，但是只需要一个 Table  Header, 所以资料需要根据 PO 进行聚合，XMLAGG 可以连接聚合的多个记录。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> yeh.po_number,</span><br><span class="line">       XMLELEMENT(&quot;table&quot;,</span><br><span class="line">         XMLCONCAT(</span><br><span class="line">           XMLELEMENT(&quot;tr&quot;, </span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;EDI Type&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;PO Number&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;PO Release Number&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;PO Date&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;Ship to Code&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;Ship to Name&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;Sold to Code&#x27;</span>),</span><br><span class="line">             XMLELEMENT(&quot;th&quot;, <span class="string">&#x27;Sold to Name&#x27;</span>)</span><br><span class="line">           ),</span><br><span class="line">           XMLAGG( </span><br><span class="line">             XMLELEMENT(&quot;tr&quot;, </span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yeh.edi_type),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yeh.po_number),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yeh.po_release_number),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yeh.po_date),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yea_ship.code),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yea_ship.name),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yea_sold.code),</span><br><span class="line">               XMLELEMENT(&quot;td&quot;, yea_sold.name)</span><br><span class="line">             )</span><br><span class="line">           )</span><br><span class="line">         )</span><br><span class="line">       ).getStringVal() <span class="keyword">as</span> table_str</span><br><span class="line">  <span class="keyword">from</span> ysc_edi_inbound_header  yeh,</span><br><span class="line">       ysc_edi_inbound_address  yea_ship,</span><br><span class="line">       ysc_edi_inbound_address  yea_sold</span><br><span class="line"> <span class="keyword">where</span> yeh.header_id <span class="operator">=</span> yea_ship.header_id</span><br><span class="line">   <span class="keyword">and</span> yeh.header_id <span class="operator">=</span> yea_sold.header_id</span><br><span class="line">   <span class="keyword">and</span> yea_ship.identifier_code <span class="operator">=</span> <span class="string">&#x27;ST&#x27;</span></span><br><span class="line">   <span class="keyword">and</span> yea_sold.identifier_code <span class="operator">=</span> <span class="string">&#x27;BY&#x27;</span></span><br><span class="line">   <span class="keyword">and</span> yeh.header_id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"> <span class="keyword">group</span> <span class="keyword">by</span> yeh.po_number;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>PO_NUMBER</th>
<th>TABLE_STR</th>
</tr>
</thead>
<tbody>
<tr>
<td>2211100025</td>
<td><code>&lt;table&gt;&lt;tr&gt;&lt;th&gt;EDI Type&lt;/th&gt;&lt;th&gt;PO Number&lt;/th&gt;&lt;th&gt;PO Release Number&lt;/th&gt;&lt;th&gt;PO Date&lt;/th&gt;&lt;th&gt;Ship to Code&lt;/th&gt;&lt;th&gt;Ship to Name&lt;/th&gt;&lt;th&gt;Sold to Code&lt;/th&gt;&lt;th&gt;Sold to Name&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;855&lt;/td&gt;&lt;td&gt;2211100025&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;20211130&lt;/td&gt;&lt;td&gt;147&lt;/td&gt;&lt;td&gt;XXX TECHNOLOGIES&lt;/td&gt;&lt;td&gt;84&lt;/td&gt;&lt;td&gt;XXX TECHNOLOGIES&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</code></td>
</tr>
</tbody>
</table>
<h2 id="xml-namespace"><a class="markdownIt-Anchor" href="#xml-namespace">#</a> XML namespace</h2>
<p>使用 XMLTable 解析 XML 如果 XML 包含 namespace, 会解析不到数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> item.<span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> som_edi_customer_source ses,</span><br><span class="line">       xmltable(</span><br><span class="line">         <span class="string">&#x27;/Pip3A4PurchaseOrderRequest/PurchaseOrder/ProductLineItem&#x27;</span></span><br><span class="line">          passing xmltype(ses.memo)  <span class="comment">--memo type is clob, if memo is xmltype can direct use passing ses.memo</span></span><br><span class="line">          columns</span><br><span class="line">            cust_name varchar2(<span class="number">1000</span>) path <span class="string">&#x27;CustomerInformation/businessName&#x27;</span>,</span><br><span class="line">            cust_po_number varchar2(<span class="number">1000</span>) path <span class="string">&#x27;PartnerBusiness/BusinessIdentifier&#x27;</span></span><br><span class="line">       ) item</span><br><span class="line"><span class="keyword">where</span> ses.seq_id <span class="operator">=</span> p_seq_id;</span><br></pre></td></tr></table></figure>
<p>解决方法 1：添加 xmlnamespace</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> item.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> som_edi_customer_source ses,</span><br><span class="line">     xmltable(</span><br><span class="line">        <span class="comment">--xmlnamespaces(&#x27;http://schemas.microsoft.com/xxx.dtd&#x27; as &quot;ns&quot;),</span></span><br><span class="line">        xmlnamespaces(<span class="keyword">default</span> <span class="string">&#x27;http://schemas.microsoft.com/xxx.dtd&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;/Pip3A4PurchaseOrderRequest/PurchaseOrder/ProductLineItem&#x27;</span></span><br><span class="line">        passing xmltype(ses.memo)</span><br><span class="line">        columns</span><br><span class="line">          cust_name varchar2(<span class="number">1000</span>) path<span class="string">&#x27;CustomerInformation/businessName&#x27;</span>,</span><br><span class="line">          cust_po_number varchar2(<span class="number">1000</span>) path <span class="string">&#x27;PartnerBusiness/BusinessIdentifier&#x27;</span></span><br><span class="line">      ) item</span><br><span class="line"><span class="keyword">where</span> ses.seq_id <span class="operator">=</span> p_seq_id;</span><br></pre></td></tr></table></figure>
<p>解决方法 2: 解析前先移除 namespace</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> remove_namespace(p_xml_clob <span class="type">clob</span>) <span class="keyword">return</span> <span class="type">clob</span> <span class="keyword">is</span></span><br><span class="line">  l_return <span class="type">clob</span>;</span><br><span class="line">  l_taiwan_namespace varchar2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;xmlns=&quot;http://schemas.microsoft.com/xxx.dtd&quot;&#x27;</span>;</span><br><span class="line">  l_china_namespace  varchar2(<span class="number">100</span>) :<span class="operator">=</span> <span class="string">&#x27;xmlns=&quot;http://schemas.microsoft.com/yyy.dtd&quot;&#x27;</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">select</span> replace(replace(p_xml_clob, l_china_namespace, <span class="keyword">null</span>),</span><br><span class="line">                   l_taiwan_namespace,</span><br><span class="line">                   <span class="keyword">null</span>)</span><br><span class="line">      <span class="keyword">into</span> l_return</span><br><span class="line">      <span class="keyword">from</span> dual;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">return</span> l_return;</span><br><span class="line"><span class="keyword">end</span> remove_namespace;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">select</span> item.<span class="operator">*</span></span><br><span class="line">  <span class="keyword">from</span> (<span class="keyword">select</span> seq_id, remove_namespace(memo) <span class="keyword">as</span> memo </span><br><span class="line">          <span class="keyword">from</span> som_edi_customer_source) ses,</span><br><span class="line">       xmltable(</span><br><span class="line">         <span class="string">&#x27;/Pip3A4PurchaseOrderRequest/PurchaseOrder/ProductLineItem&#x27;</span></span><br><span class="line">         passing xmltype(ses.memo)</span><br><span class="line">         columns</span><br><span class="line">           cust_name varchar2(<span class="number">1000</span>) path<span class="string">&#x27;CustomerInformation/businessName&#x27;</span>,</span><br><span class="line">           cust_po_number varchar2(<span class="number">1000</span>) path <span class="string">&#x27;PartnerBusiness/BusinessIdentifier&#x27;</span></span><br><span class="line">       ) item</span><br><span class="line"><span class="keyword">where</span> ses.seq_id <span class="operator">=</span> p_seq_id;</span><br></pre></td></tr></table></figure>
<p>为生成的 XML 添加 default namespace。</p>
<p><code>xmlattributes('microsoft.com' as &quot;xmlns:prx&quot;)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> (</span><br><span class="line">    xmlelement(&quot;Pip3A4PurchaseOrderConfirmation&quot;,</span><br><span class="line">      <span class="comment">--add default namespace</span></span><br><span class="line">      xmlattributes(<span class="string">&#x27;microsoft.com&#x27;</span> <span class="keyword">as</span> &quot;xmlns:prx&quot;),</span><br><span class="line">      xmlelement(&quot;PurchaseOrder&quot;,</span><br><span class="line">        ( <span class="comment">-- line loop</span></span><br><span class="line">          <span class="keyword">select</span> (</span><br><span class="line">            xmlelement(&quot;ProductLineItem&quot;,</span><br><span class="line">              xmlelement(&quot;buyerLineItem&quot;,</span><br><span class="line">                xmlelement(&quot;LineNumber&quot;, sel.line_number)</span><br><span class="line">              )</span><br><span class="line">              xmlelement(&quot;OrderQuantity&quot;,</span><br><span class="line">                xmlelement(&quot;requestedQuantity&quot;,</span><br><span class="line">                  xmlelement(&quot;ProductQuantity&quot;, order_line.ordered_quantity)</span><br><span class="line">                )</span><br><span class="line">              )</span><br><span class="line">            )</span><br><span class="line">          )</span><br><span class="line">           <span class="keyword">from</span> oe_order_lines_all order_line,</span><br><span class="line">                som_edi_customer_3a4_line sel</span><br><span class="line">          <span class="keyword">where</span> order_line.header_id <span class="operator">=</span> order_header.header_id</span><br><span class="line">            <span class="keyword">and</span> order_line.customer_line_number <span class="operator">=</span> sel.po_line_number</span><br><span class="line">            <span class="keyword">and</span> sel.header_id <span class="operator">=</span> seh.header_id</span><br><span class="line">        ) <span class="keyword">as</span> &quot;line&quot;</span><br><span class="line">      ),</span><br><span class="line">      xmlelement(&quot;requestingDocumentDateTime&quot;,</span><br><span class="line">        xmlelement(&quot;DateTimeStamp&quot;, som_edi_customer_pkg.get_customer_format_date(sysdate))</span><br><span class="line">      )</span><br><span class="line">    )</span><br><span class="line">  ).getClobVal() <span class="keyword">as</span> &quot;header&quot; <span class="keyword">into</span> l_clob_xml</span><br><span class="line"><span class="keyword">from</span> oe_order_headers_all         order_header,</span><br><span class="line">     som_edi_customer_3a4_header  seh</span><br><span class="line"><span class="keyword">where</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> order_header.cust_po_number <span class="operator">=</span> seh.po_number</span><br><span class="line">  <span class="keyword">and</span> seh.po_number <span class="operator">=</span> p_customer_po;</span><br></pre></td></tr></table></figure>
<p>输出的 XML root element 如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Pip3A4PurchaseOrderConfirmation</span> <span class="attr">xmlns:prx</span>=<span class="string">&quot;microsoft.com&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Pip3A4PurchaseOrderConfirmation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="cx_oracle-working-with-xmltype"><a class="markdownIt-Anchor" href="#cx_oracle-working-with-xmltype">#</a> cx_Oracle working with XMLTYPE</h2>
<blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9jeC1vcmFjbGUucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L3VzZXJfZ3VpZGUveG1sX2RhdGFfdHlwZS5odG1s">Working with XMLTYPE — cx_Oracle 8.3.0-dev documentation</span></p>
</blockquote>
<p>Oracle XMLType columns are fetched as strings by default. This is currently limited to the maximum length of a  <code>VARCHAR2</code>  column. To return longer XML values, they must be queried as LOB values instead.</p>
<p>The examples below demonstrate using XMLType data with cx_Oracle. The following table will be used in these examples:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> xml_table (</span><br><span class="line">    id NUMBER,</span><br><span class="line">    xml_data SYS.XMLTYPE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Inserting into the table can be done by simply binding a string as shown:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xml_data = <span class="string">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="string">        &lt;customer&gt;</span></span><br><span class="line"><span class="string">            &lt;name&gt;John Smith&lt;/name&gt;</span></span><br><span class="line"><span class="string">            &lt;Age&gt;43&lt;/Age&gt;</span></span><br><span class="line"><span class="string">            &lt;Designation&gt;Professor&lt;/Designation&gt;</span></span><br><span class="line"><span class="string">            &lt;Subject&gt;Mathematics&lt;/Subject&gt;</span></span><br><span class="line"><span class="string">        &lt;/customer&gt;&quot;&quot;&quot;</span></span><br><span class="line">cursor.execute(<span class="string">&quot;insert into xml_table values (:id, :xml)&quot;</span>,</span><br><span class="line">               <span class="built_in">id</span>=<span class="number">1</span>, xml=xml_data)</span><br></pre></td></tr></table></figure>
<p>This approach works with XML strings up to 1 GB in size. For longer strings, a temporary CLOB must be created using <a target="_blank" rel="noopener" href="https://cx-oracle.readthedocs.io/en/latest/api_manual/connection.html#Connection.createlob"> <code>Connection.createlob()</code> </a> and bound as shown:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">clob = connection.createlob(cx_Oracle.DB_TYPE_CLOB)</span><br><span class="line">clob.write(xml_data)</span><br><span class="line">cursor.execute(<span class="string">&quot;insert into xml_table values (:id, sys.xmltype(:xml))&quot;</span>,</span><br><span class="line">               <span class="built_in">id</span>=<span class="number">2</span>, xml=clob)</span><br></pre></td></tr></table></figure>
<p>Fetching XML data can be done simply for values that are shorter than the length of a VARCHAR2 column, as shown:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">&quot;select xml_data from xml_table where id = :id&quot;</span>, <span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">xml_data, = cursor.fetchone()</span><br><span class="line">print(xml_data)          <span class="comment"># will print the string that was originally stored</span></span><br></pre></td></tr></table></figure>
<p>For values that exceed the length of a VARCHAR2 column, a CLOB must be returned instead by using the function  <code>XMLTYPE.GETCLOBVAL()</code>  as shown:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cursor.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        select xmltype.getclobval(xml_data)</span></span><br><span class="line"><span class="string">        from xml_table</span></span><br><span class="line"><span class="string">        where id = :id&quot;&quot;&quot;</span>, <span class="built_in">id</span>=<span class="number">1</span>)</span><br><span class="line">clob, = cursor.fetchone()</span><br><span class="line">print(clob.read())</span><br></pre></td></tr></table></figure>
<p>The LOB that is returned can be streamed or a string can be returned instead of a CLOB. See <span class="exturl" data-url="aHR0cHM6Ly9jeC1vcmFjbGUucmVhZHRoZWRvY3MuaW8vZW4vbGF0ZXN0L3VzZXJfZ3VpZGUvbG9iX2RhdGEuaHRtbCNsb2JkYXRh">Using CLOB and BLOB Data</span> for more information about processing LOBs.</p>

      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
          <a href="/tags/xml/" rel="tag"><i class="ic i-tag"></i> xml</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-01-12 20:00:44" itemprop="dateModified" datetime="2024-01-12T20:00:44+08:00">2024-01-12</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2020/04/22/css-bfc/" itemprop="url" rel="prev" data-background-image="&#x2F;anime&#x2F;index&#x2F;银魂.jpg" title="CSS BFC">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>CSS BFC</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2020/04/30/oracle-update/" itemprop="url" rel="next" data-background-image="&#x2F;anime&#x2F;index&#x2F;比宇宙更遥远的地方.jpg" title="Update a table with data from another table">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Update a table with data from another table</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E7%94%9F%E6%88%90-xml"><span class="toc-number">1.</span> <span class="toc-text"> 从关系数据库生成 XML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlelement"><span class="toc-number">1.1.</span> <span class="toc-text"> XMLELEMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlattributes"><span class="toc-number">1.2.</span> <span class="toc-text"> XMLATTRIBUTES</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlforest"><span class="toc-number">1.3.</span> <span class="toc-text"> XMLFOREST</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlagg"><span class="toc-number">1.4.</span> <span class="toc-text"> XMLAGG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlcolattval"><span class="toc-number">1.5.</span> <span class="toc-text"> XMLCOLATTVAL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlconcat"><span class="toc-number">1.6.</span> <span class="toc-text"> XMLCONCAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlparse"><span class="toc-number">1.7.</span> <span class="toc-text"> XMLPARSE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlpi"><span class="toc-number">1.8.</span> <span class="toc-text"> XMLPI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlcomment"><span class="toc-number">1.9.</span> <span class="toc-text"> XMLCOMMENT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlcdata"><span class="toc-number">1.10.</span> <span class="toc-text"> XMLCDATA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlsequence"><span class="toc-number">1.11.</span> <span class="toc-text"> XMLSEQUENCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlserialize"><span class="toc-number">1.12.</span> <span class="toc-text"> XMLSERIALIZE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xmlquery"><span class="toc-number">1.13.</span> <span class="toc-text"> XMLQUERY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pivot-xml"><span class="toc-number">1.14.</span> <span class="toc-text"> PIVOT XML</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86-xml-%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD"><span class="toc-number">2.</span> <span class="toc-text"> 将 XML 文件保存到数据库中</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#extract"><span class="toc-number">2.1.</span> <span class="toc-text"> EXTRACT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extractvalue"><span class="toc-number">2.2.</span> <span class="toc-text"> EXTRACTVALUE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#practice-example"><span class="toc-number">3.</span> <span class="toc-text"> Practice Example</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#generate-html-table-from-db-table"><span class="toc-number">3.1.</span> <span class="toc-text"> Generate HTML Table from DB Table</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml-namespace"><span class="toc-number">4.</span> <span class="toc-text"> XML namespace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cx_oracle-working-with-xmltype"><span class="toc-number">5.</span> <span class="toc-text"> cx_Oracle working with XMLTYPE</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">363</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">51</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item codepen" data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL2xoY2hlbjc0" title="https:&#x2F;&#x2F;codepen.io&#x2F;lhchen74"><i class="ic i-address-card"></i></span>
      <span class="exturl item anki" data-url="aHR0cHM6Ly9hbmtpd2ViLm5ldC9kZWNrcy8=" title="https:&#x2F;&#x2F;ankiweb.net&#x2F;decks&#x2F;"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

    
  <li class="item">
    <a href="/anime/" rel="section"><i class="ic i-magic"></i>Anime</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2020/04/22/css-bfc/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2020/04/30/oracle-update/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ D E W</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2020/04/30/oracle-xml/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
