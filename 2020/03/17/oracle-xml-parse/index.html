



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CFira%20Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db" />


<link rel="canonical" href="https://lhchen74.github.io/2020/03/17/oracle-xml-parse/">



  <title>
Oracle Parse XML |
D E W = 露の世</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle Parse XML
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2020-03-17 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2020-03-17T00:00:00+08:00">2020-03-17</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">D E W</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/anime/index/来自深渊.jpg"></li>
          <li class="item" data-background-image="/anime/index/秦时明月-1.jpg"></li>
          <li class="item" data-background-image="/anime/index/工作细胞.jpg"></li>
          <li class="item" data-background-image="/anime/index/动物狂想曲-1.jpg"></li>
          <li class="item" data-background-image="/anime/index/埃罗芒阿老师.jpg"></li>
          <li class="item" data-background-image="/anime/index/路人女主的养成方法.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2020/03/17/oracle-xml-parse/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>转载: <span class="exturl" data-url="aHR0cHM6Ly9vcmFjbGUtYmFzZS5jb20vYXJ0aWNsZXMvbWlzYy94bWx0YWJsZS1jb252ZXJ0LXhtbC1kYXRhLWludG8tcm93cy1hbmQtY29sdW1ucy11c2luZy1zcWw=">ORACLE-BASE - XMLTABLE : Convert XML Data into Rows and Columns using SQL</span></p>
</blockquote>
<h2 id="tag-based-xml"><a class="markdownIt-Anchor" href="#tag-based-xml">#</a> Tag-Based XML</h2>
<p>This example uses tag-based XML, where each data element for an employee is surrounded by its own start and end tag.</p>
<p>First we create a table to hold our XML document and populate it with a document containing multiple rows of data. Using  <code>XMLFOREST</code>  gives us a separate tag for each column in the query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> xml_tab (</span><br><span class="line">  id        NUMBER,</span><br><span class="line">  xml_data  XMLTYPE</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xmltype XMLTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> XMLELEMENT(&quot;employees&quot;,</span><br><span class="line">           XMLAGG(</span><br><span class="line">             XMLELEMENT(&quot;employee&quot;,</span><br><span class="line">               XMLFOREST(</span><br><span class="line">                 e.empno <span class="keyword">AS</span> &quot;empno&quot;,</span><br><span class="line">                 e.ename <span class="keyword">AS</span> &quot;ename&quot;,</span><br><span class="line">                 e.job <span class="keyword">AS</span> &quot;job&quot;,</span><br><span class="line">                 TO_CHAR(e.hiredate, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>) <span class="keyword">AS</span> &quot;hiredate&quot;</span><br><span class="line">               )</span><br><span class="line">             )</span><br><span class="line">           )</span><br><span class="line">         )</span><br><span class="line">  <span class="keyword">INTO</span>   l_xmltype</span><br><span class="line">  <span class="keyword">FROM</span>   emp e;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> xml_tab <span class="keyword">VALUES</span> (<span class="number">1</span>, l_xmltype);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<p>We can see the resulting row containing the tag-based XML using the following query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> LONG <span class="number">5000</span></span><br><span class="line"><span class="keyword">SELECT</span> x.xml_data.getClobVal()</span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x;</span><br><span class="line"></span><br><span class="line">X.XML_DATA.GETCLOBVAL()</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="operator">&lt;</span>employees<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7369</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>SMITH<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>CLERK<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7499</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>ALLEN<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>SALESMAN<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">20</span><span class="operator">-</span>FEB<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7521</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>WARD<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>SALESMAN<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">22</span><span class="operator">-</span>FEB<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7566</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>JONES<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>MANAGER<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">02</span><span class="operator">-</span>APR<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7654</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>MARTIN<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>SALESMAN<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">28</span><span class="operator">-</span>SEP<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7698</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>BLAKE<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>MANAGER<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">01</span><span class="operator">-</span>MAY<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7782</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>CLARK<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>MANAGER<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">09</span><span class="operator">-</span>JUN<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7788</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>SCOTT<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>ANALYST<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">19</span><span class="operator">-</span>APR<span class="number">-1987</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7839</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>KING<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>PRESIDENT<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">17</span><span class="operator">-</span>NOV<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7844</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>TURNER<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>SALESMAN<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">08</span><span class="operator">-</span>SEP<span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7876</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>ADAMS<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>CLERK<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">23</span><span class="operator">-</span>MAY<span class="number">-1987</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7900</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>JAMES<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>CLERK<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7902</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>FORD<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>ANALYST<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>empno<span class="operator">&gt;</span><span class="number">7934</span><span class="operator">&lt;</span><span class="operator">/</span>empno<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>ename<span class="operator">&gt;</span>MILLER<span class="operator">&lt;</span><span class="operator">/</span>ename<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>job<span class="operator">&gt;</span>CLERK<span class="operator">&lt;</span><span class="operator">/</span>job<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>hiredate<span class="operator">&gt;</span><span class="number">23</span><span class="operator">-</span>JAN<span class="number">-1982</span><span class="operator">&lt;</span><span class="operator">/</span>hiredate<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>employees<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>The  <code>XMLTABLE</code>  operator allows us to split the XML data into rows and project columns on to it. We effectively make a cartesian product between the data table and the  <code>XMLTABLE</code>  call, which allows  <code>XMLTABLE</code>  to split a XML document in a single row into multiple rows in the final result set. The table column is identified as the source of the data using the  <code>PASSING</code>  clause. The rows are identified using a XQuery expression, in this case ‘/employees/employee’. Columns are projected onto the resulting XML fragments using the  <code>COLUMNS</code>  clause, which identifies the relevant tags using the  <code>PATH</code>  expression and assigns the desired column names and data types. Be careful with the names of the columns in the  <code>COLUMNS</code>  clause. If you use anything other than upper case, they will need to be quoted to make direct reference to them. Notice we are querying using the alias of the  <code>XMLTABLE</code>  call, rather than the regular table alias.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">       XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">         PASSING x.xml_data</span><br><span class="line">         COLUMNS</span><br><span class="line">           empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;empno&#x27;</span>,</span><br><span class="line">           ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;ename&#x27;</span>,</span><br><span class="line">           job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">           hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;hiredate&#x27;</span></span><br><span class="line">         ) xt;</span><br><span class="line"></span><br><span class="line">EMPN ENAME      JOB       HIREDATE</span><br><span class="line"><span class="comment">---- ---------- --------- -----------</span></span><br><span class="line"><span class="number">7369</span> SMITH      CLERK     <span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line"><span class="number">7499</span> ALLEN      SALESMAN  <span class="number">20</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"><span class="number">7521</span> WARD       SALESMAN  <span class="number">22</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"><span class="number">7566</span> JONES      MANAGER   <span class="number">02</span><span class="operator">-</span>APR<span class="number">-1981</span></span><br><span class="line"><span class="number">7654</span> MARTIN     SALESMAN  <span class="number">28</span><span class="operator">-</span>SEP<span class="number">-1981</span></span><br><span class="line"><span class="number">7698</span> BLAKE      MANAGER   <span class="number">01</span><span class="operator">-</span>MAY<span class="number">-1981</span></span><br><span class="line"><span class="number">7782</span> CLARK      MANAGER   <span class="number">09</span><span class="operator">-</span>JUN<span class="number">-1981</span></span><br><span class="line"><span class="number">7788</span> SCOTT      ANALYST   <span class="number">19</span><span class="operator">-</span>APR<span class="number">-1987</span></span><br><span class="line"><span class="number">7839</span> KING       PRESIDENT <span class="number">17</span><span class="operator">-</span>NOV<span class="number">-1981</span></span><br><span class="line"><span class="number">7844</span> TURNER     SALESMAN  <span class="number">08</span><span class="operator">-</span>SEP<span class="number">-1981</span></span><br><span class="line"><span class="number">7876</span> ADAMS      CLERK     <span class="number">23</span><span class="operator">-</span>MAY<span class="number">-1987</span></span><br><span class="line"><span class="number">7900</span> JAMES      CLERK     <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7902</span> FORD       ANALYST   <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7934</span> MILLER     CLERK     <span class="number">23</span><span class="operator">-</span>JAN<span class="number">-1982</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="attribute-based-xml"><a class="markdownIt-Anchor" href="#attribute-based-xml">#</a> Attribute-Based XML</h2>
<p>This example uses attribute-based XML, where each data element for an employee is defined as an attribute of the employee tag, not a separate tag.</p>
<p>Truncate the table we defined for the previous example and populate it with a document containing multiple rows of data. Using  <code>XMLATTRIBUTES</code>  creates an attribute for each column in the query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> xml_tab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xmltype XMLTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> XMLELEMENT(&quot;employees&quot;,</span><br><span class="line">           XMLAGG(</span><br><span class="line">             XMLELEMENT(&quot;employee&quot;,</span><br><span class="line">               XMLATTRIBUTES(</span><br><span class="line">                 e.empno <span class="keyword">AS</span> &quot;empno&quot;,</span><br><span class="line">                 e.ename <span class="keyword">AS</span> &quot;ename&quot;,</span><br><span class="line">                 e.job <span class="keyword">AS</span> &quot;job&quot;,</span><br><span class="line">                 TO_CHAR(e.hiredate, <span class="string">&#x27;DD-MON-YYYY&#x27;</span>) <span class="keyword">AS</span> &quot;hiredate&quot;</span><br><span class="line">               )</span><br><span class="line">             )</span><br><span class="line">           )</span><br><span class="line">         )</span><br><span class="line">  <span class="keyword">INTO</span>   l_xmltype</span><br><span class="line">  <span class="keyword">FROM</span>   emp e;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> xml_tab <span class="keyword">VALUES</span> (<span class="number">1</span>, l_xmltype);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<p>We can see the resulting row containing the attribute-based XML using the following query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> LONG <span class="number">5000</span></span><br><span class="line"><span class="keyword">SELECT</span> x.xml_data.getClobVal()</span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x;</span><br><span class="line"></span><br><span class="line">X.XML_DATA.GETCLOBVAL()</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="operator">&lt;</span>employees<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7369&quot; ename<span class="operator">=</span>&quot;SMITH&quot; job<span class="operator">=</span>&quot;CLERK&quot; hiredate<span class="operator">=</span>&quot;17-DEC-1980&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7499&quot; ename<span class="operator">=</span>&quot;ALLEN&quot; job<span class="operator">=</span>&quot;SALESMAN&quot; hiredate<span class="operator">=</span>&quot;20-FEB-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7521&quot; ename<span class="operator">=</span>&quot;WARD&quot; job<span class="operator">=</span>&quot;SALESMAN&quot; hiredate<span class="operator">=</span>&quot;22-FEB-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7566&quot; ename<span class="operator">=</span>&quot;JONES&quot; job<span class="operator">=</span>&quot;MANAGER&quot; hiredate<span class="operator">=</span>&quot;02-APR-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7654&quot; ename<span class="operator">=</span>&quot;MARTIN&quot; job<span class="operator">=</span>&quot;SALESMAN&quot; hiredate<span class="operator">=</span>&quot;28-SEP-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7698&quot; ename<span class="operator">=</span>&quot;BLAKE&quot; job<span class="operator">=</span>&quot;MANAGER&quot; hiredate<span class="operator">=</span>&quot;01-MAY-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7782&quot; ename<span class="operator">=</span>&quot;CLARK&quot; job<span class="operator">=</span>&quot;MANAGER&quot; hiredate<span class="operator">=</span>&quot;09-JUN-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7788&quot; ename<span class="operator">=</span>&quot;SCOTT&quot; job<span class="operator">=</span>&quot;ANALYST&quot; hiredate<span class="operator">=</span>&quot;19-APR-1987&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7839&quot; ename<span class="operator">=</span>&quot;KING&quot; job<span class="operator">=</span>&quot;PRESIDENT&quot; hiredate<span class="operator">=</span>&quot;17-NOV-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7844&quot; ename<span class="operator">=</span>&quot;TURNER&quot; job<span class="operator">=</span>&quot;SALESMAN&quot; hiredate<span class="operator">=</span>&quot;08-SEP-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7876&quot; ename<span class="operator">=</span>&quot;ADAMS&quot; job<span class="operator">=</span>&quot;CLERK&quot; hiredate<span class="operator">=</span>&quot;23-MAY-1987&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7900&quot; ename<span class="operator">=</span>&quot;JAMES&quot; job<span class="operator">=</span>&quot;CLERK&quot; hiredate<span class="operator">=</span>&quot;03-DEC-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7902&quot; ename<span class="operator">=</span>&quot;FORD&quot; job<span class="operator">=</span>&quot;ANALYST&quot; hiredate<span class="operator">=</span>&quot;03-DEC-1981&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>employee empno<span class="operator">=</span>&quot;7934&quot; ename<span class="operator">=</span>&quot;MILLER&quot; job<span class="operator">=</span>&quot;CLERK&quot; hiredate<span class="operator">=</span>&quot;23-JAN-1982&quot;<span class="operator">/</span><span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>employees<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>The  <code>XMLTABLE</code>  operator allows us to split the XML data into rows and project columns on to it. Notice this time the  <code>PATH</code>  expression uses a “@” to indicate this is an attribute, rather than a tag.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">       XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">         PASSING x.xml_data</span><br><span class="line">         COLUMNS</span><br><span class="line">           empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;@empno&#x27;</span>,</span><br><span class="line">           ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;@ename&#x27;</span>,</span><br><span class="line">           job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;@job&#x27;</span>,</span><br><span class="line">           hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;@hiredate&#x27;</span></span><br><span class="line">         ) xt;</span><br><span class="line"></span><br><span class="line">EMPN ENAME      JOB       HIREDATE</span><br><span class="line"><span class="comment">---- ---------- --------- -----------</span></span><br><span class="line"><span class="number">7369</span> SMITH      CLERK     <span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line"><span class="number">7499</span> ALLEN      SALESMAN  <span class="number">20</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"><span class="number">7521</span> WARD       SALESMAN  <span class="number">22</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"><span class="number">7566</span> JONES      MANAGER   <span class="number">02</span><span class="operator">-</span>APR<span class="number">-1981</span></span><br><span class="line"><span class="number">7654</span> MARTIN     SALESMAN  <span class="number">28</span><span class="operator">-</span>SEP<span class="number">-1981</span></span><br><span class="line"><span class="number">7698</span> BLAKE      MANAGER   <span class="number">01</span><span class="operator">-</span>MAY<span class="number">-1981</span></span><br><span class="line"><span class="number">7782</span> CLARK      MANAGER   <span class="number">09</span><span class="operator">-</span>JUN<span class="number">-1981</span></span><br><span class="line"><span class="number">7788</span> SCOTT      ANALYST   <span class="number">19</span><span class="operator">-</span>APR<span class="number">-1987</span></span><br><span class="line"><span class="number">7839</span> KING       PRESIDENT <span class="number">17</span><span class="operator">-</span>NOV<span class="number">-1981</span></span><br><span class="line"><span class="number">7844</span> TURNER     SALESMAN  <span class="number">08</span><span class="operator">-</span>SEP<span class="number">-1981</span></span><br><span class="line"><span class="number">7876</span> ADAMS      CLERK     <span class="number">23</span><span class="operator">-</span>MAY<span class="number">-1987</span></span><br><span class="line"><span class="number">7900</span> JAMES      CLERK     <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7902</span> FORD       ANALYST   <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7934</span> MILLER     CLERK     <span class="number">23</span><span class="operator">-</span>JAN<span class="number">-1982</span></span><br><span class="line"></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="nested-xml"><a class="markdownIt-Anchor" href="#nested-xml">#</a> Nested XML</h2>
<p>So far we have dealt with simple XML, but we sometimes have to deal with XML containing multiple levels of nesting. The simplest way to handle this to deal with the first layer, presenting the next layer down as an XML fragment in an  <code>XMLTYPE</code> , which can then be processed using  <code>XMLTABLE</code>  in the next step.</p>
<p>Truncate the test table and insert a row of nested XML. The example below produces a list of departments, with every department containing a nested list of employees for that department.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> xml_tab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xmltype XMLTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">SELECT</span> XMLELEMENT(&quot;departments&quot;,</span><br><span class="line">           XMLAGG(</span><br><span class="line">             XMLELEMENT(&quot;department&quot;,</span><br><span class="line">               XMLFOREST(</span><br><span class="line">                 d.deptno <span class="keyword">AS</span> &quot;department_number&quot;,</span><br><span class="line">                 d.dname <span class="keyword">AS</span> &quot;department_name&quot;,</span><br><span class="line">                 (<span class="keyword">SELECT</span> XMLAGG(</span><br><span class="line">                           XMLELEMENT(&quot;employee&quot;,</span><br><span class="line">                             XMLFOREST(</span><br><span class="line">                               e.empno <span class="keyword">AS</span> &quot;employee_number&quot;,</span><br><span class="line">                               e.ename <span class="keyword">AS</span> &quot;employee_name&quot;</span><br><span class="line">                             )</span><br><span class="line">                           )</span><br><span class="line">                         )</span><br><span class="line">                  <span class="keyword">FROM</span>   emp e</span><br><span class="line">                  <span class="keyword">WHERE</span>  e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line">                 ) &quot;employees&quot;</span><br><span class="line">               )</span><br><span class="line">             )</span><br><span class="line">           )</span><br><span class="line">         )</span><br><span class="line">  <span class="keyword">INTO</span>   l_xmltype</span><br><span class="line">  <span class="keyword">FROM</span>   dept d;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> xml_tab <span class="keyword">VALUES</span> (<span class="number">1</span>, l_xmltype);</span><br><span class="line">  <span class="keyword">COMMIT</span>;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<p>We can see the resulting row containing the nested XML using the following query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> LONG <span class="number">5000</span></span><br><span class="line"><span class="keyword">SELECT</span> x.xml_data.getClobVal()</span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x;</span><br><span class="line"></span><br><span class="line">X.XML_DATA.GETCLOBVAL()</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line"><span class="operator">&lt;</span>departments<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>department<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_number<span class="operator">&gt;</span><span class="number">10</span><span class="operator">&lt;</span><span class="operator">/</span>department_number<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_name<span class="operator">&gt;</span>ACCOUNTING<span class="operator">&lt;</span><span class="operator">/</span>department_name<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>employees<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7782</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>CLARK<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7839</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>KING<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7934</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>MILLER<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span><span class="operator">/</span>employees<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>department<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>department<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_number<span class="operator">&gt;</span><span class="number">20</span><span class="operator">&lt;</span><span class="operator">/</span>department_number<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_name<span class="operator">&gt;</span>RESEARCH<span class="operator">&lt;</span><span class="operator">/</span>department_name<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>employees<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7369</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>SMITH<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7566</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>JONES<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7788</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>SCOTT<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7876</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>ADAMS<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7902</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>FORD<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span><span class="operator">/</span>employees<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>department<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>department<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_number<span class="operator">&gt;</span><span class="number">30</span><span class="operator">&lt;</span><span class="operator">/</span>department_number<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_name<span class="operator">&gt;</span>SALES<span class="operator">&lt;</span><span class="operator">/</span>department_name<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>employees<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7499</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>ALLEN<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7521</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>WARD<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7654</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>MARTIN<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7698</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>BLAKE<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7844</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>TURNER<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span>employee<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_number<span class="operator">&gt;</span><span class="number">7900</span><span class="operator">&lt;</span><span class="operator">/</span>employee_number<span class="operator">&gt;</span></span><br><span class="line">        <span class="operator">&lt;</span>employee_name<span class="operator">&gt;</span>JAMES<span class="operator">&lt;</span><span class="operator">/</span>employee_name<span class="operator">&gt;</span></span><br><span class="line">      <span class="operator">&lt;</span><span class="operator">/</span>employee<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span><span class="operator">/</span>employees<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>department<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span>department<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_number<span class="operator">&gt;</span><span class="number">40</span><span class="operator">&lt;</span><span class="operator">/</span>department_number<span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">&lt;</span>department_name<span class="operator">&gt;</span>OPERATIONS<span class="operator">&lt;</span><span class="operator">/</span>department_name<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">/</span>department<span class="operator">&gt;</span></span><br><span class="line"><span class="operator">&lt;</span><span class="operator">/</span>departments<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>To make things simpler we’ve split out the layers using the  <code>WITH</code>  clause, but this could also be done with inline-views. The “departments_data” entry in the  <code>WITH</code>  clause extracts the basic department data, along with an XML fragment containing the employees for that department. The “employees_data” entry selects the department data from the “departments_data” entry, then extracts the employee information from the “employees”  <code>XMLTYPE</code>  using  <code>XMLTABLE</code>  in the normal way. Finally we select the flattened data from the “employees_data” entry.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span></span><br><span class="line">  departments_data <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">           XMLTABLE(<span class="string">&#x27;/departments/department&#x27;</span></span><br><span class="line">             PASSING x.xml_data</span><br><span class="line">             COLUMNS</span><br><span class="line">               deptno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;department_number&#x27;</span>,</span><br><span class="line">               dname      VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;department_name&#x27;</span>,</span><br><span class="line">               employees  XMLTYPE      PATH <span class="string">&#x27;employees&#x27;</span></span><br><span class="line">             ) xt</span><br><span class="line">  ),</span><br><span class="line">  employees_data <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> deptno,</span><br><span class="line">           dname,</span><br><span class="line">           xt2.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   departments_data dd,</span><br><span class="line">           XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">             PASSING dd.employees</span><br><span class="line">             COLUMNS</span><br><span class="line">               empno      VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;employee_number&#x27;</span>,</span><br><span class="line">               ename      VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;employee_name&#x27;</span></span><br><span class="line">             ) xt2</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees_data;</span><br><span class="line"></span><br><span class="line">DEPT DNAME      EMPN ENAME</span><br><span class="line"><span class="comment">---- ---------- ---- ----------</span></span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7782</span> CLARK</span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7839</span> KING</span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7934</span> MILLER</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7369</span> SMITH</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7566</span> JONES</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7788</span> SCOTT</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7876</span> ADAMS</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7902</span> FORD</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7499</span> ALLEN</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7521</span> WARD</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7654</span> MARTIN</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7698</span> BLAKE</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7844</span> TURNER</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7900</span> JAMES</span><br><span class="line"></span><br><span class="line"><span class="number">14</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>That looks like it has worked, but we’ve lost department “40”, which has no employees. If we want to show that row we need to do a  <code>LEFT OUTER JOIN</code>  between the “departments_data” entry and the  <code>XMLTABLE</code> , as shown below. Notice the join condition of “1=1” in the second  <code>WITH</code>  clause entry.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span></span><br><span class="line">  departments_data <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">           XMLTABLE(<span class="string">&#x27;/departments/department&#x27;</span></span><br><span class="line">             PASSING x.xml_data</span><br><span class="line">             COLUMNS</span><br><span class="line">               deptno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;department_number&#x27;</span>,</span><br><span class="line">               dname      VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;department_name&#x27;</span>,</span><br><span class="line">               employees  XMLTYPE      PATH <span class="string">&#x27;employees&#x27;</span></span><br><span class="line">             ) xt</span><br><span class="line">  ),</span><br><span class="line">  employees_data <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> deptno,</span><br><span class="line">           dname,</span><br><span class="line">           xt2.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   departments_data dd</span><br><span class="line">           <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span></span><br><span class="line">             XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">               PASSING dd.employees</span><br><span class="line">               COLUMNS</span><br><span class="line">                 empno      VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;employee_number&#x27;</span>,</span><br><span class="line">                 ename      VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;employee_name&#x27;</span></span><br><span class="line">               ) xt2 <span class="keyword">ON</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees_data;</span><br><span class="line"></span><br><span class="line">DEPT DNAME      EMPN ENAME</span><br><span class="line"><span class="comment">---- ---------- ---- ----------</span></span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7782</span> CLARK</span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7839</span> KING</span><br><span class="line"><span class="number">10</span>   ACCOUNTING <span class="number">7934</span> MILLER</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7369</span> SMITH</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7566</span> JONES</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7788</span> SCOTT</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7876</span> ADAMS</span><br><span class="line"><span class="number">20</span>   RESEARCH   <span class="number">7902</span> FORD</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7499</span> ALLEN</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7521</span> WARD</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7654</span> MARTIN</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7698</span> BLAKE</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7844</span> TURNER</span><br><span class="line"><span class="number">30</span>   SALES      <span class="number">7900</span> JAMES</span><br><span class="line"><span class="number">40</span>   OPERATIONS</span><br><span class="line"></span><br><span class="line"><span class="number">15</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="xml-data-in-variables"><a class="markdownIt-Anchor" href="#xml-data-in-variables">#</a> XML Data in Variables</h2>
<p>Not all XML data you want to process is already stored in a table. In some cases, the XML is stored in a PL/SQL variable. The  <code>XMLTABLE</code>  operator can work with this also.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SERVEROUTPUT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xml VARCHAR2(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  l_xml :<span class="operator">=</span> <span class="string">&#x27;&lt;employees&gt;</span></span><br><span class="line"><span class="string">  &lt;employee&gt;</span></span><br><span class="line"><span class="string">    &lt;empno&gt;7369&lt;/empno&gt;</span></span><br><span class="line"><span class="string">    &lt;ename&gt;SMITH&lt;/ename&gt;</span></span><br><span class="line"><span class="string">    &lt;job&gt;CLERK&lt;/job&gt;</span></span><br><span class="line"><span class="string">    &lt;hiredate&gt;17-DEC-1980&lt;/hiredate&gt;</span></span><br><span class="line"><span class="string">  &lt;/employee&gt;</span></span><br><span class="line"><span class="string">  &lt;employee&gt;</span></span><br><span class="line"><span class="string">    &lt;empno&gt;7499&lt;/empno&gt;</span></span><br><span class="line"><span class="string">    &lt;ename&gt;ALLEN&lt;/ename&gt;</span></span><br><span class="line"><span class="string">    &lt;job&gt;SALESMAN&lt;/job&gt;</span></span><br><span class="line"><span class="string">    &lt;hiredate&gt;20-FEB-1981&lt;/hiredate&gt;</span></span><br><span class="line"><span class="string">  &lt;/employee&gt;</span></span><br><span class="line"><span class="string">&lt;/employees&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FOR</span> cur_rec <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">             PASSING XMLTYPE(l_xml)</span><br><span class="line">             COLUMNS</span><br><span class="line">               empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;empno&#x27;</span>,</span><br><span class="line">               ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;ename&#x27;</span>,</span><br><span class="line">               job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">               hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;hiredate&#x27;</span></span><br><span class="line">             ) xt)</span><br><span class="line">  LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;empno=&#x27;</span> <span class="operator">||</span> cur_rec.empno <span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  ename=&#x27;</span> <span class="operator">||</span> cur_rec.ename <span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  job=&#x27;</span> <span class="operator">||</span> cur_rec.job<span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  hiredate=&#x27;</span> <span class="operator">||</span> cur_rec.hiredate);</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line">empno<span class="operator">=</span><span class="number">7369</span>  ename<span class="operator">=</span>SMITH  job<span class="operator">=</span>CLERK  hiredate<span class="operator">=</span><span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line">empno<span class="operator">=</span><span class="number">7499</span>  ename<span class="operator">=</span>ALLEN  job<span class="operator">=</span>SALESMAN  hiredate<span class="operator">=</span><span class="number">20</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"></span><br><span class="line">PL<span class="operator">/</span><span class="keyword">SQL</span> <span class="keyword">procedure</span> successfully completed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>In the previous example, the XML was being held in regular string variable, so we we had to convert it to an  <code>XMLTYPE</code>  using a constructor in the  <code>PASSING</code>  clause. If the data had already been in an  <code>XMLTYPE</code>  variable, this constructor would not have been necessary. Let’s repeat the previous example, but put the XML into an  <code>XMLTYPE</code>  before using  <code>XMLTABLE</code>  on it. Notice the  <code>PASSING</code>  clause no longer needs the  <code>XMLTYPE</code>  constructor.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SERVEROUTPUT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xml XMLTYPE;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  l_xml :<span class="operator">=</span> XMLTYPE(<span class="string">&#x27;&lt;employees&gt;</span></span><br><span class="line"><span class="string">  &lt;employee&gt;</span></span><br><span class="line"><span class="string">    &lt;empno&gt;7369&lt;/empno&gt;</span></span><br><span class="line"><span class="string">    &lt;ename&gt;SMITH&lt;/ename&gt;</span></span><br><span class="line"><span class="string">    &lt;job&gt;CLERK&lt;/job&gt;</span></span><br><span class="line"><span class="string">    &lt;hiredate&gt;17-DEC-1980&lt;/hiredate&gt;</span></span><br><span class="line"><span class="string">  &lt;/employee&gt;</span></span><br><span class="line"><span class="string">  &lt;employee&gt;</span></span><br><span class="line"><span class="string">    &lt;empno&gt;7499&lt;/empno&gt;</span></span><br><span class="line"><span class="string">    &lt;ename&gt;ALLEN&lt;/ename&gt;</span></span><br><span class="line"><span class="string">    &lt;job&gt;SALESMAN&lt;/job&gt;</span></span><br><span class="line"><span class="string">    &lt;hiredate&gt;20-FEB-1981&lt;/hiredate&gt;</span></span><br><span class="line"><span class="string">  &lt;/employee&gt;</span></span><br><span class="line"><span class="string">&lt;/employees&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FOR</span> cur_rec <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   XMLTABLE(<span class="string">&#x27;/employees/employee&#x27;</span></span><br><span class="line">             PASSING l_xml</span><br><span class="line">             COLUMNS</span><br><span class="line">               empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;empno&#x27;</span>,</span><br><span class="line">               ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;ename&#x27;</span>,</span><br><span class="line">               job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">               hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;hiredate&#x27;</span></span><br><span class="line">             ) xt)</span><br><span class="line">  LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;empno=&#x27;</span> <span class="operator">||</span> cur_rec.empno <span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  ename=&#x27;</span> <span class="operator">||</span> cur_rec.ename <span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  job=&#x27;</span> <span class="operator">||</span> cur_rec.job<span class="operator">||</span></span><br><span class="line">                         <span class="string">&#x27;  hiredate=&#x27;</span> <span class="operator">||</span> cur_rec.hiredate);</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line">empno<span class="operator">=</span><span class="number">7369</span>  ename<span class="operator">=</span>SMITH  job<span class="operator">=</span>CLERK  hiredate<span class="operator">=</span><span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line">empno<span class="operator">=</span><span class="number">7499</span>  ename<span class="operator">=</span>ALLEN  job<span class="operator">=</span>SALESMAN  hiredate<span class="operator">=</span><span class="number">20</span><span class="operator">-</span>FEB<span class="number">-1981</span></span><br><span class="line"></span><br><span class="line">PL<span class="operator">/</span><span class="keyword">SQL</span> <span class="keyword">procedure</span> successfully completed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>Here’s a more complicated example of using  <code>XMLTABLE</code>  against some XML returned from an OBIEE web service.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SERVEROUTPUT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">  l_xml     VARCHAR2(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  l_xml :<span class="operator">=</span> <span class="string">&#x27;&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:soapenc=&quot;http://schemas.xmlsoap.org/soap/encoding/&quot; xmlns:sawsoap=&quot;urn://oracle.bi.webservices/v6&quot;&gt;</span></span><br><span class="line"><span class="string">   &lt;soap:Body&gt;</span></span><br><span class="line"><span class="string">      &lt;sawsoap:executeSQLQueryResult&gt;</span></span><br><span class="line"><span class="string">         &lt;sawsoap:return xsi:type=&quot;sawsoap:QueryResults&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;sawsoap:rowset&gt;</span></span><br><span class="line"><span class="string">&lt;![CDATA[&lt;rowset xmlns=&quot;urn:schemas-microsoft-com:xml-analysis:rowset&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;Row&gt;&lt;Column0&gt;1000&lt;/Column0&gt;&lt;Column1&gt;East Region&lt;/Column1&gt;&lt;/Row&gt;</span></span><br><span class="line"><span class="string">&lt;Row&gt;&lt;Column0&gt;2000&lt;/Column0&gt;&lt;Column1&gt;West Region&lt;/Column1&gt;&lt;/Row&gt;</span></span><br><span class="line"><span class="string">&lt;Row&gt;&lt;Column0&gt;1500&lt;/Column0&gt;&lt;Column1&gt;Central Region&lt;/Column1&gt;&lt;/Row&gt;</span></span><br><span class="line"><span class="string">&lt;/rowset&gt;]]&gt;</span></span><br><span class="line"><span class="string">&lt;/sawsoap:rowset&gt;</span></span><br><span class="line"><span class="string">            &lt;sawsoap:queryID/&gt;</span></span><br><span class="line"><span class="string">            &lt;sawsoap:finished&gt;true&lt;/sawsoap:finished&gt;</span></span><br><span class="line"><span class="string">         &lt;/sawsoap:return&gt;</span></span><br><span class="line"><span class="string">      &lt;/sawsoap:executeSQLQueryResult&gt;</span></span><br><span class="line"><span class="string">   &lt;/soap:Body&gt;</span></span><br><span class="line"><span class="string">&lt;/soap:Envelope&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">FOR</span> cur_rec <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> a.mydata, xt.<span class="operator">*</span></span><br><span class="line">    <span class="keyword">FROM</span>   (</span><br><span class="line">            <span class="comment">-- Pull out just the CDATA value.</span></span><br><span class="line">            <span class="keyword">SELECT</span> EXTRACTVALUE(XMLTYPE(l_xml), <span class="string">&#x27;//sawsoap:rowset/text()&#x27;</span>,<span class="string">&#x27;xmlns:sawsoap=&quot;urn://oracle.bi.webservices/v6&quot;&#x27;</span>) <span class="keyword">AS</span> mydata</span><br><span class="line">            <span class="keyword">FROM</span> dual</span><br><span class="line">           ) a,</span><br><span class="line">           <span class="comment">-- Specify the path that marks a new row, remembering to use the correct namespace.</span></span><br><span class="line">           XMLTABLE(XMLNAMESPACES(<span class="keyword">default</span> <span class="string">&#x27;urn:schemas-microsoft-com:xml-analysis:rowset&#x27;</span>), <span class="string">&#x27;/rowset/Row&#x27;</span></span><br><span class="line">             PASSING XMLTYPE(a.mydata)</span><br><span class="line">             COLUMNS</span><br><span class="line">               column0  NUMBER(<span class="number">4</span>)    PATH <span class="string">&#x27;Column0&#x27;</span>,</span><br><span class="line">               column1  VARCHAR2(<span class="number">20</span>) PATH <span class="string">&#x27;Column1&#x27;</span></span><br><span class="line">             ) xt)</span><br><span class="line">  LOOP</span><br><span class="line">    DBMS_OUTPUT.put_line(<span class="string">&#x27;column0=&#x27;</span> <span class="operator">||</span> cur_rec.column0 <span class="operator">||</span> <span class="string">&#x27;  column1=&#x27;</span> <span class="operator">||</span> cur_rec.column1);</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line">column0<span class="operator">=</span><span class="number">1000</span>  column1<span class="operator">=</span>East Region</span><br><span class="line">column0<span class="operator">=</span><span class="number">2000</span>  column1<span class="operator">=</span>West Region</span><br><span class="line">column0<span class="operator">=</span><span class="number">1500</span>  column1<span class="operator">=</span>Central Region</span><br><span class="line"></span><br><span class="line">PL<span class="operator">/</span><span class="keyword">SQL</span> <span class="keyword">procedure</span> successfully completed.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="filtering-rows-with-xpath"><a class="markdownIt-Anchor" href="#filtering-rows-with-xpath">#</a> Filtering Rows with XPath</h2>
<p>We can limit the rows returned by altering the XPath expression. In the following example we only return rows with the job type of “CLERK”.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">       XMLTABLE(<span class="string">&#x27;/employees/employee[job=&quot;CLERK&quot;]&#x27;</span></span><br><span class="line">         PASSING x.xml_data</span><br><span class="line">         COLUMNS</span><br><span class="line">           empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;empno&#x27;</span>,</span><br><span class="line">           ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;ename&#x27;</span>,</span><br><span class="line">           job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">           hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;hiredate&#x27;</span></span><br><span class="line">         ) xt;</span><br><span class="line"></span><br><span class="line">EMPN ENAME      JOB       HIREDATE</span><br><span class="line"><span class="comment">---- ---------- --------- -----------</span></span><br><span class="line"><span class="number">7369</span> SMITH      CLERK     <span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line"><span class="number">7876</span> ADAMS      CLERK     <span class="number">23</span><span class="operator">-</span>MAY<span class="number">-1987</span></span><br><span class="line"><span class="number">7900</span> JAMES      CLERK     <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7934</span> MILLER     CLERK     <span class="number">23</span><span class="operator">-</span>JAN<span class="number">-1982</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<p>We could parameterise the job type using variable in the XPath, which is prefixed with a “$”. The value for this variable is then passed in the  <code>PASSING</code>  clause. The variable must be aliases using  <code>AS</code>  and double quoted to make sure the name and case matches that of the variable in the XPath expression.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">VARIABLE v_job VARCHAR2(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">EXEC</span> :v_job :<span class="operator">=</span> <span class="string">&#x27;CLERK&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> xt.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   xml_tab x,</span><br><span class="line">       XMLTABLE(<span class="string">&#x27;/employees/employee[job=$job]&#x27;</span></span><br><span class="line">         PASSING x.xml_data, :v_job <span class="keyword">AS</span> &quot;job&quot;</span><br><span class="line">         COLUMNS</span><br><span class="line">           empno     VARCHAR2(<span class="number">4</span>)  PATH <span class="string">&#x27;empno&#x27;</span>,</span><br><span class="line">           ename     VARCHAR2(<span class="number">10</span>) PATH <span class="string">&#x27;ename&#x27;</span>,</span><br><span class="line">           job       VARCHAR2(<span class="number">9</span>)  PATH <span class="string">&#x27;job&#x27;</span>,</span><br><span class="line">           hiredate  VARCHAR2(<span class="number">11</span>) PATH <span class="string">&#x27;hiredate&#x27;</span></span><br><span class="line">         ) xt;</span><br><span class="line"></span><br><span class="line">EMPN ENAME      JOB       HIREDATE</span><br><span class="line"><span class="comment">---- ---------- --------- -----------</span></span><br><span class="line"><span class="number">7369</span> SMITH      CLERK     <span class="number">17</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1980</span></span><br><span class="line"><span class="number">7876</span> ADAMS      CLERK     <span class="number">23</span><span class="operator">-</span>MAY<span class="number">-1987</span></span><br><span class="line"><span class="number">7900</span> JAMES      CLERK     <span class="number">03</span><span class="operator">-</span><span class="type">DEC</span><span class="number">-1981</span></span><br><span class="line"><span class="number">7934</span> MILLER     CLERK     <span class="number">23</span><span class="operator">-</span>JAN<span class="number">-1982</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> selected.</span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="performance"><a class="markdownIt-Anchor" href="#performance">#</a> Performance</h2>
<p>The  <code>XMLTABLE</code>  operator works really well with small XML documents, or tables with many rows, each of which contain a small XML document. As the XML documents get bigger the performance gets worse compared to the <span class="exturl" data-url="aHR0cHM6Ly9vcmFjbGUtYmFzZS5jb20vYXJ0aWNsZXMvOWkvcGFyc2UteG1sLWRvY3VtZW50cy05aQ==">manual parse</span> method. When dealing with large XML documents you may have to forgo the convenience for the  <code>XMLTABLE</code>  operator in favour of a manual solution.</p>

      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2022-03-20 10:43:47" itemprop="dateModified" datetime="2022-03-20T10:43:47+08:00">2022-03-20</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2020/03/05/python-excel/" itemprop="url" rel="prev" data-background-image="&#x2F;anime&#x2F;index&#x2F;言叶之庭.jpg" title="Python Excel">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Python Excel</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2020/03/17/oracle-xml-generate/" itemprop="url" rel="next" data-background-image="&#x2F;anime&#x2F;index&#x2F;文豪野犬-2.jpg" title="Oracle Generate XML">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Oracle Generate XML</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#tag-based-xml"><span class="toc-number">1.</span> <span class="toc-text"> Tag-Based XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#attribute-based-xml"><span class="toc-number">2.</span> <span class="toc-text"> Attribute-Based XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nested-xml"><span class="toc-number">3.</span> <span class="toc-text"> Nested XML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml-data-in-variables"><span class="toc-number">4.</span> <span class="toc-text"> XML Data in Variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filtering-rows-with-xpath"><span class="toc-number">5.</span> <span class="toc-text"> Filtering Rows with XPath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#performance"><span class="toc-number">6.</span> <span class="toc-text"> Performance</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">363</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">51</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item codepen" data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL2xoY2hlbjc0" title="https:&#x2F;&#x2F;codepen.io&#x2F;lhchen74"><i class="ic i-address-card"></i></span>
      <span class="exturl item anki" data-url="aHR0cHM6Ly9hbmtpd2ViLm5ldC9kZWNrcy8=" title="https:&#x2F;&#x2F;ankiweb.net&#x2F;decks&#x2F;"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

    
  <li class="item">
    <a href="/anime/" rel="section"><i class="ic i-magic"></i>Anime</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2020/03/05/python-excel/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2020/03/17/oracle-xml-generate/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ D E W</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2020/03/17/oracle-xml-parse/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
