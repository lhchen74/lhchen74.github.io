



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db" />


<link rel="canonical" href="https://lhchen74.github.io/2020/01/21/oracle-cte-with/">



  <title>
Oracle With |
D E W = 露の世</title>
<meta name="generator" content="Hexo 5.4.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle With
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2020-01-21 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2020-01-21T00:00:00+08:00">2020-01-21</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">D E W</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipetfk5zwj20zk0m8e81.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipew8gmvyj20zk0m87wh.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeu1usa7j20zk0m8b29.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclflwv2aj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipewr8iypj20zk0m8b29.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2020/01/21/oracle-cte-with/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>转载: <span class="exturl" data-url="aHR0cHM6Ly9vcmFjbGUtYmFzZS5jb20vYXJ0aWNsZXMvbWlzYy93aXRoLWNsYXVzZQ==">ORACLE-BASE - WITH Clause : Subquery Factoring in Oracle</span></p>
</blockquote>
<h2 id="setup"><a class="markdownIt-Anchor" href="#setup">#</a> Setup</h2>
<p>The examples below use the following tables.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- DROP TABLE EMP PURGE;</span></span><br><span class="line"><span class="comment">-- DROP TABLE DEPT PURGE;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DEPT (</span><br><span class="line">  DEPTNO NUMBER(<span class="number">2</span>) <span class="keyword">CONSTRAINT</span> PK_DEPT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  DNAME VARCHAR2(<span class="number">14</span>),</span><br><span class="line">  LOC VARCHAR2(<span class="number">13</span>)</span><br><span class="line">) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> EMP (</span><br><span class="line">  EMPNO NUMBER(<span class="number">4</span>) <span class="keyword">CONSTRAINT</span> PK_EMP <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  ENAME VARCHAR2(<span class="number">10</span>),</span><br><span class="line">  JOB VARCHAR2(<span class="number">9</span>),</span><br><span class="line">  MGR NUMBER(<span class="number">4</span>),</span><br><span class="line">  HIREDATE <span class="type">DATE</span>,</span><br><span class="line">  SAL NUMBER(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">  COMM NUMBER(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">  DEPTNO NUMBER(<span class="number">2</span>) <span class="keyword">CONSTRAINT</span> FK_DEPTNO <span class="keyword">REFERENCES</span> DEPT</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT <span class="keyword">VALUES</span> (<span class="number">10</span>,<span class="string">&#x27;ACCOUNTING&#x27;</span>,<span class="string">&#x27;NEW YORK&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT <span class="keyword">VALUES</span> (<span class="number">20</span>,<span class="string">&#x27;RESEARCH&#x27;</span>,<span class="string">&#x27;DALLAS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT <span class="keyword">VALUES</span> (<span class="number">30</span>,<span class="string">&#x27;SALES&#x27;</span>,<span class="string">&#x27;CHICAGO&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT <span class="keyword">VALUES</span> (<span class="number">40</span>,<span class="string">&#x27;OPERATIONS&#x27;</span>,<span class="string">&#x27;BOSTON&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7369</span>,<span class="string">&#x27;SMITH&#x27;</span>,<span class="string">&#x27;CLERK&#x27;</span>,<span class="number">7902</span>,to_date(<span class="string">&#x27;17-12-1980&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">800</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7499</span>,<span class="string">&#x27;ALLEN&#x27;</span>,<span class="string">&#x27;SALESMAN&#x27;</span>,<span class="number">7698</span>,to_date(<span class="string">&#x27;20-2-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">1600</span>,<span class="number">300</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7521</span>,<span class="string">&#x27;WARD&#x27;</span>,<span class="string">&#x27;SALESMAN&#x27;</span>,<span class="number">7698</span>,to_date(<span class="string">&#x27;22-2-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">1250</span>,<span class="number">500</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7566</span>,<span class="string">&#x27;JONES&#x27;</span>,<span class="string">&#x27;MANAGER&#x27;</span>,<span class="number">7839</span>,to_date(<span class="string">&#x27;2-4-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">2975</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7654</span>,<span class="string">&#x27;MARTIN&#x27;</span>,<span class="string">&#x27;SALESMAN&#x27;</span>,<span class="number">7698</span>,to_date(<span class="string">&#x27;28-9-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">1250</span>,<span class="number">1400</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7698</span>,<span class="string">&#x27;BLAKE&#x27;</span>,<span class="string">&#x27;MANAGER&#x27;</span>,<span class="number">7839</span>,to_date(<span class="string">&#x27;1-5-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">2850</span>,<span class="keyword">NULL</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7782</span>,<span class="string">&#x27;CLARK&#x27;</span>,<span class="string">&#x27;MANAGER&#x27;</span>,<span class="number">7839</span>,to_date(<span class="string">&#x27;9-6-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">2450</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7788</span>,<span class="string">&#x27;SCOTT&#x27;</span>,<span class="string">&#x27;ANALYST&#x27;</span>,<span class="number">7566</span>,to_date(<span class="string">&#x27;13-JUL-87&#x27;</span>,<span class="string">&#x27;dd-mm-rr&#x27;</span>)<span class="number">-85</span>,<span class="number">3000</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7839</span>,<span class="string">&#x27;KING&#x27;</span>,<span class="string">&#x27;PRESIDENT&#x27;</span>,<span class="keyword">NULL</span>,to_date(<span class="string">&#x27;17-11-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">5000</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7844</span>,<span class="string">&#x27;TURNER&#x27;</span>,<span class="string">&#x27;SALESMAN&#x27;</span>,<span class="number">7698</span>,to_date(<span class="string">&#x27;8-9-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">1500</span>,<span class="number">0</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7876</span>,<span class="string">&#x27;ADAMS&#x27;</span>,<span class="string">&#x27;CLERK&#x27;</span>,<span class="number">7788</span>,to_date(<span class="string">&#x27;13-JUL-87&#x27;</span>, <span class="string">&#x27;dd-mm-rr&#x27;</span>)<span class="number">-51</span>,<span class="number">1100</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7900</span>,<span class="string">&#x27;JAMES&#x27;</span>,<span class="string">&#x27;CLERK&#x27;</span>,<span class="number">7698</span>,to_date(<span class="string">&#x27;3-12-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">950</span>,<span class="keyword">NULL</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7902</span>,<span class="string">&#x27;FORD&#x27;</span>,<span class="string">&#x27;ANALYST&#x27;</span>,<span class="number">7566</span>,to_date(<span class="string">&#x27;3-12-1981&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">3000</span>,<span class="keyword">NULL</span>,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP <span class="keyword">VALUES</span> (<span class="number">7934</span>,<span class="string">&#x27;MILLER&#x27;</span>,<span class="string">&#x27;CLERK&#x27;</span>,<span class="number">7782</span>,to_date(<span class="string">&#x27;23-1-1982&#x27;</span>,<span class="string">&#x27;dd-mm-yyyy&#x27;</span>),<span class="number">1300</span>,<span class="keyword">NULL</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<h2 id="subquery-factoring"><a class="markdownIt-Anchor" href="#subquery-factoring">#</a> Subquery Factoring</h2>
<p>The  <code>WITH</code>  clause, or subquery factoring clause, is part of the SQL-99 standard and was added into the Oracle SQL syntax in Oracle 9.2. The WITH clause may be processed as an inline view or resolved as a temporary table. The advantage of the latter is that repeated references to the subquery may be more efficient as the data is easily retrieved from the temporary table, rather than being requeried by each reference. You should assess the performance implications of the  <code>WITH</code>  clause on a case-by-case basis.</p>
<p>This article shows how the  <code>WITH</code>  clause can be used to reduce repetition and simplify complex SQL statements. I’m not suggesting the following queries are the best way to retrieve the required information. They merely demonstrate the use of the WITH clause.</p>
<p>Using the SCOTT schema, for each employee we want to know how many other people are in their department. Using an inline view we might do the following.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- Non-ANSI Syntax</span><br><span class="line">SELECT e.ename AS employee_name,</span><br><span class="line">       dc.dept_count AS emp_dept_count</span><br><span class="line">FROM   emp e,</span><br><span class="line">       (SELECT deptno, COUNT(*) AS dept_count</span><br><span class="line">        FROM   emp</span><br><span class="line">        GROUP BY deptno) dc</span><br><span class="line">WHERE  e.deptno &#x3D; dc.deptno;</span><br><span class="line"></span><br><span class="line">-- ANSI Syntax</span><br><span class="line">SELECT e.ename AS employee_name,</span><br><span class="line">       dc.dept_count AS emp_dept_count</span><br><span class="line">FROM   emp e</span><br><span class="line">       JOIN (SELECT deptno, COUNT(*) AS dept_count</span><br><span class="line">             FROM   emp</span><br><span class="line">             GROUP BY deptno) dc</span><br><span class="line">         ON e.deptno &#x3D; dc.deptno;</span><br></pre></td></tr></table></figure>
<p>Using a  <code>WITH</code>  clause this would look like the following.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Non-ANSI Syntax</span></span><br><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc.dept_count <span class="keyword">AS</span> emp_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e,</span><br><span class="line">       dept_count dc</span><br><span class="line"><span class="keyword">WHERE</span>  e.deptno <span class="operator">=</span> dc.deptno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ANSI Syntax</span></span><br><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc.dept_count <span class="keyword">AS</span> emp_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e</span><br><span class="line">       <span class="keyword">JOIN</span> dept_count dc <span class="keyword">ON</span> e.deptno <span class="operator">=</span> dc.deptno;</span><br></pre></td></tr></table></figure>
<p>The difference seems rather insignificant here.</p>
<p>What if we also want to pull back each employees manager name and the number of people in the managers department? Using the inline view it now looks like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Non-ANSI Syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc1.dept_count <span class="keyword">AS</span> emp_dept_count,</span><br><span class="line">       m.ename <span class="keyword">AS</span> manager_name,</span><br><span class="line">       dc2.dept_count <span class="keyword">AS</span> mgr_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e,</span><br><span class="line">       (<span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">             <span class="keyword">FROM</span>   emp</span><br><span class="line">             <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) dc1,</span><br><span class="line">       emp m,</span><br><span class="line">       (<span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">        <span class="keyword">FROM</span>   emp</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) dc2</span><br><span class="line"><span class="keyword">WHERE</span>  e.deptno <span class="operator">=</span> dc1.deptno</span><br><span class="line"><span class="keyword">AND</span>    e.mgr <span class="operator">=</span> m.empno</span><br><span class="line"><span class="keyword">AND</span>    m.deptno <span class="operator">=</span> dc2.deptno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ANSI Syntax</span></span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc1.dept_count <span class="keyword">AS</span> emp_dept_count,</span><br><span class="line">       m.ename <span class="keyword">AS</span> manager_name,</span><br><span class="line">       dc2.dept_count <span class="keyword">AS</span> mgr_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e</span><br><span class="line">       <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">             <span class="keyword">FROM</span>   emp</span><br><span class="line">             <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) dc1</span><br><span class="line">         <span class="keyword">ON</span> e.deptno <span class="operator">=</span> dc1.deptno</span><br><span class="line">       <span class="keyword">JOIN</span> emp m <span class="keyword">ON</span> e.mgr <span class="operator">=</span> m.empno</span><br><span class="line">       <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">             <span class="keyword">FROM</span>   emp</span><br><span class="line">             <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) dc2</span><br><span class="line">         <span class="keyword">ON</span> m.deptno <span class="operator">=</span> dc2.deptno;</span><br></pre></td></tr></table></figure>
<p>Using the  <code>WITH</code>  clause this would look like the following.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Non-ANSI Syntax</span></span><br><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc1.dept_count <span class="keyword">AS</span> emp_dept_count,</span><br><span class="line">       m.ename <span class="keyword">AS</span> manager_name,</span><br><span class="line">       dc2.dept_count <span class="keyword">AS</span> mgr_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e,</span><br><span class="line">       dept_count dc1,</span><br><span class="line">       emp m,</span><br><span class="line">       dept_count dc2</span><br><span class="line"><span class="keyword">WHERE</span>  e.deptno <span class="operator">=</span> dc1.deptno</span><br><span class="line"><span class="keyword">AND</span>    e.mgr <span class="operator">=</span> m.empno</span><br><span class="line"><span class="keyword">AND</span>    m.deptno <span class="operator">=</span> dc2.deptno;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ANSI Syntax</span></span><br><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> e.ename <span class="keyword">AS</span> employee_name,</span><br><span class="line">       dc1.dept_count <span class="keyword">AS</span> emp_dept_count,</span><br><span class="line">       m.ename <span class="keyword">AS</span> manager_name,</span><br><span class="line">       dc2.dept_count <span class="keyword">AS</span> mgr_dept_count</span><br><span class="line"><span class="keyword">FROM</span>   emp e</span><br><span class="line">       <span class="keyword">JOIN</span> dept_count dc1 <span class="keyword">ON</span> e.deptno <span class="operator">=</span> dc1.deptno</span><br><span class="line">       <span class="keyword">JOIN</span> emp m <span class="keyword">ON</span> e.mgr <span class="operator">=</span> m.empno</span><br><span class="line">       <span class="keyword">JOIN</span> dept_count dc2 <span class="keyword">ON</span> m.deptno <span class="operator">=</span> dc2.deptno;</span><br></pre></td></tr></table></figure>
<p>So we don’t need to redefine the same subquery multiple times. Instead we just use the query name defined in the  <code>WITH</code>  clause, making the query much easier to read.</p>
<p>If the contents of the  <code>WITH</code>  clause is sufficiently complex, Oracle may decide to resolve the result of the subquery into a global temporary table. This can make multiple references to the subquery more efficient. The  <code>MATERIALIZE</code>  and  <code>INLINE</code>  optimizer hints can be used to influence the decision. The undocumented  <code>MATERIALIZE</code>  hint tells the optimizer to resolve the subquery as a global temporary table, while the  <code>INLINE</code>  hint tells it to process the query inline.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="comment">/*+ MATERIALIZE */</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> dept_count <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="comment">/*+ INLINE */</span> deptno, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> dept_count</span><br><span class="line">  <span class="keyword">FROM</span>   emp</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno)</span><br><span class="line"><span class="keyword">SELECT</span> ...</span><br></pre></td></tr></table></figure>
<p>Even when there is no repetition of SQL, the  <code>WITH</code>  clause can simplify complex queries, like the following example that lists those departments with above average wages.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> </span><br><span class="line">  dept_costs <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> dname, <span class="built_in">SUM</span>(sal) dept_total</span><br><span class="line">    <span class="keyword">FROM</span>   emp e, dept d</span><br><span class="line">    <span class="keyword">WHERE</span>  e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> dname),</span><br><span class="line">  avg_cost <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">SUM</span>(dept_total)<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) avg</span><br><span class="line">    <span class="keyword">FROM</span>   dept_costs)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   dept_costs</span><br><span class="line"><span class="keyword">WHERE</span>  dept_total <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> avg <span class="keyword">FROM</span> avg_cost)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dname;</span><br></pre></td></tr></table></figure>
<p>In the previous example, the main body of the query is very simple, with the complexity hidden in the  <code>WITH</code>  clause.</p>
<h2 id="materialize-hint"><a class="markdownIt-Anchor" href="#materialize-hint">#</a> MATERIALIZE Hint</h2>
<p>The undocumented  <code>MATERIALIZE</code>  hint was mentioned above, but there seems to be a little confusion over how it is implemented. We can see what is happening under the covers using SQL trace.</p>
<p>Create a test table.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONN test&#x2F;test</span><br><span class="line"></span><br><span class="line">CREATE TABLE t1 AS</span><br><span class="line">SELECT level AS id</span><br><span class="line">FROM   dual</span><br><span class="line">CONNECT BY level &lt;&#x3D; 100;</span><br></pre></td></tr></table></figure>
<p>Check the trace file location.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT value</span><br><span class="line">FROM   v$diag_info</span><br><span class="line">WHERE  name &#x3D; &#39;Default Trace File&#39;;</span><br><span class="line"></span><br><span class="line">VALUE</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">&#x2F;u01&#x2F;app&#x2F;oracle&#x2F;diag&#x2F;rdbms&#x2F;cdb1&#x2F;cdb1&#x2F;trace&#x2F;cdb1_ora_4278.trc</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure>
<p>Trace a statement using the  <code>MATERIALIZE</code>  hint.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> DBMS_MONITOR.session_trace_enable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">WITH</span> query1 <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="comment">/*+ MATERIALIZE */</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> query1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> DBMS_MONITOR.session_trace_disable;</span><br></pre></td></tr></table></figure>
<p>The following abbreviated output shows some points of interest in the resulting trace file. Notice the “CREATE GLOBAL TEMPORARY T” and “TABLE ACCESS FULL SYS_TEMP_0FD9D662B_2E34FB” lines. It certainly seems to be using a global temporary table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">PARSING <span class="keyword">IN</span> <span class="keyword">CURSOR</span> #<span class="number">140100560521424</span> len<span class="operator">=</span><span class="number">174</span> dep<span class="operator">=</span><span class="number">1</span> uid<span class="operator">=</span><span class="number">0</span> oct<span class="operator">=</span><span class="number">1</span> lid<span class="operator">=</span><span class="number">0</span> tim<span class="operator">=</span><span class="number">733844612</span> hv<span class="operator">=</span><span class="number">1878591410</span> ad<span class="operator">=</span><span class="string">&#x27;80b179f0&#x27;</span> sqlid<span class="operator">=</span><span class="string">&#x27;40a2untrzk1xk&#x27;</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">GLOBAL</span> TEMPORARY T</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">OF</span> STMT</span><br><span class="line">...</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">...</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line">PARSING <span class="keyword">IN</span> <span class="keyword">CURSOR</span> #<span class="number">140100560423976</span> len<span class="operator">=</span><span class="number">77</span> dep<span class="operator">=</span><span class="number">0</span> uid<span class="operator">=</span><span class="number">109</span> oct<span class="operator">=</span><span class="number">3</span> lid<span class="operator">=</span><span class="number">109</span> tim<span class="operator">=</span><span class="number">733865863</span> hv<span class="operator">=</span><span class="number">3518560624</span> ad<span class="operator">=</span><span class="string">&#x27;a35bc6c0&#x27;</span> sqlid<span class="operator">=</span><span class="string">&#x27;9fzhbw78vjybh&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> query1 <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="comment">/*+ MATERIALIZE */</span> <span class="operator">*</span> <span class="keyword">FROM</span> t1</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> query1</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">OF</span> STMT</span><br><span class="line">...</span><br><span class="line">STAT #<span class="number">140100560423976</span> id<span class="operator">=</span><span class="number">1</span> cnt<span class="operator">=</span><span class="number">100</span> pid<span class="operator">=</span><span class="number">0</span> pos<span class="operator">=</span><span class="number">1</span> obj<span class="operator">=</span><span class="number">0</span> op<span class="operator">=</span><span class="string">&#x27;TEMP TABLE TRANSFORMATION  (cr=15 pr=1 pw=1 time=19589 us)&#x27;</span></span><br><span class="line">STAT #<span class="number">140100560423976</span> id<span class="operator">=</span><span class="number">2</span> cnt<span class="operator">=</span><span class="number">0</span> pid<span class="operator">=</span><span class="number">1</span> pos<span class="operator">=</span><span class="number">1</span> obj<span class="operator">=</span><span class="number">0</span> op<span class="operator">=</span><span class="string">&#x27;LOAD AS SELECT  (cr=3 pr=0 pw=1 time=16243 us)&#x27;</span></span><br><span class="line">STAT #<span class="number">140100560423976</span> id<span class="operator">=</span><span class="number">3</span> cnt<span class="operator">=</span><span class="number">100</span> pid<span class="operator">=</span><span class="number">2</span> pos<span class="operator">=</span><span class="number">1</span> obj<span class="operator">=</span><span class="number">91676</span> op<span class="operator">=</span><span class="string">&#x27;TABLE ACCESS FULL T1 (cr=3 pr=0 pw=0 time=1514 us cost=3 size=300 card=100)&#x27;</span></span><br><span class="line">STAT #<span class="number">140100560423976</span> id<span class="operator">=</span><span class="number">4</span> cnt<span class="operator">=</span><span class="number">100</span> pid<span class="operator">=</span><span class="number">1</span> pos<span class="operator">=</span><span class="number">2</span> obj<span class="operator">=</span><span class="number">0</span> op<span class="operator">=</span><span class="string">&#x27;VIEW  (cr=12 pr=1 pw=0 time=1257 us cost=2 size=1300 card=100)&#x27;</span></span><br><span class="line">STAT #<span class="number">140100560423976</span> id<span class="operator">=</span><span class="number">5</span> cnt<span class="operator">=</span><span class="number">100</span> pid<span class="operator">=</span><span class="number">4</span> pos<span class="operator">=</span><span class="number">1</span> obj<span class="operator">=</span><span class="number">4254950955</span> op<span class="operator">=</span><span class="string">&#x27;TABLE ACCESS FULL SYS_TEMP_0FD9D662B_2E34FB (cr=12 pr=1 pw=0 time=1203 us cost=2 size=300 card=100)&#x27;</span></span><br><span class="line">...</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br></pre></td></tr></table></figure>
      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2021-10-18 13:27:14" itemprop="dateModified" datetime="2021-10-18T13:27:14+08:00">2021-10-18</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2020/01/20/oracle-raise-exception/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipevuctzzj20zk0m84qp.jpg" title="Oracle Raise Exception">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Oracle Raise Exception</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2020/02/27/cheatsheet-frontend/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclil3m4ej20zk0m8tn8.jpg" title="Frontend CheatSheet">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Frontend CheatSheet</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#setup"><span class="toc-number">1.</span> <span class="toc-text"> Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#subquery-factoring"><span class="toc-number">2.</span> <span class="toc-text"> Subquery Factoring</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#materialize-hint"><span class="toc-number">3.</span> <span class="toc-text"> MATERIALIZE Hint</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">282</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">40</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2020/01/20/oracle-raise-exception/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2020/02/27/cheatsheet-frontend/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ D E W</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2020/01/21/oracle-cte-with/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
