



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="我知这世界本如露水般短暂 然而 然而" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="我知这世界本如露水般短暂 然而 然而" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="我知这世界本如露水般短暂 然而 然而" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db" />


<link rel="canonical" href="https://lhchen74.github.io/2021/11/15/oracle-lob/">



  <title>
Oracle LOB |
露の世 = 我知这世界本如露水般短暂 然而 然而</title>
<meta name="generator" content="Hexo 5.4.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle LOB
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2021-11-15 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2021-11-15T00:00:00+08:00">2021-11-15</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">露の世</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciszlczyj20zk0m816d.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicitspjpbj20zk0m81ky.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2021/11/15/oracle-lob/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="我知这世界本如露水般短暂 然而 然而">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="大对象类型-lob"><a class="markdownIt-Anchor" href="#大对象类型-lob">#</a> 大对象类型 LOB</h2>
<p>LOB 四种类型：</p>
<ul>
<li><strong>CLOB</strong> 字符 LOB 类型，用于存储字符数据。</li>
<li><strong>NCLOB</strong> 国际语言字符集 LOB 类型。</li>
<li><strong>BLOB</strong> 二进制 LOB 类型，用于存储二进制数据。</li>
<li><strong>BFILE</strong> 二进制 FILE 类型，用于存储指向文件的指针，这些文件可以存储于硬盘、CD、DVD 等。</li>
</ul>
<p>LOB 组成：</p>
<ul>
<li><strong>LOB 定位器</strong> 一个指针，指定 LOB 数据的位置。</li>
<li><strong>LOB 数据</strong> 存储在 LOB 中的实际字符或字节数据。</li>
</ul>
<p>LOB 比 LONG, LONG RAW 优点：</p>
<ul>
<li>LOB 最多可以存储 128TB 的数据，LONG, LONG RAW 最多只能存储 2GB 数据。</li>
<li>一个表可以有多个 LOB 列，但只能有一个 LONG 或 LONG RAW 列。</li>
<li>LOB 数据可以随机访问，LONG 和 LONG RAW 只能顺序访问。</li>
</ul>
<h2 id="创建包含大对象的表"><a class="markdownIt-Anchor" href="#创建包含大对象的表">#</a> 创建包含大对象的表</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This script does the following:</span></span><br><span class="line"><span class="comment">--   1. Creates lob_user</span></span><br><span class="line"><span class="comment">--   2. Creates the database tables</span></span><br><span class="line"><span class="comment">--   3. Populates the database tables with sample data</span></span><br><span class="line"><span class="comment">--   4. Creates the PL/SQL code</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- attempt to drop the user (this will generate an error</span></span><br><span class="line"><span class="comment">-- if the user does not yet exist; do not worry about this</span></span><br><span class="line"><span class="comment">-- error); this statement is included so that you do not have</span></span><br><span class="line"><span class="comment">-- to manually run the DROP before recreating the schema</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> lob_user CASCADE;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- attempt to drop the sample files directory (this will</span></span><br><span class="line"><span class="comment">-- generate an error if the directory does not yet exist;</span></span><br><span class="line"><span class="comment">-- do not worry about this error);</span></span><br><span class="line"><span class="comment">-- this statement is included so that you do not have</span></span><br><span class="line"><span class="comment">-- to manually run the DROP before recreating the schema</span></span><br><span class="line"><span class="keyword">DROP</span> DIRECTORY SAMPLE_FILES_DIR;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create lob_user</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> lob_user IDENTIFIED <span class="keyword">BY</span> lob_password;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create the BFILE directory</span></span><br><span class="line"><span class="keyword">CREATE</span> DIRECTORY SAMPLE_FILES_DIR <span class="keyword">AS</span> <span class="string">&#x27;C:\sample_files&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- grant read and write permissions on the BFILE directory</span></span><br><span class="line"><span class="keyword">GRANT</span> read, write <span class="keyword">ON</span> DIRECTORY SAMPLE_FILES_DIR <span class="keyword">TO</span> lob_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- allow the user to connect, create database objects and</span></span><br><span class="line"><span class="comment">-- create directory objects (for the BFILEs)</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">connect</span>, resource <span class="keyword">TO</span> lob_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- give lob_user a quota of 10M on the users tablespace</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> lob_user QUOTA <span class="number">10</span>M <span class="keyword">ON</span> users;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- connect as lob_user</span></span><br><span class="line"><span class="keyword">CONNECT</span> lob_user<span class="operator">/</span>lob_password;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- create the tables</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> clob_content (</span><br><span class="line">  id          <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  clob_column <span class="type">CLOB</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> blob_content (</span><br><span class="line">  id          <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  blob_column <span class="type">BLOB</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> bfile_content (</span><br><span class="line">  id           <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  bfile_column BFILE <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> long_content (</span><br><span class="line">  id          <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  long_column LONG <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> long_raw_content (</span><br><span class="line">  id              <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  long_raw_column LONG RAW <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- populate tables with sample data</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> clob_content (</span><br><span class="line">  id, clob_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, TO_CLOB(<span class="string">&#x27;Creeps in this petty pace&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> clob_content (</span><br><span class="line">  id, clob_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, TO_CLOB(<span class="string">&#x27; from day to day&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blob_content (</span><br><span class="line">  id, blob_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, TO_BLOB(<span class="string">&#x27;100111010101011111&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> blob_content (</span><br><span class="line">  id, blob_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, TO_BLOB(<span class="string">&#x27;A0FFB71CF90DE&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bfile_content (</span><br><span class="line">  id, bfile_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, BFILENAME(<span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;textContent.txt&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> bfile_content (</span><br><span class="line">  id, bfile_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, BFILENAME(<span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;binaryContent.doc&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> long_content (</span><br><span class="line">  id, long_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, <span class="string">&#x27;Creeps in this petty pace&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> long_content (</span><br><span class="line">  id, long_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, <span class="string">&#x27; from day to day&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> long_raw_content (</span><br><span class="line">  id, long_raw_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">1</span>, <span class="string">&#x27;100111010101011111&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> long_raw_content (</span><br><span class="line">  id, long_raw_column</span><br><span class="line">) <span class="keyword">VALUES</span> (</span><br><span class="line">  <span class="number">2</span>, <span class="string">&#x27;A0FFB71CF90DE&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>textContent.txt 和 binaryContent.doc 文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">To-morrow, and to-morrow, and to-morrow,</span><br><span class="line">Creeps in this petty pace from day to day,</span><br><span class="line">To the last syllable of recorded time;</span><br><span class="line">And all our yesterdays have lighted fools</span><br><span class="line">The way to a dusty death. Out, out, brief candle!</span><br><span class="line">Life&#39;s but a walking shadow; a poor player,</span><br><span class="line">That struts and frets his hour upon the stage,</span><br><span class="line">And then is heard no more: it is a tale</span><br><span class="line">Told by an idiot, full of sound and fury,</span><br><span class="line">Signifying nothing.</span><br></pre></td></tr></table></figure>
<h2 id="检索-lob-定位器"><a class="markdownIt-Anchor" href="#检索-lob-定位器">#</a> 检索 LOB 定位器</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- create the PL/SQL code</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_clob_locator(</span><br><span class="line">  p_clob <span class="keyword">IN</span> <span class="keyword">OUT</span> <span class="type">CLOB</span>,</span><br><span class="line">  p_id   <span class="keyword">IN</span> <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator and store it in p_clob</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> p_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_id;</span><br><span class="line"><span class="keyword">END</span> get_clob_locator;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_blob_locator(</span><br><span class="line">  p_blob <span class="keyword">IN</span> <span class="keyword">OUT</span> <span class="type">BLOB</span>,</span><br><span class="line">  p_id   <span class="keyword">IN</span> <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator and store it in p_blob</span></span><br><span class="line">  <span class="keyword">SELECT</span> blob_column</span><br><span class="line">  <span class="keyword">INTO</span> p_blob</span><br><span class="line">  <span class="keyword">FROM</span> blob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_id;</span><br><span class="line"><span class="keyword">END</span> get_blob_locator;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>
<h2 id="从-clob-和-blob-读取数据"><a class="markdownIt-Anchor" href="#从-clob-和-blob-读取数据">#</a> 从 CLOB 和 BLOB 读取数据</h2>
<p>READ 方法用于将 LOB 数据读取到缓存区，各个版本的语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PROCEDURE</span> read(lob_loc <span class="keyword">IN</span>            <span class="type">BLOB</span>,</span><br><span class="line">               amount  <span class="keyword">IN</span> <span class="keyword">OUT</span> NOCOPY <span class="type">INTEGER</span>,</span><br><span class="line">               <span class="keyword">offset</span>  <span class="keyword">IN</span>            <span class="type">INTEGER</span>,</span><br><span class="line">               buffer  <span class="keyword">OUT</span>           RAW);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">PROCEDURE</span> read(lob_loc <span class="keyword">IN</span>            <span class="type">CLOB</span>     <span class="type">CHARACTER</span> <span class="keyword">SET</span> ANY_CS,</span><br><span class="line">                amount  <span class="keyword">IN</span> <span class="keyword">OUT</span> NOCOPY <span class="type">INTEGER</span>,</span><br><span class="line">                <span class="keyword">offset</span>  <span class="keyword">IN</span>            <span class="type">INTEGER</span>,</span><br><span class="line">                buffer  <span class="keyword">OUT</span>           VARCHAR2 <span class="type">CHARACTER</span> <span class="keyword">SET</span> lob_loc<span class="operator">%</span>CHARSET);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">PROCEDURE</span> read(file_loc <span class="keyword">IN</span>             BFILE,</span><br><span class="line">               amount   <span class="keyword">IN</span> <span class="keyword">OUT</span> NOCOPY  <span class="type">INTEGER</span>,</span><br><span class="line">               <span class="keyword">offset</span>   <span class="keyword">IN</span>             <span class="type">INTEGER</span>,</span><br><span class="line">               buffer   <span class="keyword">OUT</span>            RAW);</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li>lob_loc 是要读取的 CLOB、NCLOB 或 BLOB 数据。</li>
<li>file_loc 是要读取的 BFILE 数据。</li>
<li>amount 是要从 CLOB/NCLOB 数据中读取的最大字符数目，或是要从 BLOB/BFILE 数据中读取的最大字节数目。</li>
<li>offset 是开始读取的偏移量 (偏移量从 1 开始计算).</li>
<li>buffer 是 OUT 变量，用于存储从 LOB 对象中读取的数据。</li>
</ul>
<p>READ () 方法抛出的异常</p>
<table>
<thead>
<tr>
<th>异常</th>
<th>抛出条件</th>
</tr>
</thead>
<tbody>
<tr>
<td>VALUE_ERROR</td>
<td>任何一个输入参数为空值</td>
</tr>
<tr>
<td>INVALID_ARGVAL</td>
<td>只要满足如下条件之一：<br />- amount &lt; 1<br />- amount &gt; MAXBUFFERSIZE<br />- offset &lt; 1<br />- offset &gt; LOBMAXSIZE</td>
</tr>
<tr>
<td>NO_DATA_FOUND</td>
<td>到达 LOB 的末尾，LOB 中再无字节或字符可读取</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> read_clob_example(</span><br><span class="line">  p_id <span class="keyword">IN</span> <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">50</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">50</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator and store it in v_clob</span></span><br><span class="line">  get_clob_locator(v_clob, p_id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read the contents of v_clob into v_char_buffer, starting at</span></span><br><span class="line">  <span class="comment">-- the v_offset position and read a total of v_amount characters</span></span><br><span class="line">  DBMS_LOB.READ(v_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- display the contents of v_char_buffer</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_char_buffer = &#x27;</span> <span class="operator">||</span> v_char_buffer);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_amount = &#x27;</span> <span class="operator">||</span> v_amount);</span><br><span class="line"><span class="keyword">END</span> read_clob_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> read_clob_example(<span class="number">1</span>);</span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> read_blob_example(</span><br><span class="line">  p_id <span class="keyword">IN</span> <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_blob <span class="type">BLOB</span>;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line">  v_binary_buffer RAW(<span class="number">25</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator and store it in v_blob</span></span><br><span class="line">  get_blob_locator(v_blob, p_id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read the contents of v_blob into v_binary_buffer, starting at</span></span><br><span class="line">  <span class="comment">-- the v_offset position and read a total of v_amount bytes</span></span><br><span class="line">  DBMS_LOB.READ(v_blob, v_amount, v_offset, v_binary_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- display the contents of v_binary_buffer</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_binary_buffer = &#x27;</span> <span class="operator">||</span> v_binary_buffer);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_amount = &#x27;</span> <span class="operator">||</span> v_amount);</span><br><span class="line"><span class="keyword">END</span> read_blob_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> read_blob_example(<span class="number">1</span>);</span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_binary_buffer = 100111010101011111</span></span><br><span class="line"><span class="comment">-- v_amount = 9</span></span><br></pre></td></tr></table></figure>
<h2 id="向-clob-写数据"><a class="markdownIt-Anchor" href="#向-clob-写数据">#</a> 向 CLOB 写数据</h2>
<p>此过程中的 SELECT 语句使用了 FOR UPDATE 子句， 因为要使用 WRITE () 函数向 CLOB 写入数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> write_example(</span><br><span class="line">  p_id <span class="keyword">IN</span> <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">10</span>) :<span class="operator">=</span> <span class="string">&#x27;pretty&#x27;</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator into v_clob for update (for update</span></span><br><span class="line">  <span class="comment">-- because the LOB is written to using WRITE() later)</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_id</span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of the CLOB</span></span><br><span class="line">  read_clob_example(p_id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- write the characters in v_char_buffer to v_clob, starting </span></span><br><span class="line">  <span class="comment">-- at the v_offset position and write a total of v_amount characters</span></span><br><span class="line">  DBMS_LOB.WRITE(v_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of the CLOB</span></span><br><span class="line">  <span class="comment">-- and then rollback the write</span></span><br><span class="line">  read_clob_example(p_id);</span><br><span class="line">  <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span> write_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> write_example(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creepsprettyis petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br></pre></td></tr></table></figure>
<h2 id="向-clob-追加数据"><a class="markdownIt-Anchor" href="#向-clob-追加数据">#</a> 向 CLOB 追加数据</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> append_example <span class="keyword">AS</span></span><br><span class="line">  v_src_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_dest_clob <span class="type">CLOB</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator for the CLOB in row #2 of</span></span><br><span class="line">  <span class="comment">-- the clob_content table into v_src_clob</span></span><br><span class="line">  get_clob_locator(v_src_clob, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- get the LOB locator for the CLOB in row #1 of</span></span><br><span class="line">  <span class="comment">-- the clob_content table into v_dest_clob for update</span></span><br><span class="line">  <span class="comment">-- (for update because the CLOB will be added to using</span></span><br><span class="line">  <span class="comment">-- APPEND() later)</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_dest_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use APPEND() to copy the contents of v_src_clob to v_dest_clob</span></span><br><span class="line">  DBMS_LOB.APPEND(v_dest_clob, v_src_clob);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  <span class="comment">-- and then rollback the change</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span> append_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> append_example(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace from day to day</span></span><br><span class="line"><span class="comment">-- v_amount = 41</span></span><br></pre></td></tr></table></figure>
<h2 id="比较两个-cob-中的数据"><a class="markdownIt-Anchor" href="#比较两个-cob-中的数据">#</a> 比较两个 COB 中的数据</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> compare_example <span class="keyword">AS</span></span><br><span class="line">  v_clob1 <span class="type">CLOB</span>;</span><br><span class="line">  v_clob2 <span class="type">CLOB</span>;</span><br><span class="line">  v_return <span class="type">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locators</span></span><br><span class="line">  get_clob_locator(v_clob1, <span class="number">1</span>);</span><br><span class="line">  get_clob_locator(v_clob2, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- compare v_clob1 with v_clob2 (COMPARE() returns 1</span></span><br><span class="line">  <span class="comment">-- because the contents of v_clob1 and v_clob2 are different)</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Comparing v_clob1 with v_clob2&#x27;</span>);</span><br><span class="line">  v_return :<span class="operator">=</span> DBMS_LOB.COMPARE(v_clob1, v_clob2);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_return = &#x27;</span> <span class="operator">||</span> v_return);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- compare v_clob1 with v_clob1 (COMPARE() returns 0</span></span><br><span class="line">  <span class="comment">-- because the contents are the same)</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Comparing v_clob1 with v_clob1&#x27;</span>);</span><br><span class="line">  v_return :<span class="operator">=</span> DBMS_LOB.COMPARE(v_clob1, v_clob1);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_return = &#x27;</span> <span class="operator">||</span> v_return);</span><br><span class="line"><span class="keyword">END</span> compare_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> compare_example();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Comparing v_clob1 with v_clob2</span></span><br><span class="line"><span class="comment">-- v_return = 1</span></span><br><span class="line"><span class="comment">-- Comparing v_clob1 with v_clob1</span></span><br><span class="line"><span class="comment">-- v_return = 0</span></span><br></pre></td></tr></table></figure>
<h2 id="将数据从一个-clob-复制到另一个-clob"><a class="markdownIt-Anchor" href="#将数据从一个-clob-复制到另一个-clob">#</a> 将数据从一个 CLOB 复制到另一个 CLOB</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_example <span class="keyword">AS</span></span><br><span class="line">  v_src_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_dest_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_src_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_dest_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator for the CLOB in row #2 of</span></span><br><span class="line">  <span class="comment">-- the clob_content table into v_dest_clob</span></span><br><span class="line">  get_clob_locator(v_src_clob, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- get the LOB locator for the CLOB in row #1 of</span></span><br><span class="line">  <span class="comment">-- the clob_content table into v_dest_clob for update</span></span><br><span class="line">  <span class="comment">-- (for update because the CLOB will be added to using</span></span><br><span class="line">  <span class="comment">-- COPY() later)</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_dest_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- copy characters to v_dest_clob from v_src_clob using COPY(),</span></span><br><span class="line">  <span class="comment">-- starting at the offsets specified by v_dest_offset and</span></span><br><span class="line">  <span class="comment">-- v_src_offset for a total of v_amount characters</span></span><br><span class="line">  DBMS_LOB.COPY(</span><br><span class="line">    v_dest_clob, v_src_clob,</span><br><span class="line">    v_amount, v_dest_offset, v_src_offset</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  <span class="comment">-- and then rollback the change</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span> copy_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_example();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer =  from day to day</span></span><br><span class="line"><span class="comment">-- v_amount = 16</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creep from his petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="使用临时-clob"><a class="markdownIt-Anchor" href="#使用临时-clob">#</a> 使用临时 CLOB</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> temporary_lob_example <span class="keyword">AS</span></span><br><span class="line">  v_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span>;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">17</span>) :<span class="operator">=</span> <span class="string">&#x27;Juliet is the sun&#x27;</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- use CREATETEMPORARY() to create a temporary CLOB named v_clob</span></span><br><span class="line">  DBMS_LOB.CREATETEMPORARY(v_clob, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use WRITE() to write the contents of v_char_buffer to v_clob</span></span><br><span class="line">  v_amount :<span class="operator">=</span> LENGTH(v_char_buffer);</span><br><span class="line">  DBMS_LOB.WRITE(v_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use ISTEMPORARY() to check if v_clob is temporary</span></span><br><span class="line">  IF (DBMS_LOB.ISTEMPORARY(v_clob) <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">THEN</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_clob is temporary&#x27;</span>);</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use READ() to read the contents of v_clob into v_char_buffer</span></span><br><span class="line">  DBMS_LOB.READ(</span><br><span class="line">    v_clob, v_amount, v_offset, v_char_buffer</span><br><span class="line">  );</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_char_buffer = &#x27;</span> <span class="operator">||</span> v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use FREETEMPORARY() to free v_clob</span></span><br><span class="line">  DBMS_LOB.FREETEMPORARY(v_clob);</span><br><span class="line"><span class="keyword">END</span> temporary_lob_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> temporary_lob_example();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_clob is temporary</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Juliet is the sun</span></span><br></pre></td></tr></table></figure>
<h2 id="删除-clob-中的数据"><a class="markdownIt-Anchor" href="#删除-clob-中的数据">#</a> 删除 CLOB 中的数据</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> erase_example <span class="keyword">AS</span></span><br><span class="line">  v_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator for the CLOB in row #1 of</span></span><br><span class="line">  <span class="comment">-- the clob_content table into v_dest_clob for update</span></span><br><span class="line">  <span class="comment">-- (for update because the CLOB will be erased using</span></span><br><span class="line">  <span class="comment">-- ERASE() later)</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use ERASE() to erase a total of v_amount characters</span></span><br><span class="line">  <span class="comment">-- from v_clob, starting at v_offset</span></span><br><span class="line">  DBMS_LOB.ERASE(v_clob, v_amount, v_offset);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- read and display the contents of CLOB #1</span></span><br><span class="line">  <span class="comment">-- and then rollback the change</span></span><br><span class="line">  read_clob_example(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">END</span> erase_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> erase_example();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer = Creeps in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br><span class="line"><span class="comment">-- v_char_buffer = C      in this petty pace</span></span><br><span class="line"><span class="comment">-- v_amount = 25</span></span><br></pre></td></tr></table></figure>
<h2 id="搜索-clob-中的数据"><a class="markdownIt-Anchor" href="#搜索-clob-中的数据">#</a> 搜索 CLOB 中的数据</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> instr_example <span class="keyword">AS</span></span><br><span class="line">  v_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">50</span>) :<span class="operator">=</span> <span class="string">&#x27;It is the east and Juliet is the sun&#x27;</span>;</span><br><span class="line">  v_pattern VARCHAR2(<span class="number">5</span>);</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span>;</span><br><span class="line">  v_occurrence <span class="type">INTEGER</span>;</span><br><span class="line">  v_return <span class="type">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- use CREATETEMPORARY() to create a temporary CLOB named v_clob</span></span><br><span class="line">  DBMS_LOB.CREATETEMPORARY(v_clob, <span class="literal">TRUE</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use WRITE() to write the contents of v_char_buffer to v_clob</span></span><br><span class="line">  v_amount :<span class="operator">=</span> LENGTH(v_char_buffer);</span><br><span class="line">  DBMS_LOB.WRITE(v_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use READ() to read the contents of v_clob into v_char_buffer</span></span><br><span class="line">  DBMS_LOB.READ(v_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_char_buffer = &#x27;</span> <span class="operator">||</span> v_char_buffer);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use INSTR() to search v_clob for the second occurrence of is,</span></span><br><span class="line">  <span class="comment">-- and INSTR() returns 29</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Searching for second &#x27;&#x27;is&#x27;&#x27;&#x27;</span>);</span><br><span class="line">  v_pattern :<span class="operator">=</span> <span class="string">&#x27;is&#x27;</span>;</span><br><span class="line">  v_occurrence :<span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">  v_return :<span class="operator">=</span> DBMS_LOB.INSTR(v_clob, v_pattern, v_offset, v_occurrence);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_return = &#x27;</span> <span class="operator">||</span> v_return);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use INSTR() to search v_clob for the first occurrence of Moon,</span></span><br><span class="line">  <span class="comment">-- and INSTR() returns 0 because Moon doesn抰 appear in v_clob</span></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Searching for &#x27;&#x27;Moon&#x27;&#x27;&#x27;</span>);</span><br><span class="line">  v_pattern :<span class="operator">=</span> <span class="string">&#x27;Moon&#x27;</span>;</span><br><span class="line">  v_occurrence :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_return :<span class="operator">=</span> DBMS_LOB.INSTR(v_clob, v_pattern, v_offset, v_occurrence);</span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;v_return = &#x27;</span> <span class="operator">||</span> v_return);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use FREETEMPORARY() to free v_clob</span></span><br><span class="line">  DBMS_LOB.FREETEMPORARY(v_clob);</span><br><span class="line"><span class="keyword">END</span> instr_example;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> instr_example();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- v_char_buffer = It is the east and Juliet is the sun</span></span><br><span class="line"><span class="comment">-- Searching for second &#x27;is&#x27;</span></span><br><span class="line"><span class="comment">-- v_return = 27</span></span><br><span class="line"><span class="comment">-- Searching for &#x27;Moon&#x27;</span></span><br><span class="line"><span class="comment">-- v_return = 0</span></span><br></pre></td></tr></table></figure>
<h2 id="将数据从文件复制到-clob-和-blob-中"><a class="markdownIt-Anchor" href="#将数据从文件复制到-clob-和-blob-中">#</a> 将数据从文件复制到 CLOB 和 BLOB 中</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_file_data_to_clob(</span><br><span class="line">  p_clob_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_directory VARCHAR2,</span><br><span class="line">  p_file_name VARCHAR2</span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_file UTL_FILE.FILE_TYPE;</span><br><span class="line">  v_chars_read <span class="type">INTEGER</span>;</span><br><span class="line">  v_dest_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">32767</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- insert an empty CLOB</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> clob_content(</span><br><span class="line">    id, clob_column</span><br><span class="line">  ) <span class="keyword">VALUES</span> (</span><br><span class="line">    p_clob_id, EMPTY_CLOB()</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- get the LOB locator of the CLOB</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_dest_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_clob_id</span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- open the file for reading of text (up to v_amount characters per line)</span></span><br><span class="line">  v_file :<span class="operator">=</span> UTL_FILE.FOPEN(p_directory, p_file_name, <span class="string">&#x27;r&#x27;</span>, v_amount);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- copy the data from the file into v_dest_clob one line at a time</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      <span class="comment">-- read a line from the file into v_char_buffer;</span></span><br><span class="line">      <span class="comment">-- GET_LINE() does not copy the newline character into</span></span><br><span class="line">      <span class="comment">-- v_char_buffer</span></span><br><span class="line">      UTL_FILE.GET_LINE(v_file, v_char_buffer);</span><br><span class="line">      v_chars_read :<span class="operator">=</span> LENGTH(v_char_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- append the line to v_dest_clob</span></span><br><span class="line">      DBMS_LOB.WRITEAPPEND(v_dest_clob, v_chars_read, v_char_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- append a newline to v_dest_clob because v_char_buffer;</span></span><br><span class="line">      <span class="comment">-- the ASCII value for newline is 10, so CHR(10) returns newline</span></span><br><span class="line">      DBMS_LOB.WRITEAPPEND(v_dest_clob, <span class="number">1</span>, CHR(<span class="number">10</span>));</span><br><span class="line">    EXCEPTION</span><br><span class="line">      <span class="comment">-- when there is no more data in the file then exit</span></span><br><span class="line">      <span class="keyword">WHEN</span> NO_DATA_FOUND <span class="keyword">THEN</span></span><br><span class="line">        EXIT;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- close the file</span></span><br><span class="line">  UTL_FILE.FCLOSE(v_file);</span><br><span class="line"></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> copy_file_data_to_clob;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_file_data_to_clob(<span class="number">3</span>, <span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;textContent.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Copy successfully completed.</span></span><br></pre></td></tr></table></figure>
<img data-src="/2021/11/15/oracle-lob/1636964572959.png" class="" width="1636964572959">
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_file_data_to_blob(</span><br><span class="line">  p_blob_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_directory VARCHAR2,</span><br><span class="line">  p_file_name VARCHAR2</span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_file UTL_FILE.FILE_TYPE;</span><br><span class="line">  v_bytes_read <span class="type">INTEGER</span>;</span><br><span class="line">  v_dest_blob <span class="type">BLOB</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">32767</span>;</span><br><span class="line">  v_binary_buffer RAW(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- insert an empty BLOB</span></span><br><span class="line">  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> blob_content(</span><br><span class="line">    id, blob_column</span><br><span class="line">  ) <span class="keyword">VALUES</span> (</span><br><span class="line">    p_blob_id, EMPTY_BLOB()</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- get the LOB locator of the BLOB</span></span><br><span class="line">  <span class="keyword">SELECT</span> blob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_dest_blob</span><br><span class="line">  <span class="keyword">FROM</span> blob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_blob_id</span><br><span class="line">  <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- open the file for reading of bytes (up to v_amount bytes at a time)</span></span><br><span class="line">  v_file :<span class="operator">=</span> UTL_FILE.FOPEN(p_directory, p_file_name, <span class="string">&#x27;rb&#x27;</span>, v_amount);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- copy the data from the file into v_dest_blob</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      <span class="comment">-- read binary data from the file into v_binary_buffer</span></span><br><span class="line">      UTL_FILE.GET_RAW(v_file, v_binary_buffer, v_amount);</span><br><span class="line">      v_bytes_read :<span class="operator">=</span> LENGTH(v_binary_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- append v_binary_buffer to v_dest_blob</span></span><br><span class="line">      DBMS_LOB.WRITEAPPEND(v_dest_blob, v_bytes_read<span class="operator">/</span><span class="number">2</span>,</span><br><span class="line">        v_binary_buffer);</span><br><span class="line">    EXCEPTION</span><br><span class="line">      <span class="comment">-- when there is no more data in the file then exit</span></span><br><span class="line">      <span class="keyword">WHEN</span> NO_DATA_FOUND <span class="keyword">THEN</span></span><br><span class="line">        EXIT;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- close the file</span></span><br><span class="line">  UTL_FILE.FCLOSE(v_file);</span><br><span class="line"></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> copy_file_data_to_blob;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_file_data_to_blob(<span class="number">3</span>, <span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;binaryContent.doc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Copy successfully completed.</span></span><br></pre></td></tr></table></figure>
<img data-src="/2021/11/15/oracle-lob/1636963829759.png" class="" width="1636963829759">
<h2 id="将数据从-clob-和-blob-复制到文件"><a class="markdownIt-Anchor" href="#将数据从-clob-和-blob-复制到文件">#</a> 将数据从 CLOB 和 BLOB 复制到文件</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_clob_data_to_file(</span><br><span class="line">  p_clob_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_directory VARCHAR2,</span><br><span class="line">  p_file_name VARCHAR2</span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_src_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_file UTL_FILE.FILE_TYPE;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">32767</span>;</span><br><span class="line">  v_char_buffer VARCHAR2(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator of the CLOB</span></span><br><span class="line">  <span class="keyword">SELECT</span> clob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_src_clob</span><br><span class="line">  <span class="keyword">FROM</span> clob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_clob_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- open the file for writing of text (up to v_amount characters at a time)</span></span><br><span class="line">  v_file :<span class="operator">=</span> UTL_FILE.FOPEN(p_directory, p_file_name, <span class="string">&#x27;w&#x27;</span>, v_amount);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- copy the data from v_src_clob to the file</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      <span class="comment">-- read characters from v_src_clob into v_char_buffer</span></span><br><span class="line">      DBMS_LOB.READ(v_src_clob, v_amount, v_offset, v_char_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- copy the characters from v_char_buffer to the file</span></span><br><span class="line">      UTL_FILE.PUT(v_file, v_char_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- add v_amount to v_offset</span></span><br><span class="line">      v_offset :<span class="operator">=</span> v_offset <span class="operator">+</span> v_amount;</span><br><span class="line">    EXCEPTION</span><br><span class="line">      <span class="comment">-- when there is no more data in the file then exit</span></span><br><span class="line">      <span class="keyword">WHEN</span> NO_DATA_FOUND <span class="keyword">THEN</span></span><br><span class="line">        EXIT;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- flush any remaining data to the file</span></span><br><span class="line">  UTL_FILE.FFLUSH(v_file);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- close the file</span></span><br><span class="line">  UTL_FILE.FCLOSE(v_file);</span><br><span class="line"></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> copy_clob_data_to_file;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_clob_data_to_file(<span class="number">3</span>, <span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;textContent2.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Copy successfully completed.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_blob_data_to_file(</span><br><span class="line">  p_blob_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_directory VARCHAR2,</span><br><span class="line">  p_file_name VARCHAR2</span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_src_blob <span class="type">BLOB</span>;</span><br><span class="line">  v_file UTL_FILE.FILE_TYPE;</span><br><span class="line">  v_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">32767</span>;</span><br><span class="line">  v_binary_buffer RAW(<span class="number">32767</span>);</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the LOB locator of the BLOB</span></span><br><span class="line">  <span class="keyword">SELECT</span> blob_column</span><br><span class="line">  <span class="keyword">INTO</span> v_src_blob</span><br><span class="line">  <span class="keyword">FROM</span> blob_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_blob_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- open the file for writing of bytes (up to v_amount bytes at a time)</span></span><br><span class="line">  v_file :<span class="operator">=</span> UTL_FILE.FOPEN(p_directory, p_file_name, <span class="string">&#x27;wb&#x27;</span>, v_amount);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- copy the data from v_src_blob to the file</span></span><br><span class="line">  LOOP</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">      <span class="comment">-- read characters from v_src_blob into v_binary_buffer</span></span><br><span class="line">      DBMS_LOB.READ(v_src_blob, v_amount, v_offset, v_binary_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- copy the binary data from v_binary_buffer to the file</span></span><br><span class="line">      UTL_FILE.PUT_RAW(v_file, v_binary_buffer);</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- add v_amount to v_offset</span></span><br><span class="line">      v_offset :<span class="operator">=</span> v_offset <span class="operator">+</span> v_amount;</span><br><span class="line">    EXCEPTION</span><br><span class="line">      <span class="comment">-- when there is no more data in the file then exit</span></span><br><span class="line">      <span class="keyword">WHEN</span> NO_DATA_FOUND <span class="keyword">THEN</span></span><br><span class="line">        EXIT;</span><br><span class="line">    <span class="keyword">END</span>;</span><br><span class="line">  <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- flush any remaining data to the file</span></span><br><span class="line">  UTL_FILE.FFLUSH(v_file);</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- close the file</span></span><br><span class="line">  UTL_FILE.FCLOSE(v_file);</span><br><span class="line"></span><br><span class="line">  DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> copy_blob_data_to_file;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_file_data_to_blob(<span class="number">3</span>, <span class="string">&#x27;SAMPLE_FILES_DIR&#x27;</span>, <span class="string">&#x27;binaryContent2.doc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Copy successfully completed.</span></span><br></pre></td></tr></table></figure>
<h2 id="将数据从-bfile-复制到-clob-和-blob-中"><a class="markdownIt-Anchor" href="#将数据从-bfile-复制到-clob-和-blob-中">#</a> 将数据从 BFILE 复制到 CLOB 和 BLOB 中</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_bfile_data_to_clob(</span><br><span class="line">  p_bfile_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_clob_id <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_src_bfile BFILE;</span><br><span class="line">  v_directory VARCHAR2(<span class="number">200</span>);</span><br><span class="line">  v_filename VARCHAR2(<span class="number">200</span>);</span><br><span class="line">  v_length <span class="type">INTEGER</span>;</span><br><span class="line">  v_dest_clob <span class="type">CLOB</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> DBMS_LOB.LOBMAXSIZE;</span><br><span class="line">  v_dest_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_src_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_src_csid <span class="type">INTEGER</span> :<span class="operator">=</span> DBMS_LOB.DEFAULT_CSID;</span><br><span class="line">  v_lang_context <span class="type">INTEGER</span> :<span class="operator">=</span> DBMS_LOB.DEFAULT_LANG_CTX;</span><br><span class="line">  v_warning <span class="type">INTEGER</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the locator of the BFILE</span></span><br><span class="line">  <span class="keyword">SELECT</span> bfile_column</span><br><span class="line">  <span class="keyword">INTO</span> v_src_bfile</span><br><span class="line">  <span class="keyword">FROM</span> bfile_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_bfile_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use FILEEXISTS() to check if the file exists</span></span><br><span class="line">  <span class="comment">-- (FILEEXISTS() returns 1 if the file exists)</span></span><br><span class="line">  IF (DBMS_LOB.FILEEXISTS(v_src_bfile) <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">THEN</span></span><br><span class="line">    <span class="comment">-- use OPEN() to open the file</span></span><br><span class="line">    DBMS_LOB.OPEN(v_src_bfile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use FILEGETNAME() to get the name of the file and the directory</span></span><br><span class="line">    DBMS_LOB.FILEGETNAME(v_src_bfile, v_directory, v_filename);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Directory = &#x27;</span> <span class="operator">||</span> v_directory);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Filename = &#x27;</span> <span class="operator">||</span> v_filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- insert an empty CLOB</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> clob_content(</span><br><span class="line">      id, clob_column</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">      p_clob_id, EMPTY_CLOB()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- get the LOB locator of the CLOB (for update)</span></span><br><span class="line">    <span class="keyword">SELECT</span> clob_column</span><br><span class="line">    <span class="keyword">INTO</span> v_dest_clob</span><br><span class="line">    <span class="keyword">FROM</span> clob_content</span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> p_clob_id</span><br><span class="line">    <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use LOADCLOBFROMFILE() to get up to v_amount characters</span></span><br><span class="line">    <span class="comment">-- from v_src_bfile and store them in v_dest_clob, starting</span></span><br><span class="line">    <span class="comment">-- at offset 1 in v_src_bfile and v_dest_clob</span></span><br><span class="line">    DBMS_LOB.LOADCLOBFROMFILE(</span><br><span class="line">      v_dest_clob, v_src_bfile,</span><br><span class="line">      v_amount, v_dest_offset, v_src_offset,</span><br><span class="line">      v_src_csid, v_lang_context, v_warning</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- check v_warning for an inconvertible character</span></span><br><span class="line">    IF (v_warning <span class="operator">=</span> DBMS_LOB.WARN_INCONVERTIBLE_CHAR) <span class="keyword">THEN</span></span><br><span class="line">      DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Warning! Inconvertible character.&#x27;</span>);</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use CLOSE() to close v_src_bfile</span></span><br><span class="line">    DBMS_LOB.CLOSE(v_src_bfile);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line">  <span class="keyword">ELSE</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;File does not exist&#x27;</span>);</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> copy_bfile_data_to_clob;</span><br><span class="line"><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> copy_bfile_data_to_clob(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Result</span></span><br><span class="line"><span class="comment">-- Copy successfully completed.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> copy_bfile_data_to_blob(</span><br><span class="line">  p_bfile_id <span class="type">INTEGER</span>,</span><br><span class="line">  p_blob_id <span class="type">INTEGER</span></span><br><span class="line">) <span class="keyword">AS</span></span><br><span class="line">  v_src_bfile BFILE;</span><br><span class="line">  v_directory VARCHAR2(<span class="number">200</span>);</span><br><span class="line">  v_filename VARCHAR2(<span class="number">200</span>);</span><br><span class="line">  v_length <span class="type">INTEGER</span>;</span><br><span class="line">  v_dest_blob <span class="type">BLOB</span>;</span><br><span class="line">  v_amount <span class="type">INTEGER</span> :<span class="operator">=</span> DBMS_LOB.LOBMAXSIZE;</span><br><span class="line">  v_dest_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">  v_src_offset <span class="type">INTEGER</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="comment">-- get the locator of the BFILE</span></span><br><span class="line">  <span class="keyword">SELECT</span> bfile_column</span><br><span class="line">  <span class="keyword">INTO</span> v_src_bfile</span><br><span class="line">  <span class="keyword">FROM</span> bfile_content</span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> p_bfile_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">-- use FILEEXISTS() to check if the file exists</span></span><br><span class="line">  <span class="comment">-- (FILEEXISTS() returns 1 if the file exists)</span></span><br><span class="line">  IF (DBMS_LOB.FILEEXISTS(v_src_bfile) <span class="operator">=</span> <span class="number">1</span>) <span class="keyword">THEN</span></span><br><span class="line">    <span class="comment">-- use OPEN() to open the file</span></span><br><span class="line">    DBMS_LOB.OPEN(v_src_bfile);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use FILEGETNAME() to get the name of the file and</span></span><br><span class="line">    <span class="comment">-- the directory</span></span><br><span class="line">    DBMS_LOB.FILEGETNAME(v_src_bfile, v_directory, v_filename);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Directory = &#x27;</span> <span class="operator">||</span> v_directory);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Filename = &#x27;</span> <span class="operator">||</span> v_filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- insert an empty BLOB</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> blob_content(</span><br><span class="line">      id, blob_column</span><br><span class="line">    ) <span class="keyword">VALUES</span> (</span><br><span class="line">      p_blob_id, EMPTY_BLOB()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- get the LOB locator of the BLOB (for update)</span></span><br><span class="line">    <span class="keyword">SELECT</span> blob_column</span><br><span class="line">    <span class="keyword">INTO</span> v_dest_blob</span><br><span class="line">    <span class="keyword">FROM</span> blob_content</span><br><span class="line">    <span class="keyword">WHERE</span> id <span class="operator">=</span> p_blob_id</span><br><span class="line">    <span class="keyword">FOR</span> UPDATE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use LOADBLOBFROMFILE() to get up to v_amount bytes</span></span><br><span class="line">    <span class="comment">-- from v_src_bfile and store them in v_dest_blob, starting</span></span><br><span class="line">    <span class="comment">-- at offset 1 in v_src_bfile and v_dest_blob</span></span><br><span class="line">    DBMS_LOB.LOADBLOBFROMFILE(</span><br><span class="line">      v_dest_blob, v_src_bfile,</span><br><span class="line">      v_amount, v_dest_offset, v_src_offset</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- use CLOSE() to close v_src_bfile</span></span><br><span class="line">    DBMS_LOB.CLOSE(v_src_bfile);</span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;Copy successfully completed.&#x27;</span>);</span><br><span class="line">  <span class="keyword">ELSE</span></span><br><span class="line">    DBMS_OUTPUT.PUT_LINE(<span class="string">&#x27;File does not exist&#x27;</span>);</span><br><span class="line">  <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> copy_bfile_data_to_blob;</span><br><span class="line"><span class="operator">/</span></span><br></pre></td></tr></table></figure>

      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2021-11-15 16:43:53" itemprop="dateModified" datetime="2021-11-15T16:43:53+08:00">2021-11-15</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2021/11/09/c-dynamic-array/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeubcbajj20zk0m8h1h.jpg" title="C Dynamic Array">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>C Dynamic Array</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2021/12/07/sql-basic/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4lm9i7j20zk0m84qp.jpg" title="SQL Basic">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>SQL Basic</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B-lob"><span class="toc-number">1.</span> <span class="toc-text"> 大对象类型 LOB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8C%85%E5%90%AB%E5%A4%A7%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A1%A8"><span class="toc-number">2.</span> <span class="toc-text"> 创建包含大对象的表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2-lob-%E5%AE%9A%E4%BD%8D%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text"> 检索 LOB 定位器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E-clob-%E5%92%8C-blob-%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">4.</span> <span class="toc-text"> 从 CLOB 和 BLOB 读取数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%91-clob-%E5%86%99%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text"> 向 CLOB 写数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%91-clob-%E8%BF%BD%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">6.</span> <span class="toc-text"> 向 CLOB 追加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA-cob-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">7.</span> <span class="toc-text"> 比较两个 COB 中的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BB%8E%E4%B8%80%E4%B8%AA-clob-%E5%A4%8D%E5%88%B6%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA-clob"><span class="toc-number">8.</span> <span class="toc-text"> 将数据从一个 CLOB 复制到另一个 CLOB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%B4%E6%97%B6-clob"><span class="toc-number">9.</span> <span class="toc-text"> 使用临时 CLOB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4-clob-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">10.</span> <span class="toc-text"> 删除 CLOB 中的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2-clob-%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">11.</span> <span class="toc-text"> 搜索 CLOB 中的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BB%8E%E6%96%87%E4%BB%B6%E5%A4%8D%E5%88%B6%E5%88%B0-clob-%E5%92%8C-blob-%E4%B8%AD"><span class="toc-number">12.</span> <span class="toc-text"> 将数据从文件复制到 CLOB 和 BLOB 中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BB%8E-clob-%E5%92%8C-blob-%E5%A4%8D%E5%88%B6%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">13.</span> <span class="toc-text"> 将数据从 CLOB 和 BLOB 复制到文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E4%BB%8E-bfile-%E5%A4%8D%E5%88%B6%E5%88%B0-clob-%E5%92%8C-blob-%E4%B8%AD"><span class="toc-number">14.</span> <span class="toc-text"> 将数据从 BFILE 复制到 CLOB 和 BLOB 中</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">278</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">39</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2021/11/09/c-dynamic-array/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2021/12/07/sql-basic/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2022</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ 露の世</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2021/11/15/oracle-lob/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
