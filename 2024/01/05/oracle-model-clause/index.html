



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="露の世" href="https://lhchen74.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="露の世" href="https://lhchen74.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="露の世" href="https://lhchen74.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CFira%20Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="db" />


<link rel="canonical" href="https://lhchen74.github.io/2024/01/05/oracle-model-clause/">



  <title>
Oracle MODEL Clause |
D E W = 露の世</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Oracle MODEL Clause
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-01-05 00:00:00">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-01-05T00:00:00+08:00">2024-01-05</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">D E W</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="/anime/index/辉夜大小姐想让我告白.jpg"></li>
          <li class="item" data-background-image="/anime/index/昭和元禄落语心中-2.jpg"></li>
          <li class="item" data-background-image="/anime/index/动物狂想曲-1.jpg"></li>
          <li class="item" data-background-image="/anime/index/薄樱鬼.jpg"></li>
          <li class="item" data-background-image="/anime/index/刺客伍六七.jpg"></li>
          <li class="item" data-background-image="/anime/index/灰与幻想的格林姆迦尔.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://lhchen74.github.io/2024/01/05/oracle-model-clause/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="江边鸟">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="露の世">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <blockquote>
<p>repost: <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjYzLmh0bWw=">SQL Features Tutorials: MODEL Clause</span></p>
</blockquote>
<h2 id="model-clause"><a class="markdownIt-Anchor" href="#model-clause">#</a> MODEL Clause</h2>
<p>This section presents tutorials on the MODEL clause of the SELECT command. Introduced in Oracle 10g, the MODEL clause is a powerful feature that gives you the ability to change any cell in the query’s result set using data from any other cell (similar to the way a spreadsheet works). It also adds procedural features to SQL previously available only through PL/SQL calls.</p>
<p>For example, with MODEL you can take a simple table like this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY GROUP_1    GROUP_2    DATE_VAL   NUM_VAL</span><br><span class="line">------ ---------- ---------- ---------- -------</span><br><span class="line">     1 A          a1         2005-01-01     100</span><br><span class="line">     2 A          a2         2005-06-12     200</span><br><span class="line">     3 A          a3                        300</span><br><span class="line">     4 B          a1         2006-02-01</span><br><span class="line">     5 B          a2         2006-06-12     300</span><br><span class="line">     6 B          a3         2005-01-01     100</span><br><span class="line">     7 C          a1         2006-06-12     100</span><br><span class="line">     8 C          a2</span><br><span class="line">     9            a1         2005-02-01     200</span><br><span class="line">    10            a2         2005-02-01     800</span><br></pre></td></tr></table></figure>
<p>and, with a single command, create a report containing ad-hoc totals like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">null</span> &quot;&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">when</span> key <span class="keyword">like</span> <span class="string">&#x27;Total%&#x27;</span> <span class="keyword">then</span> key <span class="keyword">else</span> <span class="keyword">null</span> <span class="keyword">end</span> <span class="keyword">as</span> total ,</span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span></span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">cast</span>(key <span class="keyword">as</span> varchar2(<span class="number">20</span>)) <span class="keyword">as</span> key ,</span><br><span class="line">    nvl( group_1, <span class="string">&#x27;n/a&#x27;</span> )  <span class="keyword">as</span> group_1 ,</span><br><span class="line">    nvl( group_2, <span class="string">&#x27;n/a&#x27;</span> )  <span class="keyword">as</span> group_2</span><br><span class="line">  )</span><br><span class="line">  measures( num_val )</span><br><span class="line">  rules</span><br><span class="line">  ( num_val[ <span class="string">&#x27;Total 1 - A + C&#x27;</span>, <span class="keyword">null</span>, <span class="keyword">null</span> ] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">sum</span>(num_val)[<span class="keyword">any</span>,group_1 <span class="keyword">in</span> (<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;C&#x27;</span>),<span class="keyword">any</span>]</span><br><span class="line">      ,</span><br><span class="line">    num_val[ <span class="string">&#x27;Total 2 - A + a2&#x27;</span>, <span class="keyword">null</span>, <span class="keyword">null</span> ] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">sum</span>(num_val)[<span class="keyword">any</span>,<span class="string">&#x27;A&#x27;</span>,<span class="keyword">any</span>] <span class="operator">+</span></span><br><span class="line">      <span class="built_in">sum</span>(num_val)[<span class="keyword">any</span>,group_1 <span class="operator">&lt;&gt;</span> <span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;a2&#x27;</span>]</span><br><span class="line">      ,</span><br><span class="line">    num_val[ <span class="string">&#x27;Total 3 - n/a&#x27;</span>, <span class="keyword">null</span>, <span class="keyword">null</span> ] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">sum</span>(num_val)[<span class="keyword">any</span>,<span class="string">&#x27;n/a&#x27;</span>,<span class="keyword">any</span>]</span><br><span class="line">      ,</span><br><span class="line">    num_val[ <span class="string">&#x27;Total 4 - a1 + a3&#x27;</span>, <span class="keyword">null</span>, <span class="keyword">null</span> ] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">sum</span>(num_val)[<span class="keyword">any</span>,<span class="keyword">any</span>,group_2 <span class="keyword">in</span> (<span class="string">&#x27;a1&#x27;</span>,<span class="string">&#x27;a3&#x27;</span>)]</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  total nulls <span class="keyword">first</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TOTAL                GROUP_1    GROUP_2    NUM_VAL</span><br><span class="line">-------------------- ---------- ---------- -------</span><br><span class="line">                     A          a1             100</span><br><span class="line">                     A          a2             200</span><br><span class="line">                     A          a3             300</span><br><span class="line">                     B          a1</span><br><span class="line">                     B          a2             300</span><br><span class="line">                     B          a3             100</span><br><span class="line">                     C          a1             100</span><br><span class="line">                     C          a2</span><br><span class="line">                     n&#x2F;a        a1             200</span><br><span class="line">                     n&#x2F;a        a2             800</span><br><span class="line">Total 1 - A + C                                700</span><br><span class="line">Total 2 - A + a2                              1700</span><br><span class="line">Total 3 - n&#x2F;a                                 1000</span><br><span class="line">Total 4 - a1 + a3                              800</span><br></pre></td></tr></table></figure>
<p>You can also use MODEL’S procedural features to produce results that are difficult, inefficient, or impossible to do with a non-MODEL SELECT command. Here is an example.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">null</span> &quot;(null)&quot;</span><br><span class="line"><span class="keyword">column</span> string format a40</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> group_1, substr( string, <span class="number">2</span> ) <span class="keyword">as</span> string</span><br><span class="line"><span class="keyword">from</span>   t</span><br><span class="line"><span class="keyword">where</span>  num_val <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line">model</span><br><span class="line">  <span class="keyword">return</span> updated <span class="keyword">rows</span></span><br><span class="line">  <span class="keyword">partition</span> <span class="keyword">by</span> ( group_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> group_1 <span class="keyword">order</span> <span class="keyword">by</span> num_val) <span class="keyword">as</span> position )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( num_val <span class="keyword">as</span> varchar2(<span class="number">65</span>) ) <span class="keyword">as</span> string  ) <span class="comment">-- Note 1</span></span><br><span class="line">  rules</span><br><span class="line">    upsert</span><br><span class="line">    iterate( <span class="number">6</span> )</span><br><span class="line">      until ( presentv(string[iteration_number<span class="operator">+</span><span class="number">2</span>],<span class="number">1</span>,<span class="number">0</span>) <span class="operator">=</span> <span class="number">0</span> )</span><br><span class="line">    ( string[<span class="number">0</span>] <span class="operator">=</span> string[<span class="number">0</span>] <span class="operator">||</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">||</span> string[iteration_number<span class="operator">+</span><span class="number">1</span>] )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> group_1 ;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    STRING</span><br><span class="line">---------- ----------------------------------------</span><br><span class="line">A          100,200,300</span><br><span class="line">B          100,300</span><br><span class="line">C          100</span><br><span class="line">(null)     200,800</span><br></pre></td></tr></table></figure>
<p>(This last technique is explained fully in another section of SQL Snippets at <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTEyMDkyLmh0bWw=">Rows to String: MODEL Method 1</span>.)</p>
<p>Though powerful, the MODEL clause is also somewhat complex and this can be intimidating when you read about it for the first time. The tutorials to follow will therefore present very simple MODEL examples to help you quickly become comfortable with its many features.</p>
<p>Before continuing it is important to know that everything in the MODEL clause is evaluated <strong><em>after</em></strong> all other clauses in the query, except for SELECT DISTINCT and ORDER BY. Knowing this will help you better understand the examples in this section’s tutorials.</p>
<h2 id="dimension-by"><a class="markdownIt-Anchor" href="#dimension-by">#</a> DIMENSION BY</h2>
<p>In this tutorial we learn about the DIMENSION BY component of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause.</p>
<p>DIMENSION BY specifies which columns in a SELECT statement are dimension columns, which for our purposes can be thought of as any column that serves to identify each row in the result of a SELECT statement. By default, the dimension columns in a MODEL clause must produce a unique key for the result set. See the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvZ2xvc3NhcnkuaHRtI2k0MzE5OTI=">Oracle® Database Data Warehousing Guide 10g Release 2 (10.2) - Glossary</span> for a formal definition.</p>
<p>Before we begin please note that, on its own, DIMENSION BY has little visible effect on the output of the SELECT statement. Most of the examples below would produce the same result as one with no MODEL clause at all. This is because we are not trying to manipulate the results just yet. We are simply seeing how to specify our dimension columns, which is a precursor for learning to manipulate results in subsequent pages.</p>
<p>Consider the following table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key     ,</span><br><span class="line">  key_2   ,</span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2 GROUP_1    GROUP_2    NUM_VAL</span><br><span class="line">------ ----- ---------- ---------- -------</span><br><span class="line">     1 T-1   A          a1             100</span><br><span class="line">     2 T-2   A          a2             200</span><br><span class="line">     3 T-3   A          a3             300</span><br><span class="line">     4 T-4   B          a1</span><br><span class="line">     5 T-5   B          a2             300</span><br><span class="line">     6 T-6   B          a3             100</span><br><span class="line">     7 T-7   C          a1             100</span><br><span class="line">     8 T-8   C          a2</span><br><span class="line">     9 T-9              a1             200</span><br><span class="line">    10 T-10             a2             800</span><br></pre></td></tr></table></figure>
<p>We see that KEY, KEY_2, and (GROUP_1, GROUP_2) all uniquely identify each row in the table. They are therefore dimension column candidates. To let Oracle know which column(s) we plan to use as dimensions we compose a MODEL clause like this. (Ignore the MEASURES and RULES clauses for now. We will explore those later.)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( KEY )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL</span><br><span class="line">------ -------</span><br><span class="line">     1     100</span><br><span class="line">     2     200</span><br><span class="line">     3     300</span><br><span class="line">     4</span><br><span class="line">     5     300</span><br><span class="line">     6     100</span><br><span class="line">     7     100</span><br><span class="line">     8</span><br><span class="line">     9     200</span><br><span class="line">    10     800</span><br></pre></td></tr></table></figure>
<h3 id="multiple-dimensions"><a class="markdownIt-Anchor" href="#multiple-dimensions">#</a> Multiple Dimensions</h3>
<p>If needed, you can define more than one dimension column, as this example shows.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( GROUP_1, GROUP_2 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL</span><br><span class="line">---------- ---------- -------</span><br><span class="line">A          a1             100</span><br><span class="line">A          a2             200</span><br><span class="line">A          a3             300</span><br><span class="line">B          a1</span><br><span class="line">B          a2             300</span><br><span class="line">B          a3             100</span><br><span class="line">C          a1             100</span><br><span class="line">C          a2</span><br><span class="line">           a1             200</span><br><span class="line">           a2             800</span><br></pre></td></tr></table></figure>
<p>You can even include columns in the DIMENSION BY clause which are not required to uniquely identify each result row.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  date_val ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( KEY, DATE_VAL ) <span class="comment">-- date_val not required to uniquely identify row</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY DATE_VAL   NUM_VAL</span><br><span class="line">------ ---------- -------</span><br><span class="line">     1 2005-01-01     100</span><br><span class="line">     2 2005-06-12     200</span><br><span class="line">     3                300</span><br><span class="line">     4 2006-02-01</span><br><span class="line">     5 2006-06-12     300</span><br><span class="line">     6 2005-01-01     100</span><br><span class="line">     7 2006-06-12     100</span><br><span class="line">     8</span><br><span class="line">     9 2005-02-01     200</span><br><span class="line">    10 2005-02-01     800</span><br></pre></td></tr></table></figure>
<h3 id="aliasing"><a class="markdownIt-Anchor" href="#aliasing">#</a> Aliasing</h3>
<p>You cannot use SELECT clause aliases in DIMENSION BY. Here are some examples of aliases that will cause errors.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  KEY <span class="keyword">AS</span> KEY_3 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line">;</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">7</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: &quot;KEY_3&quot;: invalid identifier</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  KEY <span class="operator">*</span> <span class="number">10</span> <span class="keyword">AS</span> KEY_3 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line">;</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">7</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: &quot;KEY_3&quot;: invalid identifier</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  ROWNUM <span class="keyword">AS</span> KEY_3 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line">;</span><br><span class="line">  dimension <span class="keyword">by</span> ( KEY_3 )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">7</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: &quot;KEY_3&quot;: invalid identifier</span><br></pre></td></tr></table></figure>
<p>You <strong><em>can</em></strong> however alias such expressions directly in DIMENSION BY.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  KEY_3,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( KEY <span class="keyword">AS</span> KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key_3</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">     KEY_3 NUM_VAL</span><br><span class="line">---------- -------</span><br><span class="line">         1     100</span><br><span class="line">         2     200</span><br><span class="line">         3     300</span><br><span class="line">         4</span><br><span class="line">         5     300</span><br><span class="line">         6     100</span><br><span class="line">         7     100</span><br><span class="line">         8</span><br><span class="line">         9     200</span><br><span class="line">        10     800</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  KEY_3,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( KEY <span class="operator">*</span> <span class="number">10</span> <span class="keyword">AS</span> KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key_3</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">     KEY_3 NUM_VAL</span><br><span class="line">---------- -------</span><br><span class="line">        10     100</span><br><span class="line">        20     200</span><br><span class="line">        30     300</span><br><span class="line">        40</span><br><span class="line">        50     300</span><br><span class="line">        60     100</span><br><span class="line">        70     100</span><br><span class="line">        80</span><br><span class="line">        90     200</span><br><span class="line">       100     800</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  KEY_3,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( ROWNUM <span class="keyword">AS</span> KEY_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key_3</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">     KEY_3 NUM_VAL</span><br><span class="line">---------- -------</span><br><span class="line">         1     100</span><br><span class="line">         2     200</span><br><span class="line">         3     300</span><br><span class="line">         4</span><br><span class="line">         5     300</span><br><span class="line">         6     100</span><br><span class="line">         7     100</span><br><span class="line">         8</span><br><span class="line">         9     200</span><br><span class="line">        10     800</span><br></pre></td></tr></table></figure>
<h3 id="uniqueness"><a class="markdownIt-Anchor" href="#uniqueness">#</a> Uniqueness</h3>
<p>By default, if your DIMENSION BY columns do not give you a unique key for your result set you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( GROUP_2 ) <span class="comment">-- group_2 is not unique</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_2</span><br><span class="line">;</span><br><span class="line">  t</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">5</span>:</span><br><span class="line">ORA<span class="number">-32638</span>: Non <span class="keyword">unique</span> addressing <span class="keyword">in</span> MODEL dimensions</span><br></pre></td></tr></table></figure>
<p>This rule can be relaxed somewhat by specifying UNIQUE SINGLE REFERENCE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model <span class="keyword">UNIQUE</span> SINGLE REFERENCE</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )     <span class="comment">-- group_2 is not unique</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_2    NUM_VAL</span><br><span class="line">---------- -------</span><br><span class="line">a1             100</span><br><span class="line">a1             100</span><br><span class="line">a1             200</span><br><span class="line">a1</span><br><span class="line">a2             800</span><br><span class="line">a2             200</span><br><span class="line">a2             300</span><br><span class="line">a2</span><br><span class="line">a3             300</span><br><span class="line">a3             100</span><br></pre></td></tr></table></figure>
<p>Note that UNIQUE SINGLE REFERENCE affects the types of RULES you can define. This is explained further in <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNzc0Lmh0bWw=">Expressions and Cell References</span>.</p>
<h2 id="measures"><a class="markdownIt-Anchor" href="#measures">#</a> MEASURES</h2>
<p>In this tutorial we learn about the MEASURES component of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause.</p>
<p>MEASURES specifies which columns in a SELECT are measure columns, which for our purposes can be thought of as any column containing a measurable quantity like a price or a length. See the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvZ2xvc3NhcnkuaHRtI2k0MzE5OTI=">Oracle® Database Data Warehousing Guide 10g Release 2 (10.2) - Glossary</span> for a formal definition.</p>
<p>Before we begin please note that, on its own, MEASURES has little visible effect on the output of the SELECT statement. Most of the examples below would produce the same result as one with no MODEL clause at all. This is because we are not trying to manipulate the results just yet. We are simply seeing how to specify our measure columns, which is a precursor to manipulating the results. We will see how to actually manipulate our output when we explore the RULES clause in subsequent tutorials.</p>
<p>Before we see MEASURES in action first consider the following table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  group_1  ,</span><br><span class="line">  group_2  ,</span><br><span class="line">  date_val ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY GROUP_1    GROUP_2    DATE_VAL   NUM_VAL</span><br><span class="line">------ ---------- ---------- ---------- -------</span><br><span class="line">     1 A          a1         2005-01-01     100</span><br><span class="line">     2 A          a2         2005-06-12     200</span><br><span class="line">     3 A          a3                        300</span><br><span class="line">     4 B          a1         2006-02-01</span><br><span class="line">     5 B          a2         2006-06-12     300</span><br><span class="line">     6 B          a3         2005-01-01     100</span><br><span class="line">     7 C          a1         2006-06-12     100</span><br><span class="line">     8 C          a2</span><br><span class="line">     9            a1         2005-02-01     200</span><br><span class="line">    10            a2         2005-02-01     800</span><br></pre></td></tr></table></figure>
<p>If we decide to use KEY as our sole dimension column, then all other columns are available for use as measure columns. To let Oracle know we want to use the NUM_VAL column as our measure we can compose a MODEL clause like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  MEASURES     ( NUM_VAL )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL</span><br><span class="line">------ -------</span><br><span class="line">     1     100</span><br><span class="line">     2     200</span><br><span class="line">     3     300</span><br><span class="line">     4</span><br><span class="line">     5     300</span><br><span class="line">     6     100</span><br><span class="line">     7     100</span><br><span class="line">     8</span><br><span class="line">     9     200</span><br><span class="line">    10     800</span><br></pre></td></tr></table></figure>
<p>If we want to include more measure columns we do it like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  date_val ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  MEASURES     ( DATE_VAL, NUM_VAL )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY DATE_VAL   NUM_VAL</span><br><span class="line">------ ---------- -------</span><br><span class="line">     1 2005-01-01     100</span><br><span class="line">     2 2005-06-12     200</span><br><span class="line">     3                300</span><br><span class="line">     4 2006-02-01</span><br><span class="line">     5 2006-06-12     300</span><br><span class="line">     6 2005-01-01     100</span><br><span class="line">     7 2006-06-12     100</span><br><span class="line">     8</span><br><span class="line">     9 2005-02-01     200</span><br><span class="line">    10 2005-02-01     800</span><br></pre></td></tr></table></figure>
<p>You can define measures using constants and expressions instead of simple column names, like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val    ,</span><br><span class="line">  num_val_2  ,</span><br><span class="line">  date_val_2 ,</span><br><span class="line">  note</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span></span><br><span class="line">  ( key )</span><br><span class="line">  MEASURES</span><br><span class="line">  ( num_val ,</span><br><span class="line">    NUM_VAL <span class="operator">*</span> <span class="number">10</span>    <span class="keyword">AS</span> NUM_VAL_2  ,</span><br><span class="line">    SYSDATE         <span class="keyword">AS</span> DATE_VAL_2 ,</span><br><span class="line">    <span class="string">&#x27;A BRIEF NOTE&#x27;</span>  <span class="keyword">AS</span> NOTE</span><br><span class="line">  )</span><br><span class="line">  rules( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL  NUM_VAL_2 DATE_VAL_2 NOTE</span><br><span class="line">------ ------- ---------- ---------- ------------</span><br><span class="line">     1     100       1000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     2     200       2000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     3     300       3000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     4                    2007-02-28 A BRIEF NOTE</span><br><span class="line">     5     300       3000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     6     100       1000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     7     100       1000 2007-02-28 A BRIEF NOTE</span><br><span class="line">     8                    2007-02-28 A BRIEF NOTE</span><br><span class="line">     9     200       2000 2007-02-28 A BRIEF NOTE</span><br><span class="line">    10     800       8000 2007-02-28 A BRIEF NOTE</span><br></pre></td></tr></table></figure>
<h2 id="dimension-and-measure-restrictions"><a class="markdownIt-Anchor" href="#dimension-and-measure-restrictions">#</a> Dimension and Measure Restrictions</h2>
<p>In this tutorial we examine restrictions related to both the DIMENSION BY and MEASURES components of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause.</p>
<p>If you try to include columns in your SELECT clause which are not DIMENSION or MEASURE columns you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key     ,</span><br><span class="line">  GROUP_1 ,  <span class="comment">-- exists in table T, but it is not a DIMENSION or MEASURE column</span></span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  GROUP_1 ,  <span class="comment">-- exists in table T, but it is not a DIMENSION or MEASURE column</span></span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">3</span>:</span><br><span class="line">ORA<span class="number">-32614</span>: illegal MODEL <span class="keyword">SELECT</span> expression</span><br></pre></td></tr></table></figure>
<p>If you try to use the same column for both a dimension and a measure you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  DIMENSION <span class="keyword">BY</span> ( KEY )</span><br><span class="line">  MEASURES     ( KEY, num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  key ,</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">2</span>:</span><br><span class="line">ORA<span class="number">-00957</span>: duplicate <span class="keyword">column</span> name</span><br></pre></td></tr></table></figure>
<p>The constants NULL and ‘’ (empty string), by themselves, are not allowed in DIMENSION BY or MEASURES clauses.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key   ,</span><br><span class="line">  key_3 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key, <span class="keyword">NULL</span> <span class="keyword">as</span> key_3 )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  dimension <span class="keyword">by</span> ( key, <span class="keyword">NULL</span> <span class="keyword">as</span> key_3 )</span><br><span class="line">                      <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">8</span>:</span><br><span class="line">ORA<span class="number">-01723</span>: zero<span class="operator">-</span>length columns <span class="keyword">are</span> <span class="keyword">not</span> allowed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  new_text_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="string">&#x27;&#x27;</span> <span class="keyword">as</span> new_text_measure )</span><br><span class="line">  rules        ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  measures     ( <span class="string">&#x27;&#x27;</span> <span class="keyword">as</span> new_text_measure )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">8</span>:</span><br><span class="line">ORA<span class="number">-01723</span>: zero<span class="operator">-</span>length columns <span class="keyword">are</span> <span class="keyword">not</span> allowed</span><br></pre></td></tr></table></figure>
<p>Instead, use CAST to specify a datatype and length for NULL or ‘’.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">null</span> &quot;(null)&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  key_3 ,</span><br><span class="line">  new_text_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span>( key, <span class="built_in">CAST</span>( <span class="keyword">NULL</span> <span class="keyword">AS</span> VARCHAR2(<span class="number">10</span>) ) <span class="keyword">as</span> key_3 )</span><br><span class="line">  measures    ( <span class="built_in">CAST</span>( <span class="string">&#x27;&#x27;</span> <span class="keyword">AS</span> VARCHAR2(<span class="number">15</span>) ) <span class="keyword">as</span> new_text_measure )</span><br><span class="line">  rules       ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  KEY KEY_3      NEW_TEXT_MEASURE</span><br><span class="line">------ ---------- --------------------</span><br><span class="line">     1 (null)     (null)</span><br></pre></td></tr></table></figure>
<h3 id="gotchas"><a class="markdownIt-Anchor" href="#gotchas">#</a> Gotchas</h3>
<p>Pay attention to implicit data type conversions. In the following example NEW_TEXT_MEASURE is implicitly assigned a datatype with a length of 13 characters, the length of the constant used in the MEASURES clause. Attempting to assign a value that is longer than 13 characters raises a ORA-25137 error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  new_text_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span>( key )</span><br><span class="line">  measures    ( <span class="string">&#x27;13 CHARACTERS&#x27;</span> <span class="keyword">as</span> new_text_measure )</span><br><span class="line">  rules       ( new_text_measure[<span class="keyword">any</span>] <span class="operator">=</span> <span class="string">&#x27;OVER 13 CHARACTERS&#x27;</span> )</span><br><span class="line">;</span><br><span class="line">  measures    ( <span class="string">&#x27;13 CHARACTERS&#x27;</span> <span class="keyword">as</span> new_text_measure )</span><br><span class="line">                <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-25137</span>: Data <span class="keyword">value</span> <span class="keyword">out</span> <span class="keyword">of</span> <span class="keyword">range</span></span><br></pre></td></tr></table></figure>
<p>Despite the error message’s phrasing, it is really the value “OVER 13 CHARACTERS” which is out of range, not “13 CHARACTERS”.</p>
<p>To avoid the error, use CAST to force a datatype long enough to contain the largest value in the result set.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  new_text_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span>( key )</span><br><span class="line">  measures    ( <span class="built_in">CAST</span>( <span class="string">&#x27;13 CHARACTERS&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">4000</span>) ) <span class="keyword">as</span> new_text_measure )</span><br><span class="line">  rules       ( new_text_measure[<span class="keyword">any</span>] <span class="operator">=</span> <span class="string">&#x27;OVER 13 CHARACTERS&#x27;</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY NEW_TEXT_MEASURE</span><br><span class="line">------ --------------------</span><br><span class="line">     1 OVER 13 CHARACTERS</span><br></pre></td></tr></table></figure>
<h2 id="basic-rules-and-cell-assignments"><a class="markdownIt-Anchor" href="#basic-rules-and-cell-assignments">#</a> Basic Rules and Cell Assignments</h2>
<p>In this tutorial we start to explore the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause. A rule is simply a statement that assigns a value to a measure.</p>
<p>In this tutorial we will focus on basic rules and cell assignments. Subsequent tutorials will cover other aspects of rules.</p>
<h3 id="basic-rules"><a class="markdownIt-Anchor" href="#basic-rules">#</a> Basic Rules</h3>
<p>In the preceeding tutorial we learned how to specify the DIMENSION BY and MEASURES clauses in a SELECT statement like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100          0</span><br><span class="line">     2     200          0</span><br><span class="line">     3     300          0</span><br><span class="line">     4                  0</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<p>We can use the RULES clause to change any value appearing under a measure column such as M_1 like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  RULES</span><br><span class="line">  ( M_1[ <span class="number">1</span>                   ] <span class="operator">=</span> <span class="number">100</span> ,</span><br><span class="line">    M_1[ KEY <span class="operator">=</span> <span class="number">2</span>             ] <span class="operator">=</span> <span class="number">200</span> ,</span><br><span class="line">    M_1[ KEY <span class="keyword">BETWEEN</span> <span class="number">4</span> <span class="keyword">AND</span> <span class="number">7</span> ] <span class="operator">=</span> <span class="number">300</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100        100</span><br><span class="line">     2     200        200</span><br><span class="line">     3     300          0</span><br><span class="line">     4                300</span><br><span class="line">     5     300        300</span><br><span class="line">     6     100        300</span><br><span class="line">     7     100        300</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<h3 id="cell-assignments"><a class="markdownIt-Anchor" href="#cell-assignments">#</a> Cell Assignments</h3>
<p>The term “M_1[1]” is called a “cell reference” and it refers to the M_1 column value where the KEY column value is “1” in the SELECT command’s output. Cell references can only refer to measure cells, not dimension cells. When a cell reference is used as the assignment target on the left side of a rule equation it is called a &quot;<span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNjg2MDM=">cell assignment&quot;</span>. Note that the term “cell assignment” refers only to the term on the left hand side of the rule equation, not the entire equation.</p>
<p>On the right hand side of a rule cell references do not have a special name. To avoid confusion, we will always refer to the cell(s) targeted by a rule only as a “cell assignment” and we will use “cell reference” in all other cases.</p>
<p>The part between the square brackets, “[]”, is called a “dimension reference”. When a dimension reference appears in a cell assignment it can be a condition, expression, or loop construct (described in subsequent tutorials) targeting one or more dimension values. Dimension references for all other cell references can only contain conditions or expressions.</p>
<p>To create a cell assignment targeting all cells in a measure column use the ANY keyword in the dimension reference.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[ <span class="keyword">ANY</span> ] <span class="operator">=</span> <span class="number">100</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100        100</span><br><span class="line">     2     200        100</span><br><span class="line">     3     300        100</span><br><span class="line">     4                100</span><br><span class="line">     5     300        100</span><br><span class="line">     6     100        100</span><br><span class="line">     7     100        100</span><br><span class="line">     8                100</span><br><span class="line">     9     200        100</span><br><span class="line">    10     800        100</span><br></pre></td></tr></table></figure>
<p>You can nest a cell reference within a cell assignment if the nested cell reference only identifies a single cell. Other restrictions on nested cell references are documented at <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI2kxMDExNzIw">Rules and Restrictions when Using SQL for Modeling</span>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">column</span> key_equals_num_val_2 format a16</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  key_equals_num_val_2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> key_equals_num_val_2 )</span><br><span class="line">  rules        ( key_equals_num_val_2[ NUM_VAL[<span class="number">2</span>]<span class="operator">/</span><span class="number">100</span> ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL KEY_EQUALS_NUM_V</span><br><span class="line">------ ------- ----------------</span><br><span class="line">     1     100 N</span><br><span class="line">     2     200 Y</span><br><span class="line">     3     300 N</span><br><span class="line">     4         N</span><br><span class="line">     5     300 N</span><br><span class="line">     6     100 N</span><br><span class="line">     7     100 N</span><br><span class="line">     8         N</span><br><span class="line">     9     200 N</span><br><span class="line">    10     800 N</span><br></pre></td></tr></table></figure>
<p>A cell whose dimension is null will be targeted by any of the following styles of dimension reference.</p>
<ul>
<li>[any]</li>
<li>[group_1 is any]</li>
<li>[null]</li>
<li>[group_1 is null]</li>
</ul>
<p>A reference like “[group_1 = null]” will not work.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  using_any ,</span><br><span class="line">  using_is_any ,</span><br><span class="line">  using_null ,</span><br><span class="line">  using_is_null ,</span><br><span class="line">  using_equals_null</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="keyword">in</span> ( <span class="number">1</span>, <span class="number">10</span> )</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span>( group_1 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> using_any ,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> using_is_any ,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> using_null ,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> using_is_null ,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> using_equals_null</span><br><span class="line">  )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    using_any        [ <span class="keyword">ANY</span>             ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    using_is_any     [ GROUP_1 <span class="keyword">IS</span> <span class="keyword">ANY</span>  ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    using_null       [ <span class="keyword">NULL</span>            ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    using_is_null    [ GROUP_1 <span class="keyword">IS</span> <span class="keyword">NULL</span> ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    using_equals_null[ GROUP_1 <span class="operator">=</span> <span class="keyword">NULL</span>  ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    USING_ANY USING_IS_ANY USING_NULL USING_IS_NULL USING_EQUALS_NULL</span><br><span class="line">---------- --------- ------------ ---------- ------------- -----------------</span><br><span class="line">A          Y         Y            N          N             N</span><br><span class="line">           Y         Y            Y          Y             N</span><br></pre></td></tr></table></figure>
<h3 id="gotchas-2"><a class="markdownIt-Anchor" href="#gotchas-2">#</a> Gotchas</h3>
<p>Attempting to modify a dimension column with a rule will generate an error. The left side of a rule can only reference measure cells.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ( KEY[<span class="number">1</span>] <span class="operator">=</span> <span class="number">0</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( KEY[<span class="number">1</span>] <span class="operator">=</span> <span class="number">0</span> )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">9</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br></pre></td></tr></table></figure>
<p>Specifying too few dimension values in a cell reference results in an ORA-00947 error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="string">&#x27;A&#x27;</span>] <span class="operator">=</span> <span class="number">100</span> )</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="string">&#x27;A&#x27;</span>] <span class="operator">=</span> <span class="number">100</span> )</span><br><span class="line">                    <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">9</span>:</span><br><span class="line">ORA<span class="number">-00947</span>: <span class="keyword">not</span> enough <span class="keyword">values</span></span><br></pre></td></tr></table></figure>
<p>Specifying too many dimension values in a cell reference results in the same ORA-00947 error as the last example. In this case the error text “not enough values” is misleading.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="number">1</span>,<span class="number">2</span>] <span class="operator">=</span> <span class="number">100</span> )</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="number">1</span>,<span class="number">2</span>] <span class="operator">=</span> <span class="number">100</span> )</span><br><span class="line">                    <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">9</span>:</span><br><span class="line">ORA<span class="number">-00947</span>: <span class="keyword">not</span> enough <span class="keyword">values</span></span><br></pre></td></tr></table></figure>
<p>Including a dimension column on the right side of a dimension reference expression will produce an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( <span class="string">&#x27;N&#x27;</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[ <span class="keyword">any</span>, group_2 <span class="operator">&gt;</span> GROUP_1 ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[ <span class="keyword">any</span>, group_2 <span class="operator">&gt;</span> GROUP_1 ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> )</span><br><span class="line">                                     <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-32625</span>: illegal dimension <span class="keyword">in</span> cell reference predicate</span><br></pre></td></tr></table></figure>
<p>A nested cell reference that targets more than one cell will produce an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[ NUM_VAL[KEY <span class="keyword">IN</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)] ] <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-32622</span>: illegal multi<span class="operator">-</span>cell reference</span><br></pre></td></tr></table></figure>
<h2 id="for-loops"><a class="markdownIt-Anchor" href="#for-loops">#</a> FOR Loops</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on FOR loops. FOR loops allow you to take a MODEL clause like this</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag[<span class="number">2</span>] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    flag[<span class="number">4</span>] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span> ,</span><br><span class="line">    flag[<span class="number">6</span>] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY FLAG</span><br><span class="line">------ ----</span><br><span class="line">     1 .</span><br><span class="line">     2 Y</span><br><span class="line">     3 .</span><br><span class="line">     4 Y</span><br><span class="line">     5 .</span><br><span class="line">     6 Y</span><br><span class="line">     7 .</span><br><span class="line">     8 .</span><br><span class="line">     9 .</span><br><span class="line">    10 .</span><br></pre></td></tr></table></figure>
<p>and rewrite it like this …</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag[ <span class="keyword">FOR</span> KEY <span class="keyword">IN</span> ( <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span> ) ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY FLAG</span><br><span class="line">------ ----</span><br><span class="line">     1 .</span><br><span class="line">     2 Y</span><br><span class="line">     3 .</span><br><span class="line">     4 Y</span><br><span class="line">     5 .</span><br><span class="line">     6 Y</span><br><span class="line">     7 .</span><br><span class="line">     8 .</span><br><span class="line">     9 .</span><br><span class="line">    10 .</span><br></pre></td></tr></table></figure>
<p>or this</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag[ <span class="keyword">FOR</span> KEY <span class="keyword">FROM</span> <span class="number">2</span> <span class="keyword">TO</span> <span class="number">6</span> INCREMENT <span class="number">2</span> ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY FLAG</span><br><span class="line">------ ----</span><br><span class="line">     1 .</span><br><span class="line">     2 Y</span><br><span class="line">     3 .</span><br><span class="line">     4 Y</span><br><span class="line">     5 .</span><br><span class="line">     6 Y</span><br><span class="line">     7 .</span><br><span class="line">     8 .</span><br><span class="line">     9 .</span><br><span class="line">    10 .</span><br></pre></td></tr></table></figure>
<p>or this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> key <span class="keyword">from</span> t2;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">   KEY</span><br><span class="line">------</span><br><span class="line">     2</span><br><span class="line">     4</span><br><span class="line">     6</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">  key ,</span><br><span class="line">  flag</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension by ( key )</span><br><span class="line">  measures     ( &#39;.&#39; as flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag[ FOR KEY IN ( SELECT KEY FROM T2 ) ] &#x3D; &#39;Y&#39;</span><br><span class="line">  )</span><br><span class="line">order by</span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY FLAG</span><br><span class="line">------ ----</span><br><span class="line">     1 .</span><br><span class="line">     2 Y</span><br><span class="line">     3 .</span><br><span class="line">     4 Y</span><br><span class="line">     5 .</span><br><span class="line">     6 Y</span><br><span class="line">     7 .</span><br><span class="line">     8 .</span><br><span class="line">     9 .</span><br><span class="line">    10 .</span><br></pre></td></tr></table></figure>
<p>With “FOR dimension LIKE …” syntax you can combine strings with incrementing/decrementing values like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key_2 ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key_2 )</span><br><span class="line">  measures     ( <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag[ <span class="keyword">FOR</span> KEY_2 <span class="keyword">LIKE</span> <span class="string">&#x27;T-%&#x27;</span> <span class="keyword">FROM</span> <span class="number">2</span> <span class="keyword">TO</span> <span class="number">6</span> INCREMENT <span class="number">2</span> ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">KEY_2 FLAG</span><br><span class="line">----- ----</span><br><span class="line">T-1   .</span><br><span class="line">T-10  .</span><br><span class="line">T-2   Y</span><br><span class="line">T-3   .</span><br><span class="line">T-4   Y</span><br><span class="line">T-5   .</span><br><span class="line">T-6   Y</span><br><span class="line">T-7   .</span><br><span class="line">T-8   .</span><br><span class="line">T-9   .</span><br></pre></td></tr></table></figure>
<h3 id="multiple-dimensions-2"><a class="markdownIt-Anchor" href="#multiple-dimensions-2">#</a> Multiple Dimensions</h3>
<p>To specify dimension value pairs, triplets, etc. you can use a FOR loop like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag</span><br><span class="line">    [ <span class="keyword">FOR</span> ( GROUP_1, GROUP_2 ) <span class="keyword">IN</span></span><br><span class="line">      (</span><br><span class="line">        ( <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;a1&#x27;</span> ) ,</span><br><span class="line">        ( <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;a2&#x27;</span> ) ,</span><br><span class="line">        ( <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;a1&#x27;</span> )</span><br><span class="line">      )</span><br><span class="line">    ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    FLAG</span><br><span class="line">---------- ---------- ----</span><br><span class="line">A          a1         Y</span><br><span class="line">A          a2         .</span><br><span class="line">A          a3         .</span><br><span class="line">B          a1         .</span><br><span class="line">B          a2         Y</span><br><span class="line">B          a3         .</span><br><span class="line">C          a1         Y</span><br><span class="line">C          a2         .</span><br><span class="line">           a1         .</span><br><span class="line">           a2         .</span><br></pre></td></tr></table></figure>
<p>A multi-dimension FOR loop with a subquery looks like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  flag</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( num_val, <span class="string">&#x27;.&#x27;</span> <span class="keyword">as</span> flag )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    flag</span><br><span class="line">    [ <span class="keyword">FOR</span> ( GROUP_1, GROUP_2 ) <span class="keyword">IN</span></span><br><span class="line">      ( <span class="keyword">SELECT</span> GROUP_1, GROUP_2 <span class="keyword">FROM</span> T <span class="keyword">WHERE</span> NUM_VAL <span class="keyword">IS</span> <span class="keyword">NULL</span> )</span><br><span class="line">    ] <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL FLAG</span><br><span class="line">---------- ---------- ------- ----</span><br><span class="line">A          a1             100 .</span><br><span class="line">A          a2             200 .</span><br><span class="line">A          a3             300 .</span><br><span class="line">B          a1                 Y</span><br><span class="line">B          a2             300 .</span><br><span class="line">B          a3             100 .</span><br><span class="line">C          a1             100 .</span><br><span class="line">C          a2                 Y</span><br><span class="line">           a1             200 .</span><br><span class="line">           a2             800 .</span><br></pre></td></tr></table></figure>
<h3 id="for-versus-in"><a class="markdownIt-Anchor" href="#for-versus-in">#</a> FOR versus IN</h3>
<p>It is important to note that a dimension reference with a FOR loop like  <code>FOR KEY IN ( 2, 4, 6 )</code>  differs from one with an IN expression like  <code>KEY IN ( 2, 4, 6 )</code> . This is explained further in the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjc0Lmh0bWw=">Missing Cells - UPSERT</span> tutorial.</p>
<h2 id="expressions-and-cell-references"><a class="markdownIt-Anchor" href="#expressions-and-cell-references">#</a> Expressions and Cell References</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause. We will focus on cell references in the right hand side of rule equations. Subsequent tutorials will cover other aspects of rules.</p>
<h3 id="expressions"><a class="markdownIt-Anchor" href="#expressions">#</a> Expressions</h3>
<p>In the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjY3Lmh0bWw=">Basic Rules and Cell Assignments</span> tutorial we saw rules like these which assign the constants 100, 200, and 300 to certain cells.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  ( M_1[ <span class="number">1</span> ] <span class="operator">=</span> <span class="number">100</span> ,</span><br><span class="line">    M_1[ <span class="number">2</span> ] <span class="operator">=</span> <span class="number">200</span> ,</span><br><span class="line">    M_1[ <span class="number">3</span> ] <span class="operator">=</span> <span class="number">300</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100        100</span><br><span class="line">     2     200        200</span><br><span class="line">     3     300        300</span><br><span class="line">     4                  0</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<p>We can also use more complex expressions on the right hand side of a rule, like these.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">variable BIND_VAR number</span><br><span class="line"></span><br><span class="line"><span class="keyword">execute</span> :BIND_VAR :<span class="operator">=</span> <span class="number">4000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  ( m_1[ <span class="number">1</span> ] <span class="operator">=</span> NUM_VAL[ <span class="number">1</span> ] <span class="operator">*</span> <span class="number">10</span> ,</span><br><span class="line">    m_1[ <span class="number">2</span> ] <span class="operator">=</span> TO_NUMBER( TO_CHAR( SYSDATE, <span class="string">&#x27;YYYYMMDD&#x27;</span> ) ),</span><br><span class="line">    m_1[ <span class="number">3</span> ] <span class="operator">=</span> DBMS_UTILITY.GET_TIME ,</span><br><span class="line">    m_1[ <span class="number">4</span> ] <span class="operator">=</span> :BIND_VAR</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100       1000</span><br><span class="line">     2     200   20070228</span><br><span class="line">     3     300    9081636</span><br><span class="line">     4            4000000</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<h3 id="cell-references"><a class="markdownIt-Anchor" href="#cell-references">#</a> Cell References</h3>
<p>The term “NUM_VAL[1]” in the last example is called a “cell reference”. Cell references can only refer to measure cells and they must only refer to a single measure cell when used on the right hand side of a rule.</p>
<p>The part between the square brackets in a cell reference is called a dimension reference and it can only contain literal values (e.g. “1”), expressions (e.g. “1+1”), or conditions (e.g. “KEY=3”) that resolve to a single dimension value. Here are some examples.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  ( m_1[ <span class="number">1</span> ] <span class="operator">=</span> NUM_VAL[ <span class="number">1</span>     ] <span class="operator">*</span> <span class="number">10</span> ,   <span class="comment">-- literal</span></span><br><span class="line">    m_1[ <span class="number">2</span> ] <span class="operator">=</span> NUM_VAL[ <span class="number">1</span> <span class="operator">+</span> <span class="number">1</span> ] <span class="operator">*</span> <span class="number">100</span> ,  <span class="comment">-- expression</span></span><br><span class="line">    m_1[ <span class="number">3</span> ] <span class="operator">=</span> NUM_VAL[ KEY<span class="operator">=</span><span class="number">3</span> ] <span class="operator">*</span> <span class="number">1000</span>   <span class="comment">-- condition</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100       1000</span><br><span class="line">     2     200      20000</span><br><span class="line">     3     300     300000</span><br><span class="line">     4                  0</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<p>If required, you can nest one cell reference within another as long as the nested cell reference only identifies a single cell. Other restrictions on nested cell references are documented at <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI2kxMDExNzIw">Rules and Restrictions when Using SQL for Modeling</span>.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[ NUM_VAL[<span class="number">1</span>]<span class="operator">/</span><span class="number">100</span> ] <span class="operator">=</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100         10</span><br><span class="line">     2     200          0</span><br><span class="line">     3     300          0</span><br><span class="line">     4                  0</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<h3 id="unique-single-refernce"><a class="markdownIt-Anchor" href="#unique-single-refernce">#</a> UNIQUE SINGLE REFERNCE</h3>
<p>As described in <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjY0Lmh0bWw=">DIMENSION BY</span> the UNIQUE SINGLE REFERENCE feature allows you to have duplicate domain values in your result set. You can only use this feature as long as you do not include any multi-cell references on the right hand side of your query rules. For example, this is o.k.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model <span class="keyword">UNIQUE</span> SINGLE REFERENCE</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ------- ----------</span><br><span class="line">a1             100         10</span><br><span class="line">a1             100         10</span><br><span class="line">a1             200         10</span><br><span class="line">a1                         10</span><br><span class="line">a2             800         10</span><br><span class="line">a2             200         10</span><br><span class="line">a2             300         10</span><br><span class="line">a2                         10</span><br><span class="line">a3             300         10</span><br><span class="line">a3             100         10</span><br></pre></td></tr></table></figure>
<p>but this is not</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model <span class="keyword">UNIQUE</span> SINGLE REFERENCE</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> NUM_VAL[<span class="string">&#x27;a2&#x27;</span>] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">;</span><br><span class="line">  t</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">6</span>:</span><br><span class="line">ORA<span class="number">-32638</span>: Non <span class="keyword">unique</span> addressing <span class="keyword">in</span> MODEL dimensions</span><br></pre></td></tr></table></figure>
<p>and neither is this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model <span class="keyword">UNIQUE</span> SINGLE REFERENCE</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> NUM_VAL[CV()] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">;</span><br><span class="line">  t</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">6</span>:</span><br><span class="line">ORA<span class="number">-32638</span>: Non <span class="keyword">unique</span> addressing <span class="keyword">in</span> MODEL dimensions</span><br></pre></td></tr></table></figure>
<h3 id="gotchas-3"><a class="markdownIt-Anchor" href="#gotchas-3">#</a> Gotchas</h3>
<p>You cannot reference columns in rules. In the following rule the column NUM_VAL is referenced illegally. Use a cell reference like “NUM_VAL[3]” instead.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="number">3</span>] <span class="operator">=</span> NUM_VAL <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="number">3</span>] <span class="operator">=</span> NUM_VAL <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">                          <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-00984</span>: <span class="keyword">column</span> <span class="keyword">not</span> allowed here</span><br></pre></td></tr></table></figure>
<p>Including a cell reference to a dimension column will produce an error. Only measure columns are allowed in cell references.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  key_x_10</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> key_x_10 )</span><br><span class="line">  rules        ( key_x_10[<span class="number">3</span>] <span class="operator">=</span> KEY[<span class="number">3</span>] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( key_x_10[<span class="number">3</span>] <span class="operator">=</span> KEY[<span class="number">3</span>] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">                               <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br></pre></td></tr></table></figure>
<p>Multi-cell references, like NUM_VAL[ANY], are not allowed on the right hand side of a rule.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> NUM_VAL[<span class="keyword">ANY</span>] )</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> NUM_VAL[<span class="keyword">ANY</span>] )</span><br><span class="line">                                    <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-32622</span>: illegal multi<span class="operator">-</span>cell reference</span><br></pre></td></tr></table></figure>
<p>A nested cell reference that targets more than one cell will produce an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[ NUM_VAL[KEY <span class="keyword">IN</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)] <span class="operator">/</span> <span class="number">100</span> ] <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-32622</span>: illegal multi<span class="operator">-</span>cell reference</span><br></pre></td></tr></table></figure>
<p>Even though a dimension expression resolves to a single value, it may still trigger an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="number">3</span>] <span class="operator">=</span> num_val[KEY <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">AND</span> <span class="number">3</span>] <span class="operator">*</span> <span class="number">1000</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">1</span>:</span><br><span class="line">ORA<span class="number">-32622</span>: illegal multi<span class="operator">-</span>cell reference</span><br></pre></td></tr></table></figure>
<p>You may not use subqueries in rules, except in the FOR construct (described in <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjgzLmh0bWw=">FOR Loops</span>).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  dummy</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="string">&#x27;Y&#x27;</span> <span class="keyword">as</span> dummy )</span><br><span class="line">  rules        ( m_1[<span class="number">1</span>] <span class="operator">=</span> ( <span class="keyword">SELECT</span> DUMMY <span class="keyword">FROM</span> DUAL ) )</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="number">1</span>] <span class="operator">=</span> ( <span class="keyword">SELECT</span> DUMMY <span class="keyword">FROM</span> DUAL ) )</span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">11</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br></pre></td></tr></table></figure>
<p>Instead, define the subquery in the MEASURES list.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  dummy</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( ( <span class="keyword">SELECT</span> DUMMY <span class="keyword">FROM</span> DUAL ) <span class="keyword">as</span> dummy )</span><br><span class="line">  rules        ( )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY D</span><br><span class="line">------ -</span><br><span class="line">     1 X</span><br></pre></td></tr></table></figure>
<h2 id="the-cv-function"><a class="markdownIt-Anchor" href="#the-cv-function">#</a> The CV() Function</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause. We will focus on the CV() function here. Subsequent tutorials will cover other aspects of rules.</p>
<p>If we need to access the value of a dimension cell, we cannot do it using a cell reference because cell references can only refer to measure columns. For example, we cannot use a cell reference like  <code>KEY[ CV() ]</code>  to access the value of KEY cells.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> KEY[CV()] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> KEY[CV()] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">                            <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br></pre></td></tr></table></figure>
<p>Fortunately the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZnVuY3Rpb25zMDM4Lmh0bSNpMTI5NzkyNQ==">CV()</span> function exists to helps us access the current value of any dimension cell. In the following example  <code>CV(KEY)</code>  returns the current value of the KEY dimension column.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> CV(KEY) <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     1         10</span><br><span class="line">     2         20</span><br><span class="line">     3         30</span><br><span class="line">     4         40</span><br><span class="line">     5         50</span><br><span class="line">     6         60</span><br><span class="line">     7         70</span><br><span class="line">     8         80</span><br><span class="line">     9         90</span><br><span class="line">    10        100</span><br></pre></td></tr></table></figure>
<p>You can use CV() without an argument in dimension references to return the current dimension value associated with its relative position within a cell reference. For example, in the following snippet the first occurrence of  <code>CV()</code>  refers to the current value of the GROUP_1 dimension and the second occurrence refers to the current value of the GROUP_2 dimension.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val,</span><br><span class="line">    <span class="number">0</span> <span class="keyword">as</span> m_1</span><br><span class="line">  )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    m_1[<span class="keyword">any</span>,<span class="keyword">any</span>] <span class="operator">=</span> NUM_VAL[ CV(), CV() ] <span class="operator">*</span> <span class="number">10</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ---------- ------- ----------</span><br><span class="line">A          a1             100       1000</span><br><span class="line">A          a2             200       2000</span><br><span class="line">A          a3             300       3000</span><br><span class="line">B          a1</span><br><span class="line">B          a2             300       3000</span><br><span class="line">B          a3             100       1000</span><br><span class="line">C          a1             100       1000</span><br><span class="line">C          a2</span><br><span class="line">           a1             200       2000</span><br><span class="line">           a2             800       8000</span><br></pre></td></tr></table></figure>
<p>CV() also allows us to use relative indexing, as demonstrated in the dimension reference  <code>[ CV() - 1 ]</code>  for the RUNNING_TOTAL measure in this snippet.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  running_total</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    nvl(num_val,<span class="number">0</span>) <span class="keyword">as</span> num_val ,</span><br><span class="line">    <span class="number">0</span> running_total</span><br><span class="line">  )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    running_total[ <span class="number">1</span>       ] <span class="operator">=</span> num_val[cv()] ,</span><br><span class="line">    running_total[ key <span class="operator">&gt;</span> <span class="number">1</span> ] <span class="operator">=</span> num_val[cv()] <span class="operator">+</span> running_total[ CV() <span class="operator">-</span> <span class="number">1</span> ]</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL RUNNING_TOTAL</span><br><span class="line">------ ------- -------------</span><br><span class="line">     1     100           100</span><br><span class="line">     2     200           300</span><br><span class="line">     3     300           600</span><br><span class="line">     4       0           600</span><br><span class="line">     5     300           900</span><br><span class="line">     6     100          1000</span><br><span class="line">     7     100          1100</span><br><span class="line">     8       0          1100</span><br><span class="line">     9     200          1300</span><br><span class="line">    10     800          2100</span><br></pre></td></tr></table></figure>
<h3 id="gotchas-4"><a class="markdownIt-Anchor" href="#gotchas-4">#</a> Gotchas</h3>
<p>CV() cannot be used on measure columns.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> cv(NUM_VAL) <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> cv(NUM_VAL) <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">                               <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>CV() cannot be used outside of a dimension reference without an argument.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> CV() <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> CV() <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line">                            <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-32611</span>: incorrect use <span class="keyword">of</span> MODEL CV operator</span><br></pre></td></tr></table></figure>
<h2 id="partiton-by"><a class="markdownIt-Anchor" href="#partiton-by">#</a> PARTITON BY</h2>
<p>In this tutorial we explore the PARTITION component of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause. The <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRt">Oracle® Database Data Warehousing Guide 10g Release 2 (10.2) - Chapter 22</span> describes partition columns this way.</p>
<p>“Partition columns define the logical blocks of the result set in a way similar to the partitions of the analytical functions described in Chapter 21, “SQL for Analysis and Reporting”. Rules in the MODEL clause are applied to each partition independent of other partitions.”</p>
<p>“You can partition data and evaluate rules within each partition independent of other partitions. This enables parallelization of model computation based on partitions.”</p>
<h3 id="performance"><a class="markdownIt-Anchor" href="#performance">#</a> Performance</h3>
<p>If your system has multiple processors the PARTITION BY clause may improve your query’s performance (see <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0NIRERJR0VC">Parallel Execution</span>). For example, with a query like this</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>, <span class="keyword">any</span>] <span class="operator">=</span> num_val[cv(), cv()] <span class="operator">*</span> <span class="number">10</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ---------- ------- ----------</span><br><span class="line">A          a1             100       1000</span><br><span class="line">A          a2             200       2000</span><br><span class="line">A          a3             300       3000</span><br><span class="line"></span><br><span class="line">B          a1</span><br><span class="line">B          a2             300       3000</span><br><span class="line">B          a3             100       1000</span><br><span class="line"></span><br><span class="line">C          a1             100       1000</span><br><span class="line">C          a2</span><br><span class="line"></span><br><span class="line">           a1             200       2000</span><br><span class="line">           a2             800       8000</span><br></pre></td></tr></table></figure>
<p>one CPU will most likely process the M_1 rule for all rows in the result set (note: I have not tested this behaviour myself; this information is assumed from the manuals). Using a query like the following produces the same output while allowing one processor on your system to process the rows where GROUP_1 is ‘A’, another CPU to process those where GROUP_1 is ‘B’, etc.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> ( GROUP_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> num_val[cv()] <span class="operator">*</span> <span class="number">10</span> )  <span class="comment">-- note only one dimension now</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ---------- ------- ----------</span><br><span class="line">A          a1             100       1000</span><br><span class="line">A          a2             200       2000</span><br><span class="line">A          a3             300       3000</span><br><span class="line"></span><br><span class="line">B          a1</span><br><span class="line">B          a2             300       3000</span><br><span class="line">B          a3             100       1000</span><br><span class="line"></span><br><span class="line">C          a1             100       1000</span><br><span class="line">C          a2</span><br><span class="line"></span><br><span class="line">           a1             200       2000</span><br><span class="line">           a2             800       8000</span><br></pre></td></tr></table></figure>
<p>While PARTITION BY had no visible effect on the output in the last example, there are situations where it will have an effect. These are described next.</p>
<h3 id="uniqueness-of-dimension-columns"><a class="markdownIt-Anchor" href="#uniqueness-of-dimension-columns">#</a> Uniqueness of Dimension Columns</h3>
<p>In the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjY0Lmh0bWw=">DIMENSION BY</span> tutorial we saw that a DIMENSION BY clause whose columns do not uniquely identify each result row generate an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 ) <span class="comment">-- group_2 is not unique</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_2</span><br><span class="line">;</span><br><span class="line">  t</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">5</span>:</span><br><span class="line">ORA<span class="number">-32638</span>: Non <span class="keyword">unique</span> addressing <span class="keyword">in</span> MODEL dimensions</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>With a partition clause this no longer happens, as long as the dimension values are unique within a partition.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> ( GROUP_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 ) <span class="comment">-- group_2 values are unique within group_1 values</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_2    NUM_VAL</span><br><span class="line">---------- -------</span><br><span class="line">a1             100</span><br><span class="line">a1             100</span><br><span class="line">a1</span><br><span class="line">a1             200</span><br><span class="line">a2             800</span><br><span class="line">a2             200</span><br><span class="line">a2</span><br><span class="line">a2             300</span><br><span class="line">a3             100</span><br><span class="line">a3             300</span><br></pre></td></tr></table></figure>
<p>If your dimension values are not unique within a partition you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  date_val ,</span><br><span class="line">  num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">partition</span> <span class="keyword">by</span> ( group_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( DATE_VAL ) <span class="comment">-- there are duplicate date values in group_1</span></span><br><span class="line">  measures     ( num_val )</span><br><span class="line">  rules        ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  date_val</span><br><span class="line">;</span><br><span class="line">  t</span><br><span class="line">  <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">6</span>:</span><br><span class="line">ORA<span class="number">-32638</span>: Non <span class="keyword">unique</span> addressing <span class="keyword">in</span> MODEL dimensions</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="aggregate-and-analytic-functions"><a class="markdownIt-Anchor" href="#aggregate-and-analytic-functions">#</a> Aggregate and Analytic Functions</h3>
<p>PARTITION BY also effects query results with aggregate and analytic functions. This effect is described in the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjcyLmh0bWw=">Aggregate and Analytic Expressions</span> tutorial.</p>
<h2 id="aggregate-and-analytic-functions-2"><a class="markdownIt-Anchor" href="#aggregate-and-analytic-functions-2">#</a> Aggregate and Analytic Functions</h2>
<p>Queries with a <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause cannot specify aggregate or analytic functions in their SELECT or ORDER BY lists. For example, this attempt generates an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  <span class="built_in">MIN</span>( GROUP_2 ) <span class="keyword">as</span> c_1 ,</span><br><span class="line">  <span class="built_in">MAX</span>( GROUP_2 ) <span class="keyword">as</span> c_2 ,</span><br><span class="line">  <span class="built_in">SUM</span>( NUM_VAL ) <span class="keyword">as</span> c_3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  group_1</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span>( group_1 )</span><br><span class="line">  measures    ( group_2, num_val )</span><br><span class="line">  rules ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1</span><br><span class="line">;</span><br><span class="line">  measures    ( group_2, num_val )</span><br><span class="line">                <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">12</span>:</span><br><span class="line">ORA<span class="number">-00979</span>: <span class="keyword">not</span> a <span class="keyword">GROUP</span> <span class="keyword">BY</span> expression</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>If needed, these functions can instead be specified in the PARTITION BY, DIMENSION BY, MEASURES, or RULES clauses. The following examples demonstrate their use in DIMENSION BY and MEASURES.</p>
<h5 id="aggregate-example"><a class="markdownIt-Anchor" href="#aggregate-example">#</a> Aggregate Example</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">column</span> d_1 format a10</span><br><span class="line"><span class="keyword">column</span> d_2 format a10</span><br><span class="line"><span class="keyword">column</span> m_1 format <span class="number">999999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1, d_1, d_2, m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">  group_1</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span></span><br><span class="line">  (</span><br><span class="line">    group_1 ,</span><br><span class="line">    <span class="built_in">MIN</span>( GROUP_2 ) <span class="keyword">as</span> d_1  ,</span><br><span class="line">    <span class="built_in">MAX</span>( GROUP_2 ) <span class="keyword">as</span> d_2</span><br><span class="line">  )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">SUM</span>( NUM_VAL ) <span class="keyword">as</span> m_1</span><br><span class="line">  )</span><br><span class="line">  rules ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    D_1        D_2            M_1</span><br><span class="line">---------- ---------- ---------- -------</span><br><span class="line">A          a1         a3             600</span><br><span class="line">B          a1         a3             400</span><br><span class="line">C          a1         a2             100</span><br><span class="line">           a1         a2            1000</span><br></pre></td></tr></table></figure>
<h5 id="analytic-example"><a class="markdownIt-Anchor" href="#analytic-example">#</a> Analytic Example</h5>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">column</span> d_1 format a10</span><br><span class="line"><span class="keyword">column</span> d_2 format a10</span><br><span class="line"><span class="keyword">column</span> m_1 format <span class="number">999999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1, group_2, d_1, d_2, num_val, m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span></span><br><span class="line">  (</span><br><span class="line">    group_1 ,</span><br><span class="line">    group_2 ,</span><br><span class="line">    <span class="built_in">MIN</span>( GROUP_2 ) <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> GROUP_1 ) <span class="keyword">as</span> d_1 ,</span><br><span class="line">    <span class="built_in">MAX</span>( GROUP_2 ) <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> GROUP_1 ) <span class="keyword">as</span> d_2</span><br><span class="line">  )</span><br><span class="line">  measures</span><br><span class="line">  ( num_val ,</span><br><span class="line">    <span class="built_in">SUM</span>( NUM_VAL ) <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> GROUP_1 ) <span class="keyword">as</span> m_1</span><br><span class="line">  )</span><br><span class="line">  rules ( )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    D_1        D_2        NUM_VAL     M_1</span><br><span class="line">---------- ---------- ---------- ---------- ------- -------</span><br><span class="line">A          a1         a1         a3             100     600</span><br><span class="line">A          a2         a1         a3             200     600</span><br><span class="line">A          a3         a1         a3             300     600</span><br><span class="line"></span><br><span class="line">B          a1         a1         a3                     400</span><br><span class="line">B          a2         a1         a3             300     400</span><br><span class="line">B          a3         a1         a3             100     400</span><br><span class="line"></span><br><span class="line">C          a1         a1         a2             100     100</span><br><span class="line">C          a2         a1         a2                     100</span><br><span class="line"></span><br><span class="line">           a1         a1         a2             200    1000</span><br><span class="line">           a2         a1         a2             800    1000</span><br></pre></td></tr></table></figure>
<h3 id="rules"><a class="markdownIt-Anchor" href="#rules">#</a> RULES</h3>
<p>You can also use aggregate and analytic functions in the RULES clause, but it is not as straightforward as using them in DIMENSION BY and MEASURES is. See the tutorial <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjcyLmh0bWw=">Aggregate and Analytic Expressions</span> for more information on this topic.</p>
<h2 id="aggregate-and-analytic-expressions"><a class="markdownIt-Anchor" href="#aggregate-and-analytic-expressions">#</a> Aggregate and Analytic Expressions</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on aggregate and analytic expressions. (See <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZXhwcmVzc2lvbnMwMTEuaHRt">Model Expressions</span> for full syntax.)</p>
<p>Aggregate and analytic functions can be used on the right hand side of a rule to process multiple cell values. They can not appear on the left hand side of rules. Both types of functions can take constants, bind variables, measure columns, or expressions involving them as arguments. Beyond that, aggregate functions can also specify a cell reference to restrict which cells they operate on. For example, in this snippet</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="number">3</span>] <span class="operator">=</span> <span class="built_in">SUM</span>( NUM_VAL )[ KEY <span class="keyword">IN</span> (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) ] )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL        M_1</span><br><span class="line">------ ------- ----------</span><br><span class="line">     1     100          0</span><br><span class="line">     2     200          0</span><br><span class="line">     3     300        600</span><br><span class="line">     4                  0</span><br><span class="line">     5     300          0</span><br><span class="line">     6     100          0</span><br><span class="line">     7     100          0</span><br><span class="line">     8                  0</span><br><span class="line">     9     200          0</span><br><span class="line">    10     800          0</span><br></pre></td></tr></table></figure>
<p>the aggregate function SUM takes the measure column NUM_VAL as an argument. The dimension reference  <code>[ KEY IN (1,2,3) ]</code>  restricts the function to three specific cell values.</p>
<p>Here is an analytic example. Note that analytic functions are not qualified with dimension references.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> m_1 )</span><br><span class="line">  rules        ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> <span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ( <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">DESC</span> ) )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     1         10</span><br><span class="line">     2          9</span><br><span class="line">     3          8</span><br><span class="line">     4          7</span><br><span class="line">     5          6</span><br><span class="line">     6          5</span><br><span class="line">     7          4</span><br><span class="line">     8          3</span><br><span class="line">     9          2</span><br><span class="line">    10          1</span><br></pre></td></tr></table></figure>
<p>The following two snippets perform similar logic. One uses analytic functions and the other aggregate functions. By using the  <code>CV()</code>  and  <code>ANY</code>  dimension references with the aggregate functions we see that they can produce the same results analytic functions do.</p>
<p><strong>Aggregate</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1 ,</span><br><span class="line">  m_2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val,</span><br><span class="line">    <span class="number">0</span> m_1,</span><br><span class="line">    <span class="number">0</span> m_2</span><br><span class="line">  )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    m_1[<span class="keyword">any</span>,<span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">MIN</span>( NUM_VAL )</span><br><span class="line">        [ CV(), <span class="keyword">ANY</span> ] ,</span><br><span class="line">    m_2[<span class="keyword">any</span>,<span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">MAX</span>( NUM_VAL )</span><br><span class="line">        [ CV(), <span class="keyword">ANY</span> ]</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    NUM_VAL        M_1        M_2</span><br><span class="line">---------- ------- ---------- ----------</span><br><span class="line">A              100        100        300</span><br><span class="line">A              200        100        300</span><br><span class="line">A              300        100        300</span><br><span class="line"></span><br><span class="line">B                         100        300</span><br><span class="line">B              300        100        300</span><br><span class="line">B              100        100        300</span><br><span class="line"></span><br><span class="line">C              100        100        100</span><br><span class="line">C                         100        100</span><br><span class="line"></span><br><span class="line">               200        200        800</span><br><span class="line">               800        200        800</span><br></pre></td></tr></table></figure>
<p><strong>Analytic</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1 ,</span><br><span class="line">  m_2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val,</span><br><span class="line">    <span class="number">0</span> m_1,</span><br><span class="line">    <span class="number">0</span> m_2</span><br><span class="line">  )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    m_1[<span class="keyword">any</span>,<span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">MIN</span>(NUM_VAL)</span><br><span class="line">      <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> (GROUP_1)),</span><br><span class="line">    m_2[<span class="keyword">any</span>,<span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">MAX</span>(NUM_VAL)</span><br><span class="line">      <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> (GROUP_1))</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    NUM_VAL        M_1        M_2</span><br><span class="line">---------- ------- ---------- ----------</span><br><span class="line">A              100        100        300</span><br><span class="line">A              200        100        300</span><br><span class="line">A              300        100        300</span><br><span class="line"></span><br><span class="line">B                         100        300</span><br><span class="line">B              300        100        300</span><br><span class="line">B              100        100        300</span><br><span class="line"></span><br><span class="line">C              100        100        100</span><br><span class="line">C                         100        100</span><br><span class="line"></span><br><span class="line">               200        200        800</span><br><span class="line">               800        200        800</span><br></pre></td></tr></table></figure>
<h3 id="partition-by-and-aggregate-functions"><a class="markdownIt-Anchor" href="#partition-by-and-aggregate-functions">#</a> PARTITION BY and Aggregate Functions</h3>
<p>To see how PARTITION BY affects aggregate functions, consider the following snippets. The one on the left does not use PARTITION BY. The one on the right does. As you can see, using PARTITION BY produces different values under M_1 than not using it.</p>
<p><strong>Without PARTITION BY</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( num_val, <span class="number">0</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  ( m_1[<span class="keyword">any</span>, <span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">SUM</span>(NUM_VAL)[<span class="keyword">ANY</span>, <span class="keyword">ANY</span>] )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ---------- ------- ----------</span><br><span class="line">A          a1             100       2100</span><br><span class="line">A          a2             200       2100</span><br><span class="line">A          a3             300       2100</span><br><span class="line"></span><br><span class="line">B          a1                       2100</span><br><span class="line">B          a2             300       2100</span><br><span class="line">B          a3             100       2100</span><br><span class="line"></span><br><span class="line">C          a1             100       2100</span><br><span class="line">C          a2                       2100</span><br><span class="line"></span><br><span class="line">           a1             200       2100</span><br><span class="line">           a2             800       2100</span><br></pre></td></tr></table></figure>
<p><strong>With PARTITION BY</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> ( GROUP_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( num_val , <span class="number">0</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  ( m_1[<span class="keyword">any</span>] <span class="operator">=</span> <span class="built_in">SUM</span>(NUM_VAL)[<span class="keyword">ANY</span>] )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  num_val</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    NUM_VAL        M_1</span><br><span class="line">---------- ---------- ------- ----------</span><br><span class="line">A          a1             100        600</span><br><span class="line">A          a2             200        600</span><br><span class="line">A          a3             300        600</span><br><span class="line"></span><br><span class="line">B          a1                        400</span><br><span class="line">B          a2             300        400</span><br><span class="line">B          a3             100        400</span><br><span class="line"></span><br><span class="line">C          a1             100        100</span><br><span class="line">C          a2                        100</span><br><span class="line"></span><br><span class="line">           a1             200       1000</span><br><span class="line">           a2             800       1000</span><br></pre></td></tr></table></figure>
<h3 id="partition-by-and-analytic-functions"><a class="markdownIt-Anchor" href="#partition-by-and-analytic-functions">#</a> PARTITION BY and Analytic Functions</h3>
<p>To see how PARTITION BY affects analytic functions, consider the following snippets. The one on the left does not use PARTITION BY. The one on the right does. Again, using PARTITION BY produces different values under M_1 than not using it.</p>
<p><strong>Without PARTITION BY</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="comment">--</span></span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures     ( <span class="number">0</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    m_1[<span class="keyword">any</span>, <span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">ROW_NUMBER</span>()</span><br><span class="line">      <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUP_1,GROUP_2)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2           M_1</span><br><span class="line">---------- ---------- ----------</span><br><span class="line">A          a1                  1</span><br><span class="line">A          a2                  2</span><br><span class="line">A          a3                  3</span><br><span class="line"></span><br><span class="line">B          a1                  4</span><br><span class="line">B          a2                  5</span><br><span class="line">B          a3                  6</span><br><span class="line"></span><br><span class="line">C          a1                  7</span><br><span class="line">C          a2                  8</span><br><span class="line"></span><br><span class="line">           a1                  9</span><br><span class="line">           a2                 10</span><br></pre></td></tr></table></figure>
<p><strong>With PARTITION BY</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2 ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> ( GROUP_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_2 )</span><br><span class="line">  measures     ( <span class="number">0</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">  (</span><br><span class="line">    m_1[<span class="keyword">any</span>] <span class="operator">=</span></span><br><span class="line">      <span class="built_in">ROW_NUMBER</span>()</span><br><span class="line">      <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUP_1, GROUP_2)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2           M_1</span><br><span class="line">---------- ---------- ----------</span><br><span class="line">A          a1                  1</span><br><span class="line">A          a2                  2</span><br><span class="line">A          a3                  3</span><br><span class="line"></span><br><span class="line">B          a1                  1</span><br><span class="line">B          a2                  2</span><br><span class="line">B          a3                  3</span><br><span class="line"></span><br><span class="line">C          a1                  1</span><br><span class="line">C          a2                  2</span><br><span class="line"></span><br><span class="line">           a1                  1</span><br><span class="line">           a2                  2</span><br></pre></td></tr></table></figure>
<h2 id="missing-cells-upsert"><a class="markdownIt-Anchor" href="#missing-cells-upsert">#</a> Missing Cells - UPSERT</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on UPSERT behaviour with cell assignments for missing cells.</p>
<p>By default, if a cell assignment targets a cell that does not exist then <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0JFSUdHR0ZK">UPSERT</span> logic is used to process the results. With UPSERT logic Oracle may or may not add a new cell (plus the associated cells in the new cell’s row) to the result set when it encounters a nonexistent dimension value, depending on the style of dimension reference used.</p>
<p>If a dimension reference uses a constant expression (aka “positional references”) then existing cells are updated and missing cells are created. In the example below the cell assignment with the KEY value “5” points to an existing cell, so it updates the cell to “5”. The ones with KEY values “0” and “-1” point to nonexistent dimension values so new cells are added to the results.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT</span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="number">0</span>                 ] <span class="operator">=</span> <span class="number">1</span>, <span class="comment">-- positional ref., nonexistent value</span></span><br><span class="line">    m_2[ <span class="number">5</span>                 ] <span class="operator">=</span> <span class="number">2</span>, <span class="comment">-- positional ref., existing value</span></span><br><span class="line">    m_3[ <span class="keyword">FOR</span> KEY <span class="keyword">IN</span> (<span class="number">-1</span>,<span class="number">5</span>) ] <span class="operator">=</span> <span class="number">3</span>  <span class="comment">-- positional ref., mixed</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">    -1                                      3</span><br><span class="line">     0                1</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br></pre></td></tr></table></figure>
<p>Note that FOR loops like  <code>FOR KEY IN (-1,5)</code>  are considered positional references.</p>
<p>If the dimension reference uses a boolean expression (aka a “symbolic reference”) that evaluates to FALSE, i.e. the cell assignment points to a missing cell, then the rule is ignored. In this example the rule for M_1 is applied where  <code>KEY = 5</code>  is TRUE. The rule for M_2 is never applied because  <code>KEY = 0</code>  is always FALSE.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT</span><br><span class="line">  (</span><br><span class="line">    m_1[ KEY <span class="operator">=</span> <span class="number">0</span>       ] <span class="operator">=</span> <span class="number">1</span> ,  <span class="comment">-- symbolic ref, nonexistent dimension val</span></span><br><span class="line">    m_2[ KEY <span class="operator">=</span> <span class="number">5</span>       ] <span class="operator">=</span> <span class="number">2</span> ,  <span class="comment">-- symbolic ref, existing dimension val</span></span><br><span class="line">    m_3[ KEY <span class="keyword">IN</span> (<span class="number">-1</span>,<span class="number">5</span>) ] <span class="operator">=</span> <span class="number">3</span>    <span class="comment">-- symbolic ref, mixed</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br></pre></td></tr></table></figure>
<p>Note that, unlike  <code>FOR KEY IN (-1,5)</code> , the dimension reference  <code>KEY IN (-1,5)</code>  is a symbolic reference.</p>
<p>UPSERT creates cells only when all the dimension references in a cell are either positional references to existing dimension values or symbolic references that evaluate to TRUE. No cells are created for any other combination. For example, the dimension references for the first and second rules below will not trigger new cells, those for the third and fourth will.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1, group_2, key_2, m_1, m_2, m_3, m_4</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_3 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_4</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT</span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="string">&#x27;A&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a4&#x27;</span> ] <span class="operator">=</span> <span class="number">1</span> , <span class="comment">-- positional, symbolic / existing   , FALSE</span></span><br><span class="line">    m_2[ <span class="string">&#x27;D&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a3&#x27;</span> ] <span class="operator">=</span> <span class="number">2</span> , <span class="comment">-- positional, symbolic / nonexistent, TRUE</span></span><br><span class="line">    m_3[ <span class="string">&#x27;A&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a3&#x27;</span> ] <span class="operator">=</span> <span class="number">3</span> , <span class="comment">-- positional, symbolic / existing   , TRUE</span></span><br><span class="line">    m_4[ <span class="string">&#x27;A&#x27;</span>, <span class="keyword">ANY</span>            ] <span class="operator">=</span> <span class="number">4</span>   <span class="comment">-- positional, symbolic / existing   , TRUE</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    KEY_2        M_1        M_2        M_3        M_4</span><br><span class="line">---------- ---------- ----- ---------- ---------- ---------- ----------</span><br><span class="line">A          a1         T-1                                             4</span><br><span class="line">A          a2         T-2                                             4</span><br><span class="line">A          a3         T-3                                  3          4</span><br><span class="line">B          a1         T-4</span><br><span class="line">B          a2         T-5</span><br><span class="line">B          a3         T-6</span><br><span class="line">C          a1         T-7</span><br><span class="line">C          a2         T-8</span><br><span class="line">           a1         T-9</span><br><span class="line">           a2         T-10</span><br></pre></td></tr></table></figure>
<p>In rules like the one for M_4 above note that “ANY” is a symbolic reference because it equates to (GROUP_1 IS NOT NULL OR GROUP_1 IS NULL).</p>
<h3 id="gotchas-5"><a class="markdownIt-Anchor" href="#gotchas-5">#</a> Gotchas</h3>
<p>Given that WHERE clauses are evaluated before MODEL clauses and given that UPSERT may create new cells, be aware that WHERE clauses with FALSE results will not necessarily lead to empty result sets when MODEL is used. Here is a good example of a query some people might expect a “no rows selected” result from, but in fact returns two rows.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, key_2, m_1, m_2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="number">1</span><span class="operator">=</span><span class="number">2</span>  <span class="comment">-- (1) no rows are returned from table T, initial result set is empty</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_2</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    M_1[ <span class="number">0</span> ] <span class="operator">=</span> <span class="number">1</span> ,  <span class="comment">-- (2) adds a new row to the result set</span></span><br><span class="line">    M_2[ <span class="number">5</span> ] <span class="operator">=</span> <span class="number">1</span>    <span class="comment">-- (3) adds another new row to the result set</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2</span><br><span class="line">------ ----- ---------- ----------</span><br><span class="line">     0                1</span><br><span class="line">     5                           1</span><br></pre></td></tr></table></figure>
<p>In this case, the row with a KEY value of 5 is a new row created by the rule for M<em>2. It is **_not</em>** related to the row in table T with a KEY value of ‘5’.</p>
<h2 id="missing-cells-upsert-all"><a class="markdownIt-Anchor" href="#missing-cells-upsert-all">#</a> Missing Cells - UPSERT ALL</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on UPSERT ALL behaviour with cell assignments for missing cells.</p>
<p><span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0JFSUpBRkZH">UPSERT ALL</span> behaviour is similar to UPSERT behaviour. If we specify UPSERT ALL for the first two examples used in the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjc0Lmh0bWw=">Missing Cells - UPSERT</span> tutorial we see that the output for both UPSERT and UPSERT ALL is identical. Missing cells are created when a dimension reference is positional and they are ignored when it is symbolic.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT <span class="keyword">ALL</span></span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="number">0</span>                 ] <span class="operator">=</span> <span class="number">1</span> ,  <span class="comment">-- positional reference</span></span><br><span class="line">    m_2[ <span class="number">5</span>                 ] <span class="operator">=</span> <span class="number">2</span> ,  <span class="comment">-- positional reference</span></span><br><span class="line">    m_3[ <span class="keyword">FOR</span> KEY <span class="keyword">IN</span> (<span class="number">-1</span>,<span class="number">5</span>) ] <span class="operator">=</span> <span class="number">3</span>    <span class="comment">-- positional reference</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">    -1                                      3</span><br><span class="line">     0                1</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension by ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    cast(null as number) m_1 ,</span><br><span class="line">    cast(null as number) m_2 ,</span><br><span class="line">    cast(null as number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT ALL</span><br><span class="line">  (</span><br><span class="line">    m_1[ KEY &#x3D; 0       ] &#x3D; 1 ,  -- symbolic reference</span><br><span class="line">    m_2[ KEY &#x3D; 5       ] &#x3D; 2 ,  -- symbolic reference</span><br><span class="line">    m_3[ KEY IN (-1,5) ] &#x3D; 3    -- symbolic reference</span><br><span class="line">  )</span><br><span class="line">order by</span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br></pre></td></tr></table></figure>
<h3 id="existential-predicates"><a class="markdownIt-Anchor" href="#existential-predicates">#</a> Existential Predicates</h3>
<p>The difference between UPSERT and UPSERT ALL becomes evident when there is a mix of symbolic and positional references. The <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0JFSUpBRkZH">Oracle® Database Data Warehousing Guide 10g Release 2 (10.2) - Chapter 22 - UPSERT ALL Behavior</span> describes it this way</p>
<p>“UPSERT ALL behavior allows model rules with existential predicates (comparisons, IN, ANY, and so on) in their left side to have UPSERT behavior.”</p>
<p><img data-src="https://www.sqlsnippets.com/en/artwork-2-surprise.gif" alt="img"><br>
© Copyright Lee, 2007</p>
<p>According to the Wikipedia entry for <span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FeGlzdGVudGlhbGlzbQ==">Existentialism</span></p>
<p>“existentialism is often associated with anxiety, dread, awareness of death, and freedom.”</p>
<p>Fear not though, existential predicates in SQL are not as angst-ridden as their philosophical namesake. A few examples will clarify matters.</p>
<p>Here is the third example from the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjc0Lmh0bWw=">Missing Cells - UPSERT</span> tutorial modified to use UPSERT ALL. Unlike with UPSERT, here we see that missing cells <strong><em>are</em></strong> created for M_2 even though it has a nonexistent positional reference.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1, group_2, key_2, m_1, m_2, m_3, m_4</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number ) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number ) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number ) m_3 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number ) m_4</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT <span class="keyword">ALL</span></span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="string">&#x27;A&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a4&#x27;</span> ] <span class="operator">=</span> <span class="number">1</span> , <span class="comment">-- positional, symbolic / existing   , FALSE</span></span><br><span class="line">    m_2[ <span class="string">&#x27;D&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a3&#x27;</span> ] <span class="operator">=</span> <span class="number">2</span> , <span class="comment">-- positional, symbolic / nonexistent, TRUE</span></span><br><span class="line">    m_3[ <span class="string">&#x27;A&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="string">&#x27;a3&#x27;</span> ] <span class="operator">=</span> <span class="number">3</span> , <span class="comment">-- positional, symbolic / existing   , TRUE</span></span><br><span class="line">    m_4[ <span class="string">&#x27;A&#x27;</span>, <span class="keyword">ANY</span>            ] <span class="operator">=</span> <span class="number">4</span>   <span class="comment">-- positional, symbolic / existing   , TRUE</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    KEY_2        M_1        M_2        M_3        M_4</span><br><span class="line">---------- ---------- ----- ---------- ---------- ---------- ----------</span><br><span class="line">A          a1         T-1                                             4</span><br><span class="line">A          a2         T-2                                             4</span><br><span class="line">A          a3         T-3                                  3          4</span><br><span class="line">B          a1         T-4</span><br><span class="line">B          a2         T-5</span><br><span class="line">B          a3         T-6</span><br><span class="line">C          a1         T-7</span><br><span class="line">C          a2         T-8</span><br><span class="line">D          a3                                   2</span><br><span class="line">           a1         T-9</span><br><span class="line">           a2         T-10</span><br></pre></td></tr></table></figure>
<p>UPSERT ALL created a cell for the M_2 rule because there was at least one row in the initial result set with  <code>GROUP_2 = 'a3'</code> , even though it was not paired with any GROUP_1 values of “D”.</p>
<p>Here are some more examples of existential predicates that match at least one row in the result set.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  group_1, group_2, key_2, m_1, m_2, m_3, m_4</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_3 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> number) m_4</span><br><span class="line">  )</span><br><span class="line">  rules UPSERT <span class="keyword">ALL</span></span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="string">&#x27;D&#x27;</span>, GROUP_2 <span class="operator">&gt;=</span> <span class="string">&#x27;a2&#x27;</span>               ] <span class="operator">=</span> <span class="number">1</span> ,</span><br><span class="line">    m_2[ <span class="string">&#x27;E&#x27;</span>, GROUP_2 <span class="keyword">in</span> ( <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;a4&#x27;</span> )     ] <span class="operator">=</span> <span class="number">2</span> ,</span><br><span class="line">    m_3[ <span class="string">&#x27;F&#x27;</span>, GROUP_2 <span class="operator">=</span> <span class="keyword">any</span> ( <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;a5&#x27;</span> )  ] <span class="operator">=</span> <span class="number">3</span> ,</span><br><span class="line">    m_4[ <span class="string">&#x27;G&#x27;</span>, GROUP_2 <span class="keyword">not</span> <span class="keyword">in</span> ( <span class="string">&#x27;a6&#x27;</span>, <span class="string">&#x27;a7&#x27;</span> ) ] <span class="operator">=</span> <span class="number">4</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    KEY_2        M_1        M_2        M_3        M_4</span><br><span class="line">---------- ---------- ----- ---------- ---------- ---------- ----------</span><br><span class="line">A          a1         T-1</span><br><span class="line">A          a2         T-2</span><br><span class="line">A          a3         T-3</span><br><span class="line">B          a1         T-4</span><br><span class="line">B          a2         T-5</span><br><span class="line">B          a3         T-6</span><br><span class="line">C          a1         T-7</span><br><span class="line">C          a2         T-8</span><br><span class="line">D          a2                        1</span><br><span class="line">D          a3                        1</span><br><span class="line">E          a3                                   2</span><br><span class="line">F          a3                                              3</span><br><span class="line">G          a1                                                         4</span><br><span class="line">G          a2                                                         4</span><br><span class="line">G          a3                                                         4</span><br><span class="line">           a1         T-9</span><br><span class="line">           a2         T-10</span><br></pre></td></tr></table></figure>
<h2 id="missing-cells-update"><a class="markdownIt-Anchor" href="#missing-cells-update">#</a> Missing Cells - UPDATE</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on UPDATE behaviour with cell assignments for missing cells.</p>
<p>Finally, we examine the last and simplest of the three available rule behaviours, <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0JFSUpIQ0lB">UPDATE</span>. Here are the three examples used in the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjc0Lmh0bWw=">Missing Cells - UPSERT</span> tutorial modified to use UPDATE behaviour. As you can see, missing cells are never created for nonexistent dimension references like ‘-1’, ‘0’, ‘D’, and ‘a4’ when UPDATE is specified.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_1 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_2 ,</span><br><span class="line">    <span class="built_in">cast</span>(<span class="keyword">null</span> <span class="keyword">as</span> number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPDATE</span><br><span class="line">  (</span><br><span class="line">    m_1[ <span class="number">0</span>                 ] <span class="operator">=</span> <span class="number">1</span> ,  <span class="comment">-- positional reference to nonexistent value</span></span><br><span class="line">    m_2[ <span class="number">5</span>                 ] <span class="operator">=</span> <span class="number">2</span> ,  <span class="comment">-- positional reference to existing value</span></span><br><span class="line">    m_3[ <span class="keyword">FOR</span> KEY <span class="keyword">IN</span> (<span class="number">-1</span>,<span class="number">5</span>) ] <span class="operator">=</span> <span class="number">3</span>    <span class="comment">-- positional reference to both</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">  key, key_2, m_1, m_2, m_3</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension by ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    cast(null as number) m_1 ,</span><br><span class="line">    cast(null as number) m_2 ,</span><br><span class="line">    cast(null as number) m_3</span><br><span class="line">  )</span><br><span class="line">  rules UPDATE</span><br><span class="line">  (</span><br><span class="line">    m_1[ KEY &#x3D; 0       ] &#x3D; 1 ,  -- symbolic ref. to nonexistent dimension value</span><br><span class="line">    m_2[ KEY &#x3D; 5       ] &#x3D; 2 ,  -- symbolic ref. to existing dimension value</span><br><span class="line">    m_3[ KEY IN (-1,5) ] &#x3D; 3    -- symbolic ref. to both</span><br><span class="line">  )</span><br><span class="line">order by</span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">   KEY KEY_2        M_1        M_2        M_3</span><br><span class="line">------ ----- ---------- ---------- ----------</span><br><span class="line">     1 T-1</span><br><span class="line">     2 T-2</span><br><span class="line">     3 T-3</span><br><span class="line">     4 T-4</span><br><span class="line">     5 T-5                       2          3</span><br><span class="line">     6 T-6</span><br><span class="line">     7 T-7</span><br><span class="line">     8 T-8</span><br><span class="line">     9 T-9</span><br><span class="line">    10 T-10</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">  group_1, group_2, key_2, m_1, m_2, m_3, m_4</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  dimension by ( group_1, group_2 )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    key_2 ,</span><br><span class="line">    cast( null as number) m_1 ,</span><br><span class="line">    cast( null as number) m_2 ,</span><br><span class="line">    cast( null as number) m_3 ,</span><br><span class="line">    cast( null as number) m_4</span><br><span class="line">  )</span><br><span class="line">  rules UPDATE</span><br><span class="line">  (</span><br><span class="line">    m_1[&#39;A&#39;, GROUP_2&#x3D;&#39;a4&#39;] &#x3D; 1, -- positional, symbolic &#x2F; existing, nonexistent</span><br><span class="line">    m_2[&#39;D&#39;, GROUP_2&#x3D;&#39;a3&#39;] &#x3D; 2, -- positional, symbolic &#x2F; nonexistent, existing</span><br><span class="line">    m_3[&#39;A&#39;, GROUP_2&#x3D;&#39;a3&#39;] &#x3D; 3, -- positional, symbolic &#x2F; existing, existing</span><br><span class="line">    m_4[&#39;A&#39;, ANY         ] &#x3D; 4  -- positional, symbolic &#x2F; existing, existing</span><br><span class="line">  )</span><br><span class="line">order by</span><br><span class="line">  group_1 ,</span><br><span class="line">  group_2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    GROUP_2    KEY_2        M_1        M_2        M_3        M_4</span><br><span class="line">---------- ---------- ----- ---------- ---------- ---------- ----------</span><br><span class="line">A          a1         T-1                                             4</span><br><span class="line">A          a2         T-2                                             4</span><br><span class="line">A          a3         T-3                                  3          4</span><br><span class="line">B          a1         T-4</span><br><span class="line">B          a2         T-5</span><br><span class="line">B          a3         T-6</span><br><span class="line">C          a1         T-7</span><br><span class="line">C          a2         T-8</span><br><span class="line">           a1         T-9</span><br><span class="line">           a2         T-10</span><br></pre></td></tr></table></figure>
<h2 id="missing-cells-right-side"><a class="markdownIt-Anchor" href="#missing-cells-right-side">#</a> Missing Cells - Right Side</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on cell references for missing cells on the right hand side of a rule.</p>
<p>By default, if a cell reference on the right hand side of a rule targets a cell that does not exist, the reference evaluates to NULL. In the following snippet dimension “0” does not exist in the result set.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">null</span> &quot;(null)&quot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_measure, text_measure, date_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    group_1 ,</span><br><span class="line">    date_val ,</span><br><span class="line">    <span class="number">123</span>              <span class="keyword">as</span> num_measure  ,</span><br><span class="line">    <span class="string">&#x27;abcdefghijklmn&#x27;</span> <span class="keyword">as</span> text_measure ,</span><br><span class="line">    sysdate          <span class="keyword">as</span> date_measure</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_measure [<span class="number">1</span>] <span class="operator">=</span> num_val [<span class="number">0</span>] ,</span><br><span class="line">    text_measure[<span class="number">1</span>] <span class="operator">=</span> group_1 [<span class="number">0</span>] ,</span><br><span class="line">    date_measure[<span class="number">1</span>] <span class="operator">=</span> date_val[<span class="number">0</span>]</span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_MEASURE TEXT_MEASURE   DATE_MEASU</span><br><span class="line">------ ----------- -------------- ----------</span><br><span class="line">     1 (null)      (null)         (null)</span><br></pre></td></tr></table></figure>
<p>Note that missing cell references are relative to the query results, not the base table. For example, in the following snippets dimension reference  <code>[2]</code>  points to an existing cell in the first snippet and a missing cell in the second.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_measure, text_measure, date_measure</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  KEY <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    group_1 ,</span><br><span class="line">    date_val ,</span><br><span class="line">    <span class="number">123</span>              <span class="keyword">as</span> num_measure  ,</span><br><span class="line">    <span class="string">&#x27;abcdefghijklmn&#x27;</span> <span class="keyword">as</span> text_measure ,</span><br><span class="line">    sysdate          <span class="keyword">as</span> date_measure</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_measure [<span class="keyword">any</span>] <span class="operator">=</span> num_val [<span class="number">2</span>] ,</span><br><span class="line">    text_measure[<span class="keyword">any</span>] <span class="operator">=</span> group_1 [<span class="number">2</span>] ,</span><br><span class="line">    date_measure[<span class="keyword">any</span>] <span class="operator">=</span> date_val[<span class="number">2</span>]</span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_MEASURE TEXT_MEASURE   DATE_MEASU</span><br><span class="line">------ ----------- -------------- ----------</span><br><span class="line">     2         200 A              2005-06-12</span><br><span class="line"></span><br><span class="line">select</span><br><span class="line">  key, num_measure, text_measure, date_measure</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">where</span><br><span class="line">  KEY &#x3D; 1  -- row with KEY &#x3D; &#39;2&#39; is not included this time</span><br><span class="line">model</span><br><span class="line">  dimension by ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    group_1 ,</span><br><span class="line">    date_val ,</span><br><span class="line">    123              as num_measure  ,</span><br><span class="line">    &#39;abcdefghijklmn&#39; as text_measure ,</span><br><span class="line">    sysdate          as date_measure</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_measure [any] &#x3D; num_val [2] ,</span><br><span class="line">    text_measure[any] &#x3D; group_1 [2] ,</span><br><span class="line">    date_measure[any] &#x3D; date_val[2]</span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_MEASURE TEXT_MEASURE   DATE_MEASU</span><br><span class="line">------ ----------- -------------- ----------</span><br><span class="line">     1 (null)      (null)         (null)</span><br></pre></td></tr></table></figure>
<h3 id="ignore-nav"><a class="markdownIt-Anchor" href="#ignore-nav">#</a> IGNORE NAV</h3>
<p>You can control missing cell behaviour with the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jc3RocmVmOTg2Nw==">IGNORE NAV</span> option which causes Oracle to return</p>
<ul>
<li>0 for missing numeric data</li>
<li>an empty string for missing character/string data</li>
<li>01-JAN-2000 for missing date data</li>
<li>NULL for all other data types.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> session <span class="keyword">set</span> nls_date_format <span class="operator">=</span> <span class="string">&#x27;YYYY-MM-DD&#x27;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">  key, num_measure, text_measure, date_measure</span><br><span class="line">from</span><br><span class="line">  t</span><br><span class="line">where</span><br><span class="line">  key &#x3D; 1</span><br><span class="line">model</span><br><span class="line">  IGNORE NAV</span><br><span class="line">  dimension by ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    group_1 ,</span><br><span class="line">    date_val ,</span><br><span class="line">    123          as num_measure  ,</span><br><span class="line">    &#39;abcdefghij&#39; as text_measure ,</span><br><span class="line">    sysdate      as date_measure</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  ( num_measure [1] &#x3D; num_val [0] ,</span><br><span class="line">    text_measure[1] &#x3D; group_1 [0] ,</span><br><span class="line">    date_measure[1] &#x3D; date_val[0]</span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_MEASURE TEXT_MEASU DATE_MEASU</span><br><span class="line">------ ----------- ---------- ----------</span><br><span class="line">     1           0 (null)     2000-01-01</span><br></pre></td></tr></table></figure>
<p>Note that in <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI0JFSUVHRkVI">Oracle® Database Data Warehousing Guide 10g Release 2 (10.2) - Chapter 22 - Treatment of NULLs and Missing Cells</span> it incorrectly states that “01-JAN-2001” is returned for missing data data. The correct value, “01-JAN-2000”, is documented in <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">Oracle® Database SQL Reference 10g Release 2 (10.2) - SELECT - model_clause</span>.</p>
<h3 id="is-present-presentv-and-presentnnv"><a class="markdownIt-Anchor" href="#is-present-presentv-and-presentnnv">#</a> IS PRESENT, PRESENTV, and PRESENTNNV</h3>
<p>If you need to distinguish between NULL values from your data and NULL values representing missing cells you can use the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvY29uZGl0aW9uczAwNS5odG0jaTEwNTM5NjM=">IS PRESENT</span> condition or the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZnVuY3Rpb25zMTIxLmh0bQ==">PRESENTV</span> and <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZnVuY3Rpb25zMTIwLmh0bSNpMTI5ODAyNg==">PRESENTNNV</span> functions on the right hand side of a rule.</p>
<p>Here is an example of their use. Note that cell references with a dimension of “0” point to cells that were missing from the result set before the MODEL clause was executed.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_val, num_val_is_present, presentv_num_val, presentnnv_num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="keyword">in</span> ( <span class="number">1</span>, <span class="number">4</span> )</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> num_val_is_present ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentv_num_val   ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentnnv_num_val</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_val_is_present[<span class="number">0</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> ,</span><br><span class="line">    num_val_is_present[<span class="number">1</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> ,</span><br><span class="line">    num_val_is_present[<span class="number">4</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> ,</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    presentv_num_val  [<span class="number">0</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentv_num_val  [<span class="number">1</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentv_num_val  [<span class="number">4</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    presentnnv_num_val[<span class="number">0</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">1</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">4</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL NUM_VAL_IS_PRESENT   PRESENTV_NUM_VAL     PRESENTNNV_NUM_VAL</span><br><span class="line">------ ------- -------------------- -------------------- --------------------</span><br><span class="line">     0 (null)  FALSE                expr 2               expr 2</span><br><span class="line">     1     100 TRUE                 expr 1               expr 1</span><br><span class="line">     4 (null)  TRUE                 expr 1               expr 2</span><br></pre></td></tr></table></figure>
<p>It is important to note that these three functions consider a cell missing if it does not exist <strong><em>before the MODEL clause is executed</em></strong>. They will return the same results as above even when the cell they reference is created, via a rule, before the functions are called. The following variation of the last snippet demonstrates this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_val, num_val_is_present, presentv_num_val, presentnnv_num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="keyword">in</span> ( <span class="number">1</span>, <span class="number">4</span> )</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> num_val_is_present ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentv_num_val   ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentnnv_num_val</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_val[<span class="number">0</span>] <span class="operator">=</span> <span class="number">0</span> , <span class="comment">--(1)</span></span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    num_val_is_present[<span class="number">0</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> , <span class="comment">--(2)</span></span><br><span class="line">    num_val_is_present[<span class="number">1</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> ,</span><br><span class="line">    num_val_is_present[<span class="number">4</span>] <span class="operator">=</span></span><br><span class="line">      <span class="keyword">case</span> <span class="keyword">when</span> num_val[cv()] <span class="keyword">IS</span> PRESENT <span class="keyword">then</span> <span class="string">&#x27;TRUE&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;FALSE&#x27;</span> <span class="keyword">end</span> ,</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    presentv_num_val  [<span class="number">0</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>), <span class="comment">--(3)</span></span><br><span class="line">    presentv_num_val  [<span class="number">1</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentv_num_val  [<span class="number">4</span>] <span class="operator">=</span> PRESENTV  (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    presentnnv_num_val[<span class="number">0</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>), <span class="comment">--(4)</span></span><br><span class="line">    presentnnv_num_val[<span class="number">1</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">4</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- (1) num_val[0] is created</span></span><br><span class="line"><span class="comment">-- (2) still yields FALSE</span></span><br><span class="line"><span class="comment">-- (3) still yields &#x27;expr 2&#x27;</span></span><br><span class="line"><span class="comment">-- (4) still yields &#x27;expr 2&#x27;</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL NUM_VAL_IS_PRESENT   PRESENTV_NUM_VAL     PRESENTNNV_NUM_VAL</span><br><span class="line">------ ------- -------------------- -------------------- --------------------</span><br><span class="line">     0       0 FALSE                expr 2               expr 2</span><br><span class="line">     1     100 TRUE                 expr 1               expr 1</span><br><span class="line">     4 (null)  TRUE                 expr 1               expr 2</span><br></pre></td></tr></table></figure>
<p>Other SQL functions, such as PRESENTNNV’s close cousin <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZnVuY3Rpb25zMTA2Lmh0bSNpOTE4MDY=">NVL2</span>, operate on cells as they appear <strong><em>at the time the function is called</em></strong>. The following two snippets demonstrate the difference between PRESENTNNV and NVL2. 1</p>
<p>In this first snippet the results are the same for both functions.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_val, presentnnv_num_val, nvl2_num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="keyword">in</span> ( <span class="number">1</span>, <span class="number">4</span> )</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> num_val_is_present ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentv_num_val   ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentnnv_num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> nvl2_num_val</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    presentnnv_num_val[<span class="number">0</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">1</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">4</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    nvl2_num_val      [<span class="number">0</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    nvl2_num_val      [<span class="number">1</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    nvl2_num_val      [<span class="number">4</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL PRESENTNNV_NUM_VAL   NVL2_NUM_VAL</span><br><span class="line">------ ------- -------------------- --------------------</span><br><span class="line">     0 (null)  expr 2               expr 2</span><br><span class="line">     1     100 expr 1               expr 1</span><br><span class="line">     4 (null)  expr 2               expr 2</span><br></pre></td></tr></table></figure>
<p>In this next snippet the first rule creates cell “NUM_VAL[0]”. The results for NVL2 now differ from those of PRESENTNNV.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, num_val, presentnnv_num_val, nvl2_num_val</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="keyword">in</span> ( <span class="number">1</span>, <span class="number">4</span> )</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> presentnnv_num_val ,</span><br><span class="line">    <span class="built_in">cast</span> ( <span class="string">&#x27;default&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> nvl2_num_val</span><br><span class="line">  )</span><br><span class="line">  rules upsert</span><br><span class="line">  (</span><br><span class="line">    num_val[<span class="number">0</span>] <span class="operator">=</span> <span class="number">0</span> , <span class="comment">--(1)</span></span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    presentnnv_num_val[<span class="number">0</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>), <span class="comment">--(2)</span></span><br><span class="line">    presentnnv_num_val[<span class="number">1</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    presentnnv_num_val[<span class="number">4</span>] <span class="operator">=</span> PRESENTNNV(num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    <span class="comment">--</span></span><br><span class="line">    nvl2_num_val      [<span class="number">0</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>), <span class="comment">--(3)</span></span><br><span class="line">    nvl2_num_val      [<span class="number">1</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>),</span><br><span class="line">    nvl2_num_val      [<span class="number">4</span>] <span class="operator">=</span> NVL2      (num_val[cv()], <span class="string">&#x27;expr 1&#x27;</span>, <span class="string">&#x27;expr 2&#x27;</span>)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- (1) num_val[0] is created</span></span><br><span class="line"><span class="comment">-- (2) still yields &#x27;expr 2&#x27;</span></span><br><span class="line"><span class="comment">-- (3) yields &#x27;expr 1&#x27; this time</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY NUM_VAL PRESENTNNV_NUM_VAL   NVL2_NUM_VAL</span><br><span class="line">------ ------- -------------------- --------------------</span><br><span class="line">     0       0 expr 2               expr 1</span><br><span class="line">     1     100 expr 1               expr 1</span><br><span class="line">     4 (null)  expr 2               expr 2</span><br></pre></td></tr></table></figure>
<h3 id="acknowledgements"><a class="markdownIt-Anchor" href="#acknowledgements">#</a> Acknowledgements</h3>
<ol>
<li><span class="exturl" data-url="aHR0cDovL2ZvcnVtcy5vcmFjbGUuY29tL2ZvcnVtcy9tZXNzYWdlLmpzcGE/bWVzc2FnZUlEPTE2NzQ2NzMjMTY3NTQzMw==">Re: PRESENTNNV vs NVL2</span> by OTN user martyn</li>
</ol>
<h2 id="iterate"><a class="markdownIt-Anchor" href="#iterate">#</a> ITERATE</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on rule iteration.</p>
<p>To repetetively execute rules use the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMjMvc3FsbW9kZWwuaHRtI2kxMDEyNDk2">ITERATE</span> feature. For example, to repeat a rule exactly five times you can use ITERATE like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="string">&#x27;m_1: &#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    ITERATE (<span class="number">5</span>)</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">||</span> <span class="string">&#x27;x&#x27;</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY M_1</span><br><span class="line">------ --------------------</span><br><span class="line">     0 m_1: xxxxx</span><br></pre></td></tr></table></figure>
<p>The maximum number of iterations allowed (as tested in Oracle 10g XE) is 4,294,967,295 (i.e. 4Gig - 1).</p>
<p>If you specify more than one rule, let’s use three as an example, processing proceeds as follows</p>
<ul>
<li>Rule 1 is executed in the first iteration</li>
<li>Rule 2 is executed in the first iteration</li>
<li>Rule 3 is executed in the first iteration</li>
<li>Rule 1 is executed in the second iteration</li>
<li>Rule 2 is executed in the second iteration</li>
<li>Rule 3 is executed in the second iteration</li>
<li>…</li>
<li>Rule 1 is executed in the X’th iteration</li>
<li>Rule 2 is executed in the X’th iteration</li>
<li>Rule 3 is executed in the X’th iteration</li>
</ul>
<p>not</p>
<ul>
<li>Rule 1 is executed X times</li>
<li>Rule 2 is executed X times</li>
<li>Rule 3 is executed X times</li>
</ul>
<p>The following example demonstrates rule iteration order.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> varchar2(<span class="number">15</span>) ) <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules sequential <span class="keyword">order</span></span><br><span class="line">    ITERATE (<span class="number">5</span>)</span><br><span class="line">    (</span><br><span class="line">      m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">||</span> <span class="string">&#x27;x&#x27;</span> ,  <span class="comment">-- Rule 1</span></span><br><span class="line">      m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">||</span> <span class="string">&#x27;y&#x27;</span>    <span class="comment">-- Rule 2</span></span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY M_1</span><br><span class="line">------ ---------------</span><br><span class="line">     0 xyxyxyxyxy</span><br></pre></td></tr></table></figure>
<h3 id="until"><a class="markdownIt-Anchor" href="#until">#</a> UNTIL()</h3>
<p>You can specify an early termination condition using an UNTIL clause.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate (<span class="number">100</span>) UNTIL M_1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">50</span></span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     0         50</span><br></pre></td></tr></table></figure>
<p>The UNTIL clause is checked at the end of each iteration. This means iterated rules will always be executed at least once.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate (<span class="number">100</span>) UNTIL ( <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     0         10</span><br></pre></td></tr></table></figure>
<h3 id="previous"><a class="markdownIt-Anchor" href="#previous">#</a> PREVIOUS()</h3>
<p>If you need to, you can reference the previous value of a cell in the UNTIL clause using the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvZnVuY3Rpb25zMTIyLmh0bSNpMTMwNjAwMQ==">PREVIOUS()</span> function.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate (<span class="number">100</span>) until PREVIOUS( m_1[<span class="number">0</span>] ) <span class="operator">=</span> <span class="number">50</span></span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     0         60</span><br></pre></td></tr></table></figure>
<h3 id="iteration_number"><a class="markdownIt-Anchor" href="#iteration_number">#</a> ITERATION_NUMBER</h3>
<p>The ITERATION_NUMBER function lets you access the current iteration number in repetetive rule calculations.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> varchar2(<span class="number">60</span>) ) <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate (<span class="number">3</span>)</span><br><span class="line">    (</span><br><span class="line">      m_1[<span class="number">0</span>] <span class="operator">=</span></span><br><span class="line">        m_1[<span class="number">0</span>] <span class="operator">||</span></span><br><span class="line">        <span class="string">&#x27;iteration_number=&#x27;</span> <span class="operator">||</span></span><br><span class="line">        to_char( ITERATION_NUMBER ) <span class="operator">||</span></span><br><span class="line">        <span class="string">&#x27; &#x27;</span></span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY M_1</span><br><span class="line">------ ------------------------------------------------------------</span><br><span class="line">     0 iteration_number&#x3D;0 iteration_number&#x3D;1 iteration_number&#x3D;2</span><br></pre></td></tr></table></figure>
<p>Note that ITERATION_NUMBER starts at “0”.</p>
<p>Unlike PREVIOUS(), which can only be used in the UNTIL clause, ITERATION_NUMBER can appear anywhere in a main model rule. In the following example ITERATION_NUMBER is used in the UNTIL clause, as a dimension reference, and in an expression on the right side of a rule.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    upsert</span><br><span class="line">    iterate (<span class="number">10</span>) until ( ITERATION_NUMBER <span class="operator">=</span> <span class="number">5</span> )</span><br><span class="line">    (</span><br><span class="line">      m_1[ITERATION_NUMBER] <span class="operator">=</span> ITERATION_NUMBER <span class="operator">*</span> <span class="number">10</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   KEY        M_1</span><br><span class="line">------ ----------</span><br><span class="line">     0          0</span><br><span class="line">     1         10</span><br><span class="line">     2         20</span><br><span class="line">     3         30</span><br><span class="line">     4         40</span><br><span class="line">     5         50</span><br></pre></td></tr></table></figure>
<h3 id="partition-by"><a class="markdownIt-Anchor" href="#partition-by">#</a> PARTITION BY</h3>
<p>When the PARTITION BY clause is used ITERATE(n) causes rules to be iterated n times for <strong><em>each</em></strong> distinct partitioned value. For example, the following query repeats its rule five times for each of the three distinct values in GROUP_1, leading to a total of 15 rule iterations.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> group_1, iteration_count</span><br><span class="line"><span class="keyword">from</span>   ( <span class="keyword">select</span> <span class="keyword">distinct</span> group_1 <span class="keyword">from</span> t <span class="keyword">where</span> group_1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span> ) t_a</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">partition</span> <span class="keyword">by</span> ( group_1 )</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="keyword">null</span> <span class="keyword">as</span> varchar2(<span class="number">15</span>) ) <span class="keyword">as</span> iteration_count )</span><br><span class="line">  rules iterate( <span class="number">5</span> )</span><br><span class="line">    ( iteration_count[<span class="number">0</span>] <span class="operator">=</span> iteration_count[<span class="number">0</span>] <span class="operator">||</span> to_char(iteration_number) <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GROUP_1    ITERATION_COUNT</span><br><span class="line">---------- ---------------</span><br><span class="line">A          0 1 2 3 4</span><br><span class="line">B          0 1 2 3 4</span><br><span class="line">C          0 1 2 3 4</span><br></pre></td></tr></table></figure>
<h3 id="gotchas-6"><a class="markdownIt-Anchor" href="#gotchas-6">#</a> Gotchas</h3>
<p>You can only use PREVIOUS in the UNTIL clause. If you use it elsewhere you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate (<span class="number">5</span>)</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> PREVIOUS(m_1[<span class="number">0</span>]) <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> PREVIOUS(m_1[<span class="number">0</span>]) <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">               <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">11</span>:</span><br><span class="line">ORA<span class="number">-32618</span>: incorrect use <span class="keyword">of</span> MODEL PREVIOUS <span class="keyword">function</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Keep in mind that referencing the current value of a cell on the right hand side of an iterated rule automatically gives you the previous value (assuming no other rules change the cell). Attempting to use PREVIOUS in the example above was a redundant effort.</p>
<p>ITERATION_NUMBER cannot be used in DIMENSION BY or MEASURES clauses.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( ITERATION_NUMBER <span class="keyword">as</span> key )  <span class="comment">-- not allowed</span></span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    upsert</span><br><span class="line">    iterate (<span class="number">10</span>)</span><br><span class="line">    (</span><br><span class="line">      m_1[iteration_number] <span class="operator">=</span> iteration_number <span class="operator">*</span> <span class="number">10</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  dimension <span class="keyword">by</span> ( ITERATION_NUMBER <span class="keyword">as</span> key )  <span class="comment">-- not allowed</span></span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">7</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: &quot;ITERATION_NUMBER&quot;: invalid identifier</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( ITERATION_NUMBER <span class="keyword">as</span> m_1 )  <span class="comment">-- not allowed</span></span><br><span class="line">  rules</span><br><span class="line">    upsert</span><br><span class="line">    iterate (<span class="number">10</span>)</span><br><span class="line">    (</span><br><span class="line">      m_1[iteration_number] <span class="operator">=</span> iteration_number <span class="operator">*</span> <span class="number">10</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">  measures     ( ITERATION_NUMBER <span class="keyword">as</span> m_1 )  <span class="comment">-- not allowed</span></span><br><span class="line">                 <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">8</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: &quot;ITERATION_NUMBER&quot;: invalid identifier</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>If you specify more than 4,294,967,295 iterations you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate ( <span class="number">4294967296</span> ) UNTIL ( <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br><span class="line">    iterate ( <span class="number">4294967296</span> ) UNTIL ( <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line">              <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-32607</span>: invalid ITERATE <span class="keyword">value</span> <span class="keyword">in</span> MODEL clause</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m_1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m_1 )</span><br><span class="line">  rules</span><br><span class="line">    iterate ( binary_float_infinity ) UNTIL ( <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line">    ( m_1[<span class="number">0</span>] <span class="operator">=</span> m_1[<span class="number">0</span>] <span class="operator">+</span> <span class="number">10</span> )</span><br><span class="line">;</span><br><span class="line">    iterate ( binary_float_infinity ) UNTIL ( <span class="number">1</span> <span class="operator">=</span> <span class="number">1</span> )</span><br><span class="line">              <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">10</span>:</span><br><span class="line">ORA<span class="number">-32607</span>: invalid ITERATE <span class="keyword">value</span> <span class="keyword">in</span> MODEL clause</span><br></pre></td></tr></table></figure>
<h2 id="sequential-and-automatic-order"><a class="markdownIt-Anchor" href="#sequential-and-automatic-order">#</a> SEQUENTIAL and AUTOMATIC ORDER</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on the order of evaluation when multiple rules are defined.</p>
<h3 id="sequential-order"><a class="markdownIt-Anchor" href="#sequential-order">#</a> SEQUENTIAL ORDER</h3>
<p>By default, Oracle evaluates rules in the order they appear in the RULES clause. This is know as SEQUENTIAL ORDER. For example, consider the following query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1, m2, m3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">model</span><br><span class="line">  ignore nav</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1, <span class="number">0</span> <span class="keyword">as</span> m2, <span class="number">0</span> <span class="keyword">as</span> m3 )</span><br><span class="line">  rules</span><br><span class="line">    update</span><br><span class="line">    SEQUENTIAL <span class="keyword">ORDER</span>  <span class="comment">-- this line optional, SEQUENTIAL ORDER is the default</span></span><br><span class="line">  (</span><br><span class="line">    m1[<span class="keyword">any</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ] ,  <span class="comment">-- rule 1</span></span><br><span class="line">    m2[<span class="keyword">any</span>] <span class="operator">=</span> cv(key)        ,  <span class="comment">-- rule 2</span></span><br><span class="line">    m3[<span class="keyword">any</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ]    <span class="comment">-- rule 3</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY         M1         M2         M3</span><br><span class="line">------ ---------- ---------- ----------</span><br><span class="line">     1          0          1          2</span><br><span class="line">     2          0          2          3</span><br><span class="line">     3          0          3          0</span><br></pre></td></tr></table></figure>
<p>The results show that processing occured in this fashion</p>
<ol>
<li>Rule 1 is applied to cell m1[1]</li>
<li>Rule 1 is applied to cell m1[2]</li>
<li>Rule 1 is applied to cell m1[3]</li>
<li>Rule 2 is applied to cell m2[1]</li>
<li>Rule 2 is applied to cell m2[2]</li>
<li>Rule 2 is applied to cell m2[3]</li>
<li>Rule 3 is applied to cell m3[1]</li>
<li>Rule 3 is applied to cell m3[2]</li>
<li>Rule 3 is applied to cell m3[3]</li>
</ol>
<p>not this fashion.</p>
<ol>
<li>Rule 1 is applied to cell m1[1]</li>
<li>Rule 2 is applied to cell m2[1]</li>
<li>Rule 3 is applied to cell m3[1]</li>
<li>Rule 1 is applied to cell m1[2]</li>
<li>Rule 2 is applied to cell m2[2]</li>
<li>Rule 3 is applied to cell m3[2]</li>
<li>Rule 1 is applied to cell m1[3]</li>
<li>Rule 2 is applied to cell m2[3]</li>
<li>Rule 3 is applied to cell m3[3]</li>
</ol>
<p>If you need the second behaviour, you can use SEQUENTIAL ORDER with the ITERATE feature described in the <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTExNjg2Lmh0bWw=">ITERATE</span> tutorial.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1, m2, m3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">model</span><br><span class="line">  ignore nav</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1, <span class="number">0</span> <span class="keyword">as</span> m2, <span class="number">0</span> <span class="keyword">as</span> m3 )</span><br><span class="line">  rules</span><br><span class="line">    update</span><br><span class="line">    SEQUENTIAL <span class="keyword">ORDER</span></span><br><span class="line">    ITERATE (<span class="number">3</span>)</span><br><span class="line">  (</span><br><span class="line">    m1[ITERATION_NUMBER<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ] ,  <span class="comment">-- rule 1</span></span><br><span class="line">    m2[ITERATION_NUMBER<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> cv(key)        ,  <span class="comment">-- rule 2</span></span><br><span class="line">    m3[ITERATION_NUMBER<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ]    <span class="comment">-- rule 3</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY         M1         M2         M3</span><br><span class="line">------ ---------- ---------- ----------</span><br><span class="line">     1          0          1          0</span><br><span class="line">     2          0          2          0</span><br><span class="line">     3          0          3          0</span><br></pre></td></tr></table></figure>
<h3 id="automatic-order"><a class="markdownIt-Anchor" href="#automatic-order">#</a> AUTOMATIC ORDER</h3>
<p>In addition to SEQUENTIAL ORDER there is another rule ordering behaviour available. It is called AUTOMATIC ORDER. With AUTOMATIC ORDER Oracle determines rule evaluation order based on the dependencies between rules. Consider the following example.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1, m2, m3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">model</span><br><span class="line">  ignore nav</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1, <span class="number">0</span> <span class="keyword">as</span> m2, <span class="number">0</span> <span class="keyword">as</span> m3 )</span><br><span class="line">  rules</span><br><span class="line">    update</span><br><span class="line">    AUTOMATIC <span class="keyword">ORDER</span></span><br><span class="line">  (</span><br><span class="line">    m1[<span class="keyword">any</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ] ,  <span class="comment">-- rule 1</span></span><br><span class="line">    m2[<span class="keyword">any</span>] <span class="operator">=</span> cv(key)        ,  <span class="comment">-- rule 2</span></span><br><span class="line">    m3[<span class="keyword">any</span>] <span class="operator">=</span> m2[ cv() <span class="operator">+</span> <span class="number">1</span> ]    <span class="comment">-- rule 3</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   KEY         M1         M2         M3</span><br><span class="line">------ ---------- ---------- ----------</span><br><span class="line">     1          2          1          2</span><br><span class="line">     2          3          2          3</span><br><span class="line">     3          0          3          0</span><br></pre></td></tr></table></figure>
<p>Unlike SEQUENTIAL ORDER, these results show that AUTOMATIC ORDER caused Oracle to evaluate rule 2 before rules 1 and 3 because rules 1 and 3 depend on the measure modified by rule 2.</p>
<h3 id="multiple-cell-assignments"><a class="markdownIt-Anchor" href="#multiple-cell-assignments">#</a> Multiple Cell Assignments</h3>
<p>With SEQUENTIAL ORDER the same cell can be assigned a value many different times.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1 )</span><br><span class="line">  rules SEQUENTIAL <span class="keyword">ORDER</span></span><br><span class="line">  (</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">10</span> ,</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">20</span> ,</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">  )</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   KEY         M1</span><br><span class="line">------ ----------</span><br><span class="line">     0         30</span><br></pre></td></tr></table></figure>
<p>With AUTOMATIC ORDER you can assign a value to a cell only once. Attempting to do otherwise will produce an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  dual</span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( <span class="number">0</span> <span class="keyword">as</span> key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1 )</span><br><span class="line">  rules AUTOMATIC <span class="keyword">ORDER</span></span><br><span class="line">  (</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">10</span> ,</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">20</span> ,</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">30</span></span><br><span class="line">  )</span><br><span class="line">;</span><br><span class="line">    M1[<span class="number">0</span>] <span class="operator">=</span> <span class="number">20</span> ,</span><br><span class="line">    <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">11</span>:</span><br><span class="line">ORA<span class="number">-32630</span>: multiple assignment <span class="keyword">in</span> automatic <span class="keyword">order</span> MODEL</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="gotchas-7"><a class="markdownIt-Anchor" href="#gotchas-7">#</a> Gotchas</h3>
<p>You cannot use ITERATE with AUTOMATIC ORDER.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, m1, m2, m3</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">3</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="number">0</span> <span class="keyword">as</span> m1, <span class="number">0</span> <span class="keyword">as</span> m2, <span class="number">0</span> <span class="keyword">as</span> m3 )</span><br><span class="line">  rules</span><br><span class="line">    AUTOMATIC <span class="keyword">ORDER</span></span><br><span class="line">    ITERATE (<span class="number">3</span>)</span><br><span class="line">  (</span><br><span class="line">    m1[iteration_number<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> <span class="built_in">sum</span>( m2 )[<span class="keyword">any</span>] ,  <span class="comment">-- rule 1</span></span><br><span class="line">    m2[iteration_number<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> <span class="number">1</span>              ,  <span class="comment">-- rule 2</span></span><br><span class="line">    m3[iteration_number<span class="operator">+</span><span class="number">1</span>] <span class="operator">=</span> <span class="built_in">sum</span>( m2 )[<span class="keyword">any</span>]    <span class="comment">-- rule 3</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">    ITERATE (<span class="number">3</span>)</span><br><span class="line">    <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">12</span>:</span><br><span class="line">ORA<span class="number">-32607</span>: invalid ITERATE <span class="keyword">value</span> <span class="keyword">in</span> MODEL clause</span><br></pre></td></tr></table></figure>
<h2 id="ordered-rules"><a class="markdownIt-Anchor" href="#ordered-rules">#</a> Ordered Rules</h2>
<p>In this tutorial we continue exploring the RULES part of the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause with a focus on rules that use an ORDER BY clause, also known as ordered rules.</p>
<p>In addition to controlling the evaluation order of different rules, as we saw with sequential and automatic ordering in a previous tutorial, you can also control the assignment order of different cells targeted by a single rule. To do this we specify an ORDER BY clause after a cell reference. This is useful when a rule uses the ANY keyword or a symbolic reference on its left side. Here is an example of two very similar rules. One processes cells in ascending domain value order. The other processes cells in descending domain value order.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m1 ,</span><br><span class="line">  m2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m2</span><br><span class="line">  )</span><br><span class="line">  rules sequential <span class="keyword">order</span></span><br><span class="line">  (</span><br><span class="line">    m1[<span class="keyword">any</span>] <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">ASC</span>  <span class="operator">=</span> m1[ cv(key) <span class="operator">-</span> <span class="number">1</span> ] <span class="operator">||</span> <span class="string">&#x27;* &#x27;</span> , <span class="comment">-- rule 1</span></span><br><span class="line">    m2[<span class="keyword">any</span>] <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">DESC</span> <span class="operator">=</span> m2[ cv(key) <span class="operator">-</span> <span class="number">1</span> ] <span class="operator">||</span> <span class="string">&#x27;* &#x27;</span>   <span class="comment">-- rule 2</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   KEY M1                   M2</span><br><span class="line">------ -------------------- --------------------</span><br><span class="line">     1 *                    *</span><br><span class="line">     2 * *                  -*</span><br><span class="line">     3 * * *                -*</span><br><span class="line">     4 * * * *              -*</span><br><span class="line">     5 * * * * *            -*</span><br></pre></td></tr></table></figure>
<p>To understand these results it helps to imagine how the result set appears at different stages in the processing.</p>
<h3 id="stage-1"><a class="markdownIt-Anchor" href="#stage-1">#</a> Stage 1</h3>
<p>These are the results in stage 1, right after data is selected from table T.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m1 ,</span><br><span class="line">  m2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m2</span><br><span class="line">  )</span><br><span class="line">  rules ()</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   KEY M1                   M2</span><br><span class="line">------ -------------------- --------------------</span><br><span class="line">     1 -                    -</span><br><span class="line">     2 -                    -</span><br><span class="line">     3 -                    -</span><br><span class="line">     4 -                    -</span><br><span class="line">     5 -                    -</span><br></pre></td></tr></table></figure>
<h3 id="stage-2"><a class="markdownIt-Anchor" href="#stage-2">#</a> Stage 2</h3>
<p>In this stage rule 1 is applied to the result set.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m1 ,</span><br><span class="line">  m2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m2</span><br><span class="line">  )</span><br><span class="line">  rules sequential <span class="keyword">order</span></span><br><span class="line">  (</span><br><span class="line">    m1[<span class="keyword">any</span>] <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">ASC</span>  <span class="operator">=</span> m1[ cv(key) <span class="operator">-</span> <span class="number">1</span> ] <span class="operator">||</span> <span class="string">&#x27;* &#x27;</span> <span class="comment">-- rule 1</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   KEY M1                   M2</span><br><span class="line">------ -------------------- --------------------</span><br><span class="line">     1 *                    -</span><br><span class="line">     2 * *                  -</span><br><span class="line">     3 * * *                -</span><br><span class="line">     4 * * * *              -</span><br><span class="line">     5 * * * * *            -</span><br></pre></td></tr></table></figure>
<p>Because of the  <code>ORDER BY KEY ASC</code>  clause, cell assignments for rule 1 were performed in this order.</p>
<ul>
<li>m1[1] = m1[0] || '_ ’ == null || '_ ’</li>
<li>m1[2] = m1[1] || '_ ’ == '_ ’ || '* ’</li>
<li>m1[3] = m1[2] || '_ ’ == '_ _ ’ || '_ ’</li>
<li>m1[4] = m1[3] || '_ ’ == '_ * _ ’ || '_ ’</li>
<li>m1[5] = m1[4] || '_ ’ == '_ * * _ ’ || '_ ’</li>
</ul>
<h3 id="stage-3"><a class="markdownIt-Anchor" href="#stage-3">#</a> Stage 3</h3>
<p>In this stage rule 2 is applied.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key ,</span><br><span class="line">  m1 ,</span><br><span class="line">  m2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  key <span class="operator">&lt;=</span> <span class="number">5</span></span><br><span class="line">model</span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures</span><br><span class="line">  (</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m1 ,</span><br><span class="line">    <span class="built_in">cast</span>( <span class="string">&#x27;-&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">20</span>) ) <span class="keyword">as</span> m2</span><br><span class="line">  )</span><br><span class="line">  rules sequential <span class="keyword">order</span></span><br><span class="line">  (</span><br><span class="line">    m1[<span class="keyword">any</span>] <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">ASC</span>  <span class="operator">=</span> m1[ cv(key) <span class="operator">-</span> <span class="number">1</span> ] <span class="operator">||</span> <span class="string">&#x27;* &#x27;</span> , <span class="comment">-- rule 1</span></span><br><span class="line">    m2[<span class="keyword">any</span>] <span class="keyword">ORDER</span> <span class="keyword">BY</span> KEY <span class="keyword">DESC</span> <span class="operator">=</span> m2[ cv(key) <span class="operator">-</span> <span class="number">1</span> ] <span class="operator">||</span> <span class="string">&#x27;* &#x27;</span>   <span class="comment">-- rule 2</span></span><br><span class="line">  )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">   KEY M1                   M2</span><br><span class="line">------ -------------------- --------------------</span><br><span class="line">     1 *                    *</span><br><span class="line">     2 * *                  -*</span><br><span class="line">     3 * * *                -*</span><br><span class="line">     4 * * * *              -*</span><br><span class="line">     5 * * * * *            -*</span><br></pre></td></tr></table></figure>
<p>Because of the  <code>ORDER BY KEY DESC</code>  clause the cell assignments for rule 2 were performed in this order.</p>
<ul>
<li>m2[5] = m2[4] || '_ ’ == ‘-’ || '_ ’</li>
<li>m2[4] = m2[3] || '_ ’ == ‘-’ || '_ ’</li>
<li>m2[3] = m2[2] || '_ ’ == ‘-’ || '_ ’</li>
<li>m2[2] = m2[1] || '_ ’ == ‘-’ || '_ ’</li>
<li>m2[1] = m2[0] || '_ ’ == null || '_ ’</li>
</ul>
<h2 id="return-rows"><a class="markdownIt-Anchor" href="#return-rows">#</a> RETURN ROWS</h2>
<p>In this tutorial we explore the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzEwMTc=">RETURN ROWS</span> component of the MODEL clause. With it you can control whether all rows selected or only those rows updated by model rules are returned by the query.</p>
<h3 id="return-all-rows"><a class="markdownIt-Anchor" href="#return-all-rows">#</a> RETURN ALL ROWS</h3>
<p>RETURN ALL ROWS is the default behaviour for MODEL queries. It causes the query to returns all rows selected whether they were updated by a rule or not.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> key, row_status</span><br><span class="line"><span class="keyword">from</span>   t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">RETURN</span> <span class="keyword">ALL</span> <span class="keyword">ROWS</span></span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="string">&#x27;x&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">10</span>) ) <span class="keyword">as</span> row_status )</span><br><span class="line">  rules        ( row_status[key <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)] <span class="operator">=</span> <span class="string">&#x27;UPDATED&#x27;</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> key ;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY ROW_STATUS</span><br><span class="line">------ ----------</span><br><span class="line">     1 UPDATED</span><br><span class="line">     2 x</span><br><span class="line">     3 UPDATED</span><br><span class="line">     4 x</span><br><span class="line">     5 UPDATED</span><br><span class="line">     6 x</span><br><span class="line">     7 UPDATED</span><br><span class="line">     8 x</span><br><span class="line">     9 x</span><br><span class="line">    10 x</span><br></pre></td></tr></table></figure>
<h3 id="return-updated-rows"><a class="markdownIt-Anchor" href="#return-updated-rows">#</a> RETURN UPDATED ROWS</h3>
<p>RETURN UPDATED ROWS causes the query to return only those rows updated by a rule.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">break <span class="keyword">on</span> group_1 <span class="keyword">skip</span> <span class="number">1</span> duplicates</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> key, row_status</span><br><span class="line"><span class="keyword">from</span>   t</span><br><span class="line">model</span><br><span class="line">  <span class="keyword">RETURN</span> UPDATED <span class="keyword">ROWS</span></span><br><span class="line">  dimension <span class="keyword">by</span> ( key )</span><br><span class="line">  measures     ( <span class="built_in">cast</span>( <span class="string">&#x27;x&#x27;</span> <span class="keyword">as</span> varchar2(<span class="number">10</span>) ) <span class="keyword">as</span> row_status )</span><br><span class="line">  rules        ( row_status[key <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>)] <span class="operator">=</span> <span class="string">&#x27;UPDATED&#x27;</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> key ;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   KEY ROW_STATUS</span><br><span class="line">------ ----------</span><br><span class="line">     1 UPDATED</span><br><span class="line">     3 UPDATED</span><br><span class="line">     5 UPDATED</span><br><span class="line">     7 UPDATED</span><br></pre></td></tr></table></figure>
<h2 id="reference-models"><a class="markdownIt-Anchor" href="#reference-models">#</a> Reference Models</h2>
<p>In this tutorial we explore the concept of reference models within the <span class="exturl" data-url="aHR0cDovL3d3dy5vcmFjbGUuY29tL3Bscy9kYjEwMi90b190b2M/cGF0aG5hbWU9c2VydmVyLjEwMi9iMTQyMDAvc3RhdGVtZW50c18xMDAwMi5odG0jaTIxNzI4MDU=">MODEL</span> clause.</p>
<p>Until now the tutorials in this section have all dealt with a single model, called the main model. Beyond the main model you can create additional multi-dimensional arrays, called reference models, whose cells you can refer to in your main model. Reference models act like read-only lookup tables for your main model. As such, you cannot update or insert cells in a reference model.</p>
<p>Before we look at a reference model example note that, in addition to the table “T” we have used so far we will also use a table called “T3” which looks like this.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> T3;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KEY        NAME</span><br><span class="line">---------- ---------------</span><br><span class="line">a1         Alpha Squad 1</span><br><span class="line">a2         Alpha Squad 2</span><br><span class="line">a3         Alpha Squad 3</span><br></pre></td></tr></table></figure>
<p>Now here is the reference model example.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, group_2, group_2_name</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  REFERENCE T3_REF</span><br><span class="line">    <span class="keyword">ON</span></span><br><span class="line">    (</span><br><span class="line">      <span class="keyword">SELECT</span> KEY, NAME</span><br><span class="line">      <span class="keyword">FROM</span>   T3</span><br><span class="line">    )</span><br><span class="line">    DIMENSION <span class="keyword">BY</span> ( KEY )</span><br><span class="line">    MEASURES     ( NAME )</span><br><span class="line">  main T_MAIN</span><br><span class="line">    dimension <span class="keyword">by</span> ( key )</span><br><span class="line">    measures     ( group_2, <span class="string">&#x27;Undefined Group&#x27;</span> <span class="keyword">as</span> group_2_name )</span><br><span class="line">    rules        ( group_2_name[<span class="keyword">any</span>] <span class="operator">=</span> T3_REF.NAME[ GROUP_2[CV()] ] )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   KEY GROUP_2    GROUP_2_NAME</span><br><span class="line">------ ---------- ---------------</span><br><span class="line">     1 a1         Alpha Squad 1</span><br><span class="line">     2 a2         Alpha Squad 2</span><br><span class="line">     3 a3         Alpha Squad 3</span><br><span class="line">     4 a1         Alpha Squad 1</span><br><span class="line">     5 a2         Alpha Squad 2</span><br><span class="line">     6 a3         Alpha Squad 3</span><br><span class="line">     7 a1         Alpha Squad 1</span><br><span class="line">     8 a2         Alpha Squad 2</span><br><span class="line">     9 a1         Alpha Squad 1</span><br><span class="line">    10 a2         Alpha Squad 2</span><br></pre></td></tr></table></figure>
<h3 id="gotchas-8"><a class="markdownIt-Anchor" href="#gotchas-8">#</a> Gotchas</h3>
<p>If you try to update a reference model cell you will get an error.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  key, group_2, group_2_name</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  t</span><br><span class="line">model</span><br><span class="line">  reference t3_ref</span><br><span class="line">    <span class="keyword">on</span></span><br><span class="line">    (</span><br><span class="line">      <span class="keyword">select</span> key, name</span><br><span class="line">      <span class="keyword">from</span>   t3</span><br><span class="line">    )</span><br><span class="line">    dimension <span class="keyword">by</span> ( key )</span><br><span class="line">    measures     ( name )</span><br><span class="line">  main t_main</span><br><span class="line">    dimension <span class="keyword">by</span> ( key )</span><br><span class="line">    measures     ( group_2, <span class="string">&#x27;Undefined Group&#x27;</span> <span class="keyword">as</span> group_2_name )</span><br><span class="line">    rules        ( T3_REF.NAME[<span class="string">&#x27;a1&#x27;</span>] <span class="operator">=</span> <span class="string">&#x27;Alpha Squad 7&#x27;</span> )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">  key</span><br><span class="line">;</span><br><span class="line">    rules        ( T3_REF.NAME[<span class="string">&#x27;a1&#x27;</span>] <span class="operator">=</span> <span class="string">&#x27;Alpha Squad 7&#x27;</span> )</span><br><span class="line">                   <span class="operator">*</span></span><br><span class="line">ERROR <span class="keyword">at</span> line <span class="number">17</span>:</span><br><span class="line">ORA<span class="number">-00904</span>: : invalid identifier</span><br></pre></td></tr></table></figure>
<h2 id="setup"><a class="markdownIt-Anchor" href="#setup">#</a> Setup</h2>
<p>Run the code on this page in SQL*Plus to create the sample tables, data, etc. used by the examples in this section.</p>
<p>Be sure to read <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTEwMTU0Lmh0bWw=">Using SQL Snippets ™</span> before executing any of these setup steps.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t</span><br><span class="line">(</span><br><span class="line">  key        number(<span class="number">3</span>)    ,</span><br><span class="line">  key_2      varchar2(<span class="number">5</span>)  ,</span><br><span class="line">  group_1    varchar2(<span class="number">7</span>)  ,</span><br><span class="line">  group_2    varchar2(<span class="number">7</span>)  ,</span><br><span class="line">  date_val   <span class="type">date</span>         ,</span><br><span class="line">  num_val    number</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">1</span> , <span class="string">&#x27;T-1&#x27;</span> , <span class="string">&#x27;A&#x27;</span> , <span class="string">&#x27;a1&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2005-01-01&#x27;</span>, <span class="number">100</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">2</span> , <span class="string">&#x27;T-2&#x27;</span> , <span class="string">&#x27;A&#x27;</span> , <span class="string">&#x27;a2&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2005-06-12&#x27;</span>, <span class="number">200</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">3</span> , <span class="string">&#x27;T-3&#x27;</span> , <span class="string">&#x27;A&#x27;</span> , <span class="string">&#x27;a3&#x27;</span> , <span class="keyword">null</span>             , <span class="number">300</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">4</span> , <span class="string">&#x27;T-4&#x27;</span> , <span class="string">&#x27;B&#x27;</span> , <span class="string">&#x27;a1&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2006-02-01&#x27;</span>, <span class="keyword">null</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">5</span> , <span class="string">&#x27;T-5&#x27;</span> , <span class="string">&#x27;B&#x27;</span> , <span class="string">&#x27;a2&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2006-06-12&#x27;</span>, <span class="number">300</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">6</span> , <span class="string">&#x27;T-6&#x27;</span> , <span class="string">&#x27;B&#x27;</span> , <span class="string">&#x27;a3&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2005-01-01&#x27;</span>, <span class="number">100</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">7</span> , <span class="string">&#x27;T-7&#x27;</span> , <span class="string">&#x27;C&#x27;</span> , <span class="string">&#x27;a1&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2006-06-12&#x27;</span>, <span class="number">100</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">8</span> , <span class="string">&#x27;T-8&#x27;</span> , <span class="string">&#x27;C&#x27;</span> , <span class="string">&#x27;a2&#x27;</span> , <span class="keyword">null</span>             , <span class="keyword">null</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">9</span> , <span class="string">&#x27;T-9&#x27;</span> , <span class="keyword">null</span>, <span class="string">&#x27;a1&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2005-02-01&#x27;</span>, <span class="number">200</span>  );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t <span class="keyword">values</span> ( <span class="number">10</span>, <span class="string">&#x27;T-10&#x27;</span>, <span class="keyword">null</span>, <span class="string">&#x27;a2&#x27;</span> , <span class="type">date</span> <span class="string">&#x27;2005-02-01&#x27;</span>, <span class="number">800</span>  );</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">column</span> group_1 format a10</span><br><span class="line"><span class="keyword">column</span> group_2 format a10</span><br><span class="line"><span class="keyword">column</span> num_val format <span class="number">999999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2</span><br><span class="line">(</span><br><span class="line">  key  number(<span class="number">3</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> ( <span class="number">2</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> ( <span class="number">4</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2 <span class="keyword">values</span> ( <span class="number">6</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t3</span><br><span class="line">(</span><br><span class="line">  key  varchar2(<span class="number">10</span>) ,</span><br><span class="line">  name varchar2(<span class="number">15</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">values</span> ( <span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;Alpha Squad 1&#x27;</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">values</span> ( <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;Alpha Squad 2&#x27;</span> );</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">values</span> ( <span class="string">&#x27;a3&#x27;</span>, <span class="string">&#x27;Alpha Squad 3&#x27;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">column</span> key              format <span class="number">99999</span></span><br><span class="line"><span class="keyword">column</span> new_text_measure format a20</span><br><span class="line"></span><br><span class="line"><span class="keyword">column</span> flag              format a4</span><br><span class="line"><span class="keyword">column</span> using_any         format a9</span><br><span class="line"><span class="keyword">column</span> using_is_any      format a12</span><br><span class="line"><span class="keyword">column</span> using_null        format a10</span><br><span class="line"><span class="keyword">column</span> using_is_null     format a13</span><br><span class="line"><span class="keyword">column</span> using_equals_null format a17</span><br></pre></td></tr></table></figure>
<h2 id="cleanup"><a class="markdownIt-Anchor" href="#cleanup">#</a> Cleanup</h2>
<p>Run the code on this page to drop the sample tables, procedures, etc. created in earlier parts of this section. To clear session state changes (e.g. those made by SET, COLUMN, and VARIABLE commands) exit your SQL*Plus session after running these cleanup commands.</p>
<p>Be sure to read <span class="exturl" data-url="aHR0cHM6Ly93d3cuc3Fsc25pcHBldHMuY29tL2VuL3RvcGljLTEwMTU0Lmh0bWw=">Using SQL Snippets ™</span> before executing any of these setup steps.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t  ;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t2 ;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t3 ;</span><br><span class="line"></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

      <div class="tags">
          <a href="/tags/db/" rel="tag"><i class="ic i-tag"></i> db</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-01-05 19:25:48" itemprop="dateModified" datetime="2024-01-05T19:25:48+08:00">2024-01-05</time>
  </span>
</div>

      

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2023/10/20/edi-sscc-18-barcodes/" itemprop="url" rel="prev" data-background-image="&#x2F;anime&#x2F;index&#x2F;秒速五厘米.jpg" title="SSCC-18 Barcodes">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>SSCC-18 Barcodes</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/01/09/oralce-practice/" itemprop="url" rel="next" data-background-image="&#x2F;anime&#x2F;index&#x2F;七大罪.jpg" title="Oracle SQL Practice">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Oracle SQL Practice</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#model-clause"><span class="toc-number">1.</span> <span class="toc-text"> MODEL Clause</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dimension-by"><span class="toc-number">2.</span> <span class="toc-text"> DIMENSION BY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#multiple-dimensions"><span class="toc-number">2.1.</span> <span class="toc-text"> Multiple Dimensions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aliasing"><span class="toc-number">2.2.</span> <span class="toc-text"> Aliasing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uniqueness"><span class="toc-number">2.3.</span> <span class="toc-text"> Uniqueness</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#measures"><span class="toc-number">3.</span> <span class="toc-text"> MEASURES</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dimension-and-measure-restrictions"><span class="toc-number">4.</span> <span class="toc-text"> Dimension and Measure Restrictions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas"><span class="toc-number">4.1.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basic-rules-and-cell-assignments"><span class="toc-number">5.</span> <span class="toc-text"> Basic Rules and Cell Assignments</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#basic-rules"><span class="toc-number">5.1.</span> <span class="toc-text"> Basic Rules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cell-assignments"><span class="toc-number">5.2.</span> <span class="toc-text"> Cell Assignments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-2"><span class="toc-number">5.3.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#for-loops"><span class="toc-number">6.</span> <span class="toc-text"> FOR Loops</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#multiple-dimensions-2"><span class="toc-number">6.1.</span> <span class="toc-text"> Multiple Dimensions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for-versus-in"><span class="toc-number">6.2.</span> <span class="toc-text"> FOR versus IN</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#expressions-and-cell-references"><span class="toc-number">7.</span> <span class="toc-text"> Expressions and Cell References</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#expressions"><span class="toc-number">7.1.</span> <span class="toc-text"> Expressions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cell-references"><span class="toc-number">7.2.</span> <span class="toc-text"> Cell References</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unique-single-refernce"><span class="toc-number">7.3.</span> <span class="toc-text"> UNIQUE SINGLE REFERNCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-3"><span class="toc-number">7.4.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-cv-function"><span class="toc-number">8.</span> <span class="toc-text"> The CV() Function</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-4"><span class="toc-number">8.1.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#partiton-by"><span class="toc-number">9.</span> <span class="toc-text"> PARTITON BY</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#performance"><span class="toc-number">9.1.</span> <span class="toc-text"> Performance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uniqueness-of-dimension-columns"><span class="toc-number">9.2.</span> <span class="toc-text"> Uniqueness of Dimension Columns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aggregate-and-analytic-functions"><span class="toc-number">9.3.</span> <span class="toc-text"> Aggregate and Analytic Functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aggregate-and-analytic-functions-2"><span class="toc-number">10.</span> <span class="toc-text"> Aggregate and Analytic Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#aggregate-example"><span class="toc-number">10.0.0.1.</span> <span class="toc-text"> Aggregate Example</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#analytic-example"><span class="toc-number">10.0.0.2.</span> <span class="toc-text"> Analytic Example</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rules"><span class="toc-number">10.1.</span> <span class="toc-text"> RULES</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aggregate-and-analytic-expressions"><span class="toc-number">11.</span> <span class="toc-text"> Aggregate and Analytic Expressions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#partition-by-and-aggregate-functions"><span class="toc-number">11.1.</span> <span class="toc-text"> PARTITION BY and Aggregate Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partition-by-and-analytic-functions"><span class="toc-number">11.2.</span> <span class="toc-text"> PARTITION BY and Analytic Functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#missing-cells-upsert"><span class="toc-number">12.</span> <span class="toc-text"> Missing Cells - UPSERT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-5"><span class="toc-number">12.1.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#missing-cells-upsert-all"><span class="toc-number">13.</span> <span class="toc-text"> Missing Cells - UPSERT ALL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#existential-predicates"><span class="toc-number">13.1.</span> <span class="toc-text"> Existential Predicates</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#missing-cells-update"><span class="toc-number">14.</span> <span class="toc-text"> Missing Cells - UPDATE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#missing-cells-right-side"><span class="toc-number">15.</span> <span class="toc-text"> Missing Cells - Right Side</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ignore-nav"><span class="toc-number">15.1.</span> <span class="toc-text"> IGNORE NAV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#is-present-presentv-and-presentnnv"><span class="toc-number">15.2.</span> <span class="toc-text"> IS PRESENT, PRESENTV, and PRESENTNNV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#acknowledgements"><span class="toc-number">15.3.</span> <span class="toc-text"> Acknowledgements</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#iterate"><span class="toc-number">16.</span> <span class="toc-text"> ITERATE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#until"><span class="toc-number">16.1.</span> <span class="toc-text"> UNTIL()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#previous"><span class="toc-number">16.2.</span> <span class="toc-text"> PREVIOUS()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iteration_number"><span class="toc-number">16.3.</span> <span class="toc-text"> ITERATION_NUMBER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#partition-by"><span class="toc-number">16.4.</span> <span class="toc-text"> PARTITION BY</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-6"><span class="toc-number">16.5.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sequential-and-automatic-order"><span class="toc-number">17.</span> <span class="toc-text"> SEQUENTIAL and AUTOMATIC ORDER</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sequential-order"><span class="toc-number">17.1.</span> <span class="toc-text"> SEQUENTIAL ORDER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#automatic-order"><span class="toc-number">17.2.</span> <span class="toc-text"> AUTOMATIC ORDER</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multiple-cell-assignments"><span class="toc-number">17.3.</span> <span class="toc-text"> Multiple Cell Assignments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-7"><span class="toc-number">17.4.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ordered-rules"><span class="toc-number">18.</span> <span class="toc-text"> Ordered Rules</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stage-1"><span class="toc-number">18.1.</span> <span class="toc-text"> Stage 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stage-2"><span class="toc-number">18.2.</span> <span class="toc-text"> Stage 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stage-3"><span class="toc-number">18.3.</span> <span class="toc-text"> Stage 3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#return-rows"><span class="toc-number">19.</span> <span class="toc-text"> RETURN ROWS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#return-all-rows"><span class="toc-number">19.1.</span> <span class="toc-text"> RETURN ALL ROWS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#return-updated-rows"><span class="toc-number">19.2.</span> <span class="toc-text"> RETURN UPDATED ROWS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reference-models"><span class="toc-number">20.</span> <span class="toc-text"> Reference Models</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gotchas-8"><span class="toc-number">20.1.</span> <span class="toc-text"> Gotchas</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup"><span class="toc-number">21.</span> <span class="toc-text"> Setup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cleanup"><span class="toc-number">22.</span> <span class="toc-text"> Cleanup</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="江边鸟"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">江边鸟</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">378</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">2</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">51</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xoY2hlbjc0" title="https:&#x2F;&#x2F;github.com&#x2F;lhchen74"><i class="ic i-github"></i></span>
      <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;"><i class="ic i-cloud-music"></i></span>
      <span class="exturl item codepen" data-url="aHR0cHM6Ly9jb2RlcGVuLmlvL2xoY2hlbjc0" title="https:&#x2F;&#x2F;codepen.io&#x2F;lhchen74"><i class="ic i-address-card"></i></span>
      <span class="exturl item anki" data-url="aHR0cHM6Ly9hbmtpd2ViLm5ldC9kZWNrcy8=" title="https:&#x2F;&#x2F;ankiweb.net&#x2F;decks&#x2F;"><i class="ic i-address-card"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>About</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/friends/" rel="section"><i class="ic i-heart"></i>Friends</a>
  </li>

    
  <li class="item">
    <a href="/anime/" rel="section"><i class="ic i-magic"></i>Anime</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2023/10/20/edi-sscc-18-barcodes/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/01/09/oralce-practice/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">江边鸟 @ D E W</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/01/05/oracle-model-clause/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
